{"version":3,"names":["CacheManager","constructor","this","cacheKey","cacheTimeout","debounceTimeout","debounceDelay","isLocalStorageAvailable","test","localStorage","setItem","removeItem","e","console","warn","saveData","data","clearTimeout","setTimeout","cacheData","timestamp","Date","now","version","JSON","stringify","log","toLocaleString","error","loadData","cachedData","getItem","parse","clearCache","isCacheValid","VE","Endklemmen","Schrauben","Dachhaken","Mittelklemmen","Endkappen","Schienenverbinder","Schiene_240_cm","Schiene_360_cm","Solarmodul","UlicaSolarBlackJadeFlow","SolarmodulPalette","UlicaSolarBlackJadeFlowPalette","MC4_Stecker","Solarkabel","Holzunterleger","Ringkabelschuhe","BlechBohrschrauben","Kabelbinder","Erdungsband","Tellerkopfschraube","HuaweiOpti","BRCOpti","PRICE_MAP","getPackPriceForQuantity","productKey","requiredPieces","basePackPrice","getPriceFromCache","amount","Number","isFinite","PRODUCT_MAP","productId","variantId","PRODUCT_NAME_MAP","PRODUCT_IMAGES","calculationManager","worker","pendingCalculations","Map","calculationId","isWorkerReady","initWorker","Worker","onmessage","type","id","has","resolve","get","delete","reject","Error","message","onerror","cleanup","terminate","clear","calculate","Promise","set","postMessage","calculateSync","calculatePartsSync","calculateExtendedPartsSync","selection","rows","cols","cellWidth","cellHeight","orientation","options","parts","y","Array","isArray","run","x","processGroupSync","len","totalLen","floor360","Math","floor","rem360","variants","cnt360","cnt240","ceil","map","v","rails","waste","minRails","min","best","filter","reduce","a","b","ulicaModule","includeModules","mc4Connectors","panelCount","flat","length","veMc4","packs","solarkabel","woodUnderlay","erdungsband","destroy","SolarPDFGenerator","solarGrid","jsPDF","window","jspdf","html2canvas","html2pdf","companyLogoUrl","headerLogoBlueUrl","isTouchDevice","ua","navigator","userAgent","touchUA","hasTouch","maxTouchPoints","_","isAvailable","generatePDFFromSnapshot","snapshot","showToast","configs","renderSnapshotIntoPdfTemplate","rootEl","document","getElementById","prevStyle","getAttribute","style","position","left","top","opacity","pointerEvents","zIndex","background","container","images","from","querySelectorAll","all","img","complete","naturalWidth","done","addEventListener","once","waitForImages","r","requestAnimationFrame","pages","pdf","unit","format","i","pageEl","width","height","boxSizing","canvas","scale","backgroundColor","useCORS","allowTaint","logging","w","h","imgData","toDataURL","addPage","addImage","fileName","generateFileName","blob","output","url","URL","createObjectURL","open","revokeObjectURL","save","setAttribute","err","root","innerHTML","dateStr","toLocaleDateString","config","page","createElement","className","minHeight","padding","name","selectedCells","gridImg","captureGridVisualizationFromSnapshot","querySelector","src","productsPage","pdfTotalPriceEl","renderProductsIntoTable","htmlLayout","excludeAdditionalProducts","tbody","trim","productPages","parentNode","appendChild","paginateProductsPage","pageHeight","getBoundingClientRect","totalBlockTemplate","totalReservePx","prev","display","tbRect","tableBody","tableHead","allRows","makeSkeleton","clone","cloneNode","bd","tb","first","replaceChild","pagesArr","idx","currentPage","curBody","currentRect","contentLimitBottom","row","bottom","removeChild","nextPage","push","forEach","p","makeFooter","footer","right","color","alignItems","justifyContent","fontSize","textContent","alt","pagesToAppend","children","some","ch","additionalParts","computeAdditionalProductsForSnapshot","Object","keys","k","dateStr2","additionalPage","pdfAddTotalEl","renderAdditionalProductsIntoTable","tbodyEl","totalEl","calculatePartsFromSnapshot","ulicaSelected","keyPiece","keyPallet","count","pallets","remainder","totalPrice","ADDITIONAL_KEYS","Set","key","value","entries","ve","rowPrice","sort","localeCompare","productName","replace","toFixed","join","anyMc4","c","mc4","anyCable","cable","anyWood","wood","holz","anyQuetsch","quetschkabelschuhe","totalSelectedCells","sum","Boolean","result","max","hCb","bCb","qEl","qty","parseInt","checked","generatePDF","mode","fullSnapshot","createConfigSnapshot","snapshotToExport","currentConfigIndex","only","totalConfigs","addHeader","pageWidth","setTextColor","setFontSize","setFont","text","getInvertedLogoBase64","originalBase64","_invertedLogoBase64Promise","Image","onload","ctx","getContext","drawImage","imageData","getImageData","putImageData","addFooter","footerY","setFillColor","rect","logoBase64","loadImageAsBase64","invertedLogoBase64","logoHeight","logoWidth","logoX","logoY","crossOrigin","naturalHeight","imageSmoothingEnabled","calculateTotalPriceFromSnapshot","pricePerPack","addConfigurationToPDFFromSnapshot","isFirstPage","positionRef","checkPageBreak","async","neededSpace","setDrawColor","setLineWidth","gridImage","maxHeight","targetWidth","computedHeight","round","centerX","centerY","addProductTableFromSnapshot","totalText","captureGridVisualization","tempContainer","body","cellSize","cellGap","gridEl","gap","gridTemplateColumns","gridTemplateRows","border","borderRadius","normalizedSelection","cell","isSelected","offsetWidth","offsetHeight","captureGridImageForWebhook","configData","isVertical","baseCellSize","boxShadow","transition","pattern","gridLines","backgroundImage","backgroundSize","totalWidth","totalHeight","fillStyle","fillRect","startX","startY","cellX","cellY","strokeStyle","lineWidth","strokeRect","lineX","beginPath","moveTo","lineTo","stroke","lineY","base64Image","canvasWidth","canvasHeight","dataURLLength","dataURLStart","substring","maxWidthPx","maxHeightPx","modW","modH","orientVertical","unitW","unitH","baseGap","wrapperPadding","rawW","rawH","cellW","cellH","tempRoot","canvasLike","overflow","grid","yPosition","roundedRect","rowCount","quantity","packsNeeded","totalForProduct","align","line","calculationData","incM","calculatePartsDirectly","MC4","kabelbinder","calculateErdungsband","pieceKey","palletKey","addProductTable","calculateConfigParts","needed","totalProductPrice","toString","moduleCount","toISOString","slice","timeStr","toTimeString","configName","SmartConfigParser","patterns","gridSize","moduleCountAlt","moduleCheckbox","rowPattern","rowsOnly","spacing","gridCompact","gridSpaced","checkboxCombination","saveConfig","deleteConfig","deleteModules","newConfig","deleteAllConfigs","resetGrid","distributionEqual","distributionRows","distributionColumns","distributionRandom","spacingDouble","spacingRowsOnly","spacingColumnsOnly","selectRowsExplicit","gapRowsExplicit","selectColumnsExplicit","gapColumnsExplicit","allRowsExcept","allColumnsExcept","clearTopRow","clearBottomRow","fillFirstNColumns","clearFirstNColumns","clearLastNColumns","fillFirstNRows","clearFirstNRows","fillLastNRows","clearLastNRows","fillOnlyFrame","fillBlock","fillBlockRelative","checkboxAllExcept","checkboxOnly","checkboxWithout","checkboxWithAll","allSimple","saveWithName","addModulesWatt","addComponents","parseWordNumber","word","wordNumbers","ein","eine","zwei","drei","vier","sechs","sieben","acht","neun","zehn","toLowerCase","parseCheckboxCombinations","input","checkboxes","modules","split","includes","part","trimmedPart","parseInput","m","match","forceClearSelection","gridMatch","spacingMatch","spacingDoubleMatch","spacingRows","adjustSpacing","targetCols","targetRows","actualRows","totalCells","rowConfig","modulesPerRow","totalModules","gridCompactMatch","gridSpacedMatch","rowMatch","spacingOnlyMatch","spacingDoubleOnlyMatch","numRows","intelligentDistribution","baseModulesPerRow","extraModules","neededRows","distributionEqualMatch","distributionRowsMatch","distributionColumnsMatch","distributionRandomMatch","suppressAutoSelection","deprecatedNotice","distribution","moduleMatch","moduleAlt","spacingRowsOnlyMatch","spacingColumnsOnlyMatch","calculateOptimalGrid","optimalRows","sqrt","rowsOnlyMatch","isInteger","clearFrame","insideAreaMatch","parseRangeList","str","tokens","s","out","t","start","end","n","selectAreaRows","selectAreaCols","fillLeftHalf","clearRightHalf","everySecondMatch","everySecondRowsStart","orientationMatch","checkboxAllExceptMatch","checkboxOnlyMatch","checkboxWithoutMatch","checkboxWithAllMatch","exceptWord","exceptItem","onlyItems","items","item","checkboxCombinations","values","moduleCheckboxMatch","mc4Match","cableMatch","woodMatch","quetschkabelschuheMatch","kabelbinderMatch","ulicaMatch","watt","selectedModule","list","saveWithNameMatch","action","allRowsExceptMatch","maxRows","base","except","add","selectRows","allColumnsExceptMatch","maxCols","selectColumns","selectRowsMatch","rowsString","numbers","gapRowsMatch","gapRows","selectColsMatch","colsString","gapColsMatch","gapColumns","fillFirstN","clearFirstN","clearLastN","blockMatch","startRow","startCol","blockRel","fromBottom","fromRight","fillFirstRows","clearFirstRows","fillLastRows","clearLastRows","useCurrentGrid","factors","applyConfiguration","oldSelection","oldCols","oldRows","orV","orH","orientHBtn","orientVBtn","classList","toggle","handleAction","hasOwnProperty","moduleSelect","handleModuleSelectChange","updateAllConfigurationsForCheckboxes","gridSizeChanged","hasExplicitOps","newSelection","updateSize","buildGrid","buildList","updateSummaryOnChange","adjustGridSpacing","applyRowConfiguration","ensureRow","row1Based","col1Based","endX","endY","isFrame","y0","x0","prohibitedCols","allowedPerRow","size","neededColsIfExpand","placed","outer","distributeModules","autoSelectModules","hideHelpAfterFirstUse","applyPreviewToMainGrid","hidePreviewGrid","showMainGrid","renameCurrentConfig","saveNewConfig","currentConfig","clearModuleSelection","resetGridToDefault","resetAllConfigurations","helpSection","expandGridForModules","selected","targetCount","newCols","newRows","spacingConfig","occupiedRows","originalRow","maxModuleX","currentTargetRow","occupiedRow","moduleX","neededCols","expandGridForRowConfig","currentRow","modulesPlaced","rowIndex","modulesInThisRow","placeRowWise","rowCounts","extra","cells","j","random","BulkSelector","firstClick","isSelecting","bulkMode","isDragging","dragStart","mousePressed","setupKeyListener","setupGlobalMouseEvents","toggleBulkMode","showBulkModeIndicator","clearHighlight","active","el","remove","indicator","cssText","head","initializeBulkSelection","originalBuildGrid","bind","addBulkSelectionToGrid","index","newCell","preventDefault","handleDragStart","highlightRange","handleDragEnd","ctrlKey","metaKey","trackInteraction","updateConfig","updateConfigList","selectRange","minX","maxX","minY","maxY","shouldSelect","wasSelected","isSelectMode","undefined","resetDragState","calculateRangeSize","clearFirstClickMarker","getClampedCellFromPointer","event","gridRect","point","touches","changedTouches","clientX","clientY","relativeX","relativeY","colWidth","rowHeight","isCurrentlySelected","endCell","passive","SimpleCartQueue","isProcessing","execute","operation","operationName","SolarGrid","readExtrasFromSummaryList","extras","lastExtras","findQtyForLabel","label","find","it","String","firstSpan","bundleTotalModulesIntoPallets","total","single450Key","single500Key","pallet450Key","pallet500Key","count450","count500","makeBundle","singleCount","single","res450","res500","wrapper","wIn","hIn","totalPartsCache","listHolder","prodList","saveBtn","addBtn","summaryBtn","configListEl","resetBtn","continueLaterBtn","moduleData","moduleCheckboxMapping","default","updateTimeout","updateDelay","isAddingToCart","webflowFormsObserver","cartAckObserver","cartAckResolve","resizeObserver","resizeTimeout","zoomLevel","minZoom","maxZoom","zoomObserver","performanceMetrics","gridRenderTime","updateTime","memoryUsage","fps","errorCount","sessionId","generateSessionId","sessionStartTime","firstInteractionTime","lastInteractionTime","interactionCount","webhookUrl","pdfGenerator","cacheManager","loadingOverlay","loadingTextEl","init","saveToUrl","showLoading","hideLoading","substr","formatDuration","milliseconds","totalSeconds","hours","minutes","seconds","padStart","getSessionData","sessionDurationMs","timeToFirstInteractionMs","timeSinceLastInteractionMs","sessionDuration","timeToFirstInteraction","timeSinceLastInteraction","getProductSummary","calculateParts","productQuantities","price","generateGridVisualization","html","css","getConfigData","targetConfig","parseFloat","summary","gridVisualization","allProductQuantities","Schiene240cm","Schiene360cm","productQuantitiesCompact","fromEntries","selectedCoords","selectionMeta","selectedCount","totalPriceFromCompact","veKey","sessionData","analytics","selectionPercentage","gridArea","averageCellSize","sendConfigToWebhook","minimalPayload","session","duration","interactions","configIndex","totalConfigsInSession","meta","fetch","method","headers","ok","sendCurrentConfigToWebhook","sendAllConfigsToWebhook","results","successCount","cfg","originalSelection","originalOrientation","originalSolarkabel","originalIncM","originalMc4","originalHolz","success","checkMobileDevice","innerWidth","redirectToDesktopSite","disableMobileFunctionality","mainContainer","stopPropagation","redirectMessage","location","href","maybeShowIntroOverlay","cacheLoaded","hasUrlConfig","overlay","closeBtn","okBtn","close","target","closest","activeElement","loadFromCache","rawData","URLSearchParams","search","json","decodeURIComponent","atob","loadConfig","setupAllEventListeners","addCurrentToCart","addAllToCart","generateContinueLink","initSidebarNavigation","setup","defaultConfig","_makeConfigObject","setupResizeObserver","setupPinchToZoom","initSmartConfigFeatures","initAutoSaveIndicator","initConfigList","backToOverviewBtn","showOverview","editConfigBtn","editConfigName","deleteConfigBtn","deleteCurrentConfig","expressCheckoutBtn","addAllConfigsToCart","nextConfigBtn","ev","addConfigBtn","detailView","overviewView","clearAllInputFields","titleEl","nameEl","contains","initAdditionalProductsListeners","showDetailView","updateDetailView","updateCurrentTotalPrice","totalPriceEl","calculateConfigPrice","section","subtitle","disclaimer","marginTop","lineHeight","textAlign","renderConfigList","updateOverviewTotalPrice","renderAdditionalProducts","autoSaveTimeout","showAutoSaveIndicator","saveIcon","animation","totals","computeAllTotalsSnapshot","pricePerUnit","calculateAdditionalProductsPrice","additionalProductsListEl","packagesNeeded","checkboxId","checkbox","saveToCache","syncDisplayAndUpdate","focus","select","saveEdit","newName","cancelEdit","editConfigNameInList","configItem","evt","alert","confirm","splice","deleteConfigFromList","processGroupDirectly","partName","pricePerPackage","smartParser","bulkSelector","ensurePermanentVisibility","initSmartConfigCloseButton","initQuickConfigInterface","usageTips","checkAndHideHelp","closeButton","initSmartConfig","quickInput","newQuickInput","previewTimeout","updateInputValidation","showConfigPreview","self","clearGridPreview","initializeSmartConfigHelp","readyState","inputElement","showGridPreview","trigger","dropdown","isHovered","hoverTimeout","hideDropdown","visibility","transform","example","scrollIntoView","behavior","block","oldSel","updateSaveButtons","removeEventListener","handleInputChange","handleOrientationChange","syncOrientationButtons","handleCheckboxChange","boundExpansionClick","handleExpansionClick","btn","boundOrientationClick","handleOrientationButtonClick","ensureOrientationButtonsSync","isVerticalActive","isHorizontalActive","radioVerticalChecked","radioHorizontalChecked","selectedValue","enableInputs","clearModuleCheckboxes","module","disableInputs","handleModuleCheckboxChange","dir","dataset","isPlus","addColumnRight","removeColumnRight","addColumnLeft","removeColumnLeft","addRowTop","removeRowTop","addRowBottom","removeRowBottom","orientationProcessing","clickedBtn","currentTarget","disabled","cursor","updateGridAfterStructureChange","pop","unshift","shift","fill","getComputedStyle","documentElement","inputW","inputH","originalCellW","originalCellH","maxWidth","clientWidth","clientHeight","scaleX","scaleY","visualGap","setProperty","finalWidth","finalHeight","fragment","createDocumentFragment","click","itemTotal","div","itemDetails","itemVE","erdungsbandtotal","defaultVertical","orientHSetup","orientVSetup","dispatchEvent","Event","resetToDefaultGrid","colsIn","rowsIn","processGroup","mapImage","moduleHeight","erdungsbandMatrix","analyzeFieldForErdungsband","assignErdungsbandLength","checkLeftFieldsErdungsband","leftUpper","leftLower","checkLeftFieldsRecursive","checkX","loadConfigFromCache","loadFirstConfigFromCache","updateFirstConfigOrientation","globalOrientation","toast","toastTimeout","customName","emptySelection","newIndex","createNewConfig","keepCols","keepRows","emptySel","nextNumber","canDelete","arraysEqual","startTime","performance","recomputeTotalsDebounced","snap","saveTotalsToCache","manageCacheSize","deepCloneSelection","sel","deepCloneConfig","huaweiOpti","brcOpti","optiQty","moduleSelectValue","gridStructure","safeIndex","generateHiddenCartForms","webflowForms","webflowFormMap","webflowFormMapBrutto","form","skuId","bruttoKey","PRODUCT_MAP_BRUTTO","info","hideWebflowForms","initFoxyFormMap","foxyFormsByName","attemptsLeft","tryScan","refreshFoxyFormMap","_foxyObserver","disconnect","debounceTimer","lastMutationTime","debounced","MutationObserver","mutations","addedNodes","observe","childList","subtree","getVal","nameInput","val","code","image","description","weight","foxyDataByName","findFoxyFormByName","wanted","normalize","CSS","escape","forms","nWanted","addProductToCart","displayName","_ensureFoxySilentTarget","tempForm","submit","qtyInput","customerInput","raw","parsed","submitBtn","requestSubmit","iframe","_waitForFoxyIframeAck","timeoutMs","settled","onLoad","clickWebflowButtonSafely","button","isLastItem","addPartsListToCart","loadTotalsFromCache","aKey","bKey","sanitizePrice","num","sleep","ms","getData","qtyRaw","numQty","d","params","append","coupon","foxyUrl","link","isSingleModule","addSingleItemAndWait","isLast","mappedForm","ensureWebflowFormsMapped","getCartProductInfo","waitForAck","waitForCartAcknowledge","ensureCartObservers","timer","hideCartContainer","cartContainer","showCartContainer","isCartActuallyOpen","cs","dialog","dcs","isVisible","ps","parentElement","offsetParent","getClientRects","tryOpen","attempt","selectorUnion","candidates","openBtn","_buildPartsFor","itemCount","then","simpleCartQueue","configSnapshot","allBundles","currentParts","totalItemCount","isolatedGrid","calculatePartsIsolated","calculateErdungsbandIsolated","palletCount","remainingPieces","dachhakenCount","schienenCount","_buildCartItems","getCurrentConfigData","targetSelection","targetOrientation","targetIncM","targetMc4","targetCable","targetWood","targetQuetschkabelschuhe","targetErdungsband","targetUlicaModule","targetCellWidth","targetCellHeight","isolatedConfig","getAllConfigsData","originalPreviewState","createPreviewGrid","hideMainGrid","showPreviewGrid","mainGrid","previewGrid","previewCols","previewRows","previewSelection","createModuleSelection","hasSpacing","colIndex","newRowIndex","oldRow","col","buildPreviewGrid","ResizeObserver","initialDistance","initialZoom","getTouchDistance","newZoom","setZoom","touch1","touch2","dx","dy","transformOrigin","_recomputeTotalsTimer","cleanupEventListeners","cleanupDOMReferences","cleanupWorkers","handleGridClick","cleanupArrays","MAX_CACHE_SIZE","MAX_CACHE_AGE","getTime","gc","originalSel","originalRows","originalCols","originalOrV","totalErdungsband","ulicaEnabled","sendTotals","groupCollapsed","table","groupEnd","clip","whiteSpace","highestTimeoutId","highestIntervalId","setInterval","clearInterval","debugFoxy"],"sources":["script.js"],"sourcesContent":["(function() {\n  const ADD_TO_CART_DELAY = 400;\n  // Global debug toggle: disable noisy logs in production\n  const DEBUG_MODE = true;\n  if (!DEBUG_MODE) {\n    // In Produktion: laute Debug-Logs stummschalten, Warnungen/Fehler beibehalten\n    try {\n      const noop = function(){};\n      if (typeof console !== 'undefined') {\n        console.log = noop;\n        console.info = noop;\n        console.debug = noop;\n      }\n    } catch (e) {\n      // Ignorieren – falls Konsole nicht überschreibbar ist\n    }\n  }\n  \n  // Cache-Manager für 24h Persistierung\n  class CacheManager {\n    constructor() {\n      this.cacheKey = 'solarTool_continueCache';\n      this.cacheTimeout = 24 * 60 * 60 * 1000; // 24 Stunden\n      this.debounceTimeout = null;\n      this.debounceDelay = 500; // 500ms Delay für Performance\n    }\n    \n    // Prüfe ob localStorage verfügbar ist\n    isLocalStorageAvailable() {\n      try {\n        const test = '__localStorage_test__';\n        localStorage.setItem(test, test);\n        localStorage.removeItem(test);\n        return true;\n      } catch (e) {\n        console.warn('localStorage nicht verfügbar:', e);\n        return false;\n      }\n    }\n    \n    // Speichere Daten mit Debouncing\n    saveData(data) {\n      if (!this.isLocalStorageAvailable()) {\n        console.warn('localStorage nicht verfügbar - Cache wird nicht gespeichert');\n        return;\n      }\n      \n      // Debounce für Performance\n      if (this.debounceTimeout) {\n        clearTimeout(this.debounceTimeout);\n      }\n      \n      this.debounceTimeout = setTimeout(() => {\n        try {\n          const cacheData = {\n            ...data,\n            timestamp: Date.now(),\n            version: '1.0' // Für zukünftige Kompatibilität\n          };\n          \n          localStorage.setItem(this.cacheKey, JSON.stringify(cacheData));\n          console.log('Cache gespeichert:', new Date().toLocaleString());\n        } catch (error) {\n          console.error('Fehler beim Speichern des Caches:', error);\n        }\n      }, this.debounceDelay);\n    }\n    \n    // Lade Daten aus dem Cache\n    loadData() {\n      if (!this.isLocalStorageAvailable()) {\n        console.warn('localStorage nicht verfügbar - Cache wird nicht geladen');\n        return null;\n      }\n      \n      try {\n        const cachedData = localStorage.getItem(this.cacheKey);\n        if (!cachedData) {\n          console.log('Kein Cache gefunden');\n          return null;\n        }\n        \n        const data = JSON.parse(cachedData);\n        const cacheAge = Date.now() - data.timestamp;\n        \n        // Prüfe Cache-Alter\n        if (cacheAge > this.cacheTimeout) {\n          console.log('Cache ist abgelaufen (24h) - wird gelöscht');\n          this.clearCache();\n          return null;\n        }\n        \n        console.log('Cache geladen:', new Date().toLocaleString());\n        return data;\n      } catch (error) {\n        console.error('Fehler beim Laden des Caches:', error);\n        this.clearCache();\n        return null;\n      }\n    }\n    \n    // Lösche Cache\n    clearCache() {\n      try {\n        localStorage.removeItem(this.cacheKey);\n        console.log('Cache gelöscht');\n      } catch (error) {\n        console.error('Fehler beim Löschen des Caches:', error);\n      }\n    }\n    \n    // Prüfe Cache-Alter\n    isCacheValid() {\n      const data = this.loadData();\n      return data !== null;\n    }\n  }\n  \n  // Zentrale Produkt-Konfiguration (direkt eingebettet)\n  const VE = {\n    Endklemmen: 20,\n    Schrauben: 50,\n    Dachhaken: 20,\n    Mittelklemmen: 20,\n    Endkappen: 50,\n    Schienenverbinder: 10,\n    Schiene_240_cm: 1,\n    Schiene_360_cm: 1,\n    Solarmodul: 1,\n    UlicaSolarBlackJadeFlow: 1,\n    // Neue 36er-Paletten (VE = 36 Stück pro Palette)\n    SolarmodulPalette: 36,\n    UlicaSolarBlackJadeFlowPalette: 36,\n    MC4_Stecker: 50,\n    Solarkabel: 1,\n    Holzunterleger: 50,\n    Ringkabelschuhe: 100,\n    BlechBohrschrauben: 100,\n    Kabelbinder: 100,\n    Erdungsband: 1,\n    Tellerkopfschraube: 100,\n    HuaweiOpti: 1,\n    BRCOpti: 1\n  };\n  \n  const PRICE_MAP = {\n    // VK pro VE (Fallbackpreise)\n    Solarmodul: 59.70,\n    UlicaSolarBlackJadeFlow: 67.90,\n    // Paletten-Fallbackpreise (Netto) – falls Collection Price nicht gefunden wird\n    SolarmodulPalette: 2012.40, // 36x Ulica 450 W – Palette\n    UlicaSolarBlackJadeFlowPalette: 2264.40, // 36x Ulica 500 W – Palette\n    Endklemmen: 19.80,\n    Schrauben: 11.00,\n    Dachhaken: 69.00,\n    Mittelklemmen: 19.80,\n    Endkappen: 7.00,\n    Schienenverbinder: 13.00,\n    Schiene_240_cm: 11.99,\n    Schiene_360_cm: 17.49,\n    MC4_Stecker: 39.50,\n    Solarkabel: 86.90,\n    Holzunterleger: 17.50,\n    Ringkabelschuhe: 21.40,\n    BlechBohrschrauben: 24.70,\n    Kabelbinder: 3.41,\n    Erdungsband: 8.70,\n    Tellerkopfschraube: 26.00,\n    HuaweiOpti: 39.68,\n    BRCOpti: 38.53\n  };\n\n  function convertToNettoPrice(amount) {\n    return Number.isFinite(amount) ? amount : 0;\n  }\n\n  // Kundentyp-System entfernt - vereinfachte Produktverwaltung\n\n  function getCartProductInfo(productKey) {\n    // Nur noch ein Produkt-Mapping - Kundentyp existiert nicht mehr\n    return PRODUCT_MAP[productKey];\n  }\n\n\n  // Liefert den wirksamen VE-Preis (Packpreis) - nur noch Shop-Preise ohne Mengenrabatte\n  function getPackPriceForQuantity(productKey, requiredPieces) {\n    const basePackPrice = getPriceFromCache(productKey) || 0;\n    // Immer Netto-Preise verwenden für Konfigurator-Anzeige\n    return convertToNettoPrice(basePackPrice);\n  }\n\n  const PRODUCT_MAP = {\n    Solarmodul: { productId:'685003af0e41d945fb0198d8', variantId:'685003af4a8e88cb58c89d46' },\n    UlicaSolarBlackJadeFlow: { productId:'689455ed543f0cbb26ba54e9', variantId:'689455ed7d7ddfd326d5dbf9' },\n    // Neue Paletten (ohne MwSt – für Privatkunden)\n    // 450 W ganze Palette\n    SolarmodulPalette: { productId: '68b999a74abecff30536dee0', variantId: '68b999a873f9b0df7954ed8b' },\n    // 500 W ganze Palette\n    UlicaSolarBlackJadeFlowPalette: { productId: '68b99932fb8af7a115bb2680', variantId: '68b999339e25d980ba33928d' },\n    Endklemmen: { productId:'6853c34fe99f6e3d878db38b', variantId:'6853c350edab8f13fc18c1b9' },\n    Schrauben: { productId:'6853c2782b14f4486dd26f52', variantId:'6853c2798bf6755ddde26a8e' },\n    Dachhaken: { productId:'6853c1d0f350bf620389664c', variantId:'6853c1d04d7c01769211b8d6' },\n    Mittelklemmen: { productId:'68531088654d1468dca962c', variantId:'6853c1084c04541622ba3e26' },\n    Endkappen: { productId:'6853be0895a5a578324f9682', variantId:'6853be0805e96b5a16c705cd' },\n    Schienenverbinder: { productId:'6853c2018bf6755ddde216a8', variantId:'6853c202c488ee61eb51a3dc' },\n    Schiene_240_cm: { productId:'6853bd882f00db0c9a42d653', variantId:'6853bd88c4173dbe72bab10f' },\n    Schiene_360_cm: { productId:'6853bc8f3f6abf360c605142', variantId:'6853bc902f00db0c9a423d97' },\n    MC4_Stecker: { productId:'687fcc9f66078f7098826ccc', variantId:'687fcca02c6537b9a9493fa7' },\n    Solarkabel: { productId:'687fd60dc599f5e95d783f99', variantId:'687fd60dd3a8ae1f00a6d6d1' },\n    Holzunterleger: { productId:'688780821dbbf26153a85117', variantId:'688780ad795c82663cd6e69b' },\n    // NEUE PRODUKTE (aus Berechnung raus, später hinzufügen)\n    Ringkabelschuhe: { productId:'68876153200e1a5e28a1b709', variantId:'6887615388988b2ccda11067' },\n    Erdungsband: { productId:'688760e01c9c7973ee287386', variantId:'688760e0835845affc493354' },\n    Tellerkopfschraube: { productId:'688760a7124e867cf2b20051', variantId:'688760a7f246d23f70575fb1' },\n    // Optimierer (Netto)\n    HuaweiOpti: { productId: '68af2934de0a7fe5d316efbc', variantId: '68af2934c230bc1eaa972585' },\n    BRCOpti: { productId: '68b1e02629cec71ebfc12f0e', variantId: '68b1e02ca05a6b4aca721dc8' }\n  };\n  \n  const PRODUCT_NAME_MAP = {\n    // Module und Paletten\n    'Solarmodul': 'Ulica Solar Black Jade-Flow 450 W',\n    'UlicaSolarBlackJadeFlow': 'Ulica Solar Black Jade-Flow 500 W',\n    'SolarmodulPalette': '36x Ulica Solar Black Jade-Flow 450 W - Palette',\n    'UlicaSolarBlackJadeFlowPalette': '36x Ulica Solar Black Jade-Flow 500 W  - Palette',\n    // Standardteile (exakte Foxy-Bezeichnungen)\n    'Endklemmen': 'Endklemmen - 20 Stück',\n    'Mittelklemmen': 'Mittelklemmen - 20 Stück',\n    'Endkappen': 'Endkappen - 50 Stück',\n    'Dachhaken': 'Dachhaken 3-fach verstellbar - 20 Stück',\n    'Schienenverbinder': 'Schienenverbinder - 10 Stück',\n    'Schiene_360_cm': 'Schiene 360 cm',\n    'Schiene_240_cm': 'Schiene 240cm',\n    'MC4_Stecker': 'MC4 Stecker - 50 Steckerpaare',\n    'Schrauben': 'Schraube M10x25 - 50 Stück inkl. Muttern',\n    'Tellerkopfschraube': 'Tellerkopfschraube 8x100 - 100 Stück',\n    'Ringkabelschuhe': 'Ringkabelschuhe - 100 Stück',\n    'BlechBohrschrauben': 'Blech-Bohrschrauben mit EPDM Dichtung - 100 Stück',\n    'Kabelbinder': 'Kabelbinder - 100 Stück',\n    'Erdungsband': 'Erdungsband - 6M',\n    'Solarkabel': 'Solarkabel 100M',\n    'Holzunterleger': 'Unterlegholz für Dachhacken - 50 Stück',\n    // Optimierer (aus Liste)\n    'HuaweiOpti': 'Huawei Smart PV Optimierer 600W',\n    'BRCOpti': 'BRC M600M Optimierer'\n  };\n  \n  const PRODUCT_IMAGES = {\n    Solarmodul: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    UlicaSolarBlackJadeFlow: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    SolarmodulPalette: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    UlicaSolarBlackJadeFlowPalette: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    Endklemmen: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c316b21cb7d04ba2ed22_DSC04815-min.jpg',\n    Schrauben: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c2704f5147533229ccde_DSC04796-min.jpg',\n    Dachhaken: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c1c8a2835b7879f46811_DSC04760-min.jpg',\n    Mittelklemmen: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c0d0c2d922d926976bd4_DSC04810-min.jpg',\n    Endkappen: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853bdfbe7cffc653f6a4605_DSC04788-min.jpg',\n    Schienenverbinder: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c21f0c39e927fce0db3b_DSC04780-min.jpg',\n    Schiene_240_cm: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853bce018164af4b4a187f1_DSC04825-min.jpg',\n    Schiene_360_cm: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853bcd5726d1d33d4b86ba4_DSC04824-min.jpg',\n    MC4_Stecker: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/687fcdab153f840ea15b5e7b_iStock-2186771695.jpg',\n    Solarkabel: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/687fd566bdbb6de2e5f362f0_DSC04851.jpg',\n    Holzunterleger: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    // NEUE PRODUKTE (aus Berechnung raus, später hinzufügen)\n    Ringkabelschuhe: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6887614c64676f0b0c8d5037_Kabelschuh%20Platzhalter.jpg',\n    BlechBohrschrauben: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/68f81013b62d8044fc41024d_blechschraube.jpg',\n    Kabelbinder: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/68f80b1a4a90df59dba640e9_1_9.png',\n    Erdungsband: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    Tellerkopfschraube: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c2704f5147533229ccde_DSC04796-min.jpg'\n  };\n  \n  // Zentrale Konfiguration ist jetzt direkt eingebettet\n  // ===== BACKGROUND CALCULATION MANAGER =====\n  class CalculationManager {\n    constructor() {\n      this.worker = null;\n      this.pendingCalculations = new Map();\n      this.calculationId = 0;\n      this.isWorkerReady = false;\n      \n      this.initWorker();\n    }\n\n    initWorker() {\n      try {\n        this.worker = new Worker('./calculation-worker.js');\n        \n        this.worker.onmessage = (e) => {\n          const { type, id, data, error } = e.data;\n          \n          if (type === 'ready') {\n            this.isWorkerReady = true;\n            return;\n          }\n          \n          if (type === 'result' && this.pendingCalculations.has(id)) {\n            const { resolve } = this.pendingCalculations.get(id);\n            this.pendingCalculations.delete(id);\n            resolve(data);\n          }\n          \n          if (type === 'error' && this.pendingCalculations.has(id)) {\n            const { reject } = this.pendingCalculations.get(id);\n            this.pendingCalculations.delete(id);\n            reject(new Error(error.message));\n          }\n          \n          // Worker Debug-Logs an Haupt-Console weiterleiten\n          if (type === 'debug') {\n            console.log(...data);\n          }\n        };\n        \n        this.worker.onerror = (error) => {\n          this.isWorkerReady = false;\n        };\n        \n      } catch (error) {\n        this.isWorkerReady = false;\n      }\n    }\n    \n    // Memory: Worker Cleanup\n    cleanup() {\n      try {\n        if (this.worker) {\n          this.worker.terminate();\n          this.worker = null;\n        }\n        this.isWorkerReady = false;\n        this.pendingCalculations.clear();\n      } catch (error) {\n        console.warn('[CalculationManager] Cleanup error:', error);\n      }\n    }\n\n    async calculate(type, data) {\n      if (!this.isWorkerReady || !this.worker) {\n        // Fallback: Synchrone Berechnung im Main Thread\n        return this.calculateSync(type, data);\n      }\n\n      return new Promise((resolve, reject) => {\n        const id = ++this.calculationId;\n        this.pendingCalculations.set(id, { resolve, reject });\n        \n        // Timeout für Berechnungen\n        setTimeout(() => {\n          if (this.pendingCalculations.has(id)) {\n            this.pendingCalculations.delete(id);\n            reject(new Error('Calculation timeout'));\n          }\n        }, 10000); // 10 Sekunden Timeout\n        \n        this.worker.postMessage({ type, data, id });\n      });\n    }\n\n    // Fallback-Berechnungen für den Fall, dass Web Worker nicht verfügbar ist\n    calculateSync(type, data) {\n      switch (type) {\n        case 'calculateParts':\n          return this.calculatePartsSync(data);\n        case 'calculateExtendedParts':\n          return this.calculateExtendedPartsSync(data);\n        default:\n          throw new Error(`Unsupported sync calculation: ${type}`);\n      }\n    }\n\n    calculatePartsSync(data) {\n      // FALLBACK: Verwende Calculation Worker direkt\n      try {\n        // Simuliere Worker-Aufruf synchron\n        const { selection, rows, cols, cellWidth, cellHeight, orientation, options = {} } = data;\n        const parts = {\n          Solarmodul: 0, UlicaSolarBlackJadeFlow: 0, Endklemmen: 0, Mittelklemmen: 0,\n          Dachhaken: 0, Schrauben: 0, Endkappen: 0,\n          Schienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0\n        };\n\n        // Verwende die korrekte Schienenlogik (wie im Worker)\n        for (let y = 0; y < rows; y++) {\n          if (!Array.isArray(selection[y])) continue;\n          let run = 0;\n\n          for (let x = 0; x < cols; x++) {\n            if (selection[y]?.[x]) run++;\n            else if (run) { \n              this.processGroupSync(run, parts, cellWidth, cellHeight, orientation, options); \n              run = 0; \n            }\n          }\n          if (run) this.processGroupSync(run, parts, cellWidth, cellHeight, orientation, options);\n        }\n\n        return parts;\n      } catch (error) {\n        console.error('calculatePartsSync error:', error);\n        return {\n          Solarmodul: 0, Endklemmen: 0, Mittelklemmen: 0,\n          Dachhaken: 0, Schrauben: 0, Endkappen: 0,\n          Schienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0\n        };\n      }\n    }\n\n    processGroupSync(len, parts, cellWidth, cellHeight, orientation, options = {}) {\n      // FALLBACK: Kopie der Worker-Berechnung\n      const isVertical = orientation === 'vertical';\n      const actualCellWidth = isVertical ? cellHeight : cellWidth;\n      \n      const totalLen = len * actualCellWidth;\n      const floor360 = Math.floor(totalLen / 360);\n      const rem360 = totalLen - floor360 * 360;\n      const floor240 = Math.ceil(rem360 / 240);\n      const pure360 = Math.ceil(totalLen / 360);\n      const pure240 = Math.ceil(totalLen / 240);\n      \n      const variants = [\n        {cnt360: floor360, cnt240: floor240},\n        {cnt360: pure360,  cnt240: 0},\n        {cnt360: 0,        cnt240: pure240}\n      ].map(v => ({\n        ...v,\n        rails: v.cnt360 + v.cnt240,\n        waste: v.cnt360 * 360 + v.cnt240 * 240 - totalLen\n      }));\n      \n      const minRails = Math.min(...variants.map(v => v.rails));\n      const best = variants\n        .filter(v => v.rails === minRails)\n        .reduce((a, b) => a.waste <= b.waste ? a : b);\n      \n      const {cnt360, cnt240} = best;\n      parts.Schiene_360_cm     += cnt360 * 2;\n      parts.Schiene_240_cm     += cnt240 * 2;\n      parts.Schienenverbinder  += (cnt360 + cnt240 - 1) * 4;\n      parts.Endklemmen         += 4;\n      parts.Mittelklemmen      += len > 1 ? (len - 1) * 2 : 0;\n      parts.Dachhaken          += len > 1 ? len * 3 : 4;\n      parts.Endkappen          += 4; // Gleich wie Endklemmen\n      parts.Solarmodul         += len;\n      // UlicaSolarBlackJadeFlow hinzufügen wenn ulica-module Checkbox aktiviert ist\n      if (options.ulicaModule === true) {\n        parts.UlicaSolarBlackJadeFlow += len;\n      }\n      parts.Schrauben          += len > 1 ? len * 3 : 4; // Basierend auf Dachhaken\n      parts.Tellerkopfschraube += len > 1 ? (len * 3) * 2 : 8; // Basierend auf Dachhaken * 2\n    }\n\n    calculateExtendedPartsSync(data) {\n      let parts = this.calculatePartsSync(data);\n      const { options } = data;\n      \n      if (!options.includeModules) {\n        delete parts.Solarmodul;\n      }\n      \n      if (options.ulicaModule !== true) {\n        delete parts.UlicaSolarBlackJadeFlow;\n      }\n      \n      if (options.mc4Connectors) {\n        const panelCount = data.selection.flat().filter(v => v).length;\n        const veMc4 = VE.MC4_Stecker || 50;\n        const packs = Math.ceil(panelCount / 30);\n        parts.MC4_Stecker = packs * veMc4; // Stückbasis für korrekte Packanzahl im Warenkorb\n      }\n      \n      if (options.solarkabel) {\n        parts.Solarkabel = 1;\n      }\n      \n      if (options.woodUnderlay) {\n        parts.Holzunterleger = 1; // Pauschal 1x zur Gesamtbestellung\n      }\n      \n      if (options.erdungsband) {\n        // Erdungsband-Berechnung hier hinzufügen wenn nötig\n        // parts.Erdungsband = calculateErdungsband(...);\n      }\n      \n      return parts;\n    }\n\n    destroy() {\n      if (this.worker) {\n        this.worker.terminate();\n        this.worker = null;\n      }\n      this.pendingCalculations.clear();\n      this.isWorkerReady = false;\n    }\n  }\n\n  // Warte, bis alle Bilder in einem Container geladen sind (verhindert leere html2canvas Renders)\n  function waitForImages(container) {\n    const images = Array.from(container.querySelectorAll('img'));\n    if (images.length === 0) return Promise.resolve();\n    return Promise.all(images.map(img => new Promise(resolve => {\n      if (img.complete && img.naturalWidth > 0) return resolve();\n      const done = () => resolve();\n      img.addEventListener('load', done, { once: true });\n      img.addEventListener('error', done, { once: true });\n    })));\n  }\n\n  // (Fallback entfernt, wir setzen ausschließlich auf html2pdf.js)\n  // Globale Calculation Manager Instanz\n  const calculationManager = new CalculationManager();\n  // PriceCache-System entfernt - direkte PRICE_MAP-Verwendung\n\n  // Funktion um Preise direkt aus PRICE_MAP zu lesen (ohne Cache)\n  function getPriceFromCache(productKey) {\n      return PRICE_MAP[productKey] || 0;\n  }\n\n  // Legacy-Funktion für Rückwärtskompatibilität\n  function getPriceFromHTML(productKey) {\n    return getPriceFromCache(productKey);\n  }\n  // ===== PDF GENERATOR =====\n  class SolarPDFGenerator {\n    constructor(solarGrid) {\n      this.solarGrid = solarGrid;\n      this.jsPDF = window.jspdf?.jsPDF;\n      this.html2canvas = window.html2canvas;\n      this.html2pdf = window.html2pdf; // html2pdf.js (optional, moderner Pfad)\n      // Weiße Footer-Logo-Variante (für dunklen Footer-Hintergrund)\n      this.companyLogoUrl = 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/688f3fff157b70cefcaa97df_Schneider%20logo.png';\n      // Blaues Header-Logo\n      this.headerLogoBlueUrl = 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6893249274128869974e58ec_schneider%20logo%20png.png';\n    }\n\n    // Öffnet PDFs auf Touch-Geräten in neuem Tab statt Download\n    isTouchDevice() {\n      try {\n        // iOS/iPadOS/Android + generisches Touch-Feature\n        const ua = navigator.userAgent || '';\n        const touchUA = /iPad|iPhone|iPod|Android|Mobile/i.test(ua);\n        const hasTouch = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);\n        return touchUA || hasTouch;\n      } catch (_) { return false; }\n    }\n\n    // Prüfe ob PDF-Libraries verfügbar sind\n    isAvailable() {\n      return !!(this.jsPDF && this.html2canvas);\n    }\n\n    // NEU: Stabile PDF-Generation per html2canvas + jsPDF (ohne html2pdf Kette)\n    async generatePDFFromSnapshot(snapshot) {\n      if (!this.jsPDF || !this.html2canvas) {\n        console.error('jsPDF/html2canvas nicht verfügbar');\n        this.solarGrid.showToast('PDF-Generierung nicht verfügbar', 3000);\n        return;\n      }\n      if (!snapshot?.configs?.length) {\n        this.solarGrid.showToast('Keine Konfiguration zum Exportieren', 3000);\n        return;\n      }\n      try {\n        // 1) Template rendern\n        await this.renderSnapshotIntoPdfTemplate(snapshot);\n        const rootEl = document.getElementById('pdf-root');\n        if (!rootEl) throw new Error('#pdf-root nicht gefunden');\n        const prevStyle = rootEl.getAttribute('style') || '';\n\n        // 2) Sichtbar aber unsichtbar machen (für zuverlässiges Rendering)\n        rootEl.style.position = 'fixed';\n        rootEl.style.left = '0';\n        rootEl.style.top = '0';\n        rootEl.style.opacity = '0.01';\n        rootEl.style.pointerEvents = 'none';\n        rootEl.style.zIndex = '9999';\n        rootEl.style.background = '#ffffff';\n\n        // 3) Sicherstellen, dass alle Bilder fertig sind\n        await waitForImages(rootEl);\n        await new Promise(r => requestAnimationFrame(r));\n        await new Promise(r => setTimeout(r, 30));\n\n        const pages = Array.from(rootEl.querySelectorAll('.pdf-page'));\n        if (pages.length === 0) throw new Error('Keine .pdf-page Elemente');\n        console.log('[PDF] capturing pages:', pages.length);\n\n        // 4) PDF initialisieren – Pixel-Format exakt zu unseren CSS-Werten\n        const pdf = new this.jsPDF({ unit: 'px', format: [794, 1123], orientation: 'portrait' });\n\n        for (let i = 0; i < pages.length; i++) {\n          const pageEl = pages[i];\n          // Garantierte Maße pro Seite\n          pageEl.style.width = '794px';\n          pageEl.style.height = '1123px';\n          pageEl.style.boxSizing = 'border-box';\n\n          // Canvas erzeugen\n          const canvas = await this.html2canvas(pageEl, {\n            scale: 2,\n            backgroundColor: '#ffffff',\n            useCORS: true,\n            allowTaint: true,\n            logging: true\n          });\n          console.log('[PDF] canvas created', { w: canvas.width, h: canvas.height });\n          const imgData = canvas.toDataURL('image/jpeg', 0.98);\n          if (i > 0) pdf.addPage();\n          pdf.addImage(imgData, 'JPEG', 0, 0, 794, 1123);\n        }\n\n        // 5) Speichern/Öffnen: Auf Touch-Geräten in neuem Tab öffnen\n        const fileName = this.generateFileName(snapshot.configs);\n        if (this.isTouchDevice()) {\n          try {\n            const blob = pdf.output('blob');\n            const url = URL.createObjectURL(blob);\n            window.open(url, '_blank');\n            // Objekt-URL nach kurzer Zeit freigeben\n            setTimeout(() => { try { URL.revokeObjectURL(url); } catch (_) {} }, 15000);\n          } catch (_) {\n            // Fallback: normal speichern\n            pdf.save(fileName);\n          }\n        } else {\n          pdf.save(fileName);\n        }\n        rootEl.setAttribute('style', prevStyle);\n      } catch (err) {\n        console.error('PDF-Erstellung fehlgeschlagen:', err);\n        this.solarGrid.showToast('PDF-Erstellung fehlgeschlagen', 3000);\n      }\n    }\n\n    // Rendert den Snapshot in das versteckte A4-HTML-Template (#pdf-root)\n    async renderSnapshotIntoPdfTemplate(snapshot) {\n      const root = document.getElementById('pdf-root');\n      if (!root) return;\n      // Leeren\n      root.innerHTML = '';\n      const dateStr = new Date().toLocaleDateString('de-DE');\n\n      for (let i = 0; i < snapshot.configs.length; i++) {\n        const config = snapshot.configs[i];\n        // Seite klonen\n        const page = document.createElement('div');\n        page.className = 'pdf-page';\n        page.style.width = '794px';\n        page.style.minHeight = '1123px';\n        page.style.padding = '48px 48px 64px 48px';\n        page.style.boxSizing = 'border-box';\n        page.style.position = 'relative';\n\n        page.innerHTML = `\n          <header style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:10mm;\">\n            <div>\n              <div style=\"font-size:18pt; font-weight:700; color:#0e1e34;\">${config.name || 'Konfiguration'}</div>\n              <div style=\"font-size:10pt; color:#677; margin-top:2mm;\">${dateStr}</div>\n            </div>\n            <div style=\"display:flex; align-items:center; gap:8px; color:#0e1e34; font-size:10pt;\"><img src=\"${this.headerLogoBlueUrl}\" alt=\"Logo\" style=\"height:12mm; width:auto;\"/></div>\n          </header>\n          <section style=\"border:1px solid #e5e7eb; border-radius:8px; padding:6mm; margin-bottom:8mm;\">\n            <div style=\"font-size:12pt; font-weight:700; color:#0e1e34;\">Projekt</div>\n            <div style=\"font-size:10pt; color:#111; margin-top:2mm; display:flex; justify-content:space-between; gap:6mm;\">\n              <div><span style=\"font-weight:700;\">Projekttitel:</span> ${(config.name || 'Unbenannt')}</div>\n              <div><span style=\"font-weight:700;\">Datum:</span> ${dateStr}</div>\n            </div>\n            <div style=\"display:grid; grid-template-columns: 1fr 1fr; gap:6mm; margin-top:4mm;\">\n              <div>\n                <div style=\"display:flex; align-items:flex-end; gap:4mm; margin-bottom:3mm;\">\n                  <div style=\"width:28mm; color:#0e1e34;\">Name:</div>\n                  <div style=\"flex:1; height:6mm; border-bottom:1px solid #e5e7eb;\"></div>\n                </div>\n                <div style=\"display:flex; align-items:flex-end; gap:4mm; margin-bottom:3mm;\">\n                  <div style=\"width:28mm; color:#0e1e34;\">Firma:</div>\n                  <div style=\"flex:1; height:6mm; border-bottom:1px solid #e5e7eb;\"></div>\n                </div>\n                <div style=\"display:flex; align-items:flex-end; gap:4mm; margin-bottom:3mm;\">\n                  <div style=\"width:28mm; color:#0e1e34;\">Adresse:</div>\n                  <div style=\"flex:1; height:6mm; border-bottom:1px solid #e5e7eb;\"></div>\n                </div>\n                <div style=\"display:flex; align-items:flex-end; gap:4mm; margin-bottom:3mm;\">\n                  <div style=\"width:28mm; color:#0e1e34;\">Telefon:</div>\n                  <div style=\"flex:1; height:6mm; border-bottom:1px solid #e5e7eb;\"></div>\n                </div>\n                <div style=\"display:flex; align-items:flex-end; gap:4mm;\">\n                  <div style=\"width:28mm; color:#0e1e34;\">E-Mail:</div>\n                  <div style=\"flex:1; height:6mm; border-bottom:1px solid #e5e7eb;\"></div>\n                </div>\n              </div>\n              <div>\n                <div style=\"display:flex; align-items:flex-end; gap:4mm; margin-bottom:3mm;\">\n                  <div style=\"flex:0 0 auto; font-weight:700; color:#0e1e34;\">Weitere Informationen:</div>\n                  <div style=\"flex:1; height:6mm; border-bottom:1px solid #e5e7eb;\"></div>\n                </div>\n                <div style=\"height:6mm; border-bottom:1px solid #e5e7eb; margin-bottom:3mm;\"></div>\n                <div style=\"height:6mm; border-bottom:1px solid #e5e7eb; margin-bottom:3mm;\"></div>\n                <div style=\"height:6mm; border-bottom:1px solid #e5e7eb; margin-bottom:3mm;\"></div>\n                <div style=\"height:6mm; border-bottom:1px solid #e5e7eb;\"></div>\n              </div>\n            </div>\n          </section>\n          <section style=\"margin-bottom:8mm;\">\n            <div style=\"font-size:11pt; font-weight:700; color:#0e1e34; margin-bottom:4mm;\">Grid-Übersicht</div>\n            <div style=\"font-size:10pt; color:#111; margin-bottom:4mm;\">\n              Grid: ${config.cols} × ${config.rows} Module (${config.selectedCells} ausgewählt) · Orientierung: ${config.orientation === 'vertical' ? 'Vertikal' : 'Horizontal'}\n            </div>\n            <img class=\"pdf-grid-image\" alt=\"Grid\" style=\"width:100%; max-width:100%; border-radius:6px; border:1px solid #e5e7eb; box-shadow:0 2px 8px rgba(0,0,0,0.06);\" />\n          </section>\n        `;\n\n        // Grid-Bild generieren\n        try {\n          const gridImg = await this.captureGridVisualizationFromSnapshot(config);\n          if (gridImg) page.querySelector('.pdf-grid-image').src = gridImg;\n        } catch {}\n\n        // Produktliste als eigene Seite (ohne Zusatzprodukte)\n        const productsPage = document.createElement('div');\n        productsPage.className = 'pdf-page';\n        productsPage.style.width = '794px';\n        productsPage.style.minHeight = '1123px';\n        productsPage.style.padding = '48px 48px 64px 48px';\n        productsPage.style.boxSizing = 'border-box';\n        productsPage.style.position = 'relative';\n\n        productsPage.innerHTML = `\n          <header style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:10mm;\">\n            <div>\n              <div style=\"font-size:18pt; font-weight:700; color:#0e1e34;\">${config.name || 'Konfiguration'}</div>\n              <div style=\"font-size:10pt; color:#677; margin-top:2mm;\">${dateStr}</div>\n            </div>\n            <div style=\"display:flex; align-items:center; gap:8px; color:#0e1e34; font-size:10pt;\"><img src=\"${this.headerLogoBlueUrl}\" alt=\"Logo\" style=\"height:12mm; width:auto;\"/></div>\n          </header>\n          <div style=\"background:#FFB101; color:#000; border-radius:8px; padding:6mm; font-weight:700; margin-bottom:6mm;\">PRODUKT-LISTE</div>\n          <table style=\"width:100%; border-collapse:collapse; font-size:10pt;\">\n            <thead>\n              <tr style=\"background:#0e1e34; color:#fff;\">\n                <th style=\"text-align:left; padding:3mm 4mm; border-top-left-radius:6px; width:20mm;\">Anzahl</th>\n                <th style=\"text-align:left; padding:3mm 4mm;\">Produkt</th>\n                <th style=\"text-align:right; padding:3mm 4mm; width:35mm;\">Benötigte Menge</th>\n                <th style=\"text-align:right; padding:3mm 4mm; border-top-right-radius:6px; width:30mm;\">Preis</th>\n              </tr>\n            </thead>\n            <tbody class=\"pdf-table-body\"></tbody>\n          </table>\n          <div class=\"pdf-total\" style=\"margin-top:8mm; background:#0e1e34; color:#fff; border-radius:8px; padding:6mm; display:grid; grid-template-columns: 1fr auto; align-items:start; column-gap:6mm;\">\n            <div style=\"font-weight:700; line-height:1; margin:0;\">GESAMTPREIS</div>\n            <div class=\"pdf-total-price\" style=\"font-size:14pt; font-weight:700; line-height:1; margin:0;\"></div>\n          </div>\n        `;\n\n        // Produkte rendern (neues Tabellenlayout: Anzahl | Produkt+VE | benötigte Menge | Preis)\n        // Zusatzprodukte werden hier explizit ausgeschlossen – sie kommen gesammelt auf eine separate Seite\n        const pdfTotalPriceEl = productsPage.querySelector('.pdf-total-price');\n          if (pdfTotalPriceEl) {\n          // MwSt-Hinweis entfernt - vereinfachte UI\n        }\n\n        await this.renderProductsIntoTable(config, productsPage.querySelector('.pdf-table-body'), pdfTotalPriceEl, {\n          htmlLayout: true,\n          excludeAdditionalProducts: true\n        });\n\n        // Safety: falls Tabelle leer ist, füge Platzhalterzeile ein\n        const tbody = productsPage.querySelector('.pdf-table-body');\n        if (tbody && !tbody.innerHTML.trim()) {\n          tbody.innerHTML = '<tr><td style=\"padding:3mm 4mm;\" colspan=\"4\">Keine Produkte ausgewählt</td></tr>';\n        }\n\n        // Paginierung: Wenn Tabelle zu lang ist, auf mehrere .pdf-page Elemente aufteilen\n        let productPages = null;\n        try {\n          const rootEl = document.getElementById('pdf-root');\n          if (rootEl && !productsPage.parentNode) {\n            rootEl.appendChild(productsPage);\n          }\n          const paginateProductsPage = (pageEl) => {\n            const createdPages = [];\n            const pageHeight = (pageEl && pageEl.getBoundingClientRect && pageEl.getBoundingClientRect().height) || 1123;\n            const footerReservePx = 120; // Platz für Footer + Abstand\n            // Reserviere zusätzlich Platz für die Gesamtpreis-Box, damit sie nie in den Footer läuft\n            const totalBlockTemplate = pageEl.querySelector('.pdf-total');\n            let totalReservePx = 0;\n            try {\n              if (totalBlockTemplate) {\n                // Sichtbar messen (falls auf display:none)\n                const prev = totalBlockTemplate.style.display;\n                if (prev === 'none') totalBlockTemplate.style.display = '';\n                const tbRect = totalBlockTemplate.getBoundingClientRect();\n                totalReservePx = Math.ceil(tbRect.height) + 8; // kleiner Sicherheitsrand\n                totalBlockTemplate.style.display = prev;\n              }\n            } catch (_) { totalReservePx = 80; }\n            const tableBody = pageEl.querySelector('.pdf-table-body');\n            const tableHead = pageEl.querySelector('thead');\n            const totalBlock = pageEl.querySelector('.pdf-total');\n            if (!tableBody || !tableHead) return [pageEl];\n\n            const allRows = Array.from(tableBody.querySelectorAll('tr'));\n            if (allRows.length === 0) return [pageEl];\n\n            // Hilfsfunktion: leeres Seiten-Skelett klonen\n            const makeSkeleton = () => {\n              const clone = pageEl.cloneNode(true);\n              const bd = clone.querySelector('.pdf-table-body');\n              if (bd) bd.innerHTML = '';\n              // Total-Block auf Zwischen-Seiten ausblenden, erst auf letzter Seite sichtbar\n              const tb = clone.querySelector('.pdf-total');\n              if (tb) tb.style.display = 'none';\n              return clone;\n            };\n\n            // Erste Seite als Start verwenden (leeren und befüllen)\n            const first = makeSkeleton();\n            // Ersetze Original im DOM durch das neue Skelett, um Messungen korrekt zu machen\n            if (pageEl.parentNode) {\n              pageEl.parentNode.replaceChild(first, pageEl);\n            }\n            const pagesArr = [first];\n\n            let idx = 0;\n            while (idx < allRows.length) {\n              const currentPage = pagesArr[pagesArr.length - 1];\n              const curBody = currentPage.querySelector('.pdf-table-body');\n              const currentRect = currentPage.getBoundingClientRect();\n              const bodyTop = curBody.getBoundingClientRect().top - currentRect.top;\n              const maxBottom = pageHeight - footerReservePx;\n              const contentLimitBottom = maxBottom - totalReservePx;\n\n              // Füge Zeilen, bis die Unterkante überschreitet\n              while (idx < allRows.length) {\n                const row = allRows[idx].cloneNode(true);\n                curBody.appendChild(row);\n                const rowBottom = row.getBoundingClientRect().bottom - currentRect.top;\n                if (rowBottom > contentLimitBottom) {\n                  // Überschreitung → entferne und beginne neue Seite\n                  curBody.removeChild(row);\n                  break;\n                }\n                idx++;\n              }\n              if (idx < allRows.length) {\n                const nextPage = makeSkeleton();\n                if (first.parentNode) first.parentNode.appendChild(nextPage);\n                pagesArr.push(nextPage);\n              }\n            }\n\n            // Total nur auf letzter Seite anzeigen\n            pagesArr.forEach((p, i) => {\n              const tb = p.querySelector('.pdf-total');\n              if (tb) tb.style.display = (i === pagesArr.length - 1) ? '' : 'none';\n            });\n\n            return pagesArr;\n          };\n\n          productPages = paginateProductsPage(productsPage);\n          // Footer später für jede Seite hinzufügen (siehe unten)\n          // Falls mehrere Seiten entstanden, werden sie weiter unten verarbeitet\n          // productsPage wurde intern ersetzt; referenzieren wir die neue erste Seite\n          if (productPages && productPages.length) {\n            // Merke erste Seite für Footer-Handling\n            productsPage = productPages[0];\n          }\n        } catch (e) {\n          console.warn('PDF-Paginierung fehlgeschlagen (fallback auf Einzel-Seite):', e);\n        }\n\n        // Footer für beide Seiten mit Logo\n        const makeFooter = () => {\n          const footer = document.createElement('div');\n          footer.style.position = 'absolute';\n          footer.style.left = '0';\n          footer.style.right = '0';\n          footer.style.bottom = '0';\n          footer.style.height = '18mm';\n          footer.style.background = '#0e1e34';\n          footer.style.color = '#fff';\n          footer.style.display = 'flex';\n          footer.style.alignItems = 'center';\n          footer.style.justifyContent = 'space-between';\n          footer.style.padding = '0 16mm';\n          footer.style.boxSizing = 'border-box';\n          footer.style.fontSize = '8pt';\n          const left = document.createElement('div');\n          left.textContent = 'Schneider Unterkonstruktion - Solar Konfigurator';\n          const right = document.createElement('img');\n          right.src = this.companyLogoUrl;\n          right.alt = 'Logo';\n          right.style.height = '12mm';\n          right.style.width = 'auto';\n          footer.appendChild(left);\n          footer.appendChild(right);\n          return footer;\n        };\n\n        page.appendChild(makeFooter());\n        // Produktseiten nach der Übersichtsseite anhängen (korrekte Reihenfolge)\n        const pagesToAppend = (productPages && productPages.length) ? productPages : [productsPage];\n        pagesToAppend.forEach(p => {\n          const hasFooter = Array.from(p.children).some(ch => (ch.style && ch.style.position === 'absolute' && ch.style.bottom === '0px'));\n          if (!hasFooter) p.appendChild(makeFooter());\n          if (p.parentNode === root) root.removeChild(p);\n        });\n        root.appendChild(page);\n        pagesToAppend.forEach(p => root.appendChild(p));\n      }\n      // Nach allen Konfigurationen: optionale Zusatzprodukte-Seite (einmal pro PDF)\n      try {\n        const additionalParts = this.computeAdditionalProductsForSnapshot(snapshot);\n        const additionalKeys = Object.keys(additionalParts).filter(k => additionalParts[k] > 0);\n        if (additionalKeys.length > 0) {\n          const dateStr2 = new Date().toLocaleDateString('de-DE');\n          const additionalPage = document.createElement('div');\n          additionalPage.className = 'pdf-page';\n          additionalPage.style.width = '794px';\n          additionalPage.style.minHeight = '1123px';\n          additionalPage.style.padding = '48px 48px 64px 48px';\n          additionalPage.style.boxSizing = 'border-box';\n          additionalPage.style.position = 'relative';\n\n          additionalPage.innerHTML = `\n            <header style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:10mm;\">\n              <div>\n                <div style=\"font-size:18pt; font-weight:700; color:#0e1e34;\">Für alle Konfigurationen</div>\n                <div style=\"font-size:10pt; color:#677; margin-top:2mm;\">${dateStr2}</div>\n              </div>\n              <div style=\"display:flex; align-items:center; gap:8px; color:#0e1e34; font-size:10pt;\"><img src=\"${this.headerLogoBlueUrl}\" alt=\"Logo\" style=\"height:12mm; width:auto;\"/></div>\n            </header>\n            <div style=\"background:#FFB101; color:#000; border-radius:8px; padding:6mm; font-weight:700; margin-bottom:6mm;\">ZUSATZPRODUKTE</div>\n            <table style=\"width:100%; border-collapse:collapse; font-size:10pt;\">\n              <thead>\n                <tr style=\"background:#0e1e34; color:#fff;\">\n                  <th style=\"text-align:left; padding:3mm 4mm; border-top-left-radius:6px; width:20mm;\">Anzahl</th>\n                  <th style=\"text-align:left; padding:3mm 4mm;\">Produkt</th>\n                  <th style=\"text-align:right; padding:3mm 4mm; width:35mm;\">Benötigte Menge</th>\n                  <th style=\"text-align:right; padding:3mm 4mm; border-top-right-radius:6px; width:30mm;\">Preis</th>\n                </tr>\n              </thead>\n              <tbody class=\"pdf-additional-table-body\"></tbody>\n            </table>\n            <div class=\"pdf-total\" style=\"margin-top:8mm; background:#0e1e34; color:#fff; border-radius:8px; padding:6mm; display:grid; grid-template-columns: 1fr auto; align-items:start; column-gap:6mm; position:relative;\">\n              <div style=\"font-weight:700; line-height:1; margin:0;\">GESAMTPREIS</div>\n              <div class=\"pdf-additional-total-price\" style=\"font-size:14pt; font-weight:700; line-height:1; margin:0;\"></div>\n            </div>\n          `;\n\n          // Render Zusatzprodukte-Tabelle\n          const pdfAddTotalEl = additionalPage.querySelector('.pdf-additional-total-price');\n          if (pdfAddTotalEl) {\n            // MwSt-Hinweis entfernt - vereinfachte UI\n          }\n          await this.renderAdditionalProductsIntoTable(snapshot, additionalPage.querySelector('.pdf-additional-table-body'), pdfAddTotalEl);\n\n          // Footer\n          const footer = document.createElement('div');\n          footer.style.position = 'absolute';\n          footer.style.left = '0';\n          footer.style.right = '0';\n          footer.style.bottom = '0';\n          footer.style.height = '18mm';\n          footer.style.background = '#0e1e34';\n          footer.style.color = '#fff';\n          footer.style.display = 'flex';\n          footer.style.alignItems = 'center';\n          footer.style.justifyContent = 'space-between';\n          footer.style.padding = '0 16mm';\n          footer.style.boxSizing = 'border-box';\n          footer.style.fontSize = '8pt';\n          const left = document.createElement('div');\n          left.textContent = 'Schneider Unterkonstruktion - Solar Konfigurator';\n          const right = document.createElement('img');\n          right.src = this.companyLogoUrl;\n          right.alt = 'Logo';\n          right.style.height = '12mm';\n          right.style.width = 'auto';\n          footer.appendChild(left);\n          footer.appendChild(right);\n          additionalPage.appendChild(footer);\n\n          root.appendChild(additionalPage);\n        }\n      } catch (e) {\n        console.warn('Zusatzprodukte-Seite konnte nicht erzeugt werden:', e);\n      }\n    }\n\n    async renderProductsIntoTable(config, tbodyEl, totalEl, options = {}) {\n      const rawParts = await this.calculatePartsFromSnapshot(config);\n      const parts = { ...rawParts };\n      try {\n        const ulicaSelected = config.ulicaModule === true;\n        const keyPiece = ulicaSelected ? 'UlicaSolarBlackJadeFlow' : 'Solarmodul';\n        const keyPallet = ulicaSelected ? 'UlicaSolarBlackJadeFlowPalette' : 'SolarmodulPalette';\n        const count = Number(parts[keyPiece] || 0);\n        if (count > 0) {\n          const pallets = Math.floor(count / 36);\n          const remainder = count % 36;\n          if (pallets > 0) {\n            parts[keyPallet] = (parts[keyPallet] || 0) + pallets * 36; // Stückbasis, VE=36\n          }\n          parts[keyPiece] = remainder;\n        }\n      } catch (e) {}\n      let totalPrice = 0;\n      const rows = [];\n      const ADDITIONAL_KEYS = new Set(['MC4_Stecker', 'Solarkabel', 'Holzunterleger', 'Ringkabelschuhe', 'Kabelbinder', 'BlechBohrschrauben']);\n      for (const [key, value] of Object.entries(parts || {})) {\n        if (value <= 0) continue;\n        if (options.excludeAdditionalProducts && ADDITIONAL_KEYS.has(key)) continue;\n        const ve = VE[key] || 1;\n        const packs = Math.ceil(value / ve);\n        const pricePerPack = getPackPriceForQuantity(key, value);\n        const rowPrice = packs * pricePerPack;\n        totalPrice += rowPrice;\n        rows.push({ key, value, ve, packs, rowPrice });\n      }\n      // Sortiere nach Produktname\n      rows.sort((a, b) => a.key.localeCompare(b.key));\n      if (options.htmlLayout) {\n        tbodyEl.innerHTML = rows.map(r => {\n          const productName = PRODUCT_NAME_MAP[r.key] || r.key.replace(/_/g, ' ');\n          return `\n            <tr style=\"border-bottom:1px solid #eee;\">\n              <td style=\"padding:3mm 4mm; width:20mm; font-weight:700;\">${r.packs}x</td>\n              <td style=\"padding:3mm 4mm;\">\n                <div style=\"font-weight:700; font-size:11pt;\">${productName}</div>\n                <div style=\"color:#888; font-size:9pt;\">${r.ve} Stück</div>\n              </td>\n              <td style=\"padding:3mm 4mm; text-align:right; width:35mm;\">${r.value}</td>\n              <td style=\"padding:3mm 4mm; text-align:right; width:30mm;\">${r.rowPrice.toFixed(2)} €</td>\n            </tr>\n          `;\n        }).join('');\n      } else {\n        tbodyEl.innerHTML = rows.map(r => `\n          <tr style=\"border-bottom:1px solid #eee;\">\n            <td style=\"padding:3mm 4mm;\">${r.key}</td>\n            <td style=\"padding:3mm 4mm; text-align:right;\">${r.value}</td>\n            <td style=\"padding:3mm 4mm; text-align:right;\">${r.ve}</td>\n            <td style=\"padding:3mm 4mm; text-align:right;\">${r.rowPrice.toFixed(2)} €</td>\n          </tr>\n        `).join('');\n      }\n      if (totalEl) totalEl.textContent = `${totalPrice.toFixed(2)} €`;\n    }\n\n    // Aggregiert Zusatzprodukte einmalig über alle Konfigurationen im Snapshot\n    computeAdditionalProductsForSnapshot(snapshot) {\n      try {\n        const configs = Array.isArray(snapshot?.configs) ? snapshot.configs : [];\n        const anyMc4 = configs.some(c => c.mc4 === true);\n        const anyCable = configs.some(c => c.cable === true || c.solarkabel === true);\n        const anyWood = configs.some(c => c.wood === true || c.holz === true);\n        const anyQuetsch = configs.some(c => c.quetschkabelschuhe === true);\n\n        const totalSelectedCells = configs.reduce((sum, c) => {\n          if (typeof c.selectedCells === 'number') return sum + c.selectedCells;\n          if (Array.isArray(c.selection)) {\n            return sum + c.selection.flat().filter(Boolean).length;\n          }\n          return sum;\n        }, 0);\n\n        const result = {};\n        if (anyMc4) {\n          result.MC4_Stecker = Math.max(1, Math.ceil((totalSelectedCells || 0) / 30));\n        }\n        if (anyCable) {\n          result.Solarkabel = 1;\n        }\n        if (anyWood) {\n          result.Holzunterleger = 1;\n        }\n        if (anyQuetsch) {\n          result.Ringkabelschuhe = 1;\n        }\n        // Optimierer (Huawei/BRC) – Menge aus globaler UI lesen\n        try {\n          const hCb = document.getElementById('huawei-opti');\n          const bCb = document.getElementById('brc-opti');\n          const qEl = document.getElementById('opti-qty');\n          if (qEl) {\n            const qty = Math.max(1, parseInt(qEl.value || '1', 10));\n            if (hCb && hCb.checked) {\n              result.HuaweiOpti = (result.HuaweiOpti || 0) + qty;\n            }\n            if (bCb && bCb.checked) {\n              result.BRCOpti = (result.BRCOpti || 0) + qty;\n            }\n          }\n        } catch (_) {}\n        return result;\n      } catch (err) {\n        console.warn('computeAdditionalProductsForSnapshot failed:', err);\n        return {};\n      }\n    }\n    // Rendert Zusatzprodukte in eine Tabelle (HTML-Modus) und zeigt Gesamtpreis\n    async renderAdditionalProductsIntoTable(snapshot, tbodyEl, totalEl) {\n      const parts = this.computeAdditionalProductsForSnapshot(snapshot);\n      let totalPrice = 0;\n      const rows = Object.entries(parts).map(([key, value]) => {\n        const ve = VE[key] || 1;\n        const packs = Math.ceil(value / ve);\n        const pricePerPack = getPackPriceForQuantity(key, value);\n        const rowPrice = packs * pricePerPack;\n        totalPrice += rowPrice;\n        return { key, value, ve, packs, rowPrice };\n      });\n      // Reihenfolge stabil nach Name\n      rows.sort((a, b) => a.key.localeCompare(b.key));\n      tbodyEl.innerHTML = rows.map(r => {\n        const productName = PRODUCT_NAME_MAP[r.key] || r.key.replace(/_/g, ' ');\n        return `\n          <tr style=\"border-bottom:1px solid #eee;\">\n            <td style=\"padding:3mm 4mm; width:20mm; font-weight:700;\">${r.packs}x</td>\n            <td style=\"padding:3mm 4mm;\">\n              <div style=\"font-weight:700; font-size:11pt;\">${productName}</div>\n              <div style=\"color:#888; font-size:9pt;\">${r.ve} Stück</div>\n            </td>\n            <td style=\"padding:3mm 4mm; text-align:right; width:35mm;\">${r.value}</td>\n            <td style=\"padding:3mm 4mm; text-align:right; width:30mm;\">${r.rowPrice.toFixed(2)} €</td>\n          </tr>\n        `;\n      }).join('');\n      if (totalEl) totalEl.textContent = `${totalPrice.toFixed(2)} €`;\n    }\n\n    // Abwärtskompatibler Wrapper: ermöglicht this.pdfGenerator.generatePDF('current'|'all')\n    async generatePDF(mode = 'current') {\n      if (!this.isAvailable()) {\n        console.warn('PDF Libraries nicht verfügbar');\n        this.solarGrid?.showToast?.('PDF-Generierung nicht verfügbar', 3000);\n        return;\n      }\n      try {\n        // Erzeuge Snapshot über SolarGrid\n        const fullSnapshot = this.solarGrid?.createConfigSnapshot\n          ? this.solarGrid.createConfigSnapshot()\n          : null;\n        if (!fullSnapshot || !Array.isArray(fullSnapshot.configs) || fullSnapshot.configs.length === 0) {\n          this.solarGrid?.showToast?.('Keine Konfiguration zum Exportieren', 3000);\n          return;\n        }\n        let snapshotToExport = fullSnapshot;\n        if (mode === 'current') {\n          const idx = typeof fullSnapshot.currentConfigIndex === 'number' ? fullSnapshot.currentConfigIndex : 0;\n          const only = fullSnapshot.configs[idx] || fullSnapshot.configs[0];\n          snapshotToExport = {\n            timestamp: fullSnapshot.timestamp,\n            totalConfigs: 1,\n            currentConfigIndex: 0,\n            configs: [only]\n          };\n        }\n        await this.generatePDFFromSnapshot(snapshotToExport);\n      } catch (err) {\n        console.error('generatePDF wrapper failed:', err);\n        this.solarGrid?.showToast?.('PDF-Erstellung fehlgeschlagen', 3000);\n      }\n    }\n\n    // Entfernt alte generatePDF-Umleitung: direkte Nutzung von generatePDFFromSnapshot()\n\n    // Entfernt ungenutzte calculateTotalPrice (wir nutzen calculateConfigPrice zentral)\n\n    // Header auf jeder Seite (neues Design)\n    addHeader(pdf, pageWidth, config) {\n      // NEUES DESIGN: Header minimal, weißer Hintergrund mit Titel in dunkelblau\n      pdf.setTextColor(14, 30, 52);\n      pdf.setFontSize(18);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text('Ihre Konfiguration', 20, 20);\n      pdf.setFontSize(10);\n      pdf.setFont('helvetica', 'normal');\n      pdf.text(new Date().toLocaleDateString('de-DE'), pageWidth - 40, 20);\n      pdf.setTextColor(0, 0, 0);\n      return 28; // Y-Start nach Header\n    }\n\n    // Interne Hilfsfunktion: invertiert ein Base64 PNG und cached das Ergebnis\n    async getInvertedLogoBase64(originalBase64) {\n      if (this._invertedLogoBase64Promise) return this._invertedLogoBase64Promise;\n      this._invertedLogoBase64Promise = new Promise((resolve, reject) => {\n        try {\n          const img = new Image();\n          img.onload = () => {\n            try {\n              const canvas = document.createElement('canvas');\n              canvas.width = img.width;\n              canvas.height = img.height;\n              const ctx = canvas.getContext('2d');\n              ctx.drawImage(img, 0, 0);\n              const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n              const data = imageData.data;\n              for (let i = 0; i < data.length; i += 4) {\n                data[i] = 255 - data[i];       // R\n                data[i + 1] = 255 - data[i + 1]; // G\n                data[i + 2] = 255 - data[i + 2]; // B\n                // Alpha bleibt\n              }\n              ctx.putImageData(imageData, 0, 0);\n              resolve(canvas.toDataURL('image/png'));\n            } catch (err) {\n              reject(err);\n            }\n          };\n          img.onerror = reject;\n          img.src = originalBase64;\n        } catch (e) {\n          reject(e);\n        }\n      });\n      return this._invertedLogoBase64Promise;\n    }\n    // Footer mit Logo (invertiert) – neues Design\n    async addFooter(pdf, pageWidth, pageHeight) {\n      const footerY = pageHeight - 25;\n      \n      // Footer Hintergrund\n      pdf.setFillColor(14, 30, 52);\n      pdf.rect(0, footerY, pageWidth, 25, 'F');\n      \n      // Footer Text\n      pdf.setTextColor(255, 255, 255);\n      pdf.setFontSize(8);\n      pdf.setFont('helvetica', 'normal');\n      pdf.text('Schneider Unterkonstruktion - Solar Konfigurator', 20, footerY + 8);\n      pdf.text('unterkonstruktion.de', 20, footerY + 15);\n      \n      // Logo rechts - neues PNG Logo\n      try {\n        // Logo von bereitgestellter URL laden und invertieren\n        const logoBase64 = await this.loadImageAsBase64(this.companyLogoUrl);\n        const invertedLogoBase64 = await this.getInvertedLogoBase64(logoBase64);\n        const logoHeight = 15; // Feste Höhe\n        const logoWidth = logoHeight * 3.1338028169; // Exaktes Verhältnis 3.1338028169:1\n        const logoX = pageWidth - logoWidth - 20; // 20px Abstand vom rechten Rand\n        const logoY = footerY + 5; // 5px Abstand vom oberen Footer-Rand\n\n        // Base64 Logo als Bild einbetten (invertiert)\n        pdf.addImage(invertedLogoBase64, 'PNG', logoX, logoY, logoWidth, logoHeight);\n      } catch (error) {\n        console.warn('Logo konnte nicht geladen werden:', error);\n        pdf.setFontSize(12);\n        pdf.setFont('helvetica', 'bold');\n        pdf.text('Schneider Unterkonstruktion', pageWidth - 120, footerY + 12);\n      }\n    }\n\n    // Lädt ein Bild (CORS-fähig) von URL und gibt ein Base64 PNG zurück\n    async loadImageAsBase64(url) {\n      return new Promise((resolve, reject) => {\n        try {\n          const img = new Image();\n          img.crossOrigin = 'anonymous';\n          img.onload = () => {\n            try {\n              const canvas = document.createElement('canvas');\n              canvas.width = img.naturalWidth || img.width;\n              canvas.height = img.naturalHeight || img.height;\n              const ctx = canvas.getContext('2d');\n              ctx.imageSmoothingEnabled = true;\n              ctx.drawImage(img, 0, 0);\n              resolve(canvas.toDataURL('image/png'));\n            } catch (e) {\n              reject(e);\n            }\n          };\n          img.onerror = reject;\n          img.src = url;\n        } catch (e) {\n          reject(e);\n        }\n      });\n    }\n\n    // Hilfsmethode für Gesamtpreis-Berechnung aus Snapshot\n    async calculateTotalPriceFromSnapshot(config) {\n      const parts = await this.calculatePartsFromSnapshot(config);\n      \n      let totalPrice = 0;\n      Object.entries(parts).forEach(([key, value]) => {\n        if (value > 0) {\n          const packs = Math.ceil(value / (VE[key] || 1));\n          const pricePerPack = getPackPriceForQuantity(key, value);\n          totalPrice += packs * pricePerPack;\n        }\n      });\n\n      return totalPrice;\n    }\n    // NEUE ISOLIERTE Konfiguration zu PDF hinzufügen (aus Snapshot)\n    async addConfigurationToPDFFromSnapshot(pdf, config, isFirstPage) {\n      const pageWidth = 210; // A4 Breite in mm\n      const pageHeight = 297; // A4 Höhe in mm\n      const bottomMargin = 30; // Erhöhter Rand für Footer\n      \n      // Verwende Objekt für yPosition damit es von checkPageBreak geändert werden kann\n      const positionRef = { y: 25 };\n\n      // Hilfsfunktion für Seitenumbruch-Prüfung mit mehr Platz\n      const checkPageBreak = async (neededSpace = 20) => {\n        if (positionRef.y + neededSpace > pageHeight - bottomMargin) {\n          // Footer auf aktueller Seite hinzufügen\n          await this.addFooter(pdf, pageWidth, pageHeight);\n          // Neue Seite hinzufügen\n          pdf.addPage();\n          // Header auf neuer Seite\n          this.addHeader(pdf, pageWidth, config);\n          positionRef.y = 28;\n          return true;\n        }\n        return false;\n      };\n\n      /* pdf debug removed */\n\n      // Header zeichnen (auf jeder Seite identisch)\n      positionRef.y = this.addHeader(pdf, pageWidth, config);\n\n      // Projekt-Info Sektion: dezenter Container\n      await checkPageBreak(20);\n      pdf.setDrawColor(229, 231, 235); // #e5e7eb\n      pdf.setLineWidth(0.5);\n      pdf.rect(15, positionRef.y - 4, pageWidth - 30, 14);\n      pdf.setFont('helvetica', 'bold');\n      pdf.setFontSize(12);\n      pdf.setTextColor(14, 30, 52);\n      pdf.text(`Projekt: ${config.name || 'Unbenannt'}`, 20, positionRef.y + 6);\n      pdf.setTextColor(0, 0, 0);\n      positionRef.y += 22;\n\n      // Grid-Informationen\n      await checkPageBreak(20);\n      pdf.setFontSize(11);\n      pdf.setFont('helvetica', 'normal');\n      pdf.text(`Grid: ${config.cols} × ${config.rows} Module (${config.selectedCells} ausgewählt)`, 20, positionRef.y);\n      pdf.text(`Orientierung: ${config.orientation === 'vertical' ? 'Vertikal' : 'Horizontal'}`, 20, positionRef.y + 8);\n      positionRef.y += 20;\n\n      // Grid-Screenshot hinzufügen (ISOLIERT mit Snapshot-Daten)\n      try {\n        const gridImage = await this.captureGridVisualizationFromSnapshot(config);\n        if (gridImage) {\n          // Maximal 70% der A4-Höhe für das Grid-Bild\n          const maxHeight = Math.floor(pageHeight * 0.5); // 50% der Seite\n          const targetWidth = 170; // mm\n          // Berechne proportional die Bildhöhe anhand Zielbreite (Grid-Images werden im Verhältnis ~4:3 erzeugt)\n          let computedHeight = Math.round((targetWidth * 3) / 4);\n          if (computedHeight > maxHeight) {\n            // Skaliere runter, wenn höher als 70% der Seite\n            const scale = maxHeight / computedHeight;\n            computedHeight = Math.round(computedHeight * scale);\n          }\n\n          await checkPageBreak(computedHeight + 15);\n\n          // Zentriert platzieren\n          const centerX = (pageWidth - targetWidth) / 2;\n          const centerY = positionRef.y;\n          pdf.addImage(gridImage, 'PNG', centerX, centerY, targetWidth, computedHeight);\n          positionRef.y += computedHeight + 10;\n        }\n      } catch (error) {\n        console.warn('Grid-Screenshot fehlgeschlagen:', error);\n        positionRef.y += 10;\n      }\n\n      // Produkttabelle auf NEUE SEITE schieben, damit nichts abgeschnitten wird\n      await this.addFooter(pdf, pageWidth, pageHeight);\n      pdf.addPage();\n      this.addHeader(pdf, pageWidth, config);\n      positionRef.y = 28;\n      // Produkttabelle (ISOLIERT mit Snapshot-Daten)\n      await checkPageBreak(60);\n      positionRef.y = await this.addProductTableFromSnapshot(pdf, config, positionRef.y, checkPageBreak);\n\n      // Gesamtpreis hervorgehoben\n      await checkPageBreak(25);\n      const totalPrice = await this.calculateTotalPriceFromSnapshot(config);\n      pdf.setFillColor(14, 30, 52);\n      pdf.rect(15, positionRef.y - 5, pageWidth - 30, 20, 'F');\n      \n      pdf.setTextColor(255, 255, 255);\n      pdf.setFontSize(14);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text('GESAMTPREIS:', 20, positionRef.y + 8);\n      const totalText = `${totalPrice.toFixed(2)} € (exkl. MwSt)`;\n      pdf.text(totalText, 170, positionRef.y + 8);\n      \n      pdf.setTextColor(0, 0, 0);\n      positionRef.y += 30;\n\n      // Produkte pro Modul Informationen entfernt - nicht mehr notwendig\n\n      // Footer mit Logo auf der letzten Seite\n      await this.addFooter(pdf, pageWidth, pageHeight);\n    }\n\n    // Erfasse Grid-Visualisierung als Bild\n    async captureGridVisualization(config) {\n      // Alternative Methode: Erstelle temporäres Grid-Element für Screenshot\n      try {\n        const selection = config.selection || [];\n        const cols = config.cols || 5;\n        const rows = config.rows || 5;\n        \n        // Erstelle temporäres Container Element\n        const tempContainer = document.createElement('div');\n        tempContainer.style.position = 'absolute';\n        tempContainer.style.left = '-10000px';\n        tempContainer.style.top = '-10000px';\n        tempContainer.style.padding = '20px';\n        tempContainer.style.backgroundColor = '#ffffff';\n        document.body.appendChild(tempContainer);\n\n        // Erstelle Grid HTML mit kompaktem Design\n        const cellSize = 50; // Zellgröße beibehalten\n        const cellGap = 2; // Maximal 2px Abstand\n        \n        const gridEl = document.createElement('div');\n        gridEl.style.display = 'grid';\n        gridEl.style.gap = `${cellGap}px`;\n        gridEl.style.gridTemplateColumns = `repeat(${cols}, ${cellSize}px)`;\n        gridEl.style.gridTemplateRows = `repeat(${rows}, ${cellSize}px)`;\n        gridEl.style.padding = '2px'; // Kompakter äußerer Abstand\n        gridEl.style.backgroundColor = '#ffffff';\n        gridEl.style.border = '1px solid #000000'; // 1px schwarze Border\n        gridEl.style.borderRadius = '1rem'; // 1rem border-radius\n\n        // Normalisiere Selection-Array für die gewünschten Dimensionen\n        const normalizedSelection = Array.from({ length: rows }, (_, y) =>\n          Array.from({ length: cols }, (_, x) => {\n            // Prüfe ob die gespeicherte Selection diese Position abdeckt\n            if (selection[y] && Array.isArray(selection[y]) && x < selection[y].length) {\n              return selection[y][x] === true;\n            }\n            // Falls außerhalb der gespeicherten Dimensionen: false (nicht ausgewählt)\n            return false;\n          })\n        );\n\n        /* preview debug removed */\n\n        // Erstelle alle Grid-Zellen\n        for (let y = 0; y < rows; y++) {\n          for (let x = 0; x < cols; x++) {\n            const cell = document.createElement('div');\n            \n            // Verwende die normalisierte Selection\n            const isSelected = normalizedSelection[y][x];\n            \n            /* preview debug removed */\n            \n            // Basis-Styles für alle Zellen\n            cell.style.width = `${cellSize}px`;\n            cell.style.height = `${cellSize}px`;\n            cell.style.borderRadius = '1rem'; // 1rem border-radius\n            cell.style.border = '1px solid #000000'; // 1px schwarze Border\n            \n            if (isSelected) {\n              // Ausgewählte Zelle - Dunkelblaue Farbe\n              cell.style.backgroundColor = '#072544';\n            } else {\n              // Nicht-ausgewählte Zelle - hell-grau\n              cell.style.backgroundColor = '#f3f4f6';\n            }\n            \n            gridEl.appendChild(cell);\n          }\n        }\n        \n        tempContainer.appendChild(gridEl);\n\n        // Warte auf Rendering\n        await new Promise(resolve => requestAnimationFrame(resolve));\n        await new Promise(resolve => setTimeout(resolve, 100)); // Kurze Wartezeit, kein Bild-Download nötig\n\n        // Screenshot von temporärem Element\n        const canvas = await this.html2canvas(tempContainer, {\n          backgroundColor: '#ffffff',\n          scale: 2,\n          logging: false,\n          useCORS: true,\n          allowTaint: true,\n          width: tempContainer.offsetWidth,\n          height: tempContainer.offsetHeight\n        });\n\n        // Aufräumen\n        document.body.removeChild(tempContainer);\n        \n        return canvas.toDataURL('image/png');\n\n      } catch (error) {\n        console.warn('Grid-Screenshot fehlgeschlagen:', error);\n        return null;\n      }\n    }\n    // NEUE METHODE: Grid-Bild für Webhook generieren\n    async captureGridImageForWebhook(configData) {\n      try {\n        const selection = configData.selection || [];\n        const cols = configData.cols || 5;\n        const rows = configData.rows || 5;\n        \n        // Erstelle temporäres Container Element\n        const tempContainer = document.createElement('div');\n        tempContainer.style.position = 'absolute';\n        tempContainer.style.left = '-10000px';\n        tempContainer.style.top = '-10000px';\n        tempContainer.style.padding = '20px';\n        tempContainer.style.backgroundColor = '#ffffff';\n        document.body.appendChild(tempContainer);\n\n        // Grid-Eigenschaften für Webhook-optimierte Darstellung\n        const isVertical = configData.orientation === 'vertical';\n        const baseCellSize = 58; // Kompakter und moderner\n        const cellWidth = isVertical ? Math.round(baseCellSize * 0.62) : baseCellSize;\n        const cellHeight = isVertical ? baseCellSize : Math.round(baseCellSize * 0.62);\n        const cellGap = 2; // wie im UI\n        \n        const gridEl = document.createElement('div');\n        gridEl.style.display = 'grid';\n        gridEl.style.gap = `${cellGap}px`;\n        gridEl.style.gridTemplateColumns = `repeat(${cols}, ${cellWidth}px)`;\n        gridEl.style.gridTemplateRows = `repeat(${rows}, ${cellHeight}px)`;\n        gridEl.style.padding = '16px';\n        gridEl.style.backgroundColor = '#f5f7fa';\n        gridEl.style.border = '1px solid #e5e7eb';\n        gridEl.style.borderRadius = '12px';\n        gridEl.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';\n\n        // Grid-Zellen erstellen\n        for (let y = 0; y < rows; y++) {\n          for (let x = 0; x < cols; x++) {\n            const cell = document.createElement('div');\n            const isSelected = selection[y] && selection[y][x] === true;\n            \n            cell.style.width = `${cellWidth}px`;\n            cell.style.height = `${cellHeight}px`;\n            cell.style.borderRadius = '6px';\n            cell.style.border = '1px solid #d1d5db';\n            cell.style.transition = 'all 0.2s ease';\n            \n            if (isSelected) {\n              // Ausgewählte Zelle - modernes Solar-Panel-Design (nah am UI)\n              cell.style.backgroundColor = '#0b0b0b';\n              cell.style.border = '2px solid #cccccc';\n              cell.style.boxShadow = 'inset 0 2px 4px rgba(0,0,0,0.25)';\n              \n              // Solar-Panel-Pattern hinzufügen\n              const pattern = document.createElement('div');\n              pattern.style.width = '100%';\n              pattern.style.height = '100%';\n              pattern.style.background = `linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0) 40%),\n                linear-gradient(135deg, #0b0b0b 0%, #111111 50%, #0b0b0b 100%)`;\n              pattern.style.borderRadius = '4px';\n              pattern.style.position = 'relative';\n              \n              // Grid-Linien für Solarpanel-Look\n              const gridLines = document.createElement('div');\n              gridLines.style.position = 'absolute';\n              gridLines.style.top = '2px';\n              gridLines.style.left = '2px';\n              gridLines.style.right = '2px';\n              gridLines.style.bottom = '2px';\n              gridLines.style.backgroundImage = `\n                linear-gradient(to right, rgba(255,255,255,0.08) 1px, transparent 1px),\n                linear-gradient(to bottom, rgba(255,255,255,0.08) 1px, transparent 1px)\n              `;\n              gridLines.style.backgroundSize = '33% 50%';\n              \n              pattern.appendChild(gridLines);\n              cell.appendChild(pattern);\n            } else {\n              // Unausgewählte Zelle - neutral (wie UI)\n              cell.style.backgroundColor = '#f3f4f6';\n              cell.style.border = '1px solid #e5e7eb';\n            }\n            \n            gridEl.appendChild(cell);\n          }\n        }\n        \n        tempContainer.appendChild(gridEl);\n        \n        // Warte auf Rendering\n        await new Promise(resolve => requestAnimationFrame(resolve));\n        await new Promise(resolve => setTimeout(resolve, 150));\n\n        // Canvas für Screenshot erstellen\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        \n        // Canvas-Größe berechnen\n        const totalWidth = cols * cellWidth + (cols - 1) * cellGap + 40; // +40 für padding\n        const totalHeight = rows * cellHeight + (rows - 1) * cellGap + 40;\n        \n        canvas.width = totalWidth;\n        canvas.height = totalHeight;\n        \n        // Weißer Hintergrund\n        ctx.fillStyle = '#ffffff';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n        \n        // Grid manuell auf Canvas zeichnen\n        const startX = 20; // Padding\n        const startY = 20; // Padding\n        \n        for (let y = 0; y < rows; y++) {\n          for (let x = 0; x < cols; x++) {\n            const cellX = startX + x * (cellWidth + cellGap);\n            const cellY = startY + y * (cellHeight + cellGap);\n            const isSelected = selection[y] && selection[y][x] === true;\n            \n            if (isSelected) {\n              // Ausgewählte Zelle - Dunkelblau\n              ctx.fillStyle = '#072544';\n              ctx.fillRect(cellX, cellY, cellWidth, cellHeight);\n              \n              // Border\n              ctx.strokeStyle = '#0a4d75';\n              ctx.lineWidth = 2;\n              ctx.strokeRect(cellX, cellY, cellWidth, cellHeight);\n              \n              // Solar-Panel-Grid\n              ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n              ctx.lineWidth = 1;\n              \n              // Vertikale Linien\n              for (let i = 1; i < 3; i++) {\n                const lineX = cellX + (cellWidth / 3) * i;\n                ctx.beginPath();\n                ctx.moveTo(lineX, cellY + 2);\n                ctx.lineTo(lineX, cellY + cellHeight - 2);\n                ctx.stroke();\n              }\n              \n              // Horizontale Mittellinie\n              const lineY = cellY + cellHeight / 2;\n              ctx.beginPath();\n              ctx.moveTo(cellX + 2, lineY);\n              ctx.lineTo(cellX + cellWidth - 2, lineY);\n              ctx.stroke();\n            } else {\n              // Unausgewählte Zelle - Hell grau\n              ctx.fillStyle = '#f8f9fa';\n              ctx.fillRect(cellX, cellY, cellWidth, cellHeight);\n              \n              // Border\n              ctx.strokeStyle = '#e9ecef';\n              ctx.lineWidth = 1;\n              ctx.strokeRect(cellX, cellY, cellWidth, cellHeight);\n            }\n          }\n        }\n        \n        // Grid-Rahmen dezent zeichnen (moderner Look)\n        ctx.strokeStyle = '#e5e7eb';\n        ctx.lineWidth = 1;\n        ctx.strokeRect(10, 10, totalWidth - 20, totalHeight - 20);\n        \n        // Canvas zu Base64 konvertieren\n        const base64Image = canvas.toDataURL('image/png');\n        \n        console.log('Canvas generated:', {\n          canvasWidth: canvas.width,\n          canvasHeight: canvas.height,\n          dataURLLength: base64Image.length,\n          dataURLStart: base64Image.substring(0, 50) + '...'\n        });\n        \n        // Cleanup\n        document.body.removeChild(tempContainer);\n        \n        return base64Image;\n        \n      } catch (error) {\n        console.error('Grid-Bild-Generierung fehlgeschlagen:', error);\n        return null;\n      }\n    }\n\n    // NEUE ISOLIERTE Grid-Capture im UI-Design (gleiches Layout/Design wie Hauptgrid)\n    async captureGridVisualizationFromSnapshot(config) {\n      try {\n        const selection = config.selection || [];\n        const cols = config.cols || 5;\n        const rows = config.rows || 5;\n\n        // Zielgröße im PDF\n        const maxWidthPx = 698;\n        const maxHeightPx = Math.floor(1123 * 0.5);\n\n        // Modulverhältnis aus echten Maßen und Orientierung\n        const modW = Number(config.cellWidth || 179);\n        const modH = Number(config.cellHeight || 113);\n        const orientVertical = config.orientation === 'vertical';\n        const unitW = orientVertical ? modH : modW;\n        const unitH = orientVertical ? modW : modH;\n        const baseGap = 2;\n        const wrapperPadding = 16; // wie .canvas\n\n        // Skaliere, um in die Zielbox zu passen (inkl. Padding)\n        const rawW = unitW * cols + baseGap * (cols - 1) + wrapperPadding * 2;\n        const rawH = unitH * rows + baseGap * (rows - 1) + wrapperPadding * 2;\n        const scale = Math.min(maxWidthPx / rawW, maxHeightPx / rawH, 1);\n        const cellW = Math.max(1, unitW * scale);\n        const cellH = Math.max(1, unitH * scale);\n        const gap = Math.max(1, Math.round(baseGap * scale));\n\n        // Offscreen-Container im UI-Stil aufbauen\n        const tempRoot = document.createElement('div');\n        tempRoot.style.position = 'absolute';\n        tempRoot.style.left = '-10000px';\n        tempRoot.style.top = '-10000px';\n        tempRoot.style.width = `${Math.ceil(cols * cellW + (cols - 1) * gap + wrapperPadding * 2)}px`;\n        tempRoot.style.height = `${Math.ceil(rows * cellH + (rows - 1) * gap + wrapperPadding * 2)}px`;\n\n        const canvasLike = document.createElement('div');\n        canvasLike.className = 'canvas';\n        canvasLike.style.width = '100%';\n        canvasLike.style.height = '100%';\n        canvasLike.style.padding = `${wrapperPadding}px`;\n        canvasLike.style.background = '#d0d0d0';\n        canvasLike.style.borderRadius = '6px';\n        canvasLike.style.display = 'flex';\n        canvasLike.style.alignItems = 'center';\n        canvasLike.style.justifyContent = 'center';\n        canvasLike.style.boxSizing = 'border-box';\n\n        const overflow = document.createElement('div');\n        overflow.style.overflow = 'hidden';\n        overflow.style.display = 'flex';\n        overflow.style.alignItems = 'center';\n        overflow.style.justifyContent = 'center';\n\n        const grid = document.createElement('div');\n        grid.style.display = 'grid';\n        grid.style.gap = `${gap}px`;\n        grid.style.gridTemplateColumns = `repeat(${cols}, ${Math.round(cellW)}px)`;\n        grid.style.gridTemplateRows = `repeat(${rows}, ${Math.round(cellH)}px)`;\n\n        for (let y = 0; y < rows; y++) {\n          for (let x = 0; x < cols; x++) {\n            const cell = document.createElement('div');\n            cell.style.width = `${Math.round(cellW)}px`;\n            cell.style.height = `${Math.round(cellH)}px`;\n            cell.style.borderRadius = '6px';\n            cell.style.boxSizing = 'border-box';\n            const isSelected = !!(selection[y] && selection[y][x]);\n            if (isSelected) {\n              cell.style.background = '#0b0b0b';\n              cell.style.border = '2px solid #cccccc';\n            } else {\n              cell.style.background = '#f3f4f6';\n              cell.style.border = '1px solid #e5e7eb';\n            }\n            grid.appendChild(cell);\n          }\n        }\n\n        overflow.appendChild(grid);\n        canvasLike.appendChild(overflow);\n        tempRoot.appendChild(canvasLike);\n        document.body.appendChild(tempRoot);\n\n        // Rendern lassen und Screenshot erstellen\n        await new Promise(r => requestAnimationFrame(r));\n        await new Promise(r => setTimeout(r, 50));\n        const canvas = await this.html2canvas(tempRoot, {\n          backgroundColor: '#ffffff',\n          scale: 2,\n          useCORS: true,\n          logging: false\n        });\n        document.body.removeChild(tempRoot);\n        return canvas.toDataURL('image/png');\n      } catch (error) {\n        console.error('Grid-Screenshot fehlgeschlagen:', error);\n        return null;\n      }\n    }\n\n    // NEUE ISOLIERTE Produkttabelle aus Snapshot\n    async addProductTableFromSnapshot(pdf, config, yPosition, checkPageBreak) {\n      try {\n        console.log('addProductTableFromSnapshot called for:', config.name);\n        \n        // Berechne Produkte aus Snapshot-Daten (isoliert)\n        const parts = await this.calculatePartsFromSnapshot(config);\n        \n        console.log('Received parts:', parts, 'Keys count:', Object.keys(parts || {}).length);\n        console.log('Parts entries:', Object.entries(parts || {}));\n        console.log('UlicaSolarBlackJadeFlow in parts:', parts?.UlicaSolarBlackJadeFlow);\n        \n        if (!parts || Object.keys(parts).length === 0) {\n          console.log('No parts calculated, returning early');\n          return yPosition;\n        }\n\n        // NEUES DESIGN: Produkttabelle mit Header\n        await checkPageBreak(30);\n        \n        // Header im Stil der Sidebar (Orange, abgerundet)\n        pdf.setFillColor(255, 177, 1); // #FFB101\n        if (pdf.roundedRect) {\n          pdf.roundedRect(15, yPosition - 5, 180, 15, 3, 3, 'F');\n        } else {\n          pdf.rect(15, yPosition - 5, 180, 15, 'F');\n        }\n        \n        pdf.setTextColor(255, 255, 255);\n        pdf.setFontSize(12);\n        pdf.setFont('helvetica', 'bold');\n        pdf.text('PRODUKT-LISTE', 20, yPosition + 5);\n        \n        pdf.setTextColor(0, 0, 0);\n        yPosition += 20;\n\n        // Tabellen-Header im Stil der Sidebar-Elemente (Dunkelblau, abgerundet oben)\n        await checkPageBreak(15);\n        pdf.setFillColor(14, 30, 52); // #0e1e34\n        if (pdf.roundedRect) {\n          pdf.roundedRect(15, yPosition - 3, 180, 12, 3, 3, 'F');\n        } else {\n          pdf.rect(15, yPosition - 3, 180, 12, 'F');\n        }\n        \n        pdf.setTextColor(255, 255, 255);\n        pdf.setFontSize(9);\n        pdf.setFont('helvetica', 'bold');\n        // Neue Spalten: Anzahl | Produkt (+VE klein) | Benötigte Menge | Preis\n        pdf.text('Anzahl', 20, yPosition + 3);\n        pdf.text('Produkt', 45, yPosition + 3);\n        pdf.text('Benötigte Menge', 120, yPosition + 3);\n        pdf.text('Preis', 170, yPosition + 3);\n        \n        pdf.setTextColor(0, 0, 0);\n        yPosition += 15;\n\n        // Tabellen-Inhalt mit alternierenden Zeilen\n        pdf.setFont('helvetica', 'normal');\n        pdf.setFontSize(8);\n        let totalPrice = 0;\n        let rowCount = 0;\n\n        for (const [productKey, quantity] of Object.entries(parts)) {\n          console.log('Processing product:', productKey, 'quantity:', quantity);\n          if (quantity > 0) {\n            console.log('Adding to PDF:', productKey, 'quantity:', quantity);\n            await checkPageBreak(12);\n\n            // Alternierende Zeilen-Hintergründe\n            if (rowCount % 2 === 1) {\n              pdf.setFillColor(245, 245, 245); // #f5f5f5 wie Sidebar-Panels\n              pdf.rect(15, yPosition - 2, 180, 10, 'F');\n            }\n\n            const productName = PRODUCT_NAME_MAP[productKey] || productKey.replace(/_/g, ' ');\n            const ve = VE[productKey] || 1;\n            const packsNeeded = Math.ceil(quantity / ve);\n            const pricePerPack = getPackPriceForQuantity(productKey, quantity);\n            const totalForProduct = packsNeeded * pricePerPack;\n            totalPrice += totalForProduct;\n\n            // Spalte 1: Anzahl (z.B. 1x, 2x)\n            pdf.setFont('helvetica', 'bold');\n            pdf.text(`${packsNeeded}x`, 22, yPosition + 2, { align: 'left' });\n\n            // Spalte 2: Produktname + kleine VE darunter (grau)\n            pdf.setFont('helvetica', 'bold');\n            pdf.setFontSize(10);\n            pdf.text(productName, 45, yPosition + 1);\n            pdf.setFont('helvetica', 'normal');\n            pdf.setFontSize(8);\n            pdf.setTextColor(128, 128, 128);\n            pdf.text(`${ve} Stück`, 45, yPosition + 6);\n            pdf.setTextColor(0, 0, 0);\n\n            // Spalte 3: benötigte Menge (wie bisher Menge)\n            pdf.setFont('helvetica', 'normal');\n            pdf.setFontSize(9);\n            pdf.text(`${quantity}`, 140, yPosition + 2, { align: 'right' });\n\n            // Spalte 4: Preis (Gesamtpreis für diese Position)\n            pdf.setFont('helvetica', 'bold');\n            pdf.text(`${totalForProduct.toFixed(2)} €`, 190, yPosition + 2, { align: 'right' });\n\n            yPosition += 12;\n            rowCount++;\n          }\n        }\n\n        // Gesamt-Linie\n        await checkPageBreak(15);\n        pdf.setDrawColor(233, 236, 239); // #e9ecef Trennlinie wie UI\n        pdf.setLineWidth(1);\n        pdf.line(15, yPosition, 195, yPosition);\n        yPosition += 5;\n\n        return yPosition;\n\n      } catch (error) {\n        console.error('Produkttabelle fehlgeschlagen:', error);\n        return yPosition;\n      }\n    }\n    // Isolierte Produktberechnung aus Snapshot\n    async calculatePartsFromSnapshot(config) {\n      try {\n        console.log('Calculating parts for config:', config.name, {\n          selectedCells: config.selectedCells,\n          rows: config.rows,\n          cols: config.cols,\n          includeModules: config.includeModules\n        });\n\n        // Erstelle isolierte Calculation-Data aus Snapshot (optimiert)\n        const calculationData = {\n          selection: config.selection, // Direkte Referenz - Worker arbeitet isoliert\n          rows: config.rows,\n          cols: config.cols,\n          cellWidth: config.cellWidth || 179,\n          cellHeight: config.cellHeight || 113,\n          orientation: config.orientation || 'horizontal',\n          options: {\n            erdungsband: config.erdungsband || false,\n            ulicaModule: config.ulicaModule === true,\n            includeModules: config.includeModules === true || config.incM === true\n          }\n        };\n        \n\n\n        let parts;\n        try {\n          // Versuche Web Worker calculation\n          parts = await calculationManager.calculate('calculateParts', calculationData);\n        } catch (error) {\n          console.warn('calculationManager failed, using fallback:', error);\n          // Fallback zu direkter Berechnung\n          parts = this.calculatePartsDirectly(calculationData);\n        }\n\n        console.log('Parts calculated:', parts);\n        console.log('Config checkbox states:', {\n          includeModules: config.includeModules,\n          incM: config.incM,\n          ulicaModule: config.ulicaModule\n        });\n        console.log('Config object keys:', Object.keys(config));\n        console.log('Config ulicaModule value:', config.ulicaModule, 'type:', typeof config.ulicaModule);\n        console.log('CalculationData options:', calculationData.options);\n\n        // Module nur hinzufügen wenn Checkbox aktiviert ist\n        if (!config.includeModules && !config.incM) {\n          console.log('Deleting Solarmodul - both checkboxes false');\n          delete parts.Solarmodul;\n        }\n        \n        if (config.ulicaModule !== true) {\n          console.log('Deleting UlicaSolarBlackJadeFlow - ulicaModule is not true');\n          delete parts.UlicaSolarBlackJadeFlow;\n        } else {\n          console.log('Keeping UlicaSolarBlackJadeFlow - ulicaModule is true');\n        }\n\n        // Zusatzprodukte basierend auf Checkboxen\n        if (!config.mc4) {\n          console.log('Deleting MC4 - mc4 checkbox false');\n          delete parts.MC4;\n        }\n        if (!config.cable) {\n          console.log('Deleting Solarkabel - cable checkbox false');\n          delete parts.Solarkabel;\n        }\n        if (!config.wood) {\n          console.log('Deleting Holzunterleger - wood checkbox false');\n          delete parts.Holzunterleger;\n        }\n        if (!config.quetschkabelschuhe) {\n          console.log('Deleting Ringkabelschuhe - ringkabelschuhe checkbox false');\n          delete parts.Ringkabelschuhe;\n        }\n        if (!config.kabelbinder) {\n          console.log('Deleting Kabelbinder - kabelbinder checkbox false');\n          delete parts.Kabelbinder;\n        }\n\n        // Erdungsband hinzufügen wenn aktiviert\n        if (config.erdungsband) {\n          // Verwende die SolarGrid-Instanz für Erdungsband-Berechnung\n          parts.Erdungsband = this.solarGrid.calculateErdungsband();\n        } else {\n          delete parts.Erdungsband;\n        }\n\n        // Palettenlogik nachträglich anwenden, damit nachgelagerte Renderer/Preise profitieren\n        try {\n          const ulicaSelected = config.ulicaModule === true;\n          const pieceKey = ulicaSelected ? 'UlicaSolarBlackJadeFlow' : 'Solarmodul';\n          const palletKey = ulicaSelected ? 'UlicaSolarBlackJadeFlowPalette' : 'SolarmodulPalette';\n          const count = Number(parts[pieceKey] || 0);\n          if (count > 0) {\n            const pallets = Math.floor(count / 36);\n            const remainder = count % 36;\n            if (pallets > 0) {\n              parts[palletKey] = (parts[palletKey] || 0) + pallets * 36; // Stückbasis\n            }\n            parts[pieceKey] = remainder;\n          }\n        } catch (e) {}\n\n        console.log('Final parts after processing:', parts);\n        return parts;\n\n      } catch (error) {\n        console.error('Part calculation from snapshot failed:', error);\n        return {};\n      }\n    }\n    // Füge Produkttabelle zum PDF hinzu\n    async addProductTable(pdf, config, yPosition, checkPageBreak) {\n      // NEUES DESIGN: Produkttabelle mit Header – Stil der Sidebar\n      await checkPageBreak(30);\n      pdf.setFillColor(255, 177, 1); // #FFB101\n      if (pdf.roundedRect) {\n        pdf.roundedRect(15, yPosition - 5, 180, 15, 3, 3, 'F');\n      } else {\n        pdf.rect(15, yPosition - 5, 180, 15, 'F');\n      }\n      \n      pdf.setTextColor(14, 30, 52); // Dark Text passend zur Sidebar\n      pdf.setFontSize(12);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text('PRODUKT-LISTE', 20, yPosition + 5);\n      \n      pdf.setTextColor(0, 0, 0);\n      yPosition += 20;\n\n      // Berechne Teile für diese Konfiguration\n      const parts = await this.calculateConfigParts(config);\n      \n      if (!parts || Object.keys(parts).length === 0) {\n        pdf.setFontSize(10);\n        pdf.setFont('helvetica', 'italic');\n        pdf.text('Keine Produkte berechnet.', 20, yPosition);\n        return yPosition + 10;\n      }\n\n      // Tabellen-Header im Stil der Sidebar (Dunkelblau, abgerundet)\n      await checkPageBreak(15);\n      pdf.setFillColor(14, 30, 52); // #0e1e34\n      if (pdf.roundedRect) {\n        pdf.roundedRect(15, yPosition - 3, 180, 12, 3, 3, 'F');\n      } else {\n        pdf.rect(15, yPosition - 3, 180, 12, 'F');\n      }\n      \n      pdf.setTextColor(255, 255, 255);\n      pdf.setFontSize(9);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text('Produkt', 20, yPosition + 3);\n      pdf.text('Menge', 70, yPosition + 3);\n      pdf.text('Pack', 100, yPosition + 3);\n      pdf.text('Preis/Pack', 130, yPosition + 3);\n      pdf.text('Gesamt', 170, yPosition + 3);\n      \n      pdf.setTextColor(0, 0, 0);\n      yPosition += 15;\n\n      // Tabellen-Inhalt mit alternierenden Zeilen\n      pdf.setFont('helvetica', 'normal');\n      pdf.setFontSize(8);\n      let totalPrice = 0;\n      let rowCount = 0;\n\n      for (const [productKey, needed] of Object.entries(parts)) {\n        if (needed > 0) {\n          await checkPageBreak(12);\n\n          // Alternierende Zeilen-Hintergründe – Sidebar-Panel-Farbe\n          if (rowCount % 2 === 1) {\n            pdf.setFillColor(245, 245, 245); // #f5f5f5\n            pdf.rect(15, yPosition - 2, 180, 10, 'F');\n          }\n\n          const ve = VE[productKey] || 1;\n          const packs = Math.ceil(needed / ve);\n          const pricePerPack = getPackPriceForQuantity(productKey, needed);\n          const totalProductPrice = packs * pricePerPack;\n          totalPrice += totalProductPrice;\n\n          const productName = PRODUCT_NAME_MAP[productKey] || productKey.replace(/_/g, ' ');\n\n          pdf.text(productName, 20, yPosition + 2);\n          pdf.text(needed.toString(), 70, yPosition + 2);\n          pdf.text(`${packs}×`, 100, yPosition + 2);\n          pdf.text(`${pricePerPack.toFixed(2)} €`, 130, yPosition + 2);\n          pdf.text(`${totalProductPrice.toFixed(2)} €`, 170, yPosition + 2);\n\n          yPosition += 10;\n          rowCount++;\n        }\n      }\n\n      // Gesamt-Linie – dezente UI-Trennlinie\n      await checkPageBreak(15);\n      pdf.setDrawColor(233, 236, 239); // #e9ecef\n      pdf.setLineWidth(1);\n      pdf.line(15, yPosition, 195, yPosition);\n      yPosition += 5;\n\n      return yPosition;\n    }\n\n    // Füge \"Produkte pro Modul\" Informationen hinzu\n    // Berechne Teile für eine spezifische Konfiguration - VOLLSTÄNDIG ISOLIERT\n    async calculateConfigParts(config) {\n      if (!config.selection || !config.cols || !config.rows) {\n        return {};\n      }\n\n      // ISOLIERTE Berechnung ohne Grid-Eigenschaften zu berühren! (optimiert)\n      const calculationData = {\n        selection: config.selection, // Direkte Referenz - Worker arbeitet isoliert\n        rows: config.rows,\n        cols: config.cols,\n        cellWidth: config.cellWidth || 179,\n        cellHeight: config.cellHeight || 113,\n        orientation: config.orientation,\n        options: {\n          erdungsband: config.erdungsband || false,\n          ulicaModule: config.ulicaModule === true,\n          includeModules: config.includeModules === true || config.incM === true\n        }\n      };\n\n      let parts;\n      try {\n        // Direkte Berechnung mit calculationManager - KEINE Grid-Modification!\n        parts = await calculationManager.calculate('calculateParts', calculationData);\n      } catch (error) {\n        console.warn('calculationManager failed, using fallback:', error);\n        // Fallback zu isolierter Berechnung\n        parts = this.calculatePartsDirectly(calculationData);\n      }\n      \n      // Entferne Module wenn nicht ausgewählt\n      if (!config.includeModules && !config.incM) {\n        console.log('Deleting Solarmodul - both includeModules and incM false');\n        delete parts.Solarmodul;\n      }\n      \n      // Entferne Ulica-Module wenn nicht ausgewählt\n      if (config.ulicaModule !== true) {\n        console.log('Deleting UlicaSolarBlackJadeFlow - ulicaModule is not true');\n        delete parts.UlicaSolarBlackJadeFlow;\n      } else {\n        console.log('Keeping UlicaSolarBlackJadeFlow - ulicaModule is true');\n      }\n      \n      // Füge optionale Komponenten nur hinzu wenn ausgewählt\n      if (config.mc4) {\n        const moduleCount = config.selection.flat().filter(v => v).length;\n        const veMc4 = VE.MC4_Stecker || 50;\n        const packs = Math.ceil(moduleCount / 30);\n        parts.MC4_Stecker = packs * veMc4; // Stückbasis\n        console.log('Added MC4_Stecker packs:', packs, '=> pieces', parts.MC4_Stecker, 'for', moduleCount, 'modules');\n      }\n      \n      if (config.cable) {\n        parts.Solarkabel = 1;\n        console.log('Added Solarkabel: 1');\n      }\n      \n      if (config.wood) {\n        parts.Holzunterleger = 1; // Pauschal 1x zur Gesamtbestellung\n        console.log('Added Holzunterleger: 1');\n      }\n\n      return parts;\n    }\n\n    // Generiere Dateinamen basierend auf Konfiguration(en)\n    generateFileName(configs) {\n      const now = new Date();\n      const dateStr = now.toISOString().slice(0, 10); // YYYY-MM-DD\n      const timeStr = now.toTimeString().slice(0, 5).replace(':', '-'); // HH-MM\n      \n      let configName = 'Solar-Konfiguration';\n      \n      if (configs.length === 1) {\n        configName = configs[0].name || 'Konfiguration';\n      } else if (configs.length > 1) {\n        configName = `${configs.length}-Konfigurationen`;\n      }\n      \n      // Bereinige Dateinamen von ungültigen Zeichen\n      configName = configName.replace(/[<>:\"/\\\\|?*]/g, '-');\n      \n      return `${configName}_${dateStr}_${timeStr}.pdf`;\n    }\n  }\n  // ===== SMART CONFIGURATION PARSER =====\n  class SmartConfigParser {\n    constructor(solarGrid) {\n      this.solarGrid = solarGrid;\n      this.patterns = {\n        // \"5x4\" oder \"5 x 4\" → Grid-Größe\n        gridSize: /(\\d+)\\s*[x×]\\s*(\\d+)(?!\\s*mal)/i,\n        // \"20 module\" → Anzahl Module\n        moduleCount: /(\\d+)\\s*modul[e]?[n]?/i,\n        // Alternative Schreibweisen: \"modulanzahl 18\", \"anzahl module 24\"\n        moduleCountAlt: /(?:modul\\s*anzahl|modulanzahl|anzahl\\s*modul(?:e|en)?|module\\s*anzahl)\\s*(\\d+)/i,\n        // \"mit modulen\" oder \"ohne module\" → Module-Checkbox\n        moduleCheckbox: /(?:mit|ohne)[\\s-]*modul[e]?[n]?(?!\\s*\\d)/i,\n        // \"horizontal\" oder \"vertikal\"\n        orientation: /(?:horizontal|vertikal|vertical)/i,\n        // \"mit mc4\" oder \"ohne mc4\"\n        mc4: /(?:mit|ohne)[\\s-]*mc4/i,\n        // \"mit kabel\" oder \"ohne kabel\"  \n        cable: /(?:mit|ohne)[\\s-]*(?:kabel|solarkabel)/i,\n        // \"mit holz\" oder \"ohne holz\"\n        wood: /(?:mit|ohne)[\\s-]*holz(?:unterleger)?/i,\n        // \"mit quetschkabelschuhe\" oder \"ohne quetschkabelschuhe\"\n        quetschkabelschuhe: /(?:mit|ohne)[\\s-]*(?:quetschkabelschuhe|kabelschuhe)/i,\n        // \"mit kabelbinder\" oder \"ohne kabelbinder\"\n        kabelbinder: /(?:mit|ohne)[\\s-]*kabelbinder/i,\n        // \"3 reihen mit 5 modulen\" oder \"drei reihen 5 module\" oder \"20 module in 4 reihen\" oder \"3 mal 6 module\"\n        rowPattern: /(?:(\\d+|ein|eine|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)\\s*(?:reihen?|zeilen?)\\s*(?:mit|à|a)?\\s*(\\d+)\\s*modul[e]?[n]?)|(?:(\\d+)\\s*modul[e]?[n]?\\s*(?:in|auf)?\\s*(\\d+|ein|eine|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)\\s*(?:reihen?|zeilen?))|(?:(\\d+)\\s*mal\\s*(\\d+)\\s*modul[e]?[n]?)/i,\n        // Reine Reihenangabe: \"reihen 3\"\n        rowsOnly: /(?:reihen?|zeilen?)\\s*(\\d+)/i,\n        // \"mit abstand\" | \"ohne abstand\" | \"1 reihe abstand\" | \"mit doppeltem abstand\"\n        spacing: /(?:(?:mit|ohne)\\s*(?:doppelt\\w*\\s*)?(?:abstand|lücke))|(?:(\\d+)\\s*(?:reihen?|zeilen?)\\s*(?:abstand|lücke))/i,\n        // \"kompakt\" oder \"mit lücken\" für Grid-Syntax\n        gridCompact: /(?:kompakt|ohne\\s*lücken)/i,\n        gridSpaced: /(?:mit\\s*lücken|mit\\s*abstand)/i,\n        // Kombinierte Checkbox-Logik mit \"und\" Verknüpfungen\n        checkboxCombination: /(?:^|\\s)(?:mit|und)\\s+(.+?)(?:\\s+und\\s+(.+?))*(?:\\s*$)/i,\n        // NEUE ACTION PATTERNS:\n        // \"Konfiguration speichern\", \"config speichern\", \"speichern\", \"save\"\n        saveConfig: /^(?:(?:konfiguration|konfig|config)\\s*)?(?:speichern|save)$/i,\n        // \"Konfiguration löschen\", \"config löschen\" (NICHT nur \"löschen\" oder \"delete\")\n        deleteConfig: /^(?:(?:konfiguration|konfig|config)\\s*)?(?:löschen|delete)$/i,\n        // \"module löschen\" → Module-Auswahl löschen\n        deleteModules: /^modul[e]?[n]?\\s*löschen$/i,\n        // NEU: \"Neue Konfiguration\" → aktuelle speichern und neue erstellen\n        newConfig: /^(?:neu(?:e|en)?[\\s-]*(?:konfiguration|konfig|config)(?:[\\s-]*(?:erstellen|anlegen))?|(?:konfiguration|konfig|config)[\\s-]*neu(?:e|en)?(?:[\\s-]*(?:erstellen|anlegen))?|new[\\s-]*(?:config|configuration))$/i,\n        // NEU: \"Alle Konfigurationen löschen\" / \"von vorne beginnen\" → kompletter Reset\n        deleteAllConfigs: /^(?:alle[\\s-]*(?:konfigurationen|configs?|konfigs?)[\\s-]*(?:löschen|entfernen)|(?:alles|alle)[\\s-]*(?:löschen|zurücksetzen)|von[\\s-]*(?:vorne|vorn)[\\s-]*(?:beginnen|anfangen)|neu[\\s-]*starten|start[\\s-]*over|reset[\\s-]*all)$/i,\n        // \"reset\", \"zurücksetzen\" → Grid zurücksetzen\n        resetGrid: /^(?:reset|zurücksetzen|zurücksetzen)$/i,\n        // Intelligente Modul-Verteilung (\"gleichmäßig\" wird deprecated behandelt)\n        distributionEqual: /(?:gleich[-\\s]*m[aä]ßig|gleichmaessig|gleich|optimal)/i,\n        distributionRows: /(?:in\\s*reihen|reihenweise)/i,\n        distributionColumns: /(?:in\\s*spalten|spaltenweise)/i,\n        distributionRandom: /(?:zuf[aä]llig|zufaellig|random)/i,\n        // Erweiterte Abstand-Logik\n        spacingDouble: /(?:doppelter|doppeltem)\\s*abstand/i,\n        spacingRowsOnly: /(?:nur\\s*)?(?:zwischen\\s*)?reihen/i,\n        spacingColumnsOnly: /(?:nur\\s*)?(?:zwischen\\s*)?spalten/i,\n        // Explizite Reihen-Selektion und Reihen-Lücken (1-basiert)\n        selectRowsExplicit: /mit\\s*modul\\w*\\s*in\\s*(?:reihe|zeile)n?\\s*([0-9\\s,–—\\-a-z]+)/i,\n        gapRowsExplicit: /mit\\s*l[üu]cken\\s*in\\s*(?:reihe|zeile)n?\\s*([0-9\\s,–—\\-a-z]+)/i,\n        // Explizite Spalten-Selektion und Spalten-Lücken (1-basiert)\n        selectColumnsExplicit: /mit\\s*modul\\w*\\s*in\\s*(?:spalte|spalten)\\s*([0-9\\s,–—\\-a-z]+)/i,\n        gapColumnsExplicit: /mit\\s*l[üu]cken\\s*in\\s*(?:spalte|spalten)\\s*([0-9\\s,–—\\-a-z]+)/i,\n        // Alle Reihen/Spalten außer ... (1-basiert, erlaubt Bereiche)\n        allRowsExcept: /alle\\s*(?:reihen|zeilen)\\s*(?:außer|ausser)\\s*([0-9\\s,–—\\-a-z]+)/i,\n        allColumnsExcept: /alle\\s*spalten\\s*(?:außer|ausser)\\s*([0-9\\s,–—\\-a-z]+)/i,\n        // Neue präzise Befehle\n        clearTopRow: /\\b(?:oberste|oberer)\\s*reihe\\s*leer\\b/i,\n        clearBottomRow: /\\b(?:unterste|unterer)\\s*reihe\\s*leer\\b/i,\n        fillFirstNColumns: /\\berst(?:e|en|er)?\\s*(\\d+|ein|eine|eins|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)?\\s*spalten?\\s*f[üu]llen\\b/i,\n        clearFirstNColumns: /\\berst(?:e|en|er)?\\s*(\\d+|ein|eine|eins|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)?\\s*spalten?\\s*leer\\b/i,\n        clearLastNColumns: /\\bletzte[nr]?\\s*(\\d+|ein|eine|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)?\\s*spalten?\\s*leer\\b/i,\n        // Reihen füllen/leeren (erste/letzte N)\n        fillFirstNRows: /\\berst(?:e|en|er)?\\s*(\\d+|ein|eine|eins|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)?\\s*reihen?\\s*f[üu]llen\\b/i,\n        clearFirstNRows: /\\berst(?:e|en|er)?\\s*(\\d+|ein|eine|eins|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)?\\s*reihen?\\s*leer\\b/i,\n        fillLastNRows: /\\bletzte[nr]?\\s*(\\d+|ein|eine|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)?\\s*reihen?\\s*f[üu]llen\\b/i,\n        clearLastNRows: /\\bletzte[nr]?\\s*(\\d+|ein|eine|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)?\\s*reihen?\\s*leer\\b/i,\n        fillOnlyFrame: /\\bnur\\s*rand\\s*f[üu]llen\\b/i,\n        fillBlock: /\\bblock\\s*(\\d+)\\s*[x×]\\s*(\\d+)\\s*ab\\s*reihe\\s*(\\d+)\\s*,?\\s*spalte\\s*(\\d+)\\b/i,\n        fillBlockRelative: /\\bblock\\s*(\\d+)\\s*[x×]\\s*(\\d+)\\s*ab\\s*reihe\\s*von\\s*unten\\s*(\\d+)\\s*,?\\s*spalte\\s*von\\s*rechts\\s*(\\d+)\\b/i,\n        // Kombinierte Checkbox-Syntax\n        checkboxAllExcept: /(?:alles\\s*außer|alle\\s*außer)/i,\n        checkboxOnly: /(?:nur|only)/i,\n        checkboxWithout: /(?:ohne\\s*zubehör|ohne\\s*extras)/i,\n        checkboxWithAll: /(?:mit\\s*allem|alles\\s*mit)/i,\n        // Einfaches \"alles\" aktiviert alle Zusatzprodukte und Module\n        allSimple: /^(?:alles)$/i,\n        // Speichern mit Namen\n        saveWithName: /(?:speichern\\s*als\\s*['\"]?([^'\"]+)['\"]?)/i,\n        // Ulica Modul Auswahl (500/450 W) inkl. Synonyme\n        ulicaModule: /ulica(?:\\s*(500|450)\\s*w?)?|black\\s*jade(?:[-\\s]*flow)?\\s*(500|450)?/i,\n        // NEU: \"hinzufügen\"-Befehle\n        addModulesWatt: /\\b(450|500)\\s*(?:watt|w)\\s*modul(?:e|en)?\\s*hinzuf(?:ügen|uegen)\\b/i,\n        addComponents: /\\b(?:mc4|kabel|holz|quetschkabelschuhe|kabelbinder|erdungsband)(?:\\s*(?:,|und)\\s*(?:mc4|kabel|holz|quetschkabelschuhe|kabelbinder|erdungsband))*\\s*hinzuf(?:ügen|uegen)\\b/i\n      };\n    }\n\n    // Hilfsfunktion: Wandelt Wortzahlen in Nummern um\n    parseWordNumber(word) {\n      const wordNumbers = {\n        'ein': 1, 'eine': 1, 'zwei': 2, 'drei': 3, 'vier': 4, 'fünf': 5,\n        'sechs': 6, 'sieben': 7, 'acht': 8, 'neun': 9, 'zehn': 10\n      };\n      \n      if (typeof word === 'string' && wordNumbers[word.toLowerCase()]) {\n        return wordNumbers[word.toLowerCase()];\n      }\n      \n      return parseInt(word) || 0;\n    }\n\n    // Hilfsfunktion: Parst Checkbox-Kombinationen mit \"und\" Verknüpfungen\n    parseCheckboxCombinations(input) {\n      const checkboxes = {\n        modules: null,  // null = nicht erkannt, true = mit, false = ohne\n        mc4: null,\n        cable: null,\n        wood: null,\n        quetschkabelschuhe: null,\n        kabelbinder: null\n      };\n\n      // Normalisiere Input für bessere Erkennung\n      const normalizedInput = input.toLowerCase()\n        .replace(/modulen?/g, 'module')\n        .replace(/solarkabeln?/g, 'solarkabel')\n        .replace(/holzunterlegern?/g, 'holzunterleger');\n\n      // Teile Input bei \"und\" oder \",\" auf und analysiere jeden Teil\n      let parts = normalizedInput.split(/\\s*(?:und|,)\\s*/);\n      \n      // Bereinige den ersten Teil, falls er mit \"mit\" oder \"ohne\" beginnt\n      if (parts[0] && (parts[0].includes('mit ') || parts[0].includes('ohne '))) {\n        parts[0] = parts[0].replace(/.*(?:mit|ohne)\\s+/, '');\n      }\n      \n      // Entferne leere Teile\n      parts = parts.filter(part => part.trim().length > 0);\n\n      for (const part of parts) {\n        const trimmedPart = part.trim();\n        \n        // Prüfe auf Module (aber nicht wenn es Teil einer Reihen-Konfiguration ist)\n        if (/\\bmodul[e]?[n]?\\b/.test(trimmedPart) && !/\\d+\\s*modul/.test(trimmedPart) && !/reihen/.test(trimmedPart)) {\n          // Prüfe ob \"ohne\" davor steht (auch im ursprünglichen Input)\n          if (/\\bohne[\\s-]+modul[e]?[n]?\\b/.test(trimmedPart) || /\\bohne[\\s-]+modul[e]?[n]?\\b/.test(input.toLowerCase())) {\n            checkboxes.modules = false;\n          } else {\n            checkboxes.modules = true;\n          }\n        }\n        \n        // Prüfe auf MC4\n        if (/\\bmc4\\b/.test(trimmedPart)) {\n          if (/\\bohne[\\s-]+mc4\\b/.test(trimmedPart) || /\\bohne[\\s-]+mc4\\b/.test(input.toLowerCase())) {\n            checkboxes.mc4 = false;\n          } else {\n            checkboxes.mc4 = true;\n          }\n        }\n        \n        // Prüfe auf Kabel\n        if (/\\b(?:kabel|solarkabel)\\b/.test(trimmedPart)) {\n          if (/\\bohne[\\s-]+(?:kabel|solarkabel)\\b/.test(trimmedPart) || /\\bohne[\\s-]+(?:kabel|solarkabel)\\b/.test(input.toLowerCase())) {\n            checkboxes.cable = false;\n          } else {\n            checkboxes.cable = true;\n          }\n        }\n        \n        // Prüfe auf Holzunterleger\n        if (/\\b(?:holz|holzunterleger)\\b/.test(trimmedPart)) {\n          if (/\\bohne[\\s-]+(?:holz|holzunterleger)\\b/.test(trimmedPart) || /\\bohne[\\s-]+(?:holz|holzunterleger)\\b/.test(input.toLowerCase())) {\n            checkboxes.wood = false;\n          } else {\n            checkboxes.wood = true;\n          }\n        }\n        \n        // Prüfe auf Ringkabelschuhe\n        if (/\\b(?:quetschkabelschuhe|kabelschuhe)\\b/.test(trimmedPart)) {\n          if (/\\bohne[\\s-]+(?:quetschkabelschuhe|kabelschuhe)\\b/.test(trimmedPart) || /\\bohne[\\s-]+(?:quetschkabelschuhe|kabelschuhe)\\b/.test(input.toLowerCase())) {\n            checkboxes.quetschkabelschuhe = false;\n          } else {\n            checkboxes.quetschkabelschuhe = true;\n          }\n        }\n        \n        // Prüfe auf Kabelbinder\n        if (/\\bkabelbinder\\b/.test(trimmedPart)) {\n          if (/\\bohne[\\s-]+kabelbinder\\b/.test(trimmedPart) || /\\bohne[\\s-]+kabelbinder\\b/.test(input.toLowerCase())) {\n            checkboxes.kabelbinder = false;\n          } else {\n            checkboxes.kabelbinder = true;\n          }\n        }\n      }\n\n      return checkboxes;\n    }\n    parseInput(input) {\n      // NEU (Testmodus, Schritt 1): Unterstütze ausschließlich Grid-Größe wie \"5x5\"\n      try {\n        const m = input.match(this.patterns.gridSize);\n        if (m) {\n          const cols = parseInt(m[1], 10);\n          const rows = parseInt(m[2], 10);\n          return { cols, rows, forceClearSelection: true };\n        }\n        return {};\n      } catch (e) {\n        console.error('SmartConfig parseInput error (test step 1):', e);\n        return {};\n      }\n      const config = {};\n      \n      try {\n\n      // Grid-Größe parsen\n      const gridMatch = input.match(this.patterns.gridSize);\n      if (gridMatch) {\n        config.cols = parseInt(gridMatch[1]);\n        config.rows = parseInt(gridMatch[2]);\n        \n        // Prüfe auf Abstand auch bei Grid-Größen-Angaben\n        const spacingMatch = input.match(this.patterns.spacing);\n        const spacingDoubleMatch = input.match(this.patterns.spacingDouble);\n        let spacingRows = 0;\n        \n        if (spacingMatch) {\n          if (spacingDoubleMatch) {\n            spacingRows = 2;\n          } else if (spacingMatch[0].toLowerCase().includes('mit') && !spacingMatch[1]) {\n            spacingRows = 1; // Standard-Abstand\n          } else if (spacingMatch[1]) {\n            spacingRows = parseInt(spacingMatch[1]);\n          }\n          \n          // Wenn Abstand bei Grid-Größe, prüfe ob bereits Module vorhanden sind\n          if (spacingRows >= 0) { // >= 0 um auch \"ohne abstand\" zu unterstützen\n            // Überprüfe ob bereits eine Auswahl existiert (dynamische Anpassung)\n            const hasExistingSelection = this.solarGrid.selection && \n              this.solarGrid.selection.some(row => row && row.some(cell => cell === true));\n            \n            if (hasExistingSelection) {\n              // Dynamische Abstand-Anpassung auf bestehendes Grid\n              config.adjustSpacing = {\n                spacing: spacingRows,\n                targetCols: config.cols,\n                targetRows: config.rows\n              };\n            } else {\n              // Neue Grid-Erstellung mit Abstand (wie bisher)\n              const actualRows = Math.ceil(config.rows / (1 + Math.max(spacingRows, 1)));\n              const totalCells = config.cols * actualRows;\n              \n              config.rowConfig = {\n                rows: actualRows,\n                modulesPerRow: config.cols,\n                spacing: spacingRows,\n                totalModules: totalCells\n              };\n            }\n          }\n        }\n        \n        // Prüfe auf Grid-Syntax-Modifikatoren (kompakt/with lücken)\n        const gridCompactMatch = input.match(this.patterns.gridCompact);\n        const gridSpacedMatch = input.match(this.patterns.gridSpaced);\n        \n        if (gridCompactMatch) {\n          config.gridCompact = true; // Keine Abstände\n        } else if (gridSpacedMatch) {\n          config.gridSpaced = true; // Mit Abständen\n        }\n      }\n\n      // Reihen-Pattern parsen (hat Priorität vor einfacher moduleCount)\n      const rowMatch = input.match(this.patterns.rowPattern);\n      \n      // Separate Abstand-Anpassung nur wenn KEINE anderen Patterns gefunden wurden\n      // (z.B. nur \"mit abstand\" ohne Grid-Größe oder Module-Anzahl)\n      const hasOtherPatterns = gridMatch || rowMatch || input.match(this.patterns.moduleCount);\n      \n      if (!hasOtherPatterns) {\n        const spacingOnlyMatch = input.match(this.patterns.spacing);\n        const spacingDoubleOnlyMatch = input.match(this.patterns.spacingDouble);\n        if (spacingOnlyMatch) {\n          let spacingRows = 0;\n          \n          if (spacingDoubleOnlyMatch) {\n            spacingRows = 2; // \"mit doppeltem abstand\"\n          } else if (spacingOnlyMatch[0].toLowerCase().includes('ohne')) {\n            spacingRows = 0; // \"ohne abstand\"\n          } else if (spacingOnlyMatch[0].toLowerCase().includes('mit') && !spacingOnlyMatch[1]) {\n            spacingRows = 1; // \"mit abstand\" (Standard)\n          } else if (spacingOnlyMatch[1]) {\n            spacingRows = parseInt(spacingOnlyMatch[1]); // \"mit X reihen abstand\"\n          }\n          \n          // Prüfe ob bereits Module vorhanden sind\n          const hasExistingSelection = this.solarGrid.selection && \n            this.solarGrid.selection.some(row => row && row.some(cell => cell === true));\n          \n          if (hasExistingSelection) {\n            // Dynamische Abstand-Anpassung auf bestehendes Grid\n            config.adjustSpacing = {\n              spacing: spacingRows,\n              targetCols: null, // Keine spezifische Ziel-Spalten-Anzahl\n              targetRows: null  // Keine spezifische Ziel-Reihen-Anzahl\n            };\n            \n            // Früher Return, da dies die Hauptfunktion ist\n            return config;\n          } else {\n            // Keine Module vorhanden - Fehlermeldung\n            this.solarGrid.showToast(`⚠️ Keine Module vorhanden - erst Module auswählen, dann Abstand anpassen`, 3000);\n            return {};\n          }\n        }\n      }\n      if (rowMatch) {\n        let numRows, modulesPerRow;\n        \n        if (rowMatch[1] && rowMatch[2]) {\n          // \"3 reihen mit 5 modulen\" Format\n          numRows = this.parseWordNumber(rowMatch[1]);\n          modulesPerRow = parseInt(rowMatch[2]);\n        } else if (rowMatch[3] && rowMatch[4]) {\n          // \"20 module in 6 reihen\" Format\n          const totalModules = parseInt(rowMatch[3]);\n          numRows = this.parseWordNumber(rowMatch[4]);\n          // Berechne minimale Spalten für gleichmäßige Verteilung\n          modulesPerRow = Math.ceil(totalModules / numRows);\n          \n          // Speichere zusätzliche Info für intelligente Verteilung\n          config.intelligentDistribution = {\n            totalModules: totalModules,\n            numRows: numRows,\n            baseModulesPerRow: Math.floor(totalModules / numRows),\n            extraModules: totalModules % numRows\n          };\n        } else if (rowMatch[5] && rowMatch[6]) {\n          // \"3 mal 6 module\" Format\n          numRows = parseInt(rowMatch[5]);\n          modulesPerRow = parseInt(rowMatch[6]);\n        }\n        \n        if (numRows && modulesPerRow) {\n          // Prüfe auf Abstand-Spezifikation\n          const spacingMatch = input.match(this.patterns.spacing);\n          let spacingRows = 0;\n          \n          if (spacingMatch) {\n            if (spacingMatch[0].toLowerCase().includes('mit') && !spacingMatch[1]) {\n              spacingRows = 1; // Standard-Abstand\n            } else if (spacingMatch[1]) {\n              spacingRows = parseInt(spacingMatch[1]);\n            }\n          }\n          \n          config.rowConfig = {\n            rows: numRows,\n            modulesPerRow: modulesPerRow,\n            spacing: spacingRows,\n            totalModules: numRows * modulesPerRow\n          };\n          \n          // Berechne benötigte Grid-Größe\n          const neededRows = numRows + (numRows - 1) * spacingRows;\n          config.cols = modulesPerRow;\n          config.rows = neededRows;\n          \n        }\n      }\n      \n      // Intelligente Modul-Verteilung parsen\n      const distributionEqualMatch = input.match(this.patterns.distributionEqual);\n      const distributionRowsMatch = input.match(this.patterns.distributionRows);\n      const distributionColumnsMatch = input.match(this.patterns.distributionColumns);\n      const distributionRandomMatch = input.match(this.patterns.distributionRandom);\n      \n      if (distributionEqualMatch) {\n        // Deprecatet: \"gleichmäßig\" führt nicht mehr zu Auto-Verteilung\n        // Stattdessen: Nutzerhinweis und Auto-Selection unterdrücken\n        config.suppressAutoSelection = true;\n        config.deprecatedNotice = 'distributionEqual';\n      } else if (distributionRowsMatch) {\n        config.distribution = 'rows';\n      } else if (distributionColumnsMatch) {\n        config.distribution = 'columns';\n      } else if (distributionRandomMatch) {\n        // Deprecatet: \"zufällig\" führt nicht mehr zu Auto-Verteilung\n        config.suppressAutoSelection = true;\n        config.deprecatedNotice = 'distributionRandom';\n      }\n      \n      // Module-Anzahl parsen (nur wenn keine Reihen-Konfiguration)\n      if (!rowMatch) {\n        let moduleMatch = input.match(this.patterns.moduleCount);\n        if (!moduleMatch) {\n          const moduleAlt = input.match(this.patterns.moduleCountAlt);\n          if (moduleAlt) {\n            moduleMatch = [, moduleAlt[1], moduleAlt[1]]; // Dummy to enter branch\n            config.moduleCount = parseInt(moduleAlt[1]);\n          }\n        }\n        if (moduleMatch) {\n          if (!config.moduleCount) config.moduleCount = parseInt(moduleMatch[1]);\n          \n          // Prüfe auf Abstand auch bei einfacher Module-Anzahl\n          const spacingMatch = input.match(this.patterns.spacing);\n          const spacingDoubleMatch = input.match(this.patterns.spacingDouble);\n          const spacingRowsOnlyMatch = input.match(this.patterns.spacingRowsOnly);\n          const spacingColumnsOnlyMatch = input.match(this.patterns.spacingColumnsOnly);\n          let spacingRows = 0;\n          \n          if (spacingDoubleMatch) {\n            spacingRows = 2; // Doppelter Abstand\n          } else if (spacingRowsOnlyMatch) {\n            spacingRows = 1; // Nur zwischen Reihen\n            config.spacingRowsOnly = true;\n          } else if (spacingColumnsOnlyMatch) {\n            spacingRows = 1; // Nur zwischen Spalten\n            config.spacingColumnsOnly = true;\n          } else if (spacingMatch) {\n            if (spacingMatch[0].toLowerCase().includes('mit') && !spacingMatch[1]) {\n              spacingRows = 1; // Standard-Abstand\n            } else if (spacingMatch[1]) {\n              spacingRows = parseInt(spacingMatch[1]);\n            }\n          }\n          \n          // Automatisch optimale Grid-Größe berechnen\n          const gridSize = this.calculateOptimalGrid(config.moduleCount);\n          config.cols = gridSize.cols;\n          config.rows = gridSize.rows;\n          \n          // Wenn Abstand gewünscht, erstelle rowConfig für gleichmäßige Verteilung\n          if (spacingRows > 0) {\n            const optimalRows = Math.ceil(Math.sqrt(config.moduleCount / gridSize.cols));\n            const modulesPerRow = Math.ceil(config.moduleCount / optimalRows);\n            \n            config.rowConfig = {\n              rows: optimalRows,\n              modulesPerRow: modulesPerRow,\n              spacing: spacingRows,\n              totalModules: config.moduleCount\n            };\n            \n            // Angepasste Grid-Größe mit Abstand\n            config.rows = optimalRows + (optimalRows - 1) * spacingRows;\n            config.cols = Math.max(config.cols, modulesPerRow);\n          }\n        }\n      }\n\n      // Reine Reihenangabe mit bekannter Modulanzahl → automatische rowConfig\n      const rowsOnlyMatch = input.match(this.patterns.rowsOnly);\n      if (!config.rowConfig && rowsOnlyMatch && config.moduleCount) {\n        const numRows = parseInt(rowsOnlyMatch[1], 10);\n        if (Number.isInteger(numRows) && numRows > 0) {\n          const modulesPerRow = Math.ceil(config.moduleCount / numRows);\n          config.rowConfig = { rows: numRows, modulesPerRow, spacing: 0, totalModules: config.moduleCount };\n          config.intelligentDistribution = {\n            totalModules: config.moduleCount,\n            numRows,\n            baseModulesPerRow: Math.floor(config.moduleCount / numRows),\n            extraModules: config.moduleCount % numRows\n          };\n          // Passen Grid-Abmessungen an\n          config.rows = numRows;\n          config.cols = Math.max(this.solarGrid?.cols || 0, modulesPerRow);\n        }\n      }\n\n      // Rahmen außen leeren\n      if (/\\b(?:rahmen|rand)\\s*(?:außen|aussen)\\s*leer\\b/i.test(input)) {\n        config.clearFrame = true;\n      }\n\n      // Innenbereich: reihen R und spalten S füllen\n      const insideAreaMatch = input.match(/\\b(?:innen(?:bereich)?)\\s*(?:reihe[n]?\\s*([0-9\\s,–—\\-a-z]+))\\s*(?:und|,)?\\s*spalte[n]?\\s*([0-9\\s,–—\\-a-z]+)/i);\n      if (insideAreaMatch) {\n        const parseRangeList = (str) => {\n          const normalized = (str || '')\n            .replace(/[–—]/g, '-')\n            .replace(/\\bund\\b/gi, ',')\n            .replace(/\\bbis\\b/gi, '-');\n          const tokens = normalized.split(',').map(s => s.trim()).filter(Boolean);\n          const out = [];\n          for (const t of tokens) {\n            const m = t.match(/^(\\d+)\\s*-\\s*(\\d+)$/);\n            if (m) {\n              let a = parseInt(m[1], 10), b = parseInt(m[2], 10);\n              if (Number.isInteger(a) && Number.isInteger(b)) {\n                const start = Math.min(a, b), end = Math.max(a, b);\n                for (let n = start; n <= end; n++) out.push(n);\n              }\n            } else {\n              const n = parseInt(t, 10);\n              if (Number.isInteger(n) && n > 0) out.push(n);\n            }\n          }\n          return Array.from(new Set(out));\n        };\n        config.selectAreaRows = parseRangeList(insideAreaMatch[1]);\n        config.selectAreaCols = parseRangeList(insideAreaMatch[2]);\n      }\n\n      // Hälften: linke/rechte Hälfte\n      if (/\\blink[e]?\\s*h[aä]lfte\\s*f[üu]llen\\b/i.test(input)) {\n        config.fillLeftHalf = true;\n      }\n      if (/\\brecht[e]?\\s*h[aä]lfte\\s*leer\\b/i.test(input)) {\n        config.clearRightHalf = true;\n      }\n\n      // Jede zweite Reihe füllen, optionaler Start\n      const everySecondMatch = input.match(/\\bjede\\s*zweite\\s*reihe\\s*f[üu]llen(?:.*?start\\s*bei\\s*(\\d+))?/i);\n      if (everySecondMatch) {\n        const start = parseInt(everySecondMatch[1] || '1', 10);\n        config.everySecondRowsStart = Number.isInteger(start) && start > 0 ? start : 1;\n      }\n\n      // Orientierung parsen (nur wenn explizit erwähnt)\n      const orientationMatch = input.match(this.patterns.orientation);\n      if (orientationMatch) {\n        config.orientation = orientationMatch[0].toLowerCase().includes('vertikal') || \n                            orientationMatch[0].toLowerCase().includes('vertical') ? 'vertical' : 'horizontal';\n      }\n      // Erweiterte Checkbox-Syntax parsen\n      const checkboxAllExceptMatch = input.match(this.patterns.checkboxAllExcept);\n      const checkboxOnlyMatch = input.match(this.patterns.checkboxOnly);\n      const checkboxWithoutMatch = input.match(this.patterns.checkboxWithout);\n      const checkboxWithAllMatch = input.match(this.patterns.checkboxWithAll);\n      \n      if (checkboxAllExceptMatch) {\n        // \"alles außer holz\" → Alle außer das spezifische Wort\n        const exceptWord = input.toLowerCase().match(/(?:alles\\s*außer|alle\\s*außer)\\s+(\\w+)/);\n        if (exceptWord) {\n          const exceptItem = exceptWord[1];\n          config.includeModules = exceptItem !== 'module' && exceptItem !== 'modulen';\n          config.mc4 = exceptItem !== 'mc4';\n          config.cable = exceptItem !== 'kabel' && exceptItem !== 'solarkabel';\n          config.wood = exceptItem !== 'holz' && exceptItem !== 'holzunterleger';\n          config.quetschkabelschuhe = exceptItem !== 'quetschkabelschuhe' && exceptItem !== 'kabelschuhe';\n        }\n      } else if (checkboxOnlyMatch) {\n        // \"nur module und mc4\" → Nur die spezifischen Items\n        const onlyItems = input.toLowerCase().match(/(?:nur|only)\\s+(.+?)(?:\\s+und\\s+(.+?))*(?:\\s*$)/);\n        if (onlyItems) {\n          const items = [onlyItems[1], onlyItems[2]].filter(Boolean);\n          config.includeModules = items.some(item => item.includes('module'));\n          config.mc4 = items.some(item => item.includes('mc4'));\n          config.cable = items.some(item => item.includes('kabel') || item.includes('solarkabel'));\n          config.wood = items.some(item => item.includes('holz'));\n          config.quetschkabelschuhe = items.some(item => item.includes('quetschkabelschuhe') || item.includes('kabelschuhe'));\n        }\n      } else if (checkboxWithoutMatch) {\n        // \"ohne zubehör\" → Nur Module\n        config.includeModules = true;\n        config.mc4 = false;\n        config.cable = false;\n        config.wood = false;\n        config.quetschkabelschuhe = false;\n      } else if (checkboxWithAllMatch) {\n        // \"mit allem\" → Alle aktivieren\n        config.includeModules = true;\n        config.mc4 = true;\n        config.cable = true;\n        config.wood = true;\n        config.quetschkabelschuhe = true;\n        config.erdungsband = true;\n      } else if (input.match(this.patterns.allSimple)) {\n        // \"alles\" → wie \"mit allem\"\n        config.includeModules = true;\n        config.mc4 = true;\n        config.cable = true;\n        config.wood = true;\n        config.quetschkabelschuhe = true;\n        config.erdungsband = true;\n      } else {\n        // Checkbox-Kombinationen parsen (hat Priorität vor einzelnen Patterns)\n        const checkboxCombinations = this.parseCheckboxCombinations(input);\n        let hasCheckboxCombinations = Object.values(checkboxCombinations).some(value => value !== null);\n\n        if (hasCheckboxCombinations) {\n          // Setze nur die Werte, die explizit erkannt wurden (nicht null)\n          if (checkboxCombinations.modules !== null) config.includeModules = checkboxCombinations.modules;\n          if (checkboxCombinations.mc4 !== null) config.mc4 = checkboxCombinations.mc4;\n          if (checkboxCombinations.cable !== null) config.cable = checkboxCombinations.cable;\n          if (checkboxCombinations.wood !== null) config.wood = checkboxCombinations.wood;\n          if (checkboxCombinations.quetschkabelschuhe !== null) config.quetschkabelschuhe = checkboxCombinations.quetschkabelschuhe;\n          if (checkboxCombinations.kabelbinder !== null) config.kabelbinder = checkboxCombinations.kabelbinder;\n                } else {\n          // Fallback: Einzelne Checkbox-Patterns parsen\n          \n          // Module-Checkbox parsen (getrennt von moduleCount)\n          const moduleCheckboxMatch = input.match(this.patterns.moduleCheckbox);\n          if (moduleCheckboxMatch) {\n            config.includeModules = moduleCheckboxMatch[0].toLowerCase().includes('mit');\n          }\n\n          // Optionen parsen (nur wenn explizit erwähnt)\n          const mc4Match = input.match(this.patterns.mc4);\n          if (mc4Match) {\n            config.mc4 = mc4Match[0].toLowerCase().includes('mit');\n          }\n\n          const cableMatch = input.match(this.patterns.cable);\n          if (cableMatch) {\n            config.cable = cableMatch[0].toLowerCase().includes('mit');\n          }\n\n          const woodMatch = input.match(this.patterns.wood);\n          if (woodMatch) {\n            config.wood = woodMatch[0].toLowerCase().includes('mit');\n          }\n\n          const quetschkabelschuheMatch = input.match(this.patterns.quetschkabelschuhe);\n          if (quetschkabelschuheMatch) {\n            config.quetschkabelschuhe = quetschkabelschuheMatch[0].toLowerCase().includes('mit');\n          }\n          \n          const kabelbinderMatch = input.match(this.patterns.kabelbinder);\n          if (kabelbinderMatch) {\n            config.kabelbinder = kabelbinderMatch[0].toLowerCase().includes('mit');\n          }\n        }\n      }\n\n      // Ulica Modul Parsing (setzt spez. Modul + Checkbox)\n      const ulicaMatch = input.match(this.patterns.ulicaModule);\n      if (ulicaMatch) {\n        config.ulicaModule = true;\n        const watt = (ulicaMatch[1] || ulicaMatch[2] || '').toString();\n        if (watt === '450') {\n          config.selectedModule = 'ulica-450';\n        } else if (watt === '500') {\n          config.selectedModule = 'ulica-500';\n        } else {\n          // Default auf 500, wenn nicht eindeutig\n          config.selectedModule = 'ulica-500';\n        }\n        // Ulica schließt allgemeine Module aus\n        config.includeModules = false;\n      }\n\n      // NEU: \"450/500 W module hinzufügen\"\n      const addModulesWatt = input.match(this.patterns.addModulesWatt);\n      if (addModulesWatt) {\n        const watt = addModulesWatt[1];\n        config.ulicaModule = true;\n        config.selectedModule = watt === '450' ? 'ulica-450' : 'ulica-500';\n        // Exklusivität: keine allgemeinen Module\n        config.includeModules = false;\n      }\n\n      // NEU: \"mc4 und holz hinzufügen\" (Liste erlaubt)\n      const addComponents = input.match(this.patterns.addComponents);\n      if (addComponents) {\n        const list = input\n          .toLowerCase()\n          .match(/(?:mc4|kabel|holz|quetschkabelschuhe|kabelbinder|erdungsband)/g);\n        if (list) {\n          if (list.includes('mc4')) config.mc4 = true;\n          if (list.includes('kabel')) config.cable = true;\n          if (list.includes('holz')) config.wood = true;\n          if (list.includes('quetschkabelschuhe')) config.quetschkabelschuhe = true;\n          if (list.includes('kabelbinder')) config.kabelbinder = true;\n          if (list.includes('erdungsband')) config.erdungsband = true;\n        }\n      }\n\n      // NEUE ACTION PATTERNS PRÜFEN (höchste Priorität - vor allen anderen Patterns)\n      const saveWithNameMatch = input.match(this.patterns.saveWithName);\n      if (saveWithNameMatch) {\n        config.action = 'saveConfig';\n        config.configName = saveWithNameMatch[1];\n        return config;\n      }\n      \n      const saveConfigMatch = input.match(this.patterns.saveConfig);\n      if (saveConfigMatch) {\n        config.action = 'saveConfig';\n        return config;\n      }\n      \n      // NEU: Neue Konfiguration erstellen (aktuelle wird automatisch gespeichert)\n      const newConfigMatch = input.match(this.patterns.newConfig);\n      if (newConfigMatch) {\n        config.action = 'newConfig';\n        return config;\n      }\n      \n      // NEU: Alle Konfigurationen löschen / Von vorne beginnen\n      const deleteAllConfigsMatch = input.match(this.patterns.deleteAllConfigs);\n      if (deleteAllConfigsMatch) {\n        config.action = 'resetAllConfigs';\n        return config;\n      }\n      // Alle Reihen/Spalten außer ... → erzeugt vollständige Liste minus Ausnahmen\n      const allRowsExceptMatch = input.match(this.patterns.allRowsExcept);\n      if (allRowsExceptMatch) {\n        const maxRows = this.solarGrid.rows;\n        const base = Array.from({ length: maxRows }, (_, i) => i + 1);\n        const str = allRowsExceptMatch[1] || '';\n        const normalized = str\n          .replace(/[–—]/g, '-')\n          .replace(/\\bund\\b/gi, ',')\n          .replace(/\\bbis\\b/gi, '-');\n        const tokens = normalized.split(',').map(s => s.trim()).filter(Boolean);\n        const except = new Set();\n        for (const t of tokens) {\n          const m = t.match(/^(\\d+)\\s*-\\s*(\\d+)$/);\n          if (m) {\n            let a = parseInt(m[1], 10), b = parseInt(m[2], 10);\n            if (Number.isInteger(a) && Number.isInteger(b)) {\n              const start = Math.min(a, b);\n              const end = Math.max(a, b);\n              for (let n = start; n <= end; n++) except.add(n);\n            }\n          } else {\n            const n = parseInt(t, 10);\n            if (Number.isInteger(n) && n > 0) except.add(n);\n          }\n        }\n        const result = base.filter(n => !except.has(n));\n        if (result.length > 0) config.selectRows = result;\n      }\n      const allColumnsExceptMatch = input.match(this.patterns.allColumnsExcept);\n      if (allColumnsExceptMatch) {\n        const maxCols = this.solarGrid.cols;\n        const base = Array.from({ length: maxCols }, (_, i) => i + 1);\n        const str = allColumnsExceptMatch[1] || '';\n        const normalized = str\n          .replace(/[–—]/g, '-')\n          .replace(/\\bund\\b/gi, ',')\n          .replace(/\\bbis\\b/gi, '-');\n        const tokens = normalized.split(',').map(s => s.trim()).filter(Boolean);\n        const except = new Set();\n        for (const t of tokens) {\n          const m = t.match(/^(\\d+)\\s*-\\s*(\\d+)$/);\n          if (m) {\n            let a = parseInt(m[1], 10), b = parseInt(m[2], 10);\n            if (Number.isInteger(a) && Number.isInteger(b)) {\n              const start = Math.min(a, b);\n              const end = Math.max(a, b);\n              for (let n = start; n <= end; n++) except.add(n);\n            }\n          } else {\n            const n = parseInt(t, 10);\n            if (Number.isInteger(n) && n > 0) except.add(n);\n          }\n        }\n        const result = base.filter(n => !except.has(n));\n        if (result.length > 0) config.selectColumns = result;\n      }\n      \n      // Explizite Reihen-Selektion / Lücken (1-basiert)\n      const selectRowsMatch = input.match(this.patterns.selectRowsExplicit);\n      if (selectRowsMatch) {\n        const rowsString = selectRowsMatch[1] || '';\n        const normalized = rowsString\n          .replace(/[–—]/g, '-')\n          .replace(/\\bund\\b/gi, ',')\n          .replace(/\\bbis\\b/gi, '-');\n        const tokens = normalized.split(',').map(s => s.trim()).filter(Boolean);\n        const numbers = [];\n        for (const t of tokens) {\n          const m = t.match(/^(\\d+)\\s*-\\s*(\\d+)$/);\n          if (m) {\n            let a = parseInt(m[1], 10), b = parseInt(m[2], 10);\n            if (Number.isInteger(a) && Number.isInteger(b)) {\n              const start = Math.min(a, b);\n              const end = Math.max(a, b);\n              for (let n = start; n <= end; n++) numbers.push(n);\n            }\n          } else {\n            const n = parseInt(t, 10);\n            if (Number.isInteger(n) && n > 0) numbers.push(n);\n          }\n        }\n        if (numbers.length > 0) {\n          config.selectRows = Array.from(new Set(numbers));\n        }\n      }\n      const gapRowsMatch = input.match(this.patterns.gapRowsExplicit);\n      if (gapRowsMatch) {\n        const rowsString = gapRowsMatch[1] || '';\n        const normalized = rowsString\n          .replace(/[–—]/g, '-')\n          .replace(/\\bund\\b/gi, ',')\n          .replace(/\\bbis\\b/gi, '-');\n        const tokens = normalized.split(',').map(s => s.trim()).filter(Boolean);\n        const numbers = [];\n        for (const t of tokens) {\n          const m = t.match(/^(\\d+)\\s*-\\s*(\\d+)$/);\n          if (m) {\n            let a = parseInt(m[1], 10), b = parseInt(m[2], 10);\n            if (Number.isInteger(a) && Number.isInteger(b)) {\n              const start = Math.min(a, b);\n              const end = Math.max(a, b);\n              for (let n = start; n <= end; n++) numbers.push(n);\n            }\n          } else {\n            const n = parseInt(t, 10);\n            if (Number.isInteger(n) && n > 0) numbers.push(n);\n          }\n        }\n        if (numbers.length > 0) {\n          config.gapRows = Array.from(new Set(numbers));\n        }\n      }\n      // Explizite Spalten-Selektion / Lücken (1-basiert)\n      const selectColsMatch = input.match(this.patterns.selectColumnsExplicit);\n      if (selectColsMatch) {\n        const colsString = selectColsMatch[1] || '';\n        const normalized = colsString\n          .replace(/[–—]/g, '-')\n          .replace(/\\bund\\b/gi, ',')\n          .replace(/\\bbis\\b/gi, '-');\n        const tokens = normalized.split(',').map(s => s.trim()).filter(Boolean);\n        const numbers = [];\n        for (const t of tokens) {\n          const m = t.match(/^(\\d+)\\s*-\\s*(\\d+)$/);\n          if (m) {\n            let a = parseInt(m[1], 10), b = parseInt(m[2], 10);\n            if (Number.isInteger(a) && Number.isInteger(b)) {\n              const start = Math.min(a, b);\n              const end = Math.max(a, b);\n              for (let n = start; n <= end; n++) numbers.push(n);\n            }\n          } else {\n            const n = parseInt(t, 10);\n            if (Number.isInteger(n) && n > 0) numbers.push(n);\n          }\n        }\n        if (numbers.length > 0) {\n          config.selectColumns = Array.from(new Set(numbers));\n        }\n      }\n      const gapColsMatch = input.match(this.patterns.gapColumnsExplicit);\n      if (gapColsMatch) {\n        const colsString = gapColsMatch[1] || '';\n        const normalized = colsString\n          .replace(/[–—]/g, '-')\n          .replace(/\\bund\\b/gi, ',')\n          .replace(/\\bbis\\b/gi, '-');\n        const tokens = normalized.split(',').map(s => s.trim()).filter(Boolean);\n        const numbers = [];\n        for (const t of tokens) {\n          const m = t.match(/^(\\d+)\\s*-\\s*(\\d+)$/);\n          if (m) {\n            let a = parseInt(m[1], 10), b = parseInt(m[2], 10);\n            if (Number.isInteger(a) && Number.isInteger(b)) {\n              const start = Math.min(a, b);\n              const end = Math.max(a, b);\n              for (let n = start; n <= end; n++) numbers.push(n);\n            }\n          } else {\n            const n = parseInt(t, 10);\n            if (Number.isInteger(n) && n > 0) numbers.push(n);\n          }\n        }\n        if (numbers.length > 0) {\n          config.gapColumns = Array.from(new Set(numbers));\n        }\n      }\n      \n      // Neue präzise Befehle parsen\n      if (this.patterns.clearTopRow.test(input)) config.clearTopRow = true;\n      if (this.patterns.clearBottomRow.test(input)) config.clearBottomRow = true;\n      const fillFirstN = input.match(this.patterns.fillFirstNColumns);\n      if (fillFirstN) config.fillFirstNColumns = this.parseWordNumber(fillFirstN[1] || '1');\n      const clearFirstN = input.match(this.patterns.clearFirstNColumns);\n      if (clearFirstN) config.clearFirstNColumns = this.parseWordNumber(clearFirstN[1] || '1');\n      const clearLastN = input.match(this.patterns.clearLastNColumns);\n      if (clearLastN) config.clearLastNColumns = parseInt(clearLastN[1] || '1', 10);\n      if (this.patterns.fillOnlyFrame.test(input)) config.fillOnlyFrame = true;\n      const blockMatch = input.match(this.patterns.fillBlock);\n      if (blockMatch) {\n        config.fillBlock = {\n          height: this.parseWordNumber(blockMatch[1]),\n          width: this.parseWordNumber(blockMatch[2]),\n          startRow: this.parseWordNumber(blockMatch[3]),\n          startCol: this.parseWordNumber(blockMatch[4])\n        };\n      }\n      const blockRel = input.match(this.patterns.fillBlockRelative);\n      if (blockRel) {\n        config.fillBlockRelative = {\n          height: this.parseWordNumber(blockRel[1]),\n          width: this.parseWordNumber(blockRel[2]),\n          fromBottom: this.parseWordNumber(blockRel[3]),\n          fromRight: this.parseWordNumber(blockRel[4])\n        };\n      }\n      // Reihen erste/letzte N füllen/leer\n      const fillFirstRows = input.match(this.patterns.fillFirstNRows);\n      if (fillFirstRows) config.fillFirstNRows = this.parseWordNumber(fillFirstRows[1] || '1');\n      const clearFirstRows = input.match(this.patterns.clearFirstNRows);\n      if (clearFirstRows) config.clearFirstNRows = this.parseWordNumber(clearFirstRows[1] || '1');\n      const fillLastRows = input.match(this.patterns.fillLastNRows);\n      if (fillLastRows) config.fillLastNRows = this.parseWordNumber((fillLastRows[1] || '1'));\n      const clearLastRows = input.match(this.patterns.clearLastNRows);\n      if (clearLastRows) config.clearLastNRows = this.parseWordNumber((clearLastRows[1] || '1'));\n      \n      // KURZE EINGABEN: Verwende aktuelles Grid als Basis\n      const isShortInput = input.length < 20 && !input.match(/\\d/);\n      if (isShortInput) {\n        // Setze aktuelle Grid-Größe als Basis\n        config.cols = this.solarGrid.cols;\n        config.rows = this.solarGrid.rows;\n        config.useCurrentGrid = true;\n      }\n\n      const deleteConfigMatch = input.match(this.patterns.deleteConfig);\n      if (deleteConfigMatch) {\n        config.action = 'deleteConfig';\n        return config;\n      }\n\n      const deleteModulesMatch = input.match(this.patterns.deleteModules);\n      if (deleteModulesMatch) {\n        config.action = 'deleteModules';\n        return config;\n      }\n\n      const resetGridMatch = input.match(this.patterns.resetGrid);\n      if (resetGridMatch) {\n        config.action = 'resetGrid';\n        return config;\n      }\n\n      return config;\n      } catch (error) {\n        console.error('Error parsing input:', input, error);\n        return {};\n      }\n    }\n\n    calculateOptimalGrid(moduleCount) {\n      // Finde beste Rechteck-Aufteilung\n      const factors = [];\n      for (let i = 1; i <= Math.sqrt(moduleCount); i++) {\n        if (moduleCount % i === 0) {\n          factors.push([i, moduleCount / i]);\n        }\n      }\n      \n      // Bevorzuge quadratische oder leicht rechteckige Formen\n      const best = factors.reduce((a, b) => {\n        const ratioA = Math.max(a[0], a[1]) / Math.min(a[0], a[1]);\n        const ratioB = Math.max(b[0], b[1]) / Math.min(b[0], b[1]);\n        return ratioA <= ratioB ? a : b;\n      });\n\n      return { cols: Math.max(best[0], best[1]), rows: Math.min(best[0], best[1]) };\n    }\n    applyConfiguration(config) {\n      \n      // Speichere bestehende Auswahl\n      const oldSelection = this.solarGrid.selection ? \n        this.solarGrid.selection.map(row => [...row]) : null;\n      const oldCols = this.solarGrid.cols;\n      const oldRows = this.solarGrid.rows;\n      \n      // Grid-Größe setzen (nur wenn angegeben)\n      if (config.cols && config.rows) {\n        this.solarGrid.cols = config.cols;\n        this.solarGrid.rows = config.rows;\n        // Wenn explizit gefordert: Auswahl vollständig zurücksetzen\n        if (config.forceClearSelection === true) {\n          this.solarGrid.selection = Array.from({ length: this.solarGrid.rows }, () =>\n            Array.from({ length: this.solarGrid.cols }, () => false)\n          );\n        }\n      }\n\n      // Orientierung setzen (nur wenn angegeben)\n      if (config.orientation) {\n        if (this.solarGrid.orV) this.solarGrid.orV.checked = config.orientation === 'vertical';\n        if (this.solarGrid.orH) this.solarGrid.orH.checked = config.orientation === 'horizontal';\n        \n        // Synchronisiere mit den Orientation Buttons\n        const orientHBtn = document.getElementById('orient-h');\n        const orientVBtn = document.getElementById('orient-v');\n        if (orientHBtn && orientVBtn) {\n          orientHBtn.classList.toggle('active', config.orientation === 'horizontal');\n          orientVBtn.classList.toggle('active', config.orientation === 'vertical');\n        }\n      }\n\n      // NEUE ACTION PATTERNS HANDHABEN (höchste Priorität)\n      if (config.action) {\n        this.handleAction(config.action, config);\n        return; // Keine weitere Konfiguration anwenden\n      }\n\n      // Optionen setzen (nur die angegebenen)\n      if (config.hasOwnProperty('includeModules')) {\n        if (this.solarGrid.incM) this.solarGrid.incM.checked = config.includeModules;\n      }\n      if (config.hasOwnProperty('mc4')) {\n        if (this.solarGrid.mc4) this.solarGrid.mc4.checked = config.mc4;\n      }\n      if (config.hasOwnProperty('cable')) {\n        if (this.solarGrid.solarkabel) this.solarGrid.solarkabel.checked = config.cable;\n      }\n      if (config.hasOwnProperty('wood')) {\n        if (this.solarGrid.holz) this.solarGrid.holz.checked = config.wood;\n      }\n      if (config.hasOwnProperty('quetschkabelschuhe')) {\n        if (this.solarGrid.quetschkabelschuhe) this.solarGrid.quetschkabelschuhe.checked = config.quetschkabelschuhe;\n      }\n      if (config.hasOwnProperty('kabelbinder')) {\n        if (this.solarGrid.kabelbinder) this.solarGrid.kabelbinder.checked = config.kabelbinder;\n      }\n      if (config.hasOwnProperty('ulicaModule')) {\n        if (this.solarGrid.ulicaModule) this.solarGrid.ulicaModule.checked = config.ulicaModule === true;\n        // Exklusivität sicherstellen: Ulica aktiv => include-modules aus\n        if (config.ulicaModule === true && this.solarGrid.incM) {\n          this.solarGrid.incM.checked = false;\n        }\n      }\n\n      // Spezifische Modulauswahl anwenden (z.B. Ulica 500/450)\n      if (config.selectedModule && this.solarGrid.moduleSelect) {\n        this.solarGrid.moduleSelect.value = config.selectedModule;\n        // Triggert Breite/Höhe und Checkbox-Clear gemäß bestehender Logik\n        this.solarGrid.handleModuleSelectChange();\n      }\n\n      // Checkbox-Änderungen global auf alle Konfigurationen anwenden\n      // (sichert konsistentes Verhalten über alle Configs)\n      this.solarGrid.updateAllConfigurationsForCheckboxes();\n\n      // INTELLIGENTE Selection-Matrix-Erstellung\n      // NUR bei Grid-Größen-Änderung → Selection anpassen/löschen\n      // Bei reinen Checkbox-Änderungen → Selection beibehalten\n      const gridSizeChanged = (config.cols && config.cols !== oldCols) || \n                             (config.rows && config.rows !== oldRows);\n      \n      // Prüfe, ob explizite Selektions-Operationen angefragt sind\n      const hasExplicitOps = (\n        config.selectRows || config.gapRows || config.selectColumns || config.gapColumns ||\n        (config.selectAreaRows && config.selectAreaCols) || config.fillOnlyFrame || config.clearFrame ||\n        config.fillLeftHalf || config.clearRightHalf || config.everySecondRowsStart ||\n        config.clearTopRow || config.clearBottomRow || config.fillFirstNColumns || config.clearFirstNColumns ||\n        config.clearLastNColumns || config.fillFirstNRows || config.clearFirstNRows ||\n        config.fillLastNRows || config.clearLastNRows || config.fillBlock || config.fillBlockRelative\n      );\n      \n      let newSelection;\n      if (gridSizeChanged) {\n        // Grid-Größe geändert: Leere Matrix, wenn automatische oder explizite Selektion folgt\n        if (config.moduleCount || config.rowConfig || hasExplicitOps) {\n          newSelection = Array.from({ length: this.solarGrid.rows }, () =>\n            Array.from({ length: this.solarGrid.cols }, () => false)\n          );\n        } else {\n          // Nur Grid-Größe ohne weitere Selektion: Behalte was möglich ist\n          newSelection = Array.from({ length: this.solarGrid.rows }, (_, y) =>\n            Array.from({ length: this.solarGrid.cols }, (_, x) => {\n              if (oldSelection && y < oldSelection.length && x < oldSelection[y].length) {\n                return oldSelection[y][x];\n              }\n              return false;\n            })\n          );\n        }\n      } else {\n        // Keine Grid-Änderung: Behalte bestehende Selection komplett\n        newSelection = oldSelection || Array.from({ length: this.solarGrid.rows }, () =>\n          Array.from({ length: this.solarGrid.cols }, () => false)\n        );\n      }\n      \n      this.solarGrid.selection = newSelection;\n\n      // Grid mit neuen Dimensionen neu aufbauen\n      this.solarGrid.updateSize();\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n\n      // NEUE: Dynamische Abstand-Anpassung auf bestehendes Grid\n      if (config.adjustSpacing) {\n        this.adjustGridSpacing(config.adjustSpacing);\n      }\n      // Führe Reihen-Konfiguration falls vorhanden zuerst aus\n      if (config.rowConfig) {\n        this.applyRowConfiguration(config.rowConfig, config.intelligentDistribution);\n      }\n      // Explizite Reihen-/Spalten-Selektion und Layout-Operationen additiv anwenden\n      if (config.selectRows || config.gapRows || config.selectColumns || config.gapColumns || config.clearFrame || (config.selectAreaRows && config.selectAreaCols) || config.fillLeftHalf || config.clearRightHalf || config.everySecondRowsStart || config.clearTopRow || config.clearBottomRow || config.fillFirstNColumns || config.clearFirstNColumns || config.clearLastNColumns || config.fillFirstNRows || config.clearFirstNRows || config.fillLastNRows || config.clearLastNRows || config.fillOnlyFrame || config.fillBlock || config.fillBlockRelative) {\n        // Falls Grid zuvor geändert wurde: Auswahl bereits leer bzw. erhalten je nach Logik\n        // Wir arbeiten auf aktueller Selection weiter (additiv, außer Grid-Change)\n        const maxRows = this.solarGrid.rows;\n        const maxCols = this.solarGrid.cols;\n        const ensureRow = (y) => {\n          if (!this.solarGrid.selection[y]) {\n            this.solarGrid.selection[y] = Array.from({ length: maxCols }, () => false);\n          }\n        };\n        // Rahmen außen leeren\n        if (config.clearFrame) {\n          for (let y = 0; y < maxRows; y++) {\n            ensureRow(y);\n            for (let x = 0; x < maxCols; x++) {\n              if (y === 0 || y === maxRows - 1 || x === 0 || x === maxCols - 1) {\n                this.solarGrid.selection[y][x] = false;\n              }\n            }\n          }\n        }\n        // Selektiere Reihen\n        if (Array.isArray(config.selectRows)) {\n          for (const row1Based of config.selectRows) {\n            const y = row1Based - 1; // 1-basiert → 0-basiert\n            if (y < 0 || y >= maxRows) {\n              this.solarGrid.showToast(`⚠️ Reihe ${row1Based} existiert nicht (Grid ${maxCols}×${maxRows}).`, 3000);\n              continue;\n            }\n            ensureRow(y);\n            for (let x = 0; x < maxCols; x++) {\n              this.solarGrid.selection[y][x] = true;\n            }\n          }\n        }\n        // Leere Reihen (Lücken)\n        if (Array.isArray(config.gapRows)) {\n          for (const row1Based of config.gapRows) {\n            const y = row1Based - 1;\n            if (y < 0 || y >= maxRows) {\n              this.solarGrid.showToast(`⚠️ Reihe ${row1Based} existiert nicht (Grid ${maxCols}×${maxRows}).`, 3000);\n              continue;\n            }\n            ensureRow(y);\n            for (let x = 0; x < maxCols; x++) {\n              this.solarGrid.selection[y][x] = false;\n            }\n          }\n        }\n        // Selektiere Spalten\n        if (Array.isArray(config.selectColumns)) {\n          for (const col1Based of config.selectColumns) {\n            const x = col1Based - 1;\n            if (x < 0 || x >= maxCols) {\n              this.solarGrid.showToast(`⚠️ Spalte ${col1Based} existiert nicht (Grid ${maxCols}×${maxRows}).`, 3000);\n              continue;\n            }\n            for (let y = 0; y < maxRows; y++) {\n              ensureRow(y);\n              this.solarGrid.selection[y][x] = true;\n            }\n          }\n        }\n        // Leere Spalten (Lücken)\n        if (Array.isArray(config.gapColumns)) {\n          for (const col1Based of config.gapColumns) {\n            const x = col1Based - 1;\n            if (x < 0 || x >= maxCols) {\n              this.solarGrid.showToast(`⚠️ Spalte ${col1Based} existiert nicht (Grid ${maxCols}×${maxRows}).`, 3000);\n              continue;\n            }\n            for (let y = 0; y < maxRows; y++) {\n              ensureRow(y);\n              this.solarGrid.selection[y][x] = false;\n            }\n          }\n        }\n        // Innenbereich füllen (Kreuzprodukt aus angegebenen Reihen und Spalten)\n        if (Array.isArray(config.selectAreaRows) && Array.isArray(config.selectAreaCols)) {\n          for (const row1Based of config.selectAreaRows) {\n            const y = row1Based - 1;\n            if (y < 0 || y >= maxRows) continue;\n            ensureRow(y);\n            for (const col1Based of config.selectAreaCols) {\n              const x = col1Based - 1;\n              if (x < 0 || x >= maxCols) continue;\n              this.solarGrid.selection[y][x] = true;\n            }\n          }\n        }\n        // Linke Hälfte füllen\n        if (config.fillLeftHalf) {\n          const endX = Math.floor(maxCols / 2) - 1;\n          for (let y = 0; y < maxRows; y++) {\n            ensureRow(y);\n            for (let x = 0; x <= endX; x++) this.solarGrid.selection[y][x] = true;\n          }\n        }\n        // Rechte Hälfte leeren\n        if (config.clearRightHalf) {\n          const startX = Math.ceil(maxCols / 2);\n          for (let y = 0; y < maxRows; y++) {\n            ensureRow(y);\n            for (let x = startX; x < maxCols; x++) this.solarGrid.selection[y][x] = false;\n          }\n        }\n        // Oberste/unterste Reihe leeren\n        if (config.clearTopRow) {\n          const y = 0; ensureRow(y);\n          for (let x = 0; x < maxCols; x++) this.solarGrid.selection[y][x] = false;\n        }\n        if (config.clearBottomRow) {\n          const y = maxRows - 1; ensureRow(y);\n          for (let x = 0; x < maxCols; x++) this.solarGrid.selection[y][x] = false;\n        }\n        // Erste N Spalten füllen\n        if (config.fillFirstNColumns && config.fillFirstNColumns > 0) {\n          const endX = Math.min(maxCols - 1, config.fillFirstNColumns - 1);\n          for (let y = 0; y < maxRows; y++) {\n            ensureRow(y);\n            for (let x = 0; x <= endX; x++) this.solarGrid.selection[y][x] = true;\n          }\n        }\n        // Erste N Spalten leeren\n        if (config.clearFirstNColumns && config.clearFirstNColumns > 0) {\n          const endX = Math.min(maxCols - 1, config.clearFirstNColumns - 1);\n          for (let y = 0; y < maxRows; y++) {\n            ensureRow(y);\n            for (let x = 0; x <= endX; x++) this.solarGrid.selection[y][x] = false;\n          }\n        }\n        // Letzte N Spalten leeren (Default 1)\n        if (config.clearLastNColumns && config.clearLastNColumns > 0) {\n          const startX = Math.max(0, maxCols - config.clearLastNColumns);\n          for (let y = 0; y < maxRows; y++) {\n            ensureRow(y);\n            for (let x = startX; x < maxCols; x++) this.solarGrid.selection[y][x] = false;\n          }\n        }\n        // Erste N Reihen füllen/leer\n        if (config.fillFirstNRows && config.fillFirstNRows > 0) {\n          const endY = Math.min(maxRows - 1, config.fillFirstNRows - 1);\n          for (let y = 0; y <= endY; y++) {\n            ensureRow(y);\n            for (let x = 0; x < maxCols; x++) this.solarGrid.selection[y][x] = true;\n          }\n        }\n        if (config.clearFirstNRows && config.clearFirstNRows > 0) {\n          const endY = Math.min(maxRows - 1, config.clearFirstNRows - 1);\n          for (let y = 0; y <= endY; y++) {\n            ensureRow(y);\n            for (let x = 0; x < maxCols; x++) this.solarGrid.selection[y][x] = false;\n          }\n        }\n        // Letzte N Reihen füllen/leer\n        if (config.fillLastNRows && config.fillLastNRows > 0) {\n          const startY = Math.max(0, maxRows - config.fillLastNRows);\n          for (let y = startY; y < maxRows; y++) {\n            ensureRow(y);\n            for (let x = 0; x < maxCols; x++) this.solarGrid.selection[y][x] = true;\n          }\n        }\n        if (config.clearLastNRows && config.clearLastNRows > 0) {\n          const startY = Math.max(0, maxRows - config.clearLastNRows);\n          for (let y = startY; y < maxRows; y++) {\n            ensureRow(y);\n            for (let x = 0; x < maxCols; x++) this.solarGrid.selection[y][x] = false;\n          }\n        }\n        // Nur Rand füllen (innen leeren)\n        if (config.fillOnlyFrame) {\n          for (let y = 0; y < maxRows; y++) {\n            ensureRow(y);\n            for (let x = 0; x < maxCols; x++) {\n              const isFrame = y === 0 || y === maxRows - 1 || x === 0 || x === maxCols - 1;\n              this.solarGrid.selection[y][x] = isFrame;\n            }\n          }\n        }\n        // Block AxB ab Start (R,S)\n        if (config.fillBlock) {\n          const { height, width, startRow, startCol } = config.fillBlock;\n          const y0 = Math.max(1, startRow) - 1;\n          const x0 = Math.max(1, startCol) - 1;\n          for (let y = y0; y < Math.min(maxRows, y0 + height); y++) {\n            ensureRow(y);\n            for (let x = x0; x < Math.min(maxCols, x0 + width); x++) {\n              this.solarGrid.selection[y][x] = true;\n            }\n          }\n        }\n        // Block AxB relativ von unten/rechts\n        if (config.fillBlockRelative) {\n          const { height, width, fromBottom, fromRight } = config.fillBlockRelative;\n          const y0 = Math.max(0, maxRows - fromBottom);\n          const x0 = Math.max(0, maxCols - fromRight);\n          for (let y = y0; y < Math.min(maxRows, y0 + height); y++) {\n            ensureRow(y);\n            for (let x = x0; x < Math.min(maxCols, x0 + width); x++) {\n              this.solarGrid.selection[y][x] = true;\n            }\n          }\n        }\n        // Jede zweite Reihe füllen\n        if (config.everySecondRowsStart) {\n          const start = Math.max(1, config.everySecondRowsStart);\n          for (let row1Based = start; row1Based <= maxRows; row1Based += 2) {\n            const y = row1Based - 1;\n            ensureRow(y);\n            for (let x = 0; x < maxCols; x++) this.solarGrid.selection[y][x] = true;\n          }\n        }\n        // Sonderfall: moduleCount + rowsOnly + Spalten-Lücken → nach dem Leeren wieder bis zur Zielmenge auffüllen (nur auf erlaubten Spalten)\n        if (config.moduleCount && config.rowConfig && !config.selectRows && !config.gapRows) {\n          const prohibitedCols = new Set();\n          if (config.clearFirstNColumns && config.clearFirstNColumns > 0) {\n            for (let x = 0; x < Math.min(this.solarGrid.cols, config.clearFirstNColumns); x++) prohibitedCols.add(x);\n          }\n          if (Array.isArray(config.gapColumns)) {\n            for (const col1Based of config.gapColumns) {\n              const x = col1Based - 1; if (x >= 0 && x < this.solarGrid.cols) prohibitedCols.add(x);\n            }\n          }\n          // Prüfe Kapazität auf erlaubten Spalten; erweitere ggf. die Spaltenzahl\n          const allowedPerRow = this.solarGrid.cols - prohibitedCols.size;\n          const rows = this.solarGrid.rows;\n          const neededColsIfExpand = Math.ceil((config.moduleCount + prohibitedCols.size) / rows);\n          if (allowedPerRow * rows < config.moduleCount) {\n            // Erweitere Spaltenzahl so, dass erlaubte Spalten genug Kapazität haben\n            this.solarGrid.cols = Math.max(this.solarGrid.cols, neededColsIfExpand);\n            // Erweiterte Auswahlmatrix vorbereiten\n            for (let y = 0; y < this.solarGrid.rows; y++) {\n              if (!this.solarGrid.selection[y]) this.solarGrid.selection[y] = [];\n              for (let x = this.solarGrid.selection[y].length; x < this.solarGrid.cols; x++) this.solarGrid.selection[y][x] = false;\n            }\n          }\n          // Neu auffüllen bis moduleCount erreicht – nur erlaubte Spalten\n          // Zuerst alles auf erlaubten Spalten leeren, damit keine Lücken bleiben\n          for (let y = 0; y < this.solarGrid.rows; y++) {\n            for (let x = 0; x < this.solarGrid.cols; x++) {\n              if (!prohibitedCols.has(x)) this.solarGrid.selection[y][x] = false;\n            }\n          }\n          let placed = 0;\n          outer: for (let y = 0; y < this.solarGrid.rows; y++) {\n            for (let x = 0; x < this.solarGrid.cols; x++) {\n              if (prohibitedCols.has(x)) continue;\n              this.solarGrid.selection[y][x] = true;\n              placed++;\n              if (placed >= config.moduleCount) break outer;\n            }\n          }\n        }\n        this.solarGrid.buildGrid();\n        this.solarGrid.buildList();\n        this.solarGrid.updateSummaryOnChange();\n      }\n      // Wenn Module-Anzahl angegeben, automatisch auswählen (nur wenn keine expliziten Selektions-Flags gesetzt wurden)\n      if (config.moduleCount && !(config.selectRows || config.gapRows || config.selectColumns || config.gapColumns || config.selectAreaRows || config.selectAreaCols || config.fillBlock || config.fillBlockRelative || config.fillFirstNRows || config.clearFirstNRows || config.fillLastNRows || config.clearLastNRows || config.fillFirstNColumns || config.clearFirstNColumns || config.clearLastNColumns)) {\n        if (config.suppressAutoSelection) {\n          // \"gleichmäßig\" ist deprecated → keine Auto-Verteilung/Selektion\n          this.solarGrid.showToast('Hinweis: \"gleichmäßig\" ist nicht mehr verfügbar. Bitte geben Sie Reihen/Spalten oder Module pro Reihe an.', 3500);\n          // Nichts weiter tun\n        } else if (config.distribution) {\n          this.distributeModules(config.moduleCount, config.distribution, config);\n        } else {\n          this.autoSelectModules(config.moduleCount);\n        }\n      }\n\n      // Globaler Hinweis, falls \"gleichmäßig\" erkannt wurde, aber keine Modulanzahl vorhanden war\n      if (!config.moduleCount && config.deprecatedNotice === 'distributionEqual') {\n        this.solarGrid.showToast('Hinweis: \"gleichmäßig\" ist nicht mehr verfügbar. Nutzen Sie z. B. \"3 Reihen mit 6 Modulen\".', 3500);\n      }\n      if (!config.moduleCount && config.deprecatedNotice === 'distributionRandom') {\n        this.solarGrid.showToast('Hinweis: \"zufällig\" ist nicht mehr verfügbar. Nutzen Sie konkrete Reihen/Spalten-Angaben.', 3500);\n      }\n      \n      // Verstecke Tipps nach erster Nutzung\n      this.hideHelpAfterFirstUse();\n    }\n    \n    // Neue Methode: Preview-Grid verstecken und Konfiguration auf Hauptgrid anwenden\n    applyPreviewToMainGrid(config) {\n      \n      \n      // Verstecke Preview-Grid und zeige Hauptgrid\n      this.solarGrid.hidePreviewGrid();\n      this.solarGrid.showMainGrid();\n      \n      // Wende Konfiguration auf Hauptgrid an\n      this.applyConfiguration(config);\n    }\n    \n    // NEUE ACTION HANDLER METHODE\n    handleAction(action, config = {}) {\n      switch (action) {\n        case 'saveConfig':\n          if (config.configName) {\n            // Name der aktuellen Konfiguration ändern\n            this.solarGrid.renameCurrentConfig(config.configName);\n            \t\t\tthis.solarGrid.showToast(`Konfiguration umbenannt zu \"${config.configName}\"`, 2000);\n          } else {\n            // Normales Speichern\n            this.solarGrid.saveNewConfig();\n            \t\t\t\tthis.solarGrid.showToast('Konfiguration gespeichert', 2000);\n          }\n          break;\n          \n        case 'deleteConfig':\n          // Prüfe ob mindestens 2 Konfigurationen vorhanden sind\n          if (this.solarGrid.configs.length <= 1) {\n            this.solarGrid.showToast('⚠️ Kann letzte Konfiguration nicht löschen', 3000);\n            return;\n          }\n          // Lösche aktuelle Konfiguration\n          if (this.solarGrid.currentConfig !== null) {\n            this.solarGrid.deleteConfig(this.solarGrid.currentConfig);\n            \t\t\t\tthis.solarGrid.showToast('Konfiguration gelöscht', 2000);\n          }\n          break;\n          \n        case 'deleteModules':\n          // Lösche nur die Module-Auswahl, behalte Grid-Größe\n          this.clearModuleSelection();\n          \t\t\tthis.solarGrid.showToast('Module-Auswahl gelöscht', 2000);\n          break;\n          \n        case 'resetGrid':\n          // Gleiches Verhalten wie der UI-Button \"Zurücksetzen\"\n          this.solarGrid.resetGridToDefault();\n          this.solarGrid.showToast('⚡ Grid zurückgesetzt', 2000);\n          break;\n          \n        // NEU: Neue Konfiguration erstellen\n        case 'newConfig':\n          this.solarGrid.saveNewConfig();\n          this.solarGrid.showToast('Neue Konfiguration erstellt', 2000);\n          break;\n        \n        // NEU: Alle Konfigurationen löschen (mit Bestätigung, gleiche Funktion wie \"von vorne beginnen\")\n        case 'resetAllConfigs':\n          this.solarGrid.resetAllConfigurations();\n          // Bestätigungsdialog erfolgt in resetAllConfigurations(); kein zusätzliches Toast hier\n          break;\n        \n        default:\n          console.warn('Unbekannte Action:', action);\n      }\n    }\n\n    // Hilfsmethode: Lösche nur Module-Auswahl (nicht Grid-Größe)\n    clearModuleSelection() {\n      // Setze alle Zellen auf false, behalte aber Grid-Dimensionen\n      for (let y = 0; y < this.solarGrid.rows; y++) {\n        for (let x = 0; x < this.solarGrid.cols; x++) {\n          if (this.solarGrid.selection[y]) {\n            this.solarGrid.selection[y][x] = false;\n          }\n        }\n      }\n      \n      // Grid und Liste neu aufbauen\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n    }\n\n    hideHelpAfterFirstUse() {\n      const helpSection = document.querySelector('.bulk-selection-help');\n      if (helpSection) {\n        helpSection.style.display = 'none';\n        // Speichere in localStorage, dass Tipps versteckt werden sollen\n        localStorage.setItem('solarTool_hideHelp', 'true');\n      }\n    }\n\n    autoSelectModules(count) {\n      \n      // Prüfe ob das aktuelle Grid groß genug ist\n      const currentCapacity = this.solarGrid.cols * this.solarGrid.rows;\n      \n      if (currentCapacity < count) {\n        this.expandGridForModules(count);\n      }\n      \n      // ROBUST: Initialisiere das komplette Selection-Array für alle Dimensionen\n      this.solarGrid.selection = Array.from({ length: this.solarGrid.rows }, () =>\n        Array.from({ length: this.solarGrid.cols }, () => false)\n      );\n      \n      // Selektiere Module von links nach rechts, oben nach unten\n      let selected = 0;\n      for (let y = 0; y < this.solarGrid.rows && selected < count; y++) {\n        for (let x = 0; x < this.solarGrid.cols && selected < count; x++) {\n          this.solarGrid.selection[y][x] = true;\n          selected++;\n        }\n      }\n      \n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n    }\n    expandGridForModules(targetCount) {\n      const currentCapacity = this.solarGrid.cols * this.solarGrid.rows;\n      \n      if (currentCapacity >= targetCount) return;\n      \n      // Berechne optimale neue Grid-Größe\n      const optimalGrid = this.calculateOptimalGrid(targetCount);\n      \n      // Erweitere das Grid intelligent\n      let newCols = this.solarGrid.cols;\n      let newRows = this.solarGrid.rows;\n      \n      // Bevorzuge Spalten-Erweiterung (horizontal wachsen)\n      while (newCols * newRows < targetCount) {\n        if (newCols <= newRows) {\n          newCols++;\n        } else {\n          newRows++;\n        }\n      }\n      \n      \n      // Aktualisiere Grid-Dimensionen\n      this.solarGrid.cols = newCols;\n      this.solarGrid.rows = newRows;\n      \n      // Erweitere bestehende Auswahl-Matrix\n      const oldSelection = this.solarGrid.selection || [];\n      this.solarGrid.selection = Array.from({ length: newRows }, (_, y) =>\n        Array.from({ length: newCols }, (_, x) => {\n          // Behalte bestehende Auswahl bei\n          if (y < oldSelection.length && x < oldSelection[y].length) {\n            return oldSelection[y][x];\n          }\n          return false;\n        })\n      );\n      \n      // Grid neu aufbauen\n      this.solarGrid.updateSize();\n    }\n    // NEUE METHODE: Dynamische Abstand-Anpassung für bestehende Grids\n    adjustGridSpacing(spacingConfig) {\n      const { spacing, targetCols, targetRows } = spacingConfig;\n      \n      // 1. Identifiziere alle belegten Reihen im aktuellen Grid\n      const occupiedRows = [];\n      for (let y = 0; y < this.solarGrid.rows; y++) {\n        if (this.solarGrid.selection[y] && this.solarGrid.selection[y].some(cell => cell === true)) {\n          // Sammle alle Module in dieser Reihe\n          const modules = [];\n          for (let x = 0; x < this.solarGrid.cols; x++) {\n            if (this.solarGrid.selection[y][x] === true) {\n              modules.push(x);\n            }\n          }\n          occupiedRows.push({ originalRow: y, modules: modules });\n        }\n      }\n      \n      if (occupiedRows.length === 0) return; // Keine Module vorhanden\n      \n      // 2. Berechne neue Grid-Größe basierend auf gewünschtem Abstand\n      let newRows;\n      if (spacing === 0) {\n        // \"ohne abstand\" - nur die belegten Reihen\n        newRows = occupiedRows.length;\n      } else {\n        // \"mit X reihen abstand\" - belegte Reihen + Abstände dazwischen\n        newRows = occupiedRows.length + (occupiedRows.length - 1) * spacing;\n      }\n      \n      // Berechne benötigte Spalten (mindestens so viele wie das breiteste Modul braucht)\n      const maxModuleX = Math.max(...occupiedRows.map(row => \n        row.modules.length > 0 ? Math.max(...row.modules) : 0\n      ));\n      const newCols = Math.max(\n        targetCols || this.solarGrid.cols, // Ziel-Spalten oder aktuelle Spalten\n        maxModuleX + 1                     // Mindestens so breit wie das breiteste Modul\n      );\n      \n      // 3. Passe Grid-Größe an\n      this.solarGrid.cols = newCols;\n      this.solarGrid.rows = newRows;\n      \n      // 4. Erstelle neue Selection-Matrix\n      const newSelection = Array.from({ length: newRows }, () =>\n        Array.from({ length: newCols }, () => false)\n      );\n      \n      // 5. Platziere Module an neuen Positionen mit korrektem Abstand\n      let currentTargetRow = 0;\n      for (let i = 0; i < occupiedRows.length; i++) {\n        const occupiedRow = occupiedRows[i];\n        \n        // Platziere alle Module dieser Reihe\n        for (const moduleX of occupiedRow.modules) {\n          if (moduleX < newCols) {\n            newSelection[currentTargetRow][moduleX] = true;\n          }\n        }\n        \n        // Springe zum nächsten verfügbaren Slot (mit Abstand)\n        if (i < occupiedRows.length - 1) { // Nicht beim letzten Element\n          currentTargetRow += 1 + spacing;\n        }\n      }\n      \n      // 6. Aktualisiere Selection und Grid\n      this.solarGrid.selection = newSelection;\n      this.solarGrid.updateSize();\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n      \n      // 7. Erfolgsmeldung\n      if (spacing === 0) {\n        this.solarGrid.showToast(`🔧 Abstände entfernt - ${occupiedRows.length} Reihen kompakt`, 2000);\n      } else {\n        this.solarGrid.showToast(`📏 ${spacing} Reihen Abstand hinzugefügt - ${newRows} Reihen total`, 2000);\n      }\n    }\n    \n    applyRowConfiguration(rowConfig, intelligentDistribution = null) {\n      if (intelligentDistribution) {\n      }\n      \n      const { rows, modulesPerRow, spacing, totalModules } = rowConfig;\n      \n      // Stelle sicher, dass das Grid die richtige Größe hat\n      const neededRows = rows + (rows - 1) * spacing;\n      const neededCols = modulesPerRow;\n      \n      if (this.solarGrid.rows < neededRows || this.solarGrid.cols < neededCols) {\n        this.expandGridForRowConfig(neededCols, neededRows);\n      }\n      \n      // ROBUSTE Selection-Array-Initialisierung für ALLE Dimensionen\n      // Stelle sicher, dass selection[][] für die aktuellen Dimensionen existiert\n      for (let y = 0; y < this.solarGrid.rows; y++) {\n        if (!this.solarGrid.selection[y]) {\n          this.solarGrid.selection[y] = [];\n        }\n        // Stelle sicher, dass alle X-Positionen existieren\n        for (let x = 0; x < this.solarGrid.cols; x++) {\n          this.solarGrid.selection[y][x] = false;\n        }\n      }\n      \n      // Selektiere Module in Reihen mit intelligenter Verteilung\n      let currentRow = 0;\n      let modulesPlaced = 0;\n      \n      for (let rowIndex = 0; rowIndex < rows; rowIndex++) {\n        let modulesInThisRow;\n        \n        if (intelligentDistribution) {\n          // Intelligente Verteilung: Gleichmäßig verteilen + Reste von oben\n          const { baseModulesPerRow, extraModules } = intelligentDistribution;\n          modulesInThisRow = baseModulesPerRow + (rowIndex < extraModules ? 1 : 0);\n        } else {\n          // Standard: Alle Reihen gleich voll\n          modulesInThisRow = Math.min(modulesPerRow, totalModules - modulesPlaced);\n        }\n        \n        // Selektiere Module in dieser Reihe - VERWENDE AKTUELLE GRID-DIMENSIONEN\n        for (let x = 0; x < modulesInThisRow && x < this.solarGrid.cols; x++) {\n          if (currentRow < this.solarGrid.rows) {\n            // Stelle sicher, dass die Position existiert\n            if (!this.solarGrid.selection[currentRow]) {\n              this.solarGrid.selection[currentRow] = [];\n            }\n            this.solarGrid.selection[currentRow][x] = true;\n            modulesPlaced++;\n          }\n        }\n        \n        \n        // Springe über Abstand-Reihen\n        currentRow += 1 + spacing;\n      }\n      \n      \n      // Grid neu aufbauen\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n    }\n\n    // NEU: Verteile Module gemäß gewünschtem Modus\n    distributeModules(totalModules, mode, config = {}) {\n      // Stelle sicher, dass das Grid groß genug ist\n      const capacity = this.solarGrid.cols * this.solarGrid.rows;\n      if (capacity < totalModules) {\n        this.expandGridForModules(totalModules);\n      }\n\n      // Leere Auswahlmatrix aufbauen\n      this.solarGrid.selection = Array.from({ length: this.solarGrid.rows }, () =>\n        Array.from({ length: this.solarGrid.cols }, () => false)\n      );\n\n      const rows = this.solarGrid.rows;\n      const cols = this.solarGrid.cols;\n\n      const placeRowWise = (rowCounts) => {\n        for (let y = 0; y < rows; y++) {\n          let count = rowCounts[y] || 0;\n          for (let x = 0; x < cols && count > 0; x++) {\n            this.solarGrid.selection[y][x] = true;\n            count--;\n          }\n        }\n      };\n\n      if (mode === 'equal') {\n        // Verteile möglichst quadratisch\n        const numRows = Math.min(rows, Math.ceil(Math.sqrt(totalModules)));\n        const base = Math.floor(totalModules / numRows);\n        const extra = totalModules % numRows;\n        const rowCounts = Array.from({ length: rows }, (_, y) => (y < numRows ? base + (y < extra ? 1 : 0) : 0));\n        placeRowWise(rowCounts);\n      } else if (mode === 'rows') {\n        const base = Math.floor(totalModules / rows);\n        const extra = totalModules % rows;\n        const rowCounts = Array.from({ length: rows }, (_, y) => base + (y < extra ? 1 : 0));\n        placeRowWise(rowCounts);\n      } else if (mode === 'columns') {\n        // Spaltenweise gleichmäßig\n        const base = Math.floor(totalModules / cols);\n        const extra = totalModules % cols;\n        for (let x = 0; x < cols; x++) {\n          let count = base + (x < extra ? 1 : 0);\n          for (let y = 0; y < rows && count > 0; y++) {\n            this.solarGrid.selection[y][x] = true;\n            count--;\n          }\n        }\n      } else if (mode === 'random') {\n        let placed = 0;\n        const cells = [];\n        for (let y = 0; y < rows; y++) {\n          for (let x = 0; x < cols; x++) cells.push([y, x]);\n        }\n        // Shuffle\n        for (let i = cells.length - 1; i > 0; i--) {\n          const j = Math.floor(Math.random() * (i + 1));\n          [cells[i], cells[j]] = [cells[j], cells[i]];\n        }\n        for (const [y, x] of cells) {\n          if (placed >= totalModules) break;\n          this.solarGrid.selection[y][x] = true;\n          placed++;\n        }\n      } else {\n        // Fallback\n        this.autoSelectModules(totalModules);\n      }\n\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n    }\n    expandGridForRowConfig(neededCols, neededRows) {\n      const oldSelection = this.solarGrid.selection || [];\n      \n      // Aktualisiere Grid-Dimensionen\n      this.solarGrid.cols = Math.max(this.solarGrid.cols, neededCols);\n      this.solarGrid.rows = Math.max(this.solarGrid.rows, neededRows);\n      \n      // Erweitere Auswahl-Matrix\n      this.solarGrid.selection = Array.from({ length: this.solarGrid.rows }, (_, y) =>\n        Array.from({ length: this.solarGrid.cols }, (_, x) => {\n          // Behalte bestehende Auswahl bei\n          if (y < oldSelection.length && x < oldSelection[y].length) {\n            return oldSelection[y][x];\n          }\n          return false;\n        })\n      );\n      \n      // Grid neu aufbauen\n      this.solarGrid.updateSize();\n    }\n  }\n\n  // ===== BULK SELECTOR =====\n  class BulkSelector {\n    constructor(solarGrid) {\n      this.solarGrid = solarGrid;\n      this.firstClick = null;\n      this.isSelecting = false;\n      this.bulkMode = false; // Neuer Toggle-Modus für Shift\n      \n      // NEUE: Drag-to-Select Properties\n      this.isDragging = false;\n      this.dragStart = null;\n      this.mousePressed = false;\n      \n      this.setupKeyListener();\n      this.setupGlobalMouseEvents();\n    }\n\n    setupKeyListener() {\n      // FEATURE 2: Shift+Klick entfernt - nur noch Drag-and-Drop\n      // Keine Keyboard-Listener mehr für Shift-Toggle\n      // Bulk-Modus wird nur noch über Drag-and-Drop aktiviert\n    }\n\n    toggleBulkMode() {\n      this.bulkMode = !this.bulkMode;\n      \n      if (this.bulkMode) {\n        this.showBulkModeIndicator(true);\n        this.firstClick = null; // Reset bei Aktivierung\n      } else {\n        this.showBulkModeIndicator(false);\n        this.firstClick = null;\n        this.clearHighlight();\n      }\n    }\n\n    showBulkModeIndicator(active) {\n      // Entferne bestehende Indikatoren\n      document.querySelectorAll('.bulk-mode-indicator').forEach(el => el.remove());\n      \n      if (active) {\n        const indicator = document.createElement('div');\n        indicator.className = 'bulk-mode-indicator';\n        indicator.innerHTML = '🔄 Bulk-Modus aktiv - Klicke auf zwei Zellen um einen Bereich auszuwählen';\n        indicator.style.cssText = `\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          background: #f5a623;\n          color: white;\n          padding: 8px 16px;\n          border-radius: 8px;\n          font-size: 14px;\n          font-weight: bold;\n          z-index: 1000;\n          box-shadow: 0 4px 12px rgba(245, 166, 35, 0.3);\n          animation: slideIn 0.3s ease;\n        `;\n        \n        // Animation hinzufügen\n        const style = document.createElement('style');\n        style.textContent = `\n          @keyframes slideIn {\n            from { transform: translateX(100%); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n          }\n        `;\n        if (document.head) {\n          document.head.appendChild(style);\n        }\n        if (document.body) {\n          document.body.appendChild(indicator);\n        }\n      }\n    }\n\n    initializeBulkSelection() {\n      // Erweitere die bestehende Grid-Erstellung\n      const originalBuildGrid = this.solarGrid.buildGrid.bind(this.solarGrid);\n      \n      this.solarGrid.buildGrid = () => {\n        originalBuildGrid();\n        // Warte kurz bis DOM aktualisiert ist, dann füge Bulk Selection hinzu\n        setTimeout(() => {\n          this.addBulkSelectionToGrid();\n        }, 10);\n      };\n      \n      // Initialisiere Bulk Selection auch für das bestehende Grid\n      setTimeout(() => {\n        this.addBulkSelectionToGrid();\n      }, 100);\n    }\n\n    addBulkSelectionToGrid() {\n      const cells = this.solarGrid.gridEl.querySelectorAll('.grid-cell');\n      \n      cells.forEach((cell, index) => {\n        const x = index % this.solarGrid.cols;\n        const y = Math.floor(index / this.solarGrid.cols);\n        \n        // Entferne alte Event Listener\n        const newCell = cell.cloneNode(true);\n        cell.parentNode.replaceChild(newCell, cell);\n        \n        // FEATURE 1: Snap-to-Grid + Touch-Optimierung\n        // NEUE: Drag-to-Select Event Listeners mit Touch-Support\n        newCell.addEventListener('mousedown', (e) => {\n          e.preventDefault(); // Verhindert Textauswahl während Drag\n          this.handleDragStart(e, x, y, newCell);\n        });\n        \n        // Touch-Events für Mobile-Optimierung\n        newCell.addEventListener('touchstart', (e) => {\n          e.preventDefault();\n          this.handleDragStart(e, x, y, newCell);\n        });\n        \n        newCell.addEventListener('mouseenter', (e) => {\n          if (this.mousePressed && this.dragStart) {\n            // FEATURE 1: Snap-to-Grid - Live-Preview mit Grid-Snap\n            this.isDragging = true;\n            this.highlightRange(this.dragStart, { x, y });\n          }\n        });\n        \n        // Touch-Move für Mobile\n        newCell.addEventListener('touchmove', (e) => {\n          if (this.mousePressed && this.dragStart) {\n            e.preventDefault();\n            this.isDragging = true;\n            this.highlightRange(this.dragStart, { x, y });\n          }\n        });\n        \n        newCell.addEventListener('mouseup', (e) => {\n          if (this.mousePressed && this.dragStart) {\n            e.preventDefault();\n            this.handleDragEnd(e, x, y);\n          }\n        });\n        \n        // Touch-End für Mobile\n        newCell.addEventListener('touchend', (e) => {\n          if (this.mousePressed && this.dragStart) {\n            e.preventDefault();\n            this.handleDragEnd(e, x, y);\n          }\n        });\n\n        // FEATURE 2: Shift+Klick entfernt - nur noch Drag-and-Drop\n        // Füge neue Event Listener hinzu\n        newCell.addEventListener('click', (e) => {\n          // Verhindere Click-Verarbeitung wenn gerade ein Drag beendet wurde\n          if (this.isDragging || (this.mousePressed && this.dragStart)) {\n            return;\n          }\n          \n          // Normaler Click-Modus (Bulk-Modus entfernt)\n          if (!this.solarGrid.selection[y]) this.solarGrid.selection[y] = [];\n          \n          if (e.ctrlKey || e.metaKey) {\n            // Ctrl+Click: Toggle ohne firstClick zu ändern\n            this.solarGrid.selection[y][x] = !this.solarGrid.selection[y][x];\n          } else {\n            // Normaler Click: Toggle\n            this.solarGrid.selection[y][x] = !this.solarGrid.selection[y][x];\n          }\n          \n          newCell.classList.toggle('selected');\n          this.solarGrid.trackInteraction();\n          this.solarGrid.buildList();\n          this.solarGrid.updateSummaryOnChange();\n          \n          // Update config-list und overview wenn eine Konfiguration ausgewählt ist\n          if (this.solarGrid.currentConfig !== null) {\n            // Speichere die Konfiguration automatisch\n            this.solarGrid.updateConfig();\n            this.solarGrid.updateConfigList();\n          }\n        });\n\n        newCell.addEventListener('mouseleave', () => {\n          // Nur Highlight löschen wenn nicht gerade gedraggt wird\n          if (!this.mousePressed) {\n            this.clearHighlight();\n          }\n        });\n      });\n    }\n\n    selectRange(start, end) {\n      const minX = Math.min(start.x, end.x);\n      const maxX = Math.max(start.x, end.x);\n      const minY = Math.min(start.y, end.y);\n      const maxY = Math.max(start.y, end.y);\n\n      // Wenn die erste Zelle ausgewählt war, deselektiere den gesamten Bereich\n      // Wenn die erste Zelle leer war, wähle den gesamten Bereich aus\n      const shouldSelect = !start.wasSelected;\n      \n\n      for (let y = minY; y <= maxY; y++) {\n        if (!this.solarGrid.selection[y]) this.solarGrid.selection[y] = [];\n        for (let x = minX; x <= maxX; x++) {\n          this.solarGrid.selection[y][x] = shouldSelect;\n        }\n      }\n\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n    }\n\n    highlightRange(start, end) {\n      this.clearHighlight();\n      \n      const minX = Math.min(start.x, end.x);\n      const maxX = Math.max(start.x, end.x);\n      const minY = Math.min(start.y, end.y);\n      const maxY = Math.max(start.y, end.y);\n\n      const cells = this.solarGrid.gridEl.querySelectorAll('.grid-cell');\n      \n      // Ermittle ob wir im Auswahl- oder Abwahl-Modus sind\n      const isSelectMode = start.wasSelected !== undefined ? !start.wasSelected : true;\n      \n      for (let y = minY; y <= maxY; y++) {\n        for (let x = minX; x <= maxX; x++) {\n          const index = y * this.solarGrid.cols + x;\n          if (cells[index]) {\n            // Basis-Highlight (gelber Rahmen)\n            cells[index].classList.add('bulk-highlight');\n            \n            // Intelligente Preview je nach Modus\n            if (isSelectMode) {\n              // Auswahl-Modus: Zeige Solarpanel-Preview mit 30% Opacity\n              cells[index].classList.add('drag-preview-select');\n            } else {\n              // Abwahl-Modus: Zeige Unselected-Preview mit 30% Opacity\n              cells[index].classList.add('drag-preview-deselect');\n            }\n          }\n        }\n      }\n    }\n    clearHighlight() {\n      // Entferne alle Highlight- und Preview-Klassen\n      const highlighted = this.solarGrid.gridEl.querySelectorAll('.bulk-highlight, .drag-preview-select, .drag-preview-deselect');\n      highlighted.forEach(cell => {\n        cell.classList.remove('bulk-highlight', 'drag-preview-select', 'drag-preview-deselect');\n      });\n      \n      // Entferne auch alle Drag-Marker\n      const dragMarkers = this.solarGrid.gridEl.querySelectorAll('.drag-start-marker, .drag-select-mode, .drag-deselect-mode');\n      dragMarkers.forEach(cell => {\n        cell.classList.remove('drag-start-marker', 'drag-select-mode', 'drag-deselect-mode');\n      });\n    }\n    \n    // NEUE METHODEN für Drag-to-Select\n    resetDragState() {\n      this.mousePressed = false;\n      this.isDragging = false;\n      this.dragStart = null;\n      this.clearHighlight();\n    }\n    \n    calculateRangeSize(start, end) {\n      const minX = Math.min(start.x, end.x);\n      const maxX = Math.max(start.x, end.x);\n      const minY = Math.min(start.y, end.y);  \n      const maxY = Math.max(start.y, end.y);\n      \n      return (maxX - minX + 1) * (maxY - minY + 1);\n    }\n\n    clearFirstClickMarker() {\n      const cells = this.solarGrid.gridEl.querySelectorAll('.grid-cell');\n      cells.forEach(cell => cell.classList.remove('first-click-marker'));\n    }\n    \n    // Ermittelt die dem Zeiger nächstgelegene Zelle; klemmt außerhalb auf Grid-Rand\n    getClampedCellFromPointer(event) {\n      const gridRect = this.solarGrid.gridEl.getBoundingClientRect();\n      // Unterstützt Maus und Touch\n      const point = (event && (event.touches && event.touches[0])) || (event && (event.changedTouches && event.changedTouches[0])) || event;\n      const clientX = point ? point.clientX : 0;\n      const clientY = point ? point.clientY : 0;\n\n      const relativeX = Math.min(Math.max(clientX - gridRect.left, 0), gridRect.width);\n      const relativeY = Math.min(Math.max(clientY - gridRect.top, 0), gridRect.height);\n\n      const colWidth = gridRect.width / this.solarGrid.cols;\n      const rowHeight = gridRect.height / this.solarGrid.rows;\n\n      // Verhindere Division durch 0\n      const x = Math.min(\n        this.solarGrid.cols - 1,\n        Math.max(0, colWidth > 0 ? Math.floor(relativeX / colWidth) : 0)\n      );\n      const y = Math.min(\n        this.solarGrid.rows - 1,\n        Math.max(0, rowHeight > 0 ? Math.floor(relativeY / rowHeight) : 0)\n      );\n\n      return { x, y };\n    }\n\n    // FEATURE 1: Snap-to-Grid + Touch-Optimierung - Neue Methoden\n    handleDragStart(e, x, y, cell) {\n      // Erfasse aktuellen Status der Start-Zelle für intelligentes Toggle\n      const isCurrentlySelected = this.solarGrid.selection[y]?.[x] || false;\n      \n      // Starte Drag-to-Select Modus\n      this.mousePressed = true;\n      this.isDragging = false; // Wird erst bei mousemove aktiviert\n      this.dragStart = { x, y, wasSelected: isCurrentlySelected };\n      \n      // Visuelle Markierung der Start-Zelle\n      this.clearHighlight();\n      cell.classList.add('drag-start-marker');\n      \n      // Visueller Hinweis auf Toggle-Modus\n      if (isCurrentlySelected) {\n        cell.classList.add('drag-deselect-mode');\n      } else {\n        cell.classList.add('drag-select-mode');\n      }\n    }\n    \n    handleDragEnd(e, x, y) {\n      if (this.isDragging || (this.dragStart.x === x && this.dragStart.y === y)) {\n        // Drag beendet ODER Single-Click (gleiche Zelle)\n        this.selectRange(this.dragStart, { x, y });\n        \n        // KEINE Toast-Nachrichten mehr bei Drag-Operationen\n        // Alle Toast-Nachrichten für Drag-Operationen wurden entfernt\n      }\n      \n      // Reset Drag-Zustand\n      this.resetDragState();\n    }\n    \n    // FEATURE 1: Snap-to-Grid + Touch-Optimierung - Globale Events\n    setupGlobalMouseEvents() {\n      // Globaler Mouse-Move: Während Drag immer Range-Preview updaten, auch außerhalb\n      document.addEventListener('mousemove', (e) => {\n        if (this.mousePressed && this.dragStart) {\n          this.isDragging = true;\n          const endCell = this.getClampedCellFromPointer(e);\n          this.highlightRange(this.dragStart, endCell);\n        }\n      });\n\n      // Globaler Mouse-Up: Auswahl auch außerhalb committen\n      document.addEventListener('mouseup', (e) => {\n        if (this.mousePressed && this.dragStart) {\n          const endCell = this.getClampedCellFromPointer(e);\n          this.handleDragEnd(e, endCell.x, endCell.y);\n        }\n      });\n      \n      // Touch-End für Mobile\n      document.addEventListener('touchmove', (e) => {\n        if (this.mousePressed && this.dragStart) {\n          e.preventDefault();\n          this.isDragging = true;\n          const endCell = this.getClampedCellFromPointer(e);\n          this.highlightRange(this.dragStart, endCell);\n        }\n      }, { passive: false });\n\n      document.addEventListener('touchend', (e) => {\n        if (this.mousePressed && this.dragStart) {\n          const endCell = this.getClampedCellFromPointer(e);\n          this.handleDragEnd(e, endCell.x, endCell.y);\n        }\n      });\n      \n      // Grid-Leave: Kein Reset mehr – globale Events übernehmen die Vorschau außerhalb\n      this.solarGrid.gridEl.addEventListener('mouseleave', () => {\n        // bewusst leer: Drag bleibt aktiv, Vorschau wird global aktualisiert\n      });\n      \n      // Touch-Leave für Mobile: ebenfalls kein Reset\n      this.solarGrid.gridEl.addEventListener('touchcancel', () => {\n        // bewusst leer\n      });\n      \n      // Verhindere Kontext-Menu während Drag-Operationen\n      this.solarGrid.gridEl.addEventListener('contextmenu', (e) => {\n        if (this.isDragging || this.mousePressed) {\n          e.preventDefault();\n        }\n      });\n      \n      // Verhindere Zoom-Gesten während Drag-Operationen\n      this.solarGrid.gridEl.addEventListener('touchmove', (e) => {\n        if (this.isDragging || this.mousePressed) {\n          e.preventDefault();\n        }\n      });\n    }\n  }\n\n  // CartCompatibility-Modul entfernt - nicht mehr benötigt mit Foxy.io\n\n  // CMS-Suche entfernt - jetzt in cms-search.js\n  \n  // Einfaches Queue-System nur für addAllToCart\n  class SimpleCartQueue {\n    constructor() {\n      this.isProcessing = false;\n    }\n    \n    async execute(operation, operationName) {\n      // Warte bis vorherige Operation fertig ist\n      while (this.isProcessing) {\n        await new Promise(resolve => setTimeout(resolve, 50));\n      }\n      \n      this.isProcessing = true;\n      try {\n        console.log(`[SimpleCartQueue] Processing: ${operationName}`);\n        const result = await operation();\n        return result;\n      } finally {\n        this.isProcessing = false;\n      }\n    }\n  }\n\n  class SolarGrid {\n    // Liest Zusatzprodukte einmalig aus der angezeigten Zusatzproduktliste (Summary)\n    readExtrasFromSummaryList() {\n      const keys = ['MC4_Stecker','Solarkabel','Holzunterleger','Ringkabelschuhe','Kabelbinder','BlechBohrschrauben','Erdungsband'];\n      const extras = {};\n      try {\n        // Bevorzugt: interne letzte Berechnung, falls vorhanden\n        if (this.lastExtras && typeof this.lastExtras === 'object') return this.lastExtras;\n        // Fallback: aus DOM (Summary) parsen\n        const root = document.getElementById('summary-list') || document;\n        const items = Array.from(root.querySelectorAll('.produkt-item'));\n        const findQtyForLabel = (label) => {\n          // Durchsuche alle Items und finde das, dessen Text den Label enthält\n          const item = items.find(it => (it.textContent || '').toLowerCase().includes(String(label).toLowerCase()));\n          if (!item) return 0;\n          // Die erste <span> enthält in der Regel \"N×\"\n          const firstSpan = item.querySelector('span');\n          if (!firstSpan || !firstSpan.textContent) return 0;\n          const m = firstSpan.textContent.trim().match(/^(\\d+)\\s*×/);\n          return m ? parseInt(m[1], 10) : 0;\n        };\n        keys.forEach(k => {\n          // MC4: Sonderfall – nur 1x wenn Checkbox aktiviert, keine Berechnung\n          if (k === 'MC4_Stecker') {\n            extras[k] = (this.mc4 && this.mc4.checked) ? 1 : 0;\n            return;\n          }\n          const label = (PRODUCT_NAME_MAP[k] || k).split(' - ')[0];\n          let v = findQtyForLabel(label);\n          // Fallback auf Checkboxen, falls Summary noch nicht gemountet oder Label abweichend ist\n          if ((k === 'Solarkabel') && (!v) && this.solarkabel && this.solarkabel.checked) v = 1;\n          if ((k === 'Holzunterleger') && (!v) && this.holz && this.holz.checked) v = 1;\n          if ((k === 'Ringkabelschuhe') && (!v) && this.quetschkabelschuhe && this.quetschkabelschuhe.checked) v = 1;\n          if ((k === 'Kabelbinder') && (!v) && this.kabelbinder && this.kabelbinder.checked) v = 1;\n          if ((k === 'BlechBohrschrauben') && (!v) && this.erdungsband && this.erdungsband.checked) v = 1;\n          extras[k] = Number.isFinite(v) ? v : 0;\n        });\n        this.lastExtras = extras;\n      } catch(_) {\n        keys.forEach(k => extras[k] = 0);\n      }\n      return extras;\n    }\n    // Bündelt Gesamtmodule aus allen Konfigurationen in Paletten (36er) bevor in den Warenkorb gepostet wird\n    bundleTotalModulesIntoPallets(total) {\n      try {\n        const single450Key = 'Solarmodul';\n        const single500Key = 'UlicaSolarBlackJadeFlow';\n        const pallet450Key = 'SolarmodulPalette';\n        const pallet500Key = 'UlicaSolarBlackJadeFlowPalette';\n        const count450 = Number(total[single450Key] || 0);\n        const count500 = Number(total[single500Key] || 0);\n        const makeBundle = (singleCount) => {\n          if (!singleCount || singleCount < 36) return { single: singleCount, pallets: 0 };\n          const pallets = Math.floor(singleCount / 36);\n          const rest = singleCount - pallets * 36;\n          return { single: rest, pallets };\n        };\n        const res450 = makeBundle(count450);\n        const res500 = makeBundle(count500);\n        if (res450.pallets > 0) total[pallet450Key] = (total[pallet450Key] || 0) + res450.pallets * 36;\n        if (res500.pallets > 0) total[pallet500Key] = (total[pallet500Key] || 0) + res500.pallets * 36;\n        total[single450Key] = res450.single;\n        total[single500Key] = res500.single;\n      } catch (_) {}\n    }\n    constructor() {\n      this.gridEl        = document.getElementById('grid');\n      this.wrapper       = document.querySelector('.grid-wrapper');\n      this.wIn           = document.getElementById('width-input');\n      this.hIn           = document.getElementById('height-input');\n      this.orH           = document.getElementById('orient-h');\n      this.orV           = document.getElementById('orient-v');\n      this.incM          = document.getElementById('include-modules');\n      this.mc4           = document.getElementById('mc4');\n      this.solarkabel    = document.getElementById('solarkabel');\n      this.holz          = document.getElementById('holz');\n      this.quetschkabelschuhe = document.getElementById('quetschkabelschuhe');\n      this.kabelbinder = document.getElementById('kabelbinder');\n      this.erdungsband   = document.getElementById('erdungsband');\n      this.ulicaModule   = document.getElementById('ulica-module');\n\n      // Vorab berechnete Gesamtmengen (persistiert)\n      this.totalPartsCache = null;\n      \n\n      \t\tthis.listHolder    = document.querySelector('.product-section');\n      this.prodList      = document.querySelector('.product-section #produktliste');\n\n      this.saveBtn       = document.getElementById('save-config-btn');\n      this.addBtn        = document.getElementById('add-to-cart-btn');\n      this.summaryBtn    = document.getElementById('summary-add-cart-btn');\n      this.configListEl  = document.getElementById('config-list');\n      this.resetBtn      = document.getElementById('reset-btn');\n      this.continueLaterBtn = document.getElementById('continue-later-btn');\n      this.moduleSelect = document.getElementById('module-select');\n      // Entfernt: Reset-Button soll NUR aktuelle Konfiguration zurücksetzen (resetGridToDefault)\n      \n      // Modul-Daten\n      this.moduleData = {\n        'ulica-500': { name: 'Ulica Black Jade-Flow 500W', width: 195.2, height: 113.4 },\n        'ulica-450': { name: 'Ulica Black Jade-Flow 450W', width: 176.2, height: 113.4 },\n        'trina-vertex-s-plus': { name: 'Trina Vertex S+', width: 176.2, height: 113.4 },\n        'aiko-neostar-3s-plus': { name: 'Aiko Neostar 3S+', width: 176.2, height: 113.4 }\n      };\n      \n      // Modul-Checkbox-Mapping\n      this.moduleCheckboxMapping = {\n        'include-modules': 'ulica-450',\n        'ulica-module': 'ulica-500'\n      };\n\n      this.selection     = [];\n      this.configs       = [];\n      this.currentConfig = null;\n      this.default       = { cols:5, rows:5, width:176, height:113 };\n      \n      // Performance: Debouncing für häufige Updates\n      this.updateTimeout = null;\n      this.updateDelay = 100; // ms\n      \n      // Warenkorb-Queue & Observer\n      this.isAddingToCart = false;\n      this.webflowFormsObserver = null;\n      this.cartAckObserver = null;\n      this.cartAckResolve = null;\n      \n      // Performance: Resize Observer für responsive Updates\n      this.resizeObserver = null;\n      this.resizeTimeout = null;\n      \n      // FEATURE 8: Pinch-to-Zoom\n      this.zoomLevel = 1;\n      this.minZoom = 0.5;\n      this.maxZoom = 3;\n      this.zoomObserver = null;\n      \n      // FEATURE 5: Performance-Monitoring (entfernbar)\n      this.performanceMetrics = {\n        gridRenderTime: 0,\n        updateTime: 0,\n        memoryUsage: 0,\n        fps: 0,\n        errorCount: 0\n      };\n      \n      // Tracking für Session-Daten\n      this.sessionId = this.generateSessionId();\n      this.sessionStartTime = Date.now();\n      this.firstInteractionTime = null;\n      this.lastInteractionTime = Date.now();\n      this.interactionCount = 0;\n      this.webhookUrl = 'https://hook.eu2.make.com/c7lkudk1v2a2xsr291xbvfs2cb25b84k';\n\n      // PDF Generator initialisieren\n      this.pdfGenerator = new SolarPDFGenerator(this);\n      \n      // Cache Manager für 24h Persistierung\n      this.cacheManager = new CacheManager();\n\n      // Loading Overlay Elemente\n      this.loadingOverlay = null;\n      this.loadingTextEl = null;\n\n      this.init();\n    }\n\n    // No-op URL saver to avoid TypeError from old onclick bindings\n    saveToUrl() {\n      try {\n        // Optional: could push state or update query params here\n        return;\n      } catch (_) {\n        return;\n      }\n    }\n\n    showLoading(message = 'Vorgang läuft… bitte warten') {\n      try {\n        if (!this.loadingOverlay) this.loadingOverlay = document.getElementById('loading-overlay');\n        if (!this.loadingTextEl) this.loadingTextEl = document.getElementById('loading-text');\n        if (this.loadingTextEl && typeof message === 'string') {\n          this.loadingTextEl.textContent = message;\n        }\n        if (this.loadingOverlay) {\n          this.loadingOverlay.style.display = 'flex';\n        }\n      } catch (_) {}\n    }\n\n    hideLoading() {\n      try {\n        if (!this.loadingOverlay) this.loadingOverlay = document.getElementById('loading-overlay');\n        if (this.loadingOverlay) {\n          this.loadingOverlay.style.display = 'none';\n        }\n      } catch (_) {}\n    }\n\n    // ===== WEBHOOK FUNKTIONEN =====\n    \n    generateSessionId() {\n      // Generiere eine einzigartige Session-ID basierend auf Timestamp und Zufallszahl\n      const timestamp = Date.now().toString(36);\n      const randomPart = Math.random().toString(36).substr(2, 9);\n      return `session_${timestamp}_${randomPart}`;\n    }\n    \n    trackInteraction() {\n      if (!this.firstInteractionTime) {\n        this.firstInteractionTime = Date.now();\n      }\n      this.lastInteractionTime = Date.now();\n      this.interactionCount++;\n    }\n\n    formatDuration(milliseconds) {\n      if (!milliseconds || milliseconds < 0) return \"00:00:00\";\n      \n      const totalSeconds = Math.floor(milliseconds / 1000);\n      const hours = Math.floor(totalSeconds / 3600);\n      const minutes = Math.floor((totalSeconds % 3600) / 60);\n      const seconds = totalSeconds % 60;\n      \n      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n    }\n\n    getSessionData() {\n      const now = Date.now();\n      const sessionDurationMs = now - this.sessionStartTime;\n      const timeToFirstInteractionMs = this.firstInteractionTime ? this.firstInteractionTime - this.sessionStartTime : 0;\n      const timeSinceLastInteractionMs = now - this.lastInteractionTime;\n      \n      return {\n        sessionDuration: this.formatDuration(sessionDurationMs),\n        timeToFirstInteraction: this.formatDuration(timeToFirstInteractionMs),\n        timeSinceLastInteraction: this.formatDuration(timeSinceLastInteractionMs),\n        interactionCount: this.interactionCount,\n        sessionStartTime: this.sessionStartTime,\n        firstInteractionTime: this.firstInteractionTime,\n        lastInteractionTime: this.lastInteractionTime,\n        // FEATURE 5: Performance-Monitoring - Metriken hinzufügen\n        performanceMetrics: this.performanceMetrics\n      };\n    }\n\n    getProductSummary() {\n      const parts = this.calculateParts();\n      if (!this.incM.checked) delete parts.Solarmodul;\n      // Zusatzprodukte werden nicht mehr zu einzelnen Konfigurationen hinzugefügt\n      // Sie werden nur noch in der Overview berechnet\n\n      // Palettenlogik für Anzeige anwenden: 36er bündeln je nach Modultyp\n      try {\n        const ulicaSelected = currentConfig.ulicaModule === true;\n        const pieceKey = ulicaSelected ? 'UlicaSolarBlackJadeFlow' : 'Solarmodul';\n        const palletKey = ulicaSelected ? 'UlicaSolarBlackJadeFlowPalette' : 'SolarmodulPalette';\n        const count = Number(parts[pieceKey] || 0);\n        if (count > 0) {\n          const pallets = Math.floor(count / 36);\n          const remainder = count % 36;\n          if (pallets > 0) {\n            parts[palletKey] = (parts[palletKey] || 0) + pallets * 36;\n          }\n          parts[pieceKey] = remainder;\n        }\n      } catch (e) {}\n\n      const entries = Object.entries(parts).filter(([,v]) => v > 0);\n      let totalPrice = 0;\n      const productQuantities = {};\n      \n      // Berechne Preise und sammle Quantities\n      entries.forEach(([k,v]) => {\n        const packs = Math.ceil(v / VE[k]);\n        const price = getPackPriceForQuantity(k, v);\n        const itemTotal = packs * price;\n        totalPrice += itemTotal;\n        \n        // Verwende den Produktnamen ohne Unterstriche als Key\n        const productKey = k.replace(/_/g, '');\n        productQuantities[productKey] = v;\n      });\n        \n        return {\n        totalPrice \n      };\n    }\n\n    generateGridVisualization(selection, cols, rows, cellWidth, cellHeight) {\n      // Generate HTML for the grid\n      let html = `<div class=\"grid\" style=\"--cols: ${cols}; --rows: ${rows}; --cell-size: ${cellWidth}px; --cell-height: ${cellHeight}px; --cell-gap: 2px;\">`;\n      \n      for (let y = 0; y < rows; y++) {\n        for (let x = 0; x < cols; x++) {\n          const isSelected = selection[y] && selection[y][x];\n          const cellClass = isSelected ? 'cell selected' : 'cell';\n          html += `<div class=\"${cellClass}\"></div>`;\n        }\n      }\n      \n      html += '</div>';\n      \n      // Generate CSS for the grid\n      const css = `.grid { \n        display: grid; \n        gap: var(--cell-gap); \n        grid-template-columns: repeat(var(--cols), var(--cell-size)); \n        grid-template-rows: repeat(var(--rows), var(--cell-height)); \n        margin: auto; \n        background: transparent; \n      } \n      .cell { \n        background: #000000; \n        border-radius: 6px; \n        width: var(--cell-size); \n        height: var(--cell-height); \n        transition: all 0.15s ease; \n      } \n      .cell.selected { \n        background: #7f7f7f; \n      }`;\n      \n      return { html, css };\n    }\n    getConfigData(config = null) {\n      const targetConfig = config || {\n        cols: this.cols,\n        rows: this.rows,\n        cellWidth: parseFloat(this.wIn.value),\n        cellHeight: parseFloat(this.hIn.value),\n        orientation: this.orV.checked ? 'vertical' : 'horizontal',\n        selection: this.selection,\n        incM: this.incM.checked\n        // Zusatzprodukte werden nicht mehr zu einzelnen Konfigurationen hinzugefügt\n      };\n\n      const summary = this.getProductSummary();\n      const gridVisualization = this.generateGridVisualization(\n        targetConfig.selection, \n        targetConfig.cols, \n        targetConfig.rows, \n        targetConfig.cellWidth, \n        targetConfig.cellHeight\n      );\n      \n      // Berechne Produkt-Quantitäten für Webhook - ALLE Produkte, auch mit 0\n      const parts = this.calculatePartsDirectly({\n        selection: targetConfig.selection,\n        cols: targetConfig.cols,\n        rows: targetConfig.rows,\n        cellWidth: targetConfig.cellWidth,\n        cellHeight: targetConfig.cellHeight,\n        orientation: targetConfig.orientation,\n        incM: targetConfig.incM\n        // Zusatzprodukte werden nicht mehr zu einzelnen Konfigurationen hinzugefügt\n      });\n      \n      const allProductQuantities = {\n        Solarmodul: parts.Solarmodul || 0,\n        Endklemmen: parts.Endklemmen || 0,\n        Schrauben: parts.Schrauben || 0,\n        Dachhaken: parts.Dachhaken || 0,\n        Mittelklemmen: parts.Mittelklemmen || 0,\n        Endkappen: parts.Endkappen || 0,\n        Schienenverbinder: parts.Schienenverbinder || 0,\n        Schiene240cm: parts.Schiene_240_cm || 0,\n        Schiene360cm: parts.Schiene_360_cm || 0\n        // Zusatzprodukte werden nicht mehr zu einzelnen Konfigurationen hinzugefügt\n      };\n\n      // Kompakte Produktliste: nur Einträge > 0\n      const productQuantitiesCompact = Object.fromEntries(\n        Object.entries(allProductQuantities).filter(([, v]) => v > 0)\n      );\n\n      // Auswahl-Metadaten: gezielte Koordinaten + Anzahl\n      const selectedCoords = [];\n      for (let y = 0; y < targetConfig.rows; y++) {\n        const row = targetConfig.selection[y] || [];\n        for (let x = 0; x < targetConfig.cols; x++) {\n          if (row[x]) selectedCoords.push([x, y]);\n        }\n      }\n      const selectionMeta = {\n        selectedCount: selectedCoords.length,\n        selectedCoords\n      };\n      \n      // totalPrice robust aus kompakten Mengen berechnen (VE * Preis je Pack)\n      const totalPriceFromCompact = Object.entries(productQuantitiesCompact).reduce((sum, [key, qty]) => {\n        const veKey = key === 'Schiene240cm' ? 'Schiene_240_cm' : key === 'Schiene360cm' ? 'Schiene_360_cm' : key;\n        const ve = VE[veKey] || 1;\n        const packs = Math.ceil(qty / ve);\n        const pricePerPack = getPackPriceForQuantity(veKey, qty);\n        return sum + packs * pricePerPack;\n      }, 0);\n      \n      return {\n        timestamp: new Date().toISOString(),\n        sessionId: this.sessionId,\n        sessionData: this.getSessionData(),\n        config: {\n          cols: targetConfig.cols,\n          rows: targetConfig.rows,\n          cellWidth: targetConfig.cellWidth,\n          cellHeight: targetConfig.cellHeight,\n          orientation: targetConfig.orientation,\n          gridVisualization: gridVisualization,\n          options: {\n            includeModules: targetConfig.incM\n            // Zusatzprodukte werden nicht mehr zu einzelnen Konfigurationen hinzugefügt\n          }\n        },\n        summary: summary,\n        productQuantities: allProductQuantities,\n        productQuantitiesCompact: productQuantitiesCompact,\n        selectionMeta: selectionMeta,\n        totalPrice: Number.isFinite(totalPriceFromCompact) ? totalPriceFromCompact : summary.totalPrice,\n        analytics: {\n          totalCells: targetConfig.cols * targetConfig.rows,\n          selectedCells: targetConfig.selection.flat().filter(v => v).length,\n          selectionPercentage: ((targetConfig.selection.flat().filter(v => v).length / (targetConfig.cols * targetConfig.rows)) * 100).toFixed(2),\n          gridArea: targetConfig.cols * targetConfig.rows,\n          averageCellSize: ((targetConfig.cellWidth + targetConfig.cellHeight) / 2).toFixed(2)\n        }\n      };\n    }\n\n    async sendConfigToWebhook(configData) {\n      try {\n        // Kompakte Payload: nur essentielle Felder senden\n        const minimalPayload = {\n          sessionId: configData.sessionId,\n          timestamp: configData.timestamp,\n          config: {\n            cols: configData?.config?.cols,\n            rows: configData?.config?.rows,\n            cellWidth: configData?.config?.cellWidth,\n            cellHeight: configData?.config?.cellHeight,\n            orientation: configData?.config?.orientation\n          },\n          // Auswahl-Metadaten sind optional und klein\n          selection: configData.selectionMeta || undefined,\n          // Nur Produkte mit Menge > 0 übermitteln\n          productQuantities: configData.productQuantitiesCompact || configData.productQuantities,\n          totalPrice: configData.totalPrice,\n          // Sessiondaten nur einmalig (kompakt)\n          session: {\n            duration: configData.sessionData?.sessionDuration,\n            interactions: configData.sessionData?.interactionCount\n          }\n        };\n\n        // Falls Metadaten von sendAllConfigsToWebhook vorhanden sind, beilegen\n        if (typeof configData.configIndex === 'number' || configData.configName || typeof configData.totalConfigsInSession === 'number') {\n          minimalPayload.meta = {\n            configIndex: configData.configIndex,\n            configName: configData.configName,\n            totalConfigsInSession: configData.totalConfigsInSession\n          };\n        }\n\n        const response = await fetch(this.webhookUrl, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(minimalPayload)\n        });\n\n        return response.ok;\n      } catch (error) {\n        console.error('Webhook send error:', error);\n        return false;\n      }\n    }\n\n    async sendCurrentConfigToWebhook() {\n      const configData = this.getConfigData();\n      return await this.sendConfigToWebhook(configData);\n    }\n\n    async sendAllConfigsToWebhook() {\n      const results = [];\n      let successCount = 0;\n\n      // Sende jede Konfiguration einzeln\n      for (let idx = 0; idx < this.configs.length; idx++) {\n        const cfg = this.configs[idx];\n        \n        // Für die aktuell bearbeitete Konfiguration: Verwende aktuelle Werte\n        let currentConfig;\n        if (idx === this.currentConfig) {\n          currentConfig = {\n            cols: this.cols,\n            rows: this.rows,\n            cellWidth: parseFloat(this.wIn.value),\n            cellHeight: parseFloat(this.hIn.value),\n            orientation: this.orV.checked ? 'vertical' : 'horizontal',\n            selection: this.selection,\n            incM: this.incM.checked,\n            mc4: this.mc4.checked,\n            solarkabel: this.solarkabel.checked,\n            holz: this.holz.checked\n          };\n        } else {\n          currentConfig = {\n            cols: cfg.cols,\n            rows: cfg.rows,\n            cellWidth: parseFloat(cfg.cellWidth),\n            cellHeight: parseFloat(cfg.cellHeight),\n            orientation: cfg.orientation,\n            selection: cfg.selection,\n            incM: cfg.incM,\n            mc4: cfg.mc4,\n            solarkabel: cfg.solarkabel,\n            holz: cfg.holz\n          };\n        }\n\n        // Temporär setzen für Berechnung\n        const originalSelection = this.selection;\n        const originalOrientation = this.orV ? this.orV.checked : false;\n        const originalSolarkabel = this.solarkabel ? this.solarkabel.checked : false;\n        const originalIncM = this.incM ? this.incM.checked : false;\n        const originalMc4 = this.mc4 ? this.mc4.checked : false;\n        const originalHolz = this.holz ? this.holz.checked : false;\n        \n        this.selection = currentConfig.selection;\n        if (this.orV) this.orV.checked = currentConfig.orientation === 'vertical';\n        if (this.orH) this.orH.checked = !(currentConfig.orientation === 'vertical');\n        if (this.solarkabel) this.solarkabel.checked = currentConfig.solarkabel;\n        if (this.incM) this.incM.checked = currentConfig.incM;\n        if (this.mc4) this.mc4.checked = currentConfig.mc4;\n        if (this.holz) this.holz.checked = currentConfig.holz;\n\n        // Erstelle individuelle Konfigurationsdaten mit getConfigData\n        const configData = this.getConfigData(currentConfig);\n        \n        // Füge zusätzliche Metadaten hinzu\n        configData.configIndex = idx;\n        configData.configName = cfg.name;\n        configData.totalConfigsInSession = this.configs.length;\n\n        // Ursprüngliche Werte wiederherstellen\n        this.selection = originalSelection;\n        if (this.orV) this.orV.checked = originalOrientation;\n        if (this.orH) this.orH.checked = !originalOrientation;\n        if (this.solarkabel) this.solarkabel.checked = originalSolarkabel;\n        if (this.incM) this.incM.checked = originalIncM;\n        if (this.mc4) this.mc4.checked = originalMc4;\n        if (this.holz) this.holz.checked = originalHolz;\n\n        // Sende einzelne Konfiguration\n        try {\n          const success = await this.sendConfigToWebhook(configData);\n          if (success) {\n            successCount++;\n          } else {\n          }\n          results.push(success);\n          \n          // Kurze Pause zwischen Requests um Server nicht zu überlasten\n          if (idx < this.configs.length - 1) {\n            await new Promise(resolve => setTimeout(resolve, 100));\n          }\n        } catch (error) {\n          results.push(false);\n        }\n      }\n\n      return successCount === this.configs.length;\n    }\n\n    checkMobileDevice() {\n      // Mobile Device Detection\n      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||\n                       window.innerWidth <= 768 ||\n                       ('ontouchstart' in window && window.innerWidth <= 1024);\n      \n      if (isMobile) {\n        // Auf mobilen Geräten: Direkt zur unterkonstruktion.de weiterleiten\n        this.redirectToDesktopSite();\n      }\n    }\n\n    // showMobileWarning() - Entfernt, da direkte Weiterleitung implementiert\n    \n    // Deaktiviere alle Konfigurator-Funktionen auf mobilen Geräten\n    disableMobileFunctionality() {\n      try {\n        // Verstecke den Hauptkonfigurator\n        const mainContainer = document.querySelector('.main-container, #solar-configurator, .configurator-wrapper');\n        if (mainContainer) {\n          mainContainer.style.display = 'none';\n        }\n        \n        // Verstecke alle Konfigurator-spezifischen Elemente\n        const configElements = document.querySelectorAll('.grid-container, .config-sidebar, .button-bar, .checkbox-bar');\n        configElements.forEach(el => {\n          if (el) el.style.display = 'none';\n        });\n        \n        // Verhindere Event Listener\n        document.addEventListener('click', (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n        }, true);\n        \n        document.addEventListener('touchstart', (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n        }, true);\n        \n        console.log('[SolarGrid] Mobile functionality disabled - Desktop required');\n      } catch (error) {\n        console.warn('[SolarGrid] Error disabling mobile functionality:', error);\n      }\n    }\n    \n    // Weiterleitung zur Desktop-Website\n    redirectToDesktopSite() {\n      try {\n        // Verstecke alle Konfigurator-Elemente\n        this.disableMobileFunctionality();\n        \n        // Zeige eine kurze Nachricht bevor der Redirect\n        const redirectMessage = document.createElement('div');\n        redirectMessage.style.cssText = `\n          position: fixed;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          background: #0e1e34;\n          color: white;\n          padding: 20px;\n          border-radius: 8px;\n          text-align: center;\n          z-index: 10000;\n          font-family: Arial, sans-serif;\n          width: 95vw;\n          max-width: 400px;\n          box-sizing: border-box;\n        `;\n        redirectMessage.innerHTML = `\n          <h3>Weiterleitung zur Homepage</h3>\n          <p>Der Konfigurator ist nur auf Desktop-Geräten verfügbar.</p>\n          <p>Sie werden automatisch weitergeleitet...</p>\n        `;\n        document.body.appendChild(redirectMessage);\n        \n        // Redirect nach 2 Sekunden\n        setTimeout(() => {\n          window.location.href = 'https://unterkonstruktion.de/';\n        }, 2000);\n        \n        console.log('[SolarGrid] Redirecting mobile users to unterkonstruktion.de');\n      } catch (error) {\n        console.warn('[SolarGrid] Error redirecting to desktop site:', error);\n        // Fallback: Direkter Redirect\n        window.location.href = 'https://unterkonstruktion.de/';\n      }\n    }\n    // Desktop Intro Overlay (Desktop only; zeigt bei leerem Cache/ohne URL jedes Mal)\n    maybeShowIntroOverlay(cacheLoaded, hasUrlConfig) {\n      try {\n        const overlay = document.getElementById('intro-overlay');\n        if (!overlay) return;\n        // Desktop-Erkennung: echte Mobile-UserAgents oder Touch+kleine Breite gelten als mobil\n        // Auf allen Geräten anzeigen; Layout ist nun responsiv (horizontal/vertikal)\n        // Nur anzeigen, wenn KEIN Cache geladen wurde und KEINE URL-Konfiguration vorhanden ist\n        if (cacheLoaded || hasUrlConfig) return;\n        const closeBtn = document.getElementById('intro-close');\n        const okBtn = document.getElementById('intro-ok');\n        const close = () => {\n          overlay.classList.add('hidden');\n          overlay.setAttribute('aria-hidden', 'true');\n        };\n        overlay.classList.remove('hidden');\n        overlay.setAttribute('aria-hidden', 'false');\n        closeBtn?.addEventListener('click', close);\n        okBtn?.addEventListener('click', close);\n        // Outside-Click schließt Overlay\n        overlay.addEventListener('click', (e) => { if (e.target === overlay) close(); });\n        // Delegation: Klick auf \"Verstanden – Start\" (auch bei verschachtelten Elementen)\n        overlay.addEventListener('click', (e) => {\n          const t = e.target;\n          if (t && (t.id === 'intro-ok' || (t.closest && t.closest('#intro-ok')))) {\n            e.preventDefault();\n            e.stopPropagation();\n            close();\n          }\n        });\n        // Tastaturbedienung: ESC zum Schließen, Enter auf Primär-Button\n        overlay.addEventListener('keydown', (e) => {\n          if (e.key === 'Escape') { e.preventDefault(); close(); }\n          if (e.key === 'Enter' && document.activeElement && (document.activeElement.id === 'intro-ok')) {\n            e.preventDefault();\n            close();\n          }\n        });\n      } catch (err) {\n        console.warn('Intro Overlay konnte nicht initialisiert werden:', err);\n      }\n    }\n\n    init() {\n      // Mobile Detection und Warning\n      this.checkMobileDevice();\n      \n      // Prüfe zuerst den Cache (höchste Priorität)\n      const cacheLoaded = this.loadFromCache();\n      \n      // Prüfe URL-Parameter als Fallback (nur wenn Cache nicht geladen wurde)\n      if (!cacheLoaded) {\n        const params = new URLSearchParams(window.location.search);\n    \t\tconst rawData = params.get('configData');\n    \t\tif (rawData) {\n      \t\ttry {\n        \t\tconst json = decodeURIComponent(atob(rawData));\n        \t\tconst configs = JSON.parse(json);\n        \t\t// Lade alle Konfigurationen aus der URL\n        \t\tif (Array.isArray(configs)) {\n        \t\t\tthis.configs = configs;\n        \t\t\tthis.loadConfig(0); // Lade die erste Konfiguration\n        \t\t} else {\n        \t\t\t// Einzelne Konfiguration (alte URL-Format)\n        \t\t\tthis.configs.push(configs);\n        \t\t\tthis.loadConfig(0);\n        \t\t}\n      \t\t} catch (e) {\n      \t\t}\n    \t\t}\n            }\n\n      // Desktop Intro nur anzeigen, wenn kein Cache/URL\n      try {\n        const hasUrlConfig = new URLSearchParams(window.location.search).has('configData');\n        this.maybeShowIntroOverlay(cacheLoaded, hasUrlConfig);\n      } catch (_) {}\n \n       // Event-Listener für alle UI-Elemente setzen\n \t\tthis.setupAllEventListeners();\n\n  \t\t// Prüfe ob Buttons existieren bevor Event-Listener hinzugefügt werden\n  \t\tif (this.saveBtn) {\n  \t\t\tthis.saveBtn.addEventListener('click', () => {\n  \t\t\t\tthis.trackInteraction();\n  \t\t\t\tthis.saveNewConfig();\n  \t\t\t});\n  \t\t}\n  \t\tif (this.addBtn) {\n  \t\t\tthis.addBtn.addEventListener('click', () => {\n  \t\t\t\tthis.trackInteraction();\n  \t\t\t\tthis.addCurrentToCart();\n  \t\t\t});\n  \t\t}\n  \t\tif (this.summaryBtn) {\n  \t\t\tthis.summaryBtn.addEventListener('click', () => {\n  \t\t\t\tthis.trackInteraction();\n  \t\t\t\tthis.addAllToCart();\n  \t\t\t});\n  \t\t}\n  \t\t\t\tif (this.resetBtn) {\n\t\t\tthis.resetBtn.addEventListener('click', () => {\n\t\t\t\tthis.trackInteraction();\n\t\t\t\tthis.resetGridToDefault();\n\t\t\t});\n\t\t}\n  \t\tif (this.continueLaterBtn) {\n  \t\t\tthis.continueLaterBtn.addEventListener('click', () => {\n\t\t\t\tthis.trackInteraction();\n\t\t\t\tthis.generateContinueLink();\n\t\t\t});\n\t\t}\n\n\t\t// Sidebar Toggle Funktionalität\n\t\tconst sidebarToggle = document.getElementById('sidebar-toggle');\n\t\t// Neue Sidebar Navigation\n\t\tthis.initSidebarNavigation();\n\n\t\t// Loading Overlay referenzen\n\t\tthis.loadingOverlay = document.getElementById('loading-overlay');\n\t\tthis.loadingTextEl = document.getElementById('loading-text');\n\n  \t\twindow.addEventListener('resize', () => {\n    \t\tthis.updateSize();\n    \t\tthis.buildGrid();\n    \t\tthis.buildList();\n    \t\tthis.updateSummaryOnChange();\n  \t\t});\n      \n\t\t\t// Wenn keine Konfigurationen aus URL/CACHE geladen wurden, erstelle eine Standard-Konfiguration\n\t\t\tif (this.configs.length === 0) {\n  \t\t\tthis.cols = this.default.cols;\n  \t\t\tthis.rows = this.default.rows;\n  \t\t\tthis.setup();\n\n  \t\t\tconst defaultConfig = this._makeConfigObject();\n  \t\t\tthis.configs.push(defaultConfig);\n  \t\t\tthis.loadConfig(0);\n\n\t\t\t\t// Standard-Orientation nur für echte Default-Erstellung setzen\n\t\t\t\tif (this.orH && this.orV) {\n\t\t\t\t\tthis.orH.checked = false;\n\t\t\t\t\tthis.orV.checked = true;\n\t\t\t\t\t// Synchronisiere mit den Orientation Buttons\n\t\t\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\t\t\tif (orientHBtn && orientVBtn) {\n\t\t\t\t\t\torientHBtn.classList.remove('active');\n\t\t\t\t\t\torientVBtn.classList.add('active');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Performance: Resize Observer für responsive Updates\n\t\t\tthis.setupResizeObserver();\n\t\t\t\n\t\t\t// FEATURE 8: Pinch-to-Zoom Setup\n\t\t\tthis.setupPinchToZoom();\n\t\t\t\n\t\t\t// Initialisiere Smart Config Features\n\t\t\tthis.initSmartConfigFeatures();\n\n\t\t\t// Loading Overlay referenzen\n\t\t\tthis.loadingOverlay = document.getElementById('loading-overlay');\n\t\t\tthis.loadingTextEl = document.getElementById('loading-text');\n\t\t\t\n\t\t\t// Initialisiere Auto-Save Indicator\n\t\t\tthis.initAutoSaveIndicator();\n\t\t\t\n\t\t\t// Initialisiere Config-Liste\n\t\t\tthis.initConfigList();\n\t\t\t\n\t\t\t// Hinweis: Keine erzwungene Standard-Orientation hier setzen, um Cache/URL-Werte nicht zu überschreiben\n\t\t}\n\t\tinitSidebarNavigation() {\n\t\t\t// Navigation zwischen Detail-Ansicht und Übersicht\n\t\t\tconst backToOverviewBtn = document.getElementById('back-to-overview');\n\t\t\tconst detailView = document.getElementById('config-detail-view');\n\t\t\tconst overviewView = document.getElementById('config-overview');\n\t\t\t\n\t\t\tif (backToOverviewBtn) {\n\t\t\t\tbackToOverviewBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.showOverview();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Edit Config Name\n\t\t\tconst editConfigBtn = document.getElementById('edit-config-name');\n\t\t\tif (editConfigBtn) {\n\t\t\t\teditConfigBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.editConfigName();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Delete Current Config\n\t\t\tconst deleteConfigBtn = document.getElementById('delete-current-config');\n\t\t\tif (deleteConfigBtn) {\n\t\t\t\tdeleteConfigBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.deleteCurrentConfig();\n\t\t\t\t});\n\t\t\t\t// Sichtbarkeit abhängig von Anzahl Konfigurationen\n\t\t\t\tdeleteConfigBtn.style.display = this.configs.length >= 2 ? '' : 'none';\n\t\t\t}\n\t\t\t\n\t\t\t// Ersetzt: Express Checkout → Gesamte Auswahl in den Warenkorb\n\t\t\tconst expressCheckoutBtn = document.getElementById('express-checkout-btn');\n\t\t\tif (expressCheckoutBtn) {\n\t\t\t\t// Funktion umstellen, Icon/Markup unverändert lassen\n\t\t\t\ttry{ expressCheckoutBtn.setAttribute('aria-label','Gesamte Auswahl in den Warenkorb'); }catch(_){ }\n\t\t\t\ttry{ expressCheckoutBtn.setAttribute('title','Gesamte Auswahl in den Warenkorb'); }catch(_){ }\n\t\t\t\texpressCheckoutBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.addAllConfigsToCart();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Nächste Konfiguration (alter \"Konfiguration speichern\" Button)\n\t\t\tconst nextConfigBtn = document.getElementById('next-config-btn');\n\t\t\tif (nextConfigBtn) {\n\t\t\t\tnextConfigBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.saveNewConfig();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Delegiertes Click-Handling: Unterstützt mehrere Add-All Buttons (Overview & Detail)\n\t\t\tdocument.addEventListener('click', (ev) => {\n\t\t\t\ttry{\n\t\t\t\t\tvar target = ev.target;\n\t\t\t\t\tif (!target || !target.closest) return;\n\t\t\t\t\tvar btn = target.closest('#add-all-to-cart-btn, .add-all-to-cart-btn, [data-action=\"add-all-to-cart\"], [data-add-all-to-cart=\"true\"]');\n\t\t\t\t\tif (!btn) return;\n\t\t\t\t\ttry{ ev.preventDefault(); }catch(_){ }\n\t\t\t\t\tthis.addAllConfigsToCart();\n\t\t\t\t}catch(_){ }\n\t\t\t}, true);\n\t\t\t\n\t\t\t// Alle Konfigurationen zurücksetzen\n\t\t\tconst continueLaterBtn = document.getElementById('continue-later-btn');\n\t\t\tif (continueLaterBtn) {\n\t\t\t\tcontinueLaterBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.resetAllConfigurations();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Add Config Button\n\t\t\tconst addConfigBtn = document.getElementById('add-config-btn');\n\t\t\tif (addConfigBtn) {\n\t\t\t\taddConfigBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.saveNewConfig();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tshowOverview() {\n\t\t\t// Aktuelle Konfiguration speichern um Progress nicht zu verlieren\n\t\t\tif (this.currentConfig !== null) {\n\t\t\t\tthis.updateConfig();\n\t\t\t}\n\t\t\t\n\t\t\tconst detailView = document.getElementById('config-detail-view');\n\t\t\tconst overviewView = document.getElementById('config-overview');\n\t\t\t\n\t\t\tif (detailView && overviewView) {\n\t\t\t\tdetailView.classList.remove('active');\n\t\t\t\toverviewView.classList.add('active');\n\t\t\t\t\n\t\t\t\t// Alle Input-Felder entfernen\n\t\t\t\tthis.clearAllInputFields();\n\t\t\t\t\n\t\t\t\t// Config-Liste aktualisieren\n\t\t\t\tthis.updateConfigList();\n\t\t\t}\n\t\t}\n\t\t\n\t\tclearAllInputFields() {\n\t\t\t// Entferne alle Input-Felder aus der Detail-Ansicht\n\t\t\tconst titleEl = document.getElementById('current-config-title');\n\t\t\tif (titleEl) {\n\t\t\t\tconst existingInputs = titleEl.parentNode.querySelectorAll('.config-title-input');\n\t\t\t\texistingInputs.forEach(input => input.remove());\n\t\t\t\ttitleEl.style.display = 'block';\n\t\t\t}\n\t\t\t\n\t\t\t// Entferne alle Input-Felder aus der Config-Liste\n\t\t\tconst configItems = document.querySelectorAll('.config-item');\n\t\t\tconfigItems.forEach(item => {\n\t\t\t\tconst nameEl = item.querySelector('.config-item-name');\n\t\t\t\tif (nameEl) {\n\t\t\t\t\tconst existingInputs = nameEl.parentNode.querySelectorAll('input[type=\"text\"]');\n\t\t\t\t\texistingInputs.forEach(input => input.remove());\n\t\t\t\t\tnameEl.style.display = 'block';\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\t// Initialisiere Config-Liste beim Start\n\t\tinitConfigList() {\n\t\t\tif (document.getElementById('config-overview')?.classList.contains('active')) {\n\t\t\t\tthis.updateConfigList();\n\t\t\t}\n\t\t\t\n\t\t\t// Event-Listener für Zusatzprodukte-Checkboxen\n\t\t\tthis.initAdditionalProductsListeners();\n\t\t}\n\t\t\n\t\tshowDetailView(configIndex = null) {\n\t\t\tconst detailView = document.getElementById('config-detail-view');\n\t\t\tconst overviewView = document.getElementById('config-overview');\n\t\t\t\n\t\t\tif (detailView && overviewView) {\n\t\t\t\toverviewView.classList.remove('active');\n\t\t\t\tdetailView.classList.add('active');\n\t\t\t\t\n\t\t\t\tif (configIndex !== null) {\n\t\t\t\t\tthis.loadConfig(configIndex);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Detail-Ansicht aktualisieren\n\t\t\t\tthis.updateDetailView();\n\t\t\t\t// Sichtbarkeit des Delete-Buttons nach dem Rendern aktualisieren\n\t\t\t\tconst deleteConfigBtn = document.getElementById('delete-current-config');\n\t\t\t\tif (deleteConfigBtn) {\n\t\t\t\t\tdeleteConfigBtn.style.display = this.configs.length >= 2 ? '' : 'none';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t\t\tupdateDetailView() {\n\t\t\tconst currentConfig = this.configs[this.currentConfig];\n\t\t\tif (!currentConfig) return;\n\t\t\t\n\t\t\t// Titel aktualisieren\n\t\t\tconst titleEl = document.getElementById('current-config-title');\n\t\t\tif (titleEl) {\n\t\t\t\ttitleEl.textContent = currentConfig.name || `Konfiguration #${this.currentConfig + 1}`;\n\t\t\t}\n\t\t\t\n\t\t\t// Gesamtpreis aktualisieren\n\t\t\tthis.updateCurrentTotalPrice();\n\t\t\t\t// Sichtbarkeit des Delete-Buttons sicherstellen\n\t\t\t\tconst deleteConfigBtn = document.getElementById('delete-current-config');\n\t\t\t\tif (deleteConfigBtn) {\n\t\t\t\t\tdeleteConfigBtn.style.display = this.configs.length >= 2 ? '' : 'none';\n\t\t\t\t}\n\t\t}\n\t\t\n\t\tupdateCurrentTotalPrice() {\n\t\t\tconst totalPriceEl = document.getElementById('current-total-price');\n\t\t\tif (totalPriceEl) {\n\t\t\t\t// Verwende bevorzugt die gespeicherten Daten der aktiven Konfiguration,\n\t\t\t\t// damit UI-Abweichungen (Inputs/DOM) den Preis nicht verfälschen\n\t\t\t\tconst cfg = (this.currentConfig !== null && this.configs[this.currentConfig]) ? this.configs[this.currentConfig] : null;\n\t\t\t\t// Memory: Optimierte Config-Erstellung ohne unnötige Deep Copies\n\t\t\t\tconst currentConfig = cfg ? {\n\t\t\t\t\tselection: Array.isArray(cfg.selection) ? cfg.selection : [], // Direkte Referenz - Worker arbeitet isoliert\n\t\t\t\t\tcols: Number(cfg.cols || this.cols),\n\t\t\t\t\trows: Number(cfg.rows || this.rows),\n\t\t\t\t\tcellWidth: Number(cfg.cellWidth || parseInt(this.wIn?.value || '179')),\n\t\t\t\t\tcellHeight: Number(cfg.cellHeight || parseInt(this.hIn?.value || '113')),\n\t\t\t\t\torientation: (cfg.orientation || (this.orV?.checked ? 'vertical' : 'horizontal')),\n\t\t\t\t\tincM: (cfg.incM === false) ? false : true,\n\t\t\t\t\tulicaModule: !!cfg.ulicaModule\n\t\t\t\t} : {\n\t\t\t\t\tselection: this.selection, // Direkte Referenz - Worker arbeitet isoliert\n\t\t\t\t\tcols: this.cols,\n\t\t\t\t\trows: this.rows,\n\t\t\t\t\tcellWidth: parseInt(this.wIn?.value || '179'),\n\t\t\t\t\tcellHeight: parseInt(this.hIn?.value || '113'),\n\t\t\t\t\torientation: this.orV?.checked ? 'vertical' : 'horizontal',\n\t\t\t\t\tincM: (this.incM && this.incM.checked) !== false,\n\t\t\t\t\tulicaModule: document.getElementById('ulica-module')?.checked || false\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t// Berechne nur den Preis der aktuellen Konfiguration\n\t\t\t\tlet totalPrice = 0;\n\t\t\t\ttry {\n\t\t\t\t\t// Verwende die ursprüngliche calculateConfigPrice Logik für die aktuelle Konfiguration\n\t\t\t\t\ttotalPrice = this.calculateConfigPrice(currentConfig);\n\t\t\t\t} catch (_) {}\n\t\t\t\ttotalPriceEl.textContent = `${totalPrice.toFixed(2).replace('.', ',')} €`;\n\t\t\t\t// Subtitle: nur für Firmenkunden anzeigen, Text \"exkl. MwSt\"\n\t\t\t\tconst section = totalPriceEl.closest('.total-section');\n\t\t\t\tconst subtitle = section ? section.querySelector('.total-subtitle') : null;\n\t\t\t\tif (subtitle) {\n\t\t\t\t\tsubtitle.style.display = 'none'; // Kundentyp entfernt\n\t\t\t\t\tsubtitle.textContent = 'exkl. MwSt';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Disclaimer-Text: immer sichtbar unter dem Subtitle\n\t\t\t\tlet disclaimer = section ? section.querySelector('.total-disclaimer') : null;\n\t\t\t\tif (!disclaimer && section) {\n\t\t\t\t\tdisclaimer = document.createElement('div');\n\t\t\t\t\tdisclaimer.className = 'total-disclaimer';\n\t\t\t\t\tdisclaimer.style.fontSize = '12px';\n\t\t\t\t\tdisclaimer.style.color = '#666';\n\t\t\t\t\tdisclaimer.style.marginTop = '4px';\n\t\t\t\t\tdisclaimer.style.lineHeight = '1.3';\n\t\t\t\t\tdisclaimer.style.textAlign = 'right';\n\t\t\t\t\tsection.appendChild(disclaimer);\n\t\t\t\t}\n\t\t\t\tif (disclaimer) {\n\t\t\t\t\tdisclaimer.textContent = 'Der sichtbare Preis ist eine Vorberechnung, minimale Mengenanpassungen und Optimierungen werden im Warenkorb potentiell einen anderen Preis ergeben.';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n    updateConfigList() {\n      // Delegiere auf zentrale Render-Methode, um Doppelungen zu vermeiden\n      this.renderConfigList();\n      this.updateOverviewTotalPrice();\n      this.renderAdditionalProducts();\n      // Gesamtpreis sofort aktualisieren nach Config-List-Update\n      this.updateCurrentTotalPrice();\n    }\n\t\t\n\t\tinitAutoSaveIndicator() {\n\t\t\t// Auto-Save Indicator Setup\n\t\t\tthis.autoSaveTimeout = null;\n\t\t}\n\n\t\tshowAutoSaveIndicator() {\n\t\t\tconst indicator = document.getElementById('auto-save-indicator');\n\t\t\tif (!indicator) return;\n\t\t\t\n\t\t\t// Zeige Indicator\n\t\t\tindicator.classList.remove('hidden');\n\t\t\t\n\t\t\t// Animation neu starten\n\t\t\tconst saveIcon = indicator.querySelector('.save-icon');\n\t\t\tif (saveIcon) {\n\t\t\t\t// Animation zurücksetzen und neu starten\n\t\t\t\tsaveIcon.style.animation = 'none';\n\t\t\t\tsaveIcon.offsetHeight; // Trigger reflow\n\t\t\t\tsaveIcon.style.animation = 'rotate360 0.8s ease-in-out';\n\t\t\t}\n\t\t\t\n\t\t\t// Verstecke nach 1 Sekunde\n\t\t\tif (this.autoSaveTimeout) {\n\t\t\t\tclearTimeout(this.autoSaveTimeout);\n\t\t\t}\n\t\t\t\n\t\t\tthis.autoSaveTimeout = setTimeout(() => {\n\t\t\t\tindicator.classList.add('hidden');\n\t\t\t}, 1000);\n\t\t}\n\t\t\n\t\tupdateOverviewTotalPrice() {\n\t\t\tconst totalPriceEl = document.getElementById('overview-total-price');\n\t\t\tif (!totalPriceEl) return;\n\t\t\t\n\t\t\t// Gesamtpreis: Immer frische Totals berechnen (nicht aus Cache)\n\t\t\tlet totalPrice = 0;\n\t\t\ttry {\n\t\t\t\tconst totals = this.computeAllTotalsSnapshot();\n\t\t\t\tObject.entries(totals || {}).forEach(([key, quantity]) => {\n\t\t\t\t\tconst pricePerUnit = PRICE_MAP[key] || 0;\n\t\t\t\t\ttotalPrice += (Number(quantity) || 0) * pricePerUnit;\n\t\t\t\t});\n\t\t\t} catch (_) {}\n\t\t\t\n\t\t\t// HINWEIS: Zusatzprodukte sind bereits in computeAllTotalsSnapshot() enthalten\n\t\t\t// calculateAdditionalProductsPrice() wird NICHT mehr addiert (verhindert Doppelberechnung)\n\t\t\t\n\t\t\ttotalPriceEl.textContent = `${totalPrice.toFixed(2).replace('.', ',')} €`;\n\t\t\t// Subtitle: nur für Firmenkunden anzeigen, Text \"exkl. MwSt\"\n\t\t\tconst section = totalPriceEl.closest('.total-section');\n\t\t\tconst subtitle = section ? section.querySelector('.total-subtitle') : null;\n\t\t\tif (subtitle) {\n\t\t\t\tsubtitle.style.display = 'none'; // Kundentyp entfernt\n\t\t\t\tsubtitle.textContent = 'exkl. MwSt';\n\t\t\t}\n\t\t\t\n\t\t\t// Disclaimer-Text: immer sichtbar unter dem Subtitle\n\t\t\tlet disclaimer = section ? section.querySelector('.total-disclaimer') : null;\n\t\t\tif (!disclaimer && section) {\n\t\t\t\tdisclaimer = document.createElement('div');\n\t\t\t\tdisclaimer.className = 'total-disclaimer';\n\t\t\t\tdisclaimer.style.fontSize = '12px';\n\t\t\t\tdisclaimer.style.color = '#666';\n\t\t\t\tdisclaimer.style.marginTop = '4px';\n\t\t\t\tdisclaimer.style.lineHeight = '1.3';\n\t\t\t\tdisclaimer.style.textAlign = 'right';\n\t\t\t\tsection.appendChild(disclaimer);\n\t\t\t}\n\t\t\tif (disclaimer) {\n\t\t\t\tdisclaimer.textContent = 'Der sichtbare Preis ist eine Vorberechnung, minimale Mengenanpassungen und Optimierungen werden im Warenkorb potentiell einen anderen Preis ergeben.';\n\t\t\t}\n\t\t}\n\t\t\n\t\tcalculateAdditionalProductsPrice() {\n\t\t\tlet totalPrice = 0;\n\t\t\t\n\t\t\t// MC4 Stecker\n\t\t\tif (document.getElementById('mc4')?.checked) {\n\t\t\t\tconst moduleCount = this.configs.reduce((total, config) => {\n\t\t\t\t\treturn total + config.selection.flat().filter(v => v).length;\n\t\t\t\t}, 0);\n\t\t\t\tconst packagesNeeded = Math.ceil(moduleCount / 30); // 1 Packung pro 30 Module\n\t\t\t\tconst pricePerPackage = getPackPriceForQuantity('MC4_Stecker', moduleCount);\n\t\t\t\ttotalPrice += packagesNeeded * pricePerPackage;\n\t\t\t}\n\t\t\t\n\t\t\t// Solarkabel\n\t\t\tif (document.getElementById('solarkabel')?.checked) {\n\t\t\t\tconst packagesNeeded = 1; // 1x Solarkabel 100M\n\t\t\t\tconst pricePerPackage = getPackPriceForQuantity('Solarkabel', 1);\n\t\t\t\ttotalPrice += packagesNeeded * pricePerPackage;\n\t\t\t}\n\t\t\t\n\t\t\t// Holzunterleger\n\t\t\tif (document.getElementById('holz')?.checked) {\n\t\t\t\tconst packagesNeeded = 1; // 1x Unterlegholz für Dachhaken - 50 Stück\n\t\t\t\tconst pricePerPackage = getPackPriceForQuantity('Holzunterleger', VE['Holzunterleger']);\n\t\t\t\ttotalPrice += packagesNeeded * pricePerPackage;\n\t\t\t}\n\t\t\t\n\t\t\t// Ringkabelschuhe\n\t\t\tif (document.getElementById('quetschkabelschuhe')?.checked) {\n\t\t\t\tconst packagesNeeded = 1; // 1x Ringkabelschuhe - 100 Stück\n\t\t\t\tconst pricePerPackage = getPackPriceForQuantity('Ringkabelschuhe', 1);\n\t\t\t\ttotalPrice += packagesNeeded * pricePerPackage;\n\t\t\t}\n\t\t\t\n\t\t\t// Kabelbinder und Blech-Bohrschrauben werden NICHT hier berechnet\n\t\t\t// Sie werden in computeAllTotalsSnapshot() berechnet und in den gecachten Totals gespeichert\n\t\t\t\n\t\t\t// Optimierer (Huawei/BRC)\n\t\t\tconst hCb = document.getElementById('huawei-opti');\n\t\t\tconst bCb = document.getElementById('brc-opti');\n\t\t\tconst qEl = document.getElementById('opti-qty');\n\t\t\tif (hCb && bCb && qEl && (hCb.checked || bCb.checked)) {\n\t\t\t\tconst key = bCb.checked ? 'BRCOpti' : 'HuaweiOpti';\n\t\t\t\tconst qty = Math.max(1, parseInt(qEl.value || '1', 10));\n\t\t\t\tconst pricePer = getPackPriceForQuantity(key, 1);\n\t\t\t\ttotalPrice += qty * pricePer;\n\t\t\t}\n\t\t\t\n\t\t\treturn totalPrice;\n\t\t}\n\t\t\n\t\trenderAdditionalProducts() {\n\t\t\tconst additionalProductsListEl = document.getElementById('additional-products-list');\n\t\t\tif (!additionalProductsListEl) return;\n\t\t\t\n\t\t\tadditionalProductsListEl.innerHTML = '';\n\t\t\t\n\t\t\t// MC4 Stecker\n\t\t\tif (document.getElementById('mc4')?.checked) {\n\t\t\t\tconst moduleCount = this.configs.reduce((total, config) => {\n\t\t\t\t\treturn total + config.selection.flat().filter(v => v).length;\n\t\t\t\t}, 0);\n\t\t\t\tconst packagesNeeded = Math.ceil(moduleCount / 30); // 1 Packung pro 30 Module\n\t\t\t\tconst pricePerPackage = getPackPriceForQuantity('MC4_Stecker', moduleCount);\n\t\t\t\tconst totalPrice = packagesNeeded * pricePerPackage;\n\t\t\t\t\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item produkt-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">${packagesNeeded}×</span>\n\t\t\t\t\t\t<div class=\"item-info\">\n\t\t\t\t\t\t\t<span class=\"item-name\">MC4 Stecker</span>\n\t\t\t\t\t\t\t<span class=\"item-ve\">${VE['MC4_Stecker']} Stück</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</span>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t\t\n\t\t\t// Solarkabel\n\t\t\tif (document.getElementById('solarkabel')?.checked) {\n\t\t\t\tconst packagesNeeded = 1;\n\t\t\t\tconst pricePerPackage = getPackPriceForQuantity('Solarkabel', 1);\n\t\t\t\tconst totalPrice = packagesNeeded * pricePerPackage;\n\t\t\t\t\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item produkt-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">1×</span>\n\t\t\t\t\t\t<div class=\"item-info\">\n\t\t\t\t\t\t\t<span class=\"item-name\">Solarkabel</span>\n\t\t\t\t\t\t\t<span class=\"item-ve\">100 m</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</span>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t\t\n\t\t\t// Holzunterleger\n\t\t\tif (document.getElementById('holz')?.checked) {\n\t\t\t\tconst packagesNeeded = 1;\n\t\t\t\tconst pricePerPackage = getPackPriceForQuantity('Holzunterleger', VE['Holzunterleger']);\n\t\t\t\tconst totalPrice = packagesNeeded * pricePerPackage;\n\t\t\t\t\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item produkt-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">1×</span>\n\t\t\t\t\t\t<div class=\"item-info\">\n\t\t\t\t\t\t\t<span class=\"item-name\">Unterlegholz für Dachhaken</span>\n\t\t\t\t\t\t\t<span class=\"item-ve\">${VE['Holzunterleger']} Stück</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</span>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t\t\n\t\t\t// Ringkabelschuhe\n\t\t\tif (document.getElementById('quetschkabelschuhe')?.checked) {\n\t\t\t\tconst packagesNeeded = 1;\n\t\t\t\tconst pricePerPackage = getPackPriceForQuantity('Ringkabelschuhe', 1);\n\t\t\t\tconst totalPrice = packagesNeeded * pricePerPackage;\n\t\t\t\t\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item produkt-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">1×</span>\n\t\t\t\t\t\t<div class=\"item-info\">\n\t\t\t\t\t\t\t<span class=\"item-name\">Ringkabelschuhe</span>\n\t\t\t\t\t\t\t<span class=\"item-ve\">${VE['Ringkabelschuhe']} Stück</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</span>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t\t\n\t\t\t// Kabelbinder\n\t\t\tif (document.getElementById('kabelbinder')?.checked) {\n\t\t\t\tconst packagesNeeded = 1;\n\t\t\t\tconst pricePerPackage = getPackPriceForQuantity('Kabelbinder', 1);\n\t\t\t\tconst totalPrice = packagesNeeded * pricePerPackage;\n\t\t\t\t\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item produkt-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">1×</span>\n\t\t\t\t\t\t<div class=\"item-info\">\n\t\t\t\t\t\t\t<span class=\"item-name\">Kabelbinder</span>\n\t\t\t\t\t\t\t<span class=\"item-ve\">${VE['Kabelbinder']} Stück</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</span>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t\t\n\t\t\t// Blech-Bohrschrauben (automatisch bei Erdungsband)\n\t\t\tif (document.getElementById('erdungsband')?.checked) {\n\t\t\t\tconst packagesNeeded = 1;\n\t\t\t\tconst pricePerPackage = getPackPriceForQuantity('BlechBohrschrauben', 1);\n\t\t\t\tconst totalPrice = packagesNeeded * pricePerPackage;\n\t\t\t\t\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item produkt-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">1×</span>\n\t\t\t\t\t\t<div class=\"item-info\">\n\t\t\t\t\t\t\t<span class=\"item-name\">Blech-Bohrschrauben</span>\n\t\t\t\t\t\t\t<span class=\"item-ve\">${VE['BlechBohrschrauben']} Stück</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</span>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t\t\n\t\t\t// Optimierer (Huawei/BRC) – exklusiv, Menge aus Input\n\t\t\tconst hCb = document.getElementById('huawei-opti');\n\t\t\tconst bCb = document.getElementById('brc-opti');\n\t\t\tconst qEl = document.getElementById('opti-qty');\n\t\t\tif (hCb && bCb && qEl && (hCb.checked || bCb.checked)) {\n\t\t\t\tconst key = bCb.checked ? 'BRCOpti' : 'HuaweiOpti';\n\t\t\t\tconst qty = Math.max(1, parseInt(qEl.value || '1', 10));\n\t\t\t\tconst pricePer = getPackPriceForQuantity(key, 1);\n\t\t\t\tconst total = qty * pricePer;\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item produkt-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">${qty}×</span>\n\t\t\t\t\t\t<div class=\"item-info\">\n\t\t\t\t\t\t\t<span class=\"item-name\">${PRODUCT_NAME_MAP[key] || key}</span>\n\t\t\t\t\t\t\t<span class=\"item-ve\">1 Stück</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"item-price\">${total.toFixed(2).replace('.', ',')} €</span>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t}\n\t\t\n\t\tinitAdditionalProductsListeners() {\n\t\t\t// Event-Listener für Zusatzprodukte-Checkboxen\n\t\t\tconst additionalProductCheckboxes = ['mc4', 'solarkabel', 'holz', 'quetschkabelschuhe', 'kabelbinder', 'erdungsband', 'huawei-opti', 'brc-opti', 'opti-qty'];\n\t\t\t\n\t\t\tadditionalProductCheckboxes.forEach(checkboxId => {\n\t\t\t\tconst checkbox = document.getElementById(checkboxId);\n\t\t\t\tif (checkbox) {\n\t\t\t\t\tcheckbox.addEventListener('change', () => {\n\t\t\t\t\t\t// Update Gesamtpreis und Zusatzprodukte-Liste\n\t\t\t\t\t\tthis.updateOverviewTotalPrice();\n\t\t\t\t\t\tthis.renderAdditionalProducts();\n\t\t\t\t\t\t// Neu: Änderungen unmittelbar persistieren\n\t\t\t\t\t\tthis.saveToCache?.();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\t// Exklusivität der Optis + Mengeingabe Handling (robust, sofortiges UI-Update)\n\t\t\tconst hCb = document.getElementById('huawei-opti');\n\t\t\tconst bCb = document.getElementById('brc-opti');\n\t\t\tconst qEl = document.getElementById('opti-qty');\n\t\t\tconst syncDisplayAndUpdate = () => {\n\t\t\t\tif (!hCb || !bCb || !qEl) return;\n\t\t\t\tqEl.style.display = (hCb.checked || bCb.checked) ? '' : 'none';\n\t\t\t\tthis.renderAdditionalProducts();\n\t\t\t\tthis.updateOverviewTotalPrice();\n\t\t\t\t// Neu: State sichern\n\t\t\t\tthis.saveToCache?.();\n\t\t\t};\n\t\t\tif (hCb) {\n\t\t\t\thCb.addEventListener('click', () => {\n\t\t\t\t\tif (hCb.checked && bCb) bCb.checked = false;\n\t\t\t\t\tsyncDisplayAndUpdate();\n\t\t\t\t});\n\t\t\t\thCb.addEventListener('change', syncDisplayAndUpdate);\n\t\t\t}\n\t\t\tif (bCb) {\n\t\t\t\tbCb.addEventListener('click', () => {\n\t\t\t\t\tif (bCb.checked && hCb) hCb.checked = false;\n\t\t\t\t\tsyncDisplayAndUpdate();\n\t\t\t\t});\n\t\t\t\tbCb.addEventListener('change', syncDisplayAndUpdate);\n\t\t\t}\n\t\t\tif (qEl) {\n\t\t\t\tqEl.addEventListener('input', () => {\n\t\t\t\t\tsyncDisplayAndUpdate();\n\t\t\t\t});\n\t\t\t}\n\t\t\tsyncDisplayAndUpdate();\n\t\t}\n\t\teditConfigName() {\n\t\t\tconst titleEl = document.getElementById('current-config-title');\n\t\t\tif (!titleEl) return;\n\t\t\t\n\t\t\t// Entferne alle existierenden Input-Felder\n\t\t\tconst existingInputs = titleEl.parentNode.querySelectorAll('.config-title-input');\n\t\t\texistingInputs.forEach(input => input.remove());\n\t\t\t\n\t\t\t// Stelle sicher, dass der Titel sichtbar ist\n\t\t\ttitleEl.style.display = 'block';\n\t\t\t\n\t\t\t// Erstelle Input-Feld\n\t\t\tconst input = document.createElement('input');\n\t\t\tinput.type = 'text';\n\t\t\tinput.value = titleEl.textContent;\n\t\t\tinput.className = 'config-title-input';\n\t\t\tinput.style.cssText = `\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\tfont-size: 24px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tcolor: #000000;\n\t\t\t\tbackground: white;\n\t\t\t\tborder: 2px solid #FFB101;\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tpadding: 4px 8px;\n\t\t\t\twidth: 200px;\n\t\t\t\toutline: none;\n\t\t\t\tz-index: 1000;\n\t\t\t`;\n\t\t\t\n\t\t\t// Füge Input hinzu ohne Titel zu ersetzen\n\t\t\ttitleEl.parentNode.appendChild(input);\n\t\t\tinput.focus();\n\t\t\tinput.select();\n\t\t\t\n\t\t\t// Event-Listener für Enter und Blur\n\t\t\tconst saveEdit = function() {\n\t\t\t\tconst newName = input.value.trim();\n\t\t\t\tif (newName && this.currentConfig !== null) {\n\t\t\t\t\tthis.configs[this.currentConfig].name = newName;\n\t\t\t\t\ttitleEl.textContent = newName;\n\t\t\t\t\tthis.updateConfigList();\n\t\t\t\t\tthis.updateConfig();\n\t\t\t\t\tthis.saveToCache();\n\t\t\t\t\tthis.showAutoSaveIndicator();\n\t\t\t\t}\n\t\t\t\tinput.remove();\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\tconst cancelEdit = function() {\n\t\t\t\tinput.remove();\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\tinput.addEventListener('blur', saveEdit);\n\t\t\tinput.addEventListener('keydown', function(e) {\n\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tsaveEdit();\n\t\t\t\t} else if (e.key === 'Escape') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tcancelEdit();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\teditConfigNameInList(configIndex) {\n\t\t\tconst config = this.configs[configIndex];\n\t\t\tif (!config) return;\n\t\t\t\n\t\t\t// Finde das config-item Element\n\t\t\tconst configItems = document.querySelectorAll('.config-item');\n\t\t\tconst configItem = configItems[configIndex];\n\t\t\tif (!configItem) return;\n\t\t\t\n\t\t\t// Finde das name Element\n\t\t\tconst nameEl = configItem.querySelector('.config-item-name');\n\t\t\tif (!nameEl) return;\n\t\t\t\n\t\t\t// Entferne alle existierenden Input-Felder in diesem Item\n\t\t\tconst existingInputs = nameEl.parentNode.querySelectorAll('input[type=\"text\"]');\n\t\t\texistingInputs.forEach(input => input.remove());\n\t\t\t\n\t\t\t// Stelle sicher, dass der Name sichtbar ist\n\t\t\tnameEl.style.display = 'block';\n\t\t\t\n\t\t\t// Erstelle Input-Feld\n\t\t\tconst input = document.createElement('input');\n\t\t\tinput.type = 'text';\n\t\t\tinput.value = nameEl.textContent;\n\t\t\tinput.className = 'inline-edit-input';\n\t\t\t\n\t\t\t// Input absolut über dem Namen platzieren, ohne Layout zu verschieben\n\t\t\tnameEl.appendChild(input);\n\t\t\t// Interaktionen im Input sollen die Item-Navigation nicht auslösen\n\t\t\t['click','mousedown','pointerdown'].forEach(evt => {\n\t\t\t\tinput.addEventListener(evt, (e) => e.stopPropagation());\n\t\t\t});\n\t\t\tinput.focus();\n\t\t\tinput.select();\n\t\t\t\n\t\t\t// Event-Listener für Enter und Blur\n\t\t\tconst saveEdit = function() {\n\t\t\t\tconst newName = input.value.trim();\n\t\t\t\tif (newName) {\n\t\t\t\t\tconfig.name = newName;\n\t\t\t\t\tnameEl.textContent = newName;\n\t\t\t\t\tthis.updateConfig();\n\t\t\t\t\tthis.saveToCache();\n\t\t\t\t\tthis.showAutoSaveIndicator();\n\t\t\t\t}\n\t\t\t\tif (input.parentNode) input.remove();\n\t\t\t\tthis.updateConfigList();\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\tconst cancelEdit = function() {\n\t\t\t\tif (input.parentNode) input.remove();\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\tinput.addEventListener('blur', saveEdit);\n\t\t\tinput.addEventListener('keydown', function(e) {\n\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tsaveEdit();\n\t\t\t\t} else if (e.key === 'Escape') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tcancelEdit();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\tdeleteCurrentConfig() {\n\t\t\tif (this.configs.length <= 1) {\n\t\t\t\talert('Die letzte Konfiguration kann nicht gelöscht werden.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tconst currentConfig = this.configs[this.currentConfig];\n\t\t\tconst configName = currentConfig?.name || `Konfiguration #${this.currentConfig + 1}`;\n\t\t\t\n\t\t\tif (confirm(`Möchten Sie \"${configName}\" wirklich löschen?`)) {\n\t\t\t\tthis.configs.splice(this.currentConfig, 1);\n\t\t\t\t\n\t\t\t\t// Aktive Konfiguration anpassen\n\t\t\t\tif (this.currentConfig >= this.configs.length) {\n\t\t\t\t\tthis.currentConfig = this.configs.length - 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.loadConfig(this.currentConfig);\n\t\t\t\tthis.saveToUrl();\n\t\t\t\t\n\t\t\t\t// Zurück zur Übersicht und Config-Liste updaten\n\t\t\t\tthis.showOverview();\n\t\t\t}\n\t\t}\n\t\t\n\t\tdeleteConfigFromList(configIndex) {\n\t\t\tif (this.configs.length <= 1) {\n\t\t\t\talert('Die letzte Konfiguration kann nicht gelöscht werden.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tconst config = this.configs[configIndex];\n\t\t\tconst configName = config?.name || `Konfiguration #${configIndex + 1}`;\n\t\t\t\n\t\t\tif (confirm(`Möchten Sie \"${configName}\" wirklich löschen?`)) {\n\t\t\t\tthis.configs.splice(configIndex, 1);\n\t\t\t\t\n\t\t\t\t// Aktive Konfiguration anpassen\n\t\t\t\tif (this.currentConfig >= this.configs.length) {\n\t\t\t\t\tthis.currentConfig = this.configs.length - 1;\n\t\t\t\t} else if (this.currentConfig > configIndex) {\n\t\t\t\t\tthis.currentConfig--;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.loadConfig(this.currentConfig);\n\t\t\t\tthis.saveToUrl();\n\t\t\t\tthis.updateConfigList();\n\t\t\t}\n\t\t\t\n\t\t\t// Event propagation stoppen\n\t\t\tevent.stopPropagation();\n\t\t}\n\t\t\n\t\tcalculateConfigPrice(config) {\n\t\t\t// Verwende die ursprüngliche Berechnungslogik\n\t\t\tconst parts = {\n\t\t\t\tSolarmodul: 0, Endklemmen: 0, Mittelklemmen: 0,\n\t\t\t\tDachhaken: 0, Schrauben: 0, Endkappen: 0,\n\t\t\t\tSchienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0,\n\t\t\t\tUlicaSolarBlackJadeFlow: 0,\n\t\t\t\t// Palettenzählung wird als Stückbasis 36× gespeichert\n\t\t\t\tSolarmodulPalette: 0,\n\t\t\t\tUlicaSolarBlackJadeFlowPalette: 0\n\t\t\t};\n\n\t\t\t// Berechne Teile für jede Zeile\n\t\t\tfor (let y = 0; y < config.rows; y++) {\n\t\t\t\tif (!Array.isArray(config.selection[y])) continue;\n\t\t\t\tlet run = 0;\n\n\t\t\t\tfor (let x = 0; x < config.cols; x++) {\n\t\t\t\t\tif (config.selection[y]?.[x]) {\n\t\t\t\t\t\trun++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (run) { \n\t\t\t\t\t\tthis.processGroupDirectly(run, parts, config.cellWidth || 179, config.cellHeight || 113, config.orientation || 'vertical', config.ulicaModule || false); \n\t\t\t\t\t\trun = 0; \n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (run) {\n\t\t\t\t\tthis.processGroupDirectly(run, parts, config.cellWidth || 179, config.cellHeight || 113, config.orientation || 'vertical', config.ulicaModule || false);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Module nur hinzufügen wenn Konfig-Flags es erlauben (DOM-unabhängig)\n\t\t\t// Default: Module sind enthalten, außer incM ist explizit false\n\t\t\tconst includeModules = (config && config.incM === false) ? false : true;\n\t\t\t// Ulica-Module nur wenn explizit true\n\t\t\tconst ulicaModule = (config && config.ulicaModule === true);\n\t\t\t\n\t\t\tif (includeModules === false) {\n\t\t\t\tdelete parts.Solarmodul;\n\t\t\t}\n\t\t\t\n\t\t\tif (ulicaModule !== true) {\n\t\t\t\tdelete parts.UlicaSolarBlackJadeFlow;\n\t\t\t}\n\t\t\t\n\t\t\t// Palettenlogik: 36er bündeln je nach Modultyp\n\t\t\ttry {\n\t\t\t\tconst pieceKey = ulicaModule ? 'UlicaSolarBlackJadeFlow' : 'Solarmodul';\n\t\t\t\tconst palletKey = ulicaModule ? 'UlicaSolarBlackJadeFlowPalette' : 'SolarmodulPalette';\n\t\t\t\tconst count = Number(parts[pieceKey] || 0);\n\t\t\t\tif (count > 0) {\n\t\t\t\t\tconst pallets = Math.floor(count / 36);\n\t\t\t\t\tconst remainder = count % 36;\n\t\t\t\t\tif (pallets > 0) {\n\t\t\t\t\t\tparts[palletKey] = (parts[palletKey] || 0) + pallets * 36; // Stückbasis\n\t\t\t\t\t}\n\t\t\t\t\tparts[pieceKey] = remainder;\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\t\t\t\n\t\t\tlet totalPrice = 0;\n\t\t\tObject.entries(parts).forEach(([partName, quantity]) => {\n\t\t\t\tif (quantity > 0) {\n\t\t\t\t\tconst packagesNeeded = Math.ceil(quantity / (VE[partName] || 1));\n\t\t\t\t\tconst pricePerPackage = getPackPriceForQuantity(partName, quantity);\n\t\t\t\t\ttotalPrice += packagesNeeded * pricePerPackage;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\treturn totalPrice;\n\t\t}\n\t\t\n\n\t\t\n\t\taddAllConfigsToCart() {\n\t\t\t// Verwende die gleiche Logik wie addAllToCart()\n\t\t\tthis.addAllToCart();\n\t\t}\n\t\t\n\t\tinitSmartConfigFeatures() {\n\t\t\tconsole.log('Initializing Smart Config Features...');\n\t\t\tthis.smartParser = new SmartConfigParser(this);\n\t\t\tthis.bulkSelector = new BulkSelector(this);\n\t\t\tthis.bulkSelector.initializeBulkSelection();\n\t\t\t\n\t\t\t// Stelle sicher, dass Smart Config und Tipps permanent sichtbar sind\n\t\t\tthis.ensurePermanentVisibility();\n\t\t\t\n\t\t\t// Initialisiere Smart Config Close Button\n\t\t\tthis.initSmartConfigCloseButton();\n\t\t\t\n\t\t\t// Initialisiere Quick Config Interface mit verbesserter Fehlerbehandlung\n\t\t\tthis.initQuickConfigInterface();\n\t\t\t\n\t\t\tconsole.log('Smart Config Features initialized');\n\t\t}\n\t\t\n\t\tensurePermanentVisibility() {\n\t\t\t// Stelle sicher, dass Tipps permanent sichtbar bleiben\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst usageTips = document.querySelector('.usage-tips');\n\t\t\t\tif (usageTips) {\n\t\t\t\t\tusageTips.style.display = 'block';\n\t\t\t\t\tusageTips.classList.remove('hidden');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Stelle sicher, dass Smart Config Container permanent sichtbar sind\n\t\t\t\tconst smartConfigContainers = document.querySelectorAll('.smart-config-container');\n\t\t\t\tsmartConfigContainers.forEach(container => {\n\t\t\t\t\tcontainer.style.display = 'flex';\n\t\t\t\t\tcontainer.classList.remove('hidden');\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Entferne localStorage-Einstellungen, die das Verstecken verursachen\n\t\t\t\tlocalStorage.removeItem('solarTool_hideHelp');\n\t\t\t\tlocalStorage.removeItem('solarTool_hideSmartConfig');\n\t\t\t\t\n\t\t\t}, 100);\n\t\t}\n\t\t\n\t\tcheckAndHideHelp() {\n\t\t\t// Tipps sollen permanent sichtbar bleiben - diese Funktion wird deaktiviert\n\t\t\t// const shouldHideHelp = localStorage.getItem('solarTool_hideHelp');\n\t\t\t// if (shouldHideHelp === 'true') {\n\t\t\t// \tsetTimeout(() => {\n\t\t\t// \t\tconst helpSection = document.querySelector('.bulk-selection-help');\n\t\t\t// \t\tif (helpSection) {\n\t\t\t// \t\t\thelpSection.style.display = 'none';\n\t\t\t// \t\t}\n\t\t\t// \t}, 600);\n\t\t\t// }\n\t\t}\n\t\t\n\t\tinitSmartConfigCloseButton() {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst closeButton = document.getElementById('smart-config-close');\n\t\t\t\tconst container = document.querySelector('.smart-config-container');\n\t\t\t\tif (closeButton && container) {\n\t\t\t\t\tcloseButton.addEventListener('click', () => {\n\t\t\t\t\t\t// Smart Config Container soll permanent sichtbar bleiben - Close-Button deaktiviert\n\t\t\t\t\t\t// container.style.display = 'none';\n\t\t\t\t\t\t// localStorage.setItem('solarTool_hideSmartConfig', 'true');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, 600);\n\t\t}\n\t\tinitQuickConfigInterface() {\n\t\t\t// Verbesserte Initialisierung mit mehreren Versuchen\n\t\t\tconst initSmartConfig = () => {\n\t\t\t\tconst quickInput = document.getElementById('quick-config-input');\n\t\t\t\t\n\t\t\t\tif (!quickInput) {\n\t\t\t\t\tconsole.warn('Smart Config Input Element nicht gefunden, versuche erneut...');\n\t\t\t\t\tsetTimeout(initSmartConfig, 100);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconsole.log('Smart Config Interface initialisiert (ohne Button)');\n\t\t\t\t\n\t\t\t\t// Entferne bestehende Event-Listener (falls vorhanden)\n\t\t\t\tconst newQuickInput = quickInput.cloneNode(true);\n\t\t\t\tquickInput.parentNode.replaceChild(newQuickInput, quickInput);\n\t\t\t\t\n\t\t\t\t// Automatische Anwendung der Konfiguration\n\t\t\t\tconst applyConfiguration = (input) => {\n\t\t\t\t\tif (input && input.trim()) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconsole.log('Smart Config Input:', input);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Clear preview timeout when applying configuration\n\t\t\t\t\t\t\tif (this.previewTimeout) {\n\t\t\t\t\t\t\t\tclearTimeout(this.previewTimeout);\n\t\t\t\t\t\t\t\tthis.previewTimeout = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconst config = this.smartParser.parseInput(input);\n\t\t\t\t\t\t\tconsole.log('Parsed config:', config);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (Object.keys(config).length > 0) {\n\t\t\t\t\t\t\t\tthis.smartParser.applyPreviewToMainGrid(config);\n\t\t\t\t\t\t\t\tnewQuickInput.value = ''; // Input leeren\n\t\t\t\t\t\t\t\tthis.showToast('✅ Konfiguration angewendet', 1500);\n\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.showToast('⚠️ Keine gültige Konfiguration erkannt', 2000);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Smart Config Error:', error);\n\t\t\t\t\t\t\tthis.showToast(`❌ Fehler: ${error.message}`, 3000);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t// Enter-Taste Support - automatische Anwendung\n\t\t\t\tnewQuickInput.addEventListener('keypress', (e) => {\n\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tapplyConfiguration(newQuickInput.value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Feld verlassen (blur) Support - automatische Anwendung\n\t\t\t\tnewQuickInput.addEventListener('blur', () => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tconst input = newQuickInput.value.trim();\n\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\tapplyConfiguration(input);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 100); // Kurze Verzögerung für bessere UX\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Live-Grid-Preview bei jedem Tastendruck\n\t\t\t\tnewQuickInput.addEventListener('input', (e) => {\n\t\t\t\t\tconst input = e.target.value.trim();\n\t\t\t\t\t\n\t\t\t\t\t// Clear previous timeout\n\t\t\t\t\tif (this.previewTimeout) {\n\t\t\t\t\t\tclearTimeout(this.previewTimeout);\n\t\t\t\t\t\tthis.previewTimeout = null;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Update input validation status\n\t\t\t\t\tthis.updateInputValidation(newQuickInput, input);\n\t\t\t\t\t\n\t\t\t\t\tif (input.length > 0) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst config = this.smartParser.parseInput(input);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Zeige Preview für gültige Konfigurationen\n\t\t\t\t\t\t\tif (config.cols || config.rows || config.moduleCount || config.orientation || config.adjustSpacing || config.rowConfig || config.action) {\n\t\t\t\t\t\t\t\tthis.showConfigPreview(config);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Automatische Anwendung nach 2 Sekunden Inaktivität\n\t\t\t\t\t\t\t\tconst self = this;\n\t\t\t\t\t\t\t\tthis.previewTimeout = setTimeout(() => {\n\t\t\t\t\t\t\t\t\tif (self && self.clearGridPreview) {\n\t\t\t\t\t\t\t\t\t\t// Automatisch anwenden wenn gültige Konfiguration\n\t\t\t\t\t\t\t\t\t\tif (Object.keys(config).length > 0) {\n\t\t\t\t\t\t\t\t\t\t\tself.smartParser.applyPreviewToMainGrid(config);\n\t\t\t\t\t\t\t\t\t\t\tnewQuickInput.value = ''; // Input leeren\n\t\t\t\t\t\t\t\t\t\t\tself.showToast('✅ Konfiguration automatisch angewendet', 1500);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tself.clearGridPreview();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, 2000); // Reduziert von 3 auf 2 Sekunden für bessere UX\n  \t\t\t} else {\n\t\t\t\t\t\t\t\t// Keine gültige Konfiguration - Preview löschen\n\t\t\t\t\t\t\t\tthis.clearGridPreview();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Smart Config Preview Error:', error);\n\t\t\t\t\t\t\t// Bei Parsing-Fehler Preview löschen\n\t\t\t\t\t\t\tthis.clearGridPreview();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Input leer - Preview löschen\n\t\t\t\t\t\tthis.clearGridPreview();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Smart Config Help Dropdown Event-Handler initialisieren\n\t\t\t\tthis.initializeSmartConfigHelp();\n\t\t\t};\n\t\t\t\n\t\t\t// Starte Initialisierung mit mehreren Versuchen\n\t\t\tsetTimeout(initSmartConfig, 100);\n\t\t\tsetTimeout(initSmartConfig, 500);\n\t\t\tsetTimeout(initSmartConfig, 1000);\n\t\t\t\n\t\t\t// Zusätzlicher Versuch nach DOMContentLoaded\n\t\t\tif (document.readyState === 'loading') {\n\t\t\t\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\t\t\t\tsetTimeout(initSmartConfig, 100);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\tupdateInputValidation(inputElement, input) {\n\t\t\t// Entferne alle Validierungs-Klassen\n\t\t\tinputElement.classList.remove('input-valid', 'input-invalid', 'input-loading');\n\t\t\t\n\t\t\tif (input.length === 0) {\n\t\t\t\treturn; // Keine Validierung für leere Eingabe\n\t\t\t}\n\t\t\t\n\t\t\t// Zeige Loading-Status\n\t\t\tinputElement.classList.add('input-loading');\n\t\t\t\n\t\t\t// Kurze Verzögerung für bessere UX\n\t\t\tsetTimeout(() => {\n\t\t\t\ttry {\n\t\t\t\t\tconst config = this.smartParser.parseInput(input);\n\t\t\t\t\tconsole.log('Input validation result:', config);\n\t\t\t\t\t\n\t\t\t\t\t// Prüfe ob gültige Konfiguration\n\t\t\t\t\tif (config.cols || config.rows || config.moduleCount || config.orientation || config.adjustSpacing || config.rowConfig || config.action) {\n\t\t\t\t\t\tinputElement.classList.remove('input-loading');\n\t\t\t\t\t\tinputElement.classList.add('input-valid');\n\t\t\t\t\t\tconsole.log('Input is valid');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinputElement.classList.remove('input-loading');\n\t\t\t\t\t\tinputElement.classList.add('input-invalid');\n\t\t\t\t\t\tconsole.log('Input is invalid');\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Input validation error:', error);\n\t\t\t\t\tinputElement.classList.remove('input-loading');\n\t\t\t\t\tinputElement.classList.add('input-invalid');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t}\n\n\t\tshowConfigPreview(config) {\n\t\t\tconsole.log('Showing config preview:', config);\n\t\t\t\n\t\t\t// Grid-Preview für alle Konfigurationen die das Grid beeinflussen\n\t\t\tif (\n\t\t\t\tconfig.cols || config.rows || config.moduleCount || config.orientation || config.adjustSpacing || config.rowConfig ||\n\t\t\t\tconfig.selectRows || config.gapRows || config.selectColumns || config.gapColumns ||\n\t\t\t\tconfig.selectAreaRows || config.selectAreaCols || config.fillOnlyFrame || config.clearFrame ||\n\t\t\t\tconfig.fillLeftHalf || config.clearRightHalf || config.everySecondRowsStart ||\n\t\t\t\tconfig.clearTopRow || config.clearBottomRow || config.fillFirstNColumns || config.clearFirstNColumns || config.clearLastNColumns ||\n\t\t\t\tconfig.fillFirstNRows || config.clearFirstNRows || config.fillLastNRows || config.clearLastNRows ||\n\t\t\t\tconfig.fillBlock || config.fillBlockRelative\n\t\t\t) {\n\t\t\t\t// this ist die SolarGrid Instanz selbst, also können wir direkt auf ihre Methoden zugreifen\n\t\t\t\tif (this && typeof this.showGridPreview === 'function') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.showGridPreview(config);\n\t\t\t\t\t\tconsole.log('Grid preview shown successfully');\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('Error showing grid preview:', error);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error('showGridPreview method not available!');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('No grid-affecting config found, skipping preview');\n\t\t\t}\n\t\t}\n\t\t// Smart Config Help Dropdown Initialisierung\n\t\tinitializeSmartConfigHelp() {\n\t\t\t// Trigger wird auch in setupSmartConfig aufgerufen\n\t\t\tconst trigger = document.getElementById('smart-help-trigger');\n\t\t\tconst dropdown = document.getElementById('smart-help-dropdown');\n\t\t\t\n\t\t\tif (!trigger || !dropdown) return; // Falls die Elemente nicht existieren\n\t\t\t\n\t\t\tlet isHovered = false;\n\t\t\tlet hoverTimeout = null;\n\t\t\t\n\t\t\t// JavaScript-basierte Hover-Funktionalität (überschreibt CSS)\n\t\t\tconst showDropdown = () => {\n\t\t\t\tdropdown.style.opacity = '1';\n\t\t\t\tdropdown.style.visibility = 'visible';\n\t\t\t\tdropdown.style.transform = 'translateY(0)';\n\t\t\t};\n\t\t\t\n\t\t\tconst hideDropdown = () => {\n\t\t\t\tdropdown.style.opacity = '0';\n\t\t\t\tdropdown.style.visibility = 'hidden';\n\t\t\t\tdropdown.style.transform = 'translateY(-10px)';\n\t\t\t};\n\t\t\t\n\t\t\t// Hover Events für Trigger\n\t\t\ttrigger.addEventListener('mouseenter', () => {\n\t\t\t\tisHovered = true;\n\t\t\t\tif (hoverTimeout) clearTimeout(hoverTimeout);\n\t\t\t\tshowDropdown();\n\t\t\t});\n\t\t\t\n\t\t\ttrigger.addEventListener('mouseleave', () => {\n\t\t\t\tisHovered = false;\n\t\t\t\thoverTimeout = setTimeout(() => {\n\t\t\t\t\tif (!isHovered) hideDropdown();\n\t\t\t\t}, 100); // Kleine Verzögerung für sanfteren Übergang\n\t\t\t});\n\t\t\t\n\t\t\t// Hover Events für Dropdown selbst\n\t\t\tdropdown.addEventListener('mouseenter', () => {\n\t\t\t\tisHovered = true;\n\t\t\t\tif (hoverTimeout) clearTimeout(hoverTimeout);\n\t\t\t});\n\t\t\t\n\t\t\tdropdown.addEventListener('mouseleave', () => {\n\t\t\t\tisHovered = false;\n\t\t\t\thoverTimeout = setTimeout(() => {\n\t\t\t\t\tif (!isHovered) hideDropdown();\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t\t\n\t\t\t// Verhindere dass Dropdown schließt wenn darauf geklickt wird\n\t\t\tdropdown.addEventListener('click', (e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t\t\n            // Entfernt: Automatisches Schließen bei Klick außerhalb – Dropdown bleibt offen, bis der Nutzer weg hovert\n\t\t\t\n\t\t\t// Beispiel-Click Handler für sofortige Anwendung (ohne Ctrl+Click Tipp)\n\t\t\tdocument.querySelectorAll('.example').forEach(example => {\n\t\t\t\texample.addEventListener('click', (e) => {\n\t\t\t\t\te.stopPropagation(); // Verhindere Click-Outside-Handler\n\t\t\t\t\t\n\t\t\t\t\tconst quickInput = document.getElementById('quick-config-input');\n\t\t\t\t\tif (quickInput) {\n\t\t\t\t\t\t// Entferne Anführungszeichen und setze Wert\n\t\t\t\t\t\tquickInput.value = example.textContent.replace(/\"/g, '');\n\t\t\t\t\t\tquickInput.focus();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Zeige Vorschau\n\t\t\t\t\t\tif (quickInput.value.length > 3) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst config = this.smartParser.parseInput(quickInput.value);\n\t\t\t\t\t\t\t\tthis.showConfigPreview(config);\n\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t// Ignoriere Parsing-Fehler\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n                        // Dropdown bleibt sichtbar, damit Nutzer weitere Beispiele wählen kann\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Optional: Scroll zur Smart Config Section\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tquickInput.scrollIntoView({ behavior: 'smooth', block: 'center' });\n\t\t\t\t\t\t}, 100);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n    setup() {\n  \t\t// Verwende Standard-Werte falls nicht bereits gesetzt\n  \t\tif (!this.cols || !this.rows) {\n  \t\t\tthis.cols = this.default.cols;\n  \t\t\tthis.rows = this.default.rows;\n  \t\t}\n  \t\tif (!this.cols || !this.rows) {\n    \t\talert('Spalten und Zeilen müssen > 0 sein');\n    \t\treturn;\n  \t\t}\n\n  \t\t// Nur dann eine neue leere Auswahl erstellen, wenn noch keine existiert oder die Dimensionen nicht stimmen\n    \tif (\n    \t\t!Array.isArray(this.selection) ||\n    \t\tthis.selection.length !== this.rows ||\n    \t\tthis.selection[0]?.length !== this.cols\n  \t\t) {\n  \t\tconst oldSel = this.selection;\n  \t\tthis.selection = Array.from({ length: this.rows }, (_, y) =>\n    \t\tArray.from({ length: this.cols }, (_, x) => oldSel?.[y]?.[x] || false)\n  \t\t);\n  \t\t}\n\n  \t\tif (this.listHolder) {\n  \t\tthis.listHolder.style.display = 'block';\n  \t\t}\n  \t\tthis.updateSize();\n  \t\tthis.buildGrid();\n  \t\tthis.buildList();\n  \t\tthis.updateSaveButtons();\n\t\t}\n\n\t\t// Neue Funktion für Grid-Event-Listener\n\t\t// Neue Funktion für alle Event-Listener\n\t\tsetupAllEventListeners() {\n\t\t\t// Input-Event-Listener\n\t\t\tconst inputs = [this.wIn, this.hIn].filter(el => el);\n\t\t\tinputs.forEach(el => {\n\t\t\t\tel.removeEventListener('change', this.handleInputChange);\n\t\t\t\tel.addEventListener('change', this.handleInputChange.bind(this));\n\t\t\t});\n\t\t\t\n\t\t\t// Modul-Auswahl-Event-Listener\n\t\t\tif (this.moduleSelect) {\n\t\t\t\tthis.moduleSelect.removeEventListener('change', this.handleModuleSelectChange);\n\t\t\t\tthis.moduleSelect.addEventListener('change', this.handleModuleSelectChange.bind(this));\n\t\t\t}\n\t\t\t\n\t\t\t// Orientation-Event-Listener\n\t\t\tif (this.orH && this.orV) {\n\t\t\t\t[this.orH, this.orV].forEach(el => {\n\t\t\t\t\tel.removeEventListener('change', this.handleOrientationChange);\n\t\t\t\t\tel.addEventListener('change', this.handleOrientationChange.bind(this));\n\t\t\t\t});\n\t\t\t\t// Synchronisiere Buttons nach Radio-Button Setup\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.syncOrientationButtons();\n\t\t\t\t}, 10);\n\t\t\t}\n\t\t\t\n\t\t\t\t\t// Checkbox-Event-Listener\n\t\t[this.incM, this.mc4, this.solarkabel, this.holz, this.quetschkabelschuhe, this.erdungsband, this.ulicaModule].filter(el => el).forEach(el => {\n\t\t\tel.removeEventListener('change', this.handleCheckboxChange);\n\t\t\tel.addEventListener('change', this.handleCheckboxChange.bind(this));\n\t\t});\n\t\t\n\t\t// Zusätzliche Event-Listener für Modul-Checkboxen im Dropdown\n\t\tdocument.querySelectorAll('#include-modules, #ulica-module').forEach(el => {\n\t\t\tel.removeEventListener('change', this.handleCheckboxChange);\n\t\t\tel.addEventListener('change', this.handleCheckboxChange.bind(this));\n\t\t});\n\t\t\t\n\t\t\t// Expansion-Button-Event-Listener mit stabiler Referenz\n\t\t\tif (!this.boundExpansionClick) {\n\t\t\t\tthis.boundExpansionClick = this.handleExpansionClick.bind(this);\n\t\t\t}\n\t\t\tdocument.querySelectorAll('[data-dir=\"right\"]').forEach(btn => {\n\t\t\t\tbtn.removeEventListener('click', this.boundExpansionClick);\n\t\t\t\tbtn.addEventListener('click', this.boundExpansionClick);\n\t\t\t});\n\t\t\tdocument.querySelectorAll('[data-dir=\"left\"]').forEach(btn => {\n\t\t\t\tbtn.removeEventListener('click', this.boundExpansionClick);\n\t\t\t\tbtn.addEventListener('click', this.boundExpansionClick);\n\t\t\t});\n\t\t\tdocument.querySelectorAll('[data-dir=\"top\"]').forEach(btn => {\n\t\t\t\tbtn.removeEventListener('click', this.boundExpansionClick);\n\t\t\t\tbtn.addEventListener('click', this.boundExpansionClick);\n\t\t\t});\n\t\t\tdocument.querySelectorAll('[data-dir=\"bottom\"]').forEach(btn => {\n\t\t\t\tbtn.removeEventListener('click', this.boundExpansionClick);\n\t\t\t\tbtn.addEventListener('click', this.boundExpansionClick);\n\t\t\t});\n\t\t\t\n\t\t\t// Orientation-Button-Event-Listener\n\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\tif (orientHBtn && orientVBtn) {\n\t\t\t\t// Verwende eine gebundene Referenz, damit removeEventListener korrekt funktioniert\n\t\t\t\tif (!this.boundOrientationClick) {\n\t\t\t\t\tthis.boundOrientationClick = this.handleOrientationButtonClick.bind(this);\n\t\t\t\t}\n\t\t\t\t[orientHBtn, orientVBtn].forEach(btn => {\n\t\t\t\t\tbtn.removeEventListener('click', this.boundOrientationClick);\n\t\t\t\t\tbtn.addEventListener('click', this.boundOrientationClick);\n\t\t\t\t});\n\t\t\t\t// Sofortige Synchronisation\n\t\t\t\tthis.syncOrientationButtons();\n  \t\t} else {\n\t\t\t\t// Fallback: Versuche es später nochmal\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\t\t\tif (orientHBtn && orientVBtn) {\n\t\t\t\t\t\tif (!this.boundOrientationClick) {\n\t\t\t\t\t\t\tthis.boundOrientationClick = this.handleOrientationButtonClick.bind(this);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t[orientHBtn, orientVBtn].forEach(btn => {\n\t\t\t\t\t\t\tbtn.removeEventListener('click', this.boundOrientationClick);\n\t\t\t\t\t\t\tbtn.addEventListener('click', this.boundOrientationClick);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Synchronisiere Orientation Buttons nach dem Setup\n\t\t\t\t\t\tthis.syncOrientationButtons();\n\t\t\t\t\t}\n\t\t\t\t}, 50); // Reduzierte Verzögerung\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Event-Handler-Funktionen\n\t\t\n\t\t// Hilfsfunktion für robuste Orientation-Button-Synchronisation\n\t\tensureOrientationButtonsSync() {\n\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\t\n\t\t\tif (!orientHBtn || !orientVBtn || !this.orH || !this.orV) return;\n\t\t\t\n\t\t\t// Prüfe ob Buttons korrekt synchronisiert sind\n\t\t\tconst isVerticalActive = orientVBtn.classList.contains('active');\n\t\t\tconst isHorizontalActive = orientHBtn.classList.contains('active');\n\t\t\tconst radioVerticalChecked = this.orV.checked;\n\t\t\tconst radioHorizontalChecked = this.orH.checked;\n\t\t\t\n\t\t\t// Wenn Inkonsistenz festgestellt wird, korrigiere sie\n\t\t\tif ((isVerticalActive !== radioVerticalChecked) || (isHorizontalActive !== radioHorizontalChecked)) {\n\t\t\t\tthis.syncOrientationButtons();\n\t\t\t}\n\t\t}\n\t\t\n\t\thandleModuleSelectChange() {\n\t\t\tthis.trackInteraction();\n\t\t\tconst selectedValue = this.moduleSelect.value;\n\t\t\t\n\t\t\tif (selectedValue === '' || selectedValue === 'custom') {\n\t\t\t\t// Kein Modul ausgewählt oder Benutzerdefiniert - Inputs freigeben\n\t\t\t\tthis.enableInputs();\n\t\t\t\tthis.updateSize();\n\t\t\t\tthis.buildList();\n    \t\tthis.updateSummaryOnChange();\n\t\t\t\t// Alle Modul-Checkboxen abwählen\n\t\t\t\tthis.clearModuleCheckboxes();\n\t\t\t} else if (this.moduleData[selectedValue]) {\n\t\t\t\t// Modul ausgewählt - Werte setzen und Inputs sperren\n\t\t\t\tconst module = this.moduleData[selectedValue];\n\t\t\t\tthis.wIn.value = module.width;\n\t\t\t\tthis.hIn.value = module.height;\n\t\t\t\t// Aktualisiere auch die aktuelle Konfiguration mit den neuen Zellgrößen\n\t\t\t\tif (this.currentConfig !== null && this.configs[this.currentConfig]) {\n\t\t\t\t\tthis.configs[this.currentConfig].cellWidth = module.width;\n\t\t\t\t\tthis.configs[this.currentConfig].cellHeight = module.height;\n\t\t\t\t}\n\t\t\t\tthis.disableInputs();\n\t\t\t\tthis.updateSize();\n\t\t\t\tthis.buildList();\n\t\t\t\tthis.updateSummaryOnChange();\n\t\t\t\t\n\t\t\t\t// Keine Checkbox-Interaktion mehr - nur Dropdown-Werte setzen\n\t\t\t\tthis.clearModuleCheckboxes();\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Neue Funktionen für Modul-Checkbox-Synchronisation\n\t\thandleModuleCheckboxChange(checkboxId) {\n\t\t\tthis.trackInteraction();\n\t\t\t\n\t\t\t// Nur eine Modul-Checkbox darf ausgewählt sein\n\t\t\tif (checkboxId === 'include-modules' && this.incM.checked) {\n\t\t\t\t// include-modules wurde ausgewählt - ulica-module abwählen\n\t\t\t\tif (this.ulicaModule) {\n\t\t\t\t\tthis.ulicaModule.checked = false;\n\t\t\t\t}\n\t\t\t\t// Dropdown auf ulica-450 setzen und Input-Werte anpassen\n\t\t\t\tif (this.moduleSelect) {\n\t\t\t\t\tthis.moduleSelect.value = 'ulica-450';\n\t\t\t\t\t// Input-Werte für ulica-450 setzen\n\t\t\t\t\tif (this.wIn) this.wIn.value = '176.2';\n\t\t\t\t\tif (this.hIn) this.hIn.value = '113.4';\n\t\t\t\t\tif (this.currentConfig !== null && this.configs[this.currentConfig]) {\n\t\t\t\t\t\tthis.configs[this.currentConfig].cellWidth = 176.2;\n\t\t\t\t\t\tthis.configs[this.currentConfig].cellHeight = 113.4;\n\t\t\t\t\t}\n\t\t\t\t\tthis.disableInputs();\n\t\t\t\t}\n\t\t\t} else if (checkboxId === 'ulica-module' && this.ulicaModule.checked) {\n\t\t\t\t// ulica-module wurde ausgewählt - include-modules abwählen\n\t\t\t\tif (this.incM) {\n\t\t\t\t\tthis.incM.checked = false;\n\t\t\t\t}\n\t\t\t\t// Dropdown auf ulica-500 setzen und Input-Werte anpassen\n\t\t\t\tif (this.moduleSelect) {\n\t\t\t\t\tthis.moduleSelect.value = 'ulica-500';\n\t\t\t\t\t// Input-Werte für ulica-500 setzen\n\t\t\t\t\tif (this.wIn) this.wIn.value = '195.2';\n\t\t\t\t\tif (this.hIn) this.hIn.value = '113.4';\n\t\t\t\t\tif (this.currentConfig !== null && this.configs[this.currentConfig]) {\n\t\t\t\t\t\tthis.configs[this.currentConfig].cellWidth = 195.2;\n\t\t\t\t\t\tthis.configs[this.currentConfig].cellHeight = 113.4;\n\t\t\t\t\t}\n\t\t\t\t\tthis.disableInputs();\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Grid und Berechnungen aktualisieren\n\t\t\tthis.updateSize();\n\t\t\tthis.buildGrid();\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\t\t\tthis.updateConfig();\n\t\t\t// Neu: Modul-Checkboxen gelten global -> auf alle Konfigurationen anwenden\n\t\t\tthis.updateAllConfigurationsForCheckboxes();\n\t\t}\n\t\t\n\t\tclearModuleCheckboxes() {\n\t\t\tif (this.incM) this.incM.checked = false;\n\t\t\tif (this.ulicaModule) this.ulicaModule.checked = false;\n\t\t}\n\t\t\n\t\thandleInputChange() {\n\t\t\tthis.trackInteraction();\n\t\t\tthis.updateSize();\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\t\t}\n\t\t\n\t\thandleOrientationChange() {\n\t\t\tthis.trackInteraction();\n\t\t\tthis.updateSize();\n\t\t\tthis.buildGrid();\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\t\t}\n\t\t\n\t\thandleCheckboxChange() {\n\t\t\tthis.trackInteraction();\n\t\t\t\n\t\t\t// Prüfe ob es sich um eine Modul-Checkbox handelt\n\t\t\tconst checkboxId = event.target.id;\n\t\t\tif (checkboxId === 'include-modules' || checkboxId === 'ulica-module') {\n\t\t\t\tthis.handleModuleCheckboxChange(checkboxId);\n\t\t\t} else {\n\t\t\t\t// Ursprüngliche Funktion: Update aller Konfigurationen für Checkboxen\n\t\t\t\tthis.updateAllConfigurationsForCheckboxes();\n\t\t\t}\n\t\t}\n\t\t\n\t\thandleExpansionClick(e) {\n\t\t\tthis.trackInteraction();\n\t\t\tconst dir = e.target.dataset.dir;\n\t\t\tconst isPlus = e.target.classList.contains('plus-btn');\n\t\t\t\n\t\t\tif (dir === 'right') {\n\t\t\t\tisPlus ? this.addColumnRight() : this.removeColumnRight();\n\t\t\t} else if (dir === 'left') {\n\t\t\t\tisPlus ? this.addColumnLeft() : this.removeColumnLeft();\n\t\t\t} else if (dir === 'top') {\n\t\t\t\tisPlus ? this.addRowTop() : this.removeRowTop();\n\t\t\t} else if (dir === 'bottom') {\n\t\t\t\tisPlus ? this.addRowBottom() : this.removeRowBottom();\n\t\t\t}\n\t\t}\n\t\t\n\t\thandleOrientationButtonClick(e) {\n\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\t\n\t\t\tif (!orientHBtn || !orientVBtn) return;\n\t\t\t\n\t\t\t// Verhindere mehrfache Klicks während der Verarbeitung\n\t\t\tif (this.orientationProcessing) return;\n\t\t\tthis.orientationProcessing = true;\n\t\t\t\n\t\t\t// Bestimme die neue Orientierung basierend auf dem Button, der den Handler ausgelöst hat\n\t\t\tconst clickedBtn = e.currentTarget || e.target;\n\t\t\tconst isVertical = clickedBtn === orientVBtn;\n\t\t\tconst newOrientation = isVertical ? 'vertical' : 'horizontal';\n\t\t\t\n\t\t\t// Sofortige visuelle Rückmeldung\n\t\t\torientHBtn.classList.remove('active');\n\t\t\torientVBtn.classList.remove('active');\n\t\t\tif (clickedBtn && clickedBtn.classList) clickedBtn.classList.add('active');\n\t\t\t\n\t\t\t// Radio-Buttons synchronisieren\n\t\t\tif (this.orV) this.orV.checked = isVertical;\n\t\t\tif (this.orH) this.orH.checked = !isVertical;\n\t\t\t\n\t\t\tthis.trackInteraction();\n\t\t\t\n\t\t\t// Sofortige Grid-Updates ohne Verzögerung\n\t\t\tthis.updateSize();\n\t\t\tthis.buildGrid();\n\t\t\t\n\t\t\t// Verzögerte Updates für Performance\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.buildList();\n\t\t\t\tthis.updateSummaryOnChange();\n\t\t\t\tthis.orientationProcessing = false;\n\t\t\t\t// Zusätzliche Synchronisation für Robustheit\n\t\t\t\tthis.ensureOrientationButtonsSync();\n\t\t\t}, 10); // Reduzierte Verzögerung für bessere Reaktionszeit\n\t\t}\n\t\t\n\t\t// NEUE FUNKTION: Synchronisiere Orientation Buttons\n\t\tsyncOrientationButtons() {\n\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\t\n\t\t\tif (!orientHBtn || !orientVBtn || !this.orH || !this.orV) return;\n\t\t\t\n\t\t\t// Entferne active Klasse von beiden Buttons\n\t\t\torientHBtn.classList.remove('active');\n\t\t\torientVBtn.classList.remove('active');\n\t\t\t\n\t\t\t// Setze active Klasse basierend auf Radio-Button Status\n\t\t\t// Priorisiere orV.checked für konsistente Logik\n\t\t\tif (this.orV.checked) {\n\t\t\t\torientVBtn.classList.add('active');\n\t\t\t} else if (this.orH.checked) {\n\t\t\t\torientHBtn.classList.add('active');\n\t\t\t} else {\n\t\t\t\t// Fallback: Standard auf vertikal setzen\n\t\t\t\tthis.orV.checked = true;\n\t\t\t\tthis.orH.checked = false;\n\t\t\t\torientVBtn.classList.add('active');\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Input-Sperr-Funktionen\n\t\tdisableInputs() {\n\t\t\tif (this.wIn) {\n\t\t\t\tthis.wIn.disabled = true;\n\t\t\t\tthis.wIn.style.backgroundColor = '#f0f0f0';\n\t\t\t\tthis.wIn.style.cursor = 'not-allowed';\n\t\t\t}\n\t\t\tif (this.hIn) {\n\t\t\t\tthis.hIn.disabled = true;\n\t\t\t\tthis.hIn.style.backgroundColor = '#f0f0f0';\n\t\t\t\tthis.hIn.style.cursor = 'not-allowed';\n\t\t\t}\n\t\t}\n\t\t\n\t\tenableInputs() {\n\t\t\tif (this.wIn) {\n\t\t\t\tthis.wIn.disabled = false;\n\t\t\t\tthis.wIn.style.backgroundColor = '';\n\t\t\t\tthis.wIn.style.cursor = '';\n\t\t\t}\n\t\t\tif (this.hIn) {\n\t\t\t\tthis.hIn.disabled = false;\n\t\t\t\tthis.hIn.style.backgroundColor = '';\n\t\t\t\tthis.hIn.style.cursor = '';\n\t\t\t}\n\t\t}\n\n    updateSaveButtons() {\n  \t\t// Immer den \"Neue Konfiguration speichern\" Button anzeigen\n  \t\tif (this.saveBtn) {\n  \t\t\tthis.saveBtn.style.display = 'inline-block';\n  \t\t}\n\t\t}\n    \n\n    \n    // Spalten-Methoden - Rechts (am Ende)\n    addColumnRight() {\n  \t\tthis.cols += 1;\n  \t\tfor (let row of this.selection) {\n    \t\trow.push(false);\n  \t\t}\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\tremoveColumnRight() {\n  \t\tif (this.cols <= 1) return;\n  \t\tthis.cols -= 1;\n  \t\tfor (let row of this.selection) {\n    \t\trow.pop();\n  \t\t}\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\t// Spalten-Methoden - Links (am Anfang)\n\t\taddColumnLeft() {\n  \t\tthis.cols += 1;\n  \t\tfor (let row of this.selection) {\n    \t\trow.unshift(false);\n  \t\t}\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\tremoveColumnLeft() {\n  \t\tif (this.cols <= 1) return;\n  \t\tthis.cols -= 1;\n  \t\tfor (let row of this.selection) {\n    \t\trow.shift();\n  \t\t}\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\t// Zeilen-Methoden - Unten (am Ende)\n\t\taddRowBottom() {\n  \t\tthis.rows += 1;\n  \t\tthis.selection.push(Array(this.cols).fill(false));\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\tremoveRowBottom() {\n  \t\tif (this.rows <= 1) return;\n  \t\tthis.rows -= 1;\n  \t\tthis.selection.pop();\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\t// Zeilen-Methoden - Oben (am Anfang)\n\t\taddRowTop() {\n  \t\tthis.rows += 1;\n  \t\tthis.selection.unshift(Array(this.cols).fill(false));\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\tremoveRowTop() {\n  \t\tif (this.rows <= 1) return;\n  \t\tthis.rows -= 1;\n  \t\tthis.selection.shift();\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\tupdateGridAfterStructureChange() {\n  \t\tthis.updateSize();\n  \t\tthis.buildGrid();\n  \t\tthis.buildList();\n  \t\tthis.updateSummaryOnChange();\n\t\t}\n    \n\n    \n\n    updateSize() {\n  \t\tconst RAIL_GAP = 2; // Immer 2cm für Schienen-Berechnungen\n  \t\tconst remPx = parseFloat(getComputedStyle(document.documentElement).fontSize);\n\n  \t\t\t\t// Original Zellengrößen aus Input - bei Orientierung entsprechend anwenden\n\t\tconst inputW = parseFloat(this.wIn ? this.wIn.value : '179') || 179;\n\t\tconst inputH = parseFloat(this.hIn ? this.hIn.value : '113') || 113;\n  \t\t\n  \t\t\t\t// Bei vertikaler Orientierung: Breite und Höhe der Zellen tauschen\n\t\tconst isVertical = this.orV ? this.orV.checked : false;\n  \t\tconst originalCellW = isVertical ? inputH : inputW;\n  \t\tconst originalCellH = isVertical ? inputW : inputH;\n  \t\t\n  \t\t\t\t// Maximale verfügbare Größe\n\t\t// 80px Abstand auf allen Seiten: links, rechts, oben, unten\n\t\t// Insgesamt 160px für Breite (80px links + 80px rechts) und 160px für Höhe (80px oben + 80px unten)\n\t\tconst maxWidth = this.wrapper ? this.wrapper.clientWidth - 160 : 800; // grid-wrapper Breite - 160px (80px links + 80px rechts)\n\t\tconst maxHeight = this.wrapper ? this.wrapper.clientHeight - 160 : 600; // grid-wrapper Höhe - 160px (80px oben + 80px unten)\n  \t\t\n  \t\t// Berechne benötigte Gesamtgröße mit Original-Zellgrößen (inklusive Gaps für Schienen)\n  \t\tconst totalWidthWithRailGaps = this.cols * originalCellW + (this.cols - 1) * RAIL_GAP;\n  \t\tconst totalHeightWithRailGaps = this.rows * originalCellH + (this.rows - 1) * RAIL_GAP;\n  \t\t\n  \t\t// Berechne Skalierungsfaktoren für beide Dimensionen\n  \t\tconst scaleX = maxWidth / totalWidthWithRailGaps;\n  \t\tconst scaleY = maxHeight / totalHeightWithRailGaps;\n  \t\t\n  \t\t// Verwende den kleineren Skalierungsfaktor, um Proportionen zu erhalten\n  \t\t// und sicherzustellen, dass das Grid nie die Grenzen überschreitet\n  \t\tconst scale = Math.min(scaleX, scaleY, 1);\n  \t\t\n  \t\t// Berechne finale Zellgrößen\n  \t\tconst w = originalCellW * scale;\n  \t\tconst h = originalCellH * scale;\n\n  \t\t// Bestimme visuelle Gap: 0 wenn viele Spalten/Zeilen, sonst RAIL_GAP * scale\n  \t\t// Gap verschwindet horizontal ab 15 Spalten, vertikal ab 10 Zeilen\n  \t\tconst shouldHideGap = this.cols >= 15 || this.rows >= 10;\n  \t\tconst visualGap = shouldHideGap ? 0 : RAIL_GAP * scale;\n\n  \t\t// CSS Variablen setzen\n  \t\tdocument.documentElement.style.setProperty('--cell-size', w + 'px');\n  \t\tdocument.documentElement.style.setProperty('--cell-width',  w + 'px');\n  \t\tdocument.documentElement.style.setProperty('--cell-height', h + 'px');\n  \t\tdocument.documentElement.style.setProperty('--cell-gap', visualGap + 'px');\n\n  \t\t// Grid-Größe direkt setzen - niemals größer als die maximalen Grenzen\n  \t\tconst finalWidth = Math.min(this.cols * w + (this.cols - 1) * visualGap, maxWidth);\n  \t\tconst finalHeight = Math.min(this.rows * h + (this.rows - 1) * visualGap, maxHeight);\n  \t\t\n  \t\t\t\tif (this.gridEl) {\n\t\t\tthis.gridEl.style.width = finalWidth + 'px';\n\t\t\tthis.gridEl.style.height = finalHeight + 'px';\n\t\t}\n\t\t}\n    buildGrid() {\n  \t\tif (!Array.isArray(this.selection)) return;\n  \t\t\n  \t\t// Performance: Verwende DocumentFragment für bessere Performance\n  \t\tconst fragment = document.createDocumentFragment();\n  \t\t\n  \t\t// CSS-Variablen setzen\n  \t\tdocument.documentElement.style.setProperty('--cols', this.cols);\n  \t\tdocument.documentElement.style.setProperty('--rows', this.rows);\n\n  \t\t// Batch-Erstellung aller Zellen - optimiert für Orientation Changes\n  \t\tfor (let y = 0; y < this.rows; y++) {\n    \t\tif (!Array.isArray(this.selection[y])) continue;\n\n    \t\tfor (let x = 0; x < this.cols; x++) {\n      \t\tconst cell = document.createElement('div');\n      \t\tcell.className = 'grid-cell';\n      \t\tif (this.selection[y]?.[x]) cell.classList.add('selected');\n\n      \t\t// FEATURE 6: Screen Reader Support - ARIA-Labels\n      \t\tcell.setAttribute('role', 'button');\n      \t\tcell.setAttribute('tabindex', '0');\n      \t\tcell.setAttribute('aria-label', `Modul ${x + 1}, ${y + 1} - ${this.selection[y]?.[x] ? 'ausgewählt' : 'nicht ausgewählt'}`);\n      \t\tcell.setAttribute('aria-pressed', this.selection[y]?.[x] ? 'true' : 'false');\n\n      \t\t// Event-Listener optimiert\n      \t\tcell.addEventListener('click', () => {\n        \t\tif (!this.selection[y]) this.selection[y] = [];\n        \t\tthis.selection[y][x] = !this.selection[y][x];\n        \t\tcell.classList.toggle('selected');\n        \t\t\n        \t\t// FEATURE 6: Screen Reader Support - Update ARIA\n        \t\tcell.setAttribute('aria-pressed', this.selection[y][x] ? 'true' : 'false');\n        \t\tcell.setAttribute('aria-label', `Modul ${x + 1}, ${y + 1} - ${this.selection[y][x] ? 'ausgewählt' : 'nicht ausgewählt'}`);\n        \t\t\n        \t\t// Performance: Update aktuelle Konfiguration ohne Deep Copy\n        \t\tif (this.currentConfig !== null && this.configs[this.currentConfig]) {\n        \t\t\t// Direkte Referenz statt JSON.parse/stringify\n        \t\t\tthis.configs[this.currentConfig].selection = this.selection;\n        \t\t\t// Speichere die Konfiguration automatisch\n        \t\t\tthis.updateConfig();\n        \t\t}\n        \t\t\n        \t\tthis.trackInteraction();\n        \t\t// Performance: Sofortige Produktliste Update + Debounced Summary\n        \t\tthis.buildList();\n        \t\tthis.updateSummaryOnChange();\n        \t\t\n        \t\t// Update config-list und overview wenn eine Konfiguration ausgewählt ist\n        \t\tif (this.currentConfig !== null) {\n        \t\t\tthis.updateConfigList();\n        \t\t}\n      \t\t});\n       \n      \t\t// FEATURE 6: Screen Reader Support - Keyboard Navigation\n      \t\tcell.addEventListener('keydown', (e) => {\n        \t\tif (e.key === 'Enter' || e.key === ' ') {\n        \t\t\te.preventDefault();\n        \t\t\tcell.click();\n        \t\t}\n      \t\t});\n\n      \t\t// Animation entfernt für bessere Performance\n      \t\t// const dx = x - centerX;\n      \t\t// const dy = y - centerY;\n      \t\t// const distance = Math.sqrt(dx * dx + dy * dy);\n      \t\t// const delay = distance * delayPerUnit;\n      \t\t// cell.style.animationDelay = `${delay}ms`;\n      \t\t// setTimeout(() => cell.classList.remove('animate-in'), 400);\n      \t\tfragment.appendChild(cell);\n    \t\t}\n  \t\t}\n  \t\t\n  \t\t// Einmalige DOM-Manipulation\n  \t\tthis.gridEl.innerHTML = '';\n  \t\tthis.gridEl.appendChild(fragment);\n\t\t}\n    async buildList() {\n      try {\n        // Performance: Cached panel count calculation\n        const panelCount = this.selection.flat().filter(v => v).length;\n        \n        // Verwende die gleiche Berechnungslogik wie calculateConfigPrice für Konsistenz\n        const currentConfig = {\n          selection: this.selection,\n          cols: this.cols,\n          rows: this.rows,\n          cellWidth: parseInt(this.wIn?.value || '179'),\n          cellHeight: parseInt(this.hIn?.value || '113'),\n          orientation: this.orV?.checked ? 'vertical' : 'horizontal',\n          ulicaModule: document.getElementById('ulica-module')?.checked || false\n        };\n        \n        // Verwende calculateConfigPrice Logik für die Teile-Berechnung\n        const parts = {\n          Solarmodul: 0, Endklemmen: 0, Mittelklemmen: 0,\n          Dachhaken: 0, Schrauben: 0, Endkappen: 0,\n          Schienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0,\n          UlicaSolarBlackJadeFlow: 0\n        };\n\n        // Berechne Teile für jede Zeile (gleiche Logik wie calculateConfigPrice)\n        for (let y = 0; y < currentConfig.rows; y++) {\n          if (!Array.isArray(currentConfig.selection[y])) continue;\n          let run = 0;\n\n          for (let x = 0; x < currentConfig.cols; x++) {\n            if (currentConfig.selection[y]?.[x]) {\n              run++;\n            }\n            else if (run) { \n              this.processGroupDirectly(run, parts, currentConfig.cellWidth || 179, currentConfig.cellHeight || 113, currentConfig.orientation || 'vertical', currentConfig.ulicaModule || false); \n              run = 0; \n            }\n          }\n          if (run) {\n            this.processGroupDirectly(run, parts, currentConfig.cellWidth || 179, currentConfig.cellHeight || 113, currentConfig.orientation || 'vertical', currentConfig.ulicaModule || false);\n          }\n        }\n        \n        // Module nur hinzufügen wenn Checkbox aktiviert ist (gleiche Logik wie calculateConfigPrice)\n        const includeModules = document.getElementById('include-modules')?.checked || false;\n        const ulicaModule = document.getElementById('ulica-module')?.checked || false;\n        const kabelbinder = this.kabelbinder?.checked || false;\n        \n        if (!includeModules) {\n          delete parts.Solarmodul;\n        }\n        \n        if (!ulicaModule) {\n          delete parts.UlicaSolarBlackJadeFlow;\n        }\n        \n        // Zusatzprodukte: Erdungsband wieder in die Produktliste aufnehmen wenn Checkbox aktiv\n        if (this.erdungsband && this.erdungsband.checked) {\n          parts.Erdungsband = this.calculateErdungsband();\n        } else {\n          delete parts.Erdungsband;\n        }\n        \n        // Kabelbinder und Blech-Bohrschrauben werden NICHT in der Produktliste angezeigt\n        // Sie werden nur in der Zusatzproduktliste angezeigt\n        delete parts.Kabelbinder;\n        delete parts.BlechBohrschrauben;\n\n\n      // Palettenlogik für Produktliste (36er-Bündel je nach Modultyp)\n      try {\n        const pieceKey = ulicaModule ? 'UlicaSolarBlackJadeFlow' : 'Solarmodul';\n        const palletKey = ulicaModule ? 'UlicaSolarBlackJadeFlowPalette' : 'SolarmodulPalette';\n        const count = Number(parts[pieceKey] || 0);\n        if (count > 0) {\n          const pallets = Math.floor(count / 36);\n          const remainder = count % 36;\n          if (pallets > 0) {\n            parts[palletKey] = (parts[palletKey] || 0) + pallets * 36; // Stückbasis\n          }\n          parts[pieceKey] = remainder;\n        }\n      } catch (e) {}\n\n      const entries = Object.entries(parts).filter(([,v]) => v > 0);\n      if (!entries.length) {\n        if (this.listHolder) {\n        this.listHolder.style.display = 'none';\n        }\n        return;\n      }\n      if (this.listHolder) {\n      this.listHolder.style.display = 'block';\n      }\n      if (this.prodList) {\n        // Performance: Reduziere DOM-Manipulation\n        const fragment = document.createDocumentFragment();\n        entries.forEach(([k,v]) => {\n        const packs = Math.ceil(v / VE[k]);\n          const price = getPackPriceForQuantity(k, v);\n          const itemTotal = packs * price;\n          const div = document.createElement('div');\n          div.className = 'produkt-item';\n          \n          // Spezielle Behandlung für Erdungsband: Zeige Länge statt Anzahl\n          let itemDetails = `(${v})`;\n          let itemVE = `${VE[k]} Stück`;\n          if (k === 'Erdungsband' && this.erdungsbandtotal) {\n            itemDetails = `(${Number(this.erdungsbandtotal).toFixed(2)} cm)`;\n            itemVE = `600 cm`;\n          }\n          // Zusätzliche Formatierungen für bestimmte Zusatzprodukte\n          if (k === 'Solarkabel') {\n            itemVE = '100 m';\n          }\n          if (k === 'MC4_Stecker') {\n            itemVE = `${VE[k]} Stück`;\n          }\n          \n          div.innerHTML = `\n            <div class=\"item-left\">\n              <span class=\"item-quantity\">${packs}×</span>\n              <div class=\"item-info\">\n                <span class=\"item-name\">${PRODUCT_NAME_MAP[k] || k.replace(/_/g,' ')}</span>\n                <span class=\"item-ve\">${itemVE}</span>\n              </div>\n              <span class=\"item-details\">${itemDetails}</span>\n            </div>\n            <span class=\"item-price\">${itemTotal.toFixed(2).replace('.', ',')} €</span>\n          `;\n          fragment.appendChild(div);\n        });\n        this.prodList.innerHTML = '';\n        this.prodList.appendChild(fragment);\n      this.prodList.style.display = 'block';\n      }\n      \n      // Gesamtpreis sofort aktualisieren nach Produktliste-Update\n      this.updateCurrentTotalPrice();\n      \n      } catch (error) {\n        // Fallback: Verstecke Liste bei Fehler\n        if (this.listHolder) {\n          this.listHolder.style.display = 'none';\n        }\n      }\n    }\n    \n    resetGridToDefault() {\n  \t\tconst { cols, rows, width, height } = this.default;\n\n  \t\t// Setze Inputs und interne Werte\n  \t\tthis.wIn.value = width;\n  \t\tthis.hIn.value = height;\n  \t\t\n  \t\t// Setze Orientierung auf Standard (vertikal als Standard)\n\t\tconst defaultVertical = true; // Vertikal als Standard\n\t\tif (this.orH) this.orH.checked = !defaultVertical;\n\t\tif (this.orV) this.orV.checked = defaultVertical;\n\t\t\n\t\t// Synchronisiere Setup-Container Radio-Buttons\n\t\tconst orientHSetup = document.getElementById('orient-h-setup');\n\t\tconst orientVSetup = document.getElementById('orient-v-setup');\n\t\tif (orientHSetup && orientVSetup) {\n\t\t\torientHSetup.checked = !defaultVertical;\n\t\t\torientVSetup.checked = defaultVertical;\n\t\t}\n\n\t\t// Setze alle Checkboxen zurück für neue Konfiguration\n\t\tif (this.incM) this.incM.checked = false;\n\t\tif (this.mc4) this.mc4.checked = false;\n\t\tif (this.solarkabel) this.solarkabel.checked = false;\n\t\tif (this.holz) this.holz.checked = false;\n\t\tif (this.quetschkabelschuhe) this.quetschkabelschuhe.checked = false;\n\t\tif (this.erdungsband) this.erdungsband.checked = false;\n\t\tif (this.ulicaModule) this.ulicaModule.checked = false;\n\t\t// Optimierer (Huawei/BRC) und Menge zurücksetzen\n\t\ttry {\n\t\t\tconst hCb = document.getElementById('huawei-opti');\n\t\t\tconst bCb = document.getElementById('brc-opti');\n\t\t\tconst qEl = document.getElementById('opti-qty');\n\t\t\tif (hCb) { hCb.checked = false; hCb.dispatchEvent(new Event('change')); }\n\t\t\tif (bCb) { bCb.checked = false; bCb.dispatchEvent(new Event('change')); }\n\t\t\tif (qEl) qEl.value = '1';\n\t\t} catch (_) {}\n\t\t\n\t\t// Module Dropdown auf Default zurücksetzen\n\t\tif (this.moduleSelect) {\n\t\t\tthis.moduleSelect.value = '';\n\t\t\tthis.enableInputs();\n\t\t}\n\n  \t\tthis.cols = cols;\n  \t\tthis.rows = rows;\n\n  \t\t// Leere Auswahl - alle Module abwählen\n  \t\tthis.selection = Array.from({ length: this.rows }, () =>\n    \t\tArray.from({ length: this.cols }, () => false)\n  \t\t);\n\n  \t\t// Aktualisiere alles\n  \t\tthis.setup();\n  \t\tthis.buildGrid();\n  \t\tthis.buildList();\n  \t\tthis.updateSummaryOnChange();\n\t\t}\n    \n    resetToDefaultGrid() {\n\t\tif (this.colsIn) this.colsIn.value = this.default.cols;\n\t\tif (this.rowsIn) this.rowsIn.value = this.default.rows;\n\t\tif (this.wIn) this.wIn.value = this.default.width;\n\t\tif (this.hIn) this.hIn.value = this.default.height;\n\t\tif (this.orH) this.orH.checked = false;\n\t\tif (this.orV) this.orV.checked = true;\n\n  \t\t// Setze cols/rows synchron\n  \t\tthis.cols = this.default.cols;\n  \t\tthis.rows = this.default.rows;\n\n  \t\t// Leere Auswahl\n  \t\tthis.selection = Array.from({ length: this.rows }, () =>\n    \t\tArray.from({ length: this.cols }, () => false)\n  \t\t);\n\n  \t\tthis.setup(); // jetzt stimmt alles beim Rebuild\n\t\t}\n    async calculateParts() {\n      // Verwende immer den Fallback für Tellerkopfschraube-Berechnung\n      return this.calculatePartsSync();\n    }\n\n    // Fallback synchrone Berechnung (ursprüngliche Methode)\n    calculatePartsSync() {\n  \t\tconst p = {\n    \t\tSolarmodul: 0, UlicaSolarBlackJadeFlow: 0, Endklemmen: 0, Mittelklemmen: 0,\n    \t\tDachhaken: 0, Schrauben: 0, Endkappen: 0,\n    \t\tSchienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0,\n    \t\tErdungsband: 0\n  \t\t};\n\n  \t\tfor (let y = 0; y < this.rows; y++) {\n    \t\tif (!Array.isArray(this.selection[y])) continue;\n    \t\tlet run = 0;\n\n    \t\tfor (let x = 0; x < this.cols; x++) {\n      \t\tif (this.selection[y]?.[x]) run++;\n      \t\telse if (run) { this.processGroup(run, p); run = 0; }\n    \t\t}\n    \t\tif (run) this.processGroup(run, p);\n  \t\t}\n\n\t\t// Erdungsband-Berechnung nur wenn gewünscht\n\t\tif (this.erdungsband && this.erdungsband.checked) {\n\t\t\tp.Erdungsband = this.calculateErdungsband();\n\t\t}\n\n\t\t// Tellerkopfschrauben global berechnen: 2 × Dachhaken (entspricht früherer Gruppenformel)\n\t\tp.Tellerkopfschraube = (p.Dachhaken || 0) * 2;\n\n\t\treturn p;\n\t\t}\n    processGroup(len, p) {\n      // Verwende die korrekte Schienenlogik (wie im Worker)\n      const isVertical = this.orV?.checked;\n      const actualCellWidth = isVertical ? parseFloat(this.hIn?.value || '113') : parseFloat(this.wIn?.value || '179');\n      \n      const totalLen = len * actualCellWidth;\n      const floor360 = Math.floor(totalLen / 360);\n      const rem360 = totalLen - floor360 * 360;\n      const floor240 = Math.ceil(rem360 / 240);\n      const pure360 = Math.ceil(totalLen / 360);\n      const pure240 = Math.ceil(totalLen / 240);\n      \n      const variants = [\n        {cnt360: floor360, cnt240: floor240},\n        {cnt360: pure360,  cnt240: 0},\n        {cnt360: 0,        cnt240: pure240}\n      ].map(v => ({\n        ...v,\n        rails: v.cnt360 + v.cnt240,\n        waste: v.cnt360 * 360 + v.cnt240 * 240 - totalLen\n      }));\n      \n      const minRails = Math.min(...variants.map(v => v.rails));\n      const best = variants\n        .filter(v => v.rails === minRails)\n        .reduce((a, b) => a.waste <= b.waste ? a : b);\n      \n      const {cnt360, cnt240} = best;\n      \n      p.Schiene_360_cm     += cnt360 * 2;\n      p.Schiene_240_cm     += cnt240 * 2;\n      p.Schienenverbinder  += (cnt360 + cnt240 - 1) * 4;\n      p.Endklemmen         += 4;\n      p.Mittelklemmen      += len > 1 ? (len - 1) * 2 : 0;\n      p.Dachhaken          += len > 1 ? len * 3 : 4;\n      p.Endkappen          += 4; // Gleich wie Endklemmen\n      p.Solarmodul         += len;\n      if (this.ulicaModule && this.ulicaModule.checked) {\n        p.UlicaSolarBlackJadeFlow += len;\n      }\n      p.Schrauben          += len > 1 ? len * 3 : 4; // Basierend auf Dachhaken\n      // Tellerkopfschrauben nur einmal global berechnen, nicht pro Reihe additiv – hier kein Zuwachs\n      p.Tellerkopfschraube += 0;\n    }\n\n    mapImage(key) {\n      // Verwende zentrale Produkt-Konfiguration oder Fallback\n      return PRODUCT_IMAGES[key] || '';\n    }\n\n    // Erdungsband-Berechnung\n    calculateErdungsband() {\n      const isVertical = this.orV?.checked;\n      const moduleHeight = isVertical ? parseFloat(this.wIn?.value || '179') : parseFloat(this.hIn?.value || '113');\n      const gap = 2; // 2cm Lücke zwischen Modulen\n      \n      // Kopiere selection Matrix für Erdungsbandlength-Tracking\n      const erdungsbandMatrix = this.selection.map(row => [...row]);\n      \n      let erdungsbandtotal = 0;\n      \n      // Analysiere Grid von oben nach unten, links nach rechts\n      for (let y = 0; y < this.rows; y++) {\n        for (let x = 0; x < this.cols; x++) {\n          const result = this.analyzeFieldForErdungsband(x, y, erdungsbandMatrix, moduleHeight, gap);\n          erdungsbandtotal += result;\n        }\n      }\n      \n      // Speichere Erdungsbandtotal für Display\n      this.erdungsbandtotal = erdungsbandtotal;\n      \n      // Berechne Anzahl benötigter Erdungsbänder\n      return Math.ceil(erdungsbandtotal / 600);\n    }\n\n    // Analysiere ein Feld für Erdungsband\n    analyzeFieldForErdungsband(x, y, erdungsbandMatrix, moduleHeight, gap) {\n      // Schritt 1: Hat das Feld ein Modul?\n      if (!erdungsbandMatrix[y]?.[x]) {\n        return 0; // Kein Modul, nächstes Feld\n      }\n      \n      // Schritt 2: Hat das Modul ein weiteres Modul direkt darunter?\n      if (y + 1 >= this.rows || !erdungsbandMatrix[y + 1]?.[x]) {\n        return 0; // Kein Modul darunter, nächstes Feld\n      }\n      \n      // Schritt 3: Ist links vom aktuellen Feld ein weiteres Feld mit Modul?\n      if (x === 0 || !erdungsbandMatrix[y]?.[x - 1]) {\n        // Kein Modul links → Erdungsbandlength für aktuelles Feld + Feld darunter\n        return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n      }\n      \n      // Schritt 4: Hat das linke Feld ein Modul darunter?\n      if (y + 1 >= this.rows || !erdungsbandMatrix[y + 1]?.[x - 1]) {\n        // Kein Modul unter dem linken Feld → Erdungsbandlength für aktuelles Feld + Feld darunter\n        return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n      }\n      \n      // Schritt 5: Haben die beiden linken Felder bereits Erdungsbandlength?\n      return this.checkLeftFieldsErdungsband(x, y, erdungsbandMatrix, moduleHeight, gap);\n    }\n\n    // Prüfe linke Felder auf Erdungsbandlength\n    checkLeftFieldsErdungsband(x, y, erdungsbandMatrix, moduleHeight, gap) {\n      const leftUpper = erdungsbandMatrix[y]?.[x - 1];\n      const leftLower = erdungsbandMatrix[y + 1]?.[x - 1];\n      \n      if (leftUpper && leftLower) {\n        // Beide haben Module → Prüfe ob sie bereits Erdungsbandlength haben\n        if (leftUpper === 'erdungsband' && leftLower === 'erdungsband') {\n          // Beide haben Erdungsbandlength → Nichts tun\n          return 0;\n        } else if (leftUpper === 'erdungsband' && leftLower !== 'erdungsband') {\n          // Nur das obere hat Erdungsbandlength → Erdungsbandlength für aktuelles Feld + Feld darunter\n          return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n        } else {\n          // Keine Erdungsbandlength links → Rekursiv weiter links prüfen\n          return this.checkLeftFieldsRecursive(x, y, erdungsbandMatrix, moduleHeight, gap);\n        }\n      } else if (leftUpper && !leftLower) {\n        // Nur oberes Feld hat Modul → Erdungsbandlength für aktuelles Feld + Feld darunter\n        return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n      } else {\n        // Keine Module links → Erdungsbandlength für aktuelles Feld + Feld darunter\n        return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n      }\n    }\n\n    // Rekursiv weiter links prüfen\n    checkLeftFieldsRecursive(x, y, erdungsbandMatrix, moduleHeight, gap) {\n      let checkX = x - 2; // Ein Feld weiter links\n      \n      while (checkX >= 0) {\n        // Schritt 3: Hat das Feld links ein Modul?\n        if (!erdungsbandMatrix[y]?.[checkX]) {\n          // Kein Modul links → Erdungsbandlength für aktuelles Feld + Feld darunter\n          return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n        }\n        \n        // Schritt 4: Hat das linke Feld ein Modul darunter?\n        if (y + 1 >= this.rows || !erdungsbandMatrix[y + 1]?.[checkX]) {\n          // Kein Modul unter dem linken Feld → Erdungsbandlength für aktuelles Feld + Feld darunter\n          return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n        }\n        \n        // Schritt 5: Haben die beiden linken Felder bereits Erdungsbandlength?\n        const leftUpper = erdungsbandMatrix[y]?.[checkX];\n        const leftLower = erdungsbandMatrix[y + 1]?.[checkX];\n        \n        if (leftUpper === 'erdungsband' && leftLower === 'erdungsband') {\n          // Beide haben Erdungsbandlength → Nichts tun\n          return 0;\n        } else if (leftUpper === 'erdungsband' && leftLower !== 'erdungsband') {\n          // Nur das obere hat Erdungsbandlength → Erdungsbandlength für aktuelles Feld + Feld darunter\n          return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n        } else {\n          // Keine Erdungsbandlength → Weiter nach links\n          checkX--;\n          continue;\n        }\n      }\n      \n      // Keine Module mehr links → Erdungsbandlength für aktuelles Feld + Feld darunter\n      return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n    }\n\n    // Weise Erdungsbandlength zu\n    assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap) {\n      // Prüfe ob aktuelles Feld bereits Erdungsbandlength hat\n      const currentFieldHasErdungsband = erdungsbandMatrix[y][x] === 'erdungsband';\n      \n      if (currentFieldHasErdungsband) {\n        // Nur das Feld darunter markieren\n        erdungsbandMatrix[y + 1][x] = 'erdungsband';\n        // Berechne Erdungsbandlength: 1 × Modul-Höhe + Gap\n        return moduleHeight + gap;\n      } else {\n        // Beide Felder markieren\n        erdungsbandMatrix[y][x] = 'erdungsband';\n        erdungsbandMatrix[y + 1][x] = 'erdungsband';\n        // Berechne Erdungsbandlength: 2 × Modul-Höhe + Gap\n        return 2 * moduleHeight + gap;\n      }\n    }\n\n\n\n\n\n\n    \n    loadConfig(idx) {\n  \t\tconst cfg = this.configs[idx];\n  \t\tthis.currentConfig = idx;\n\n  \t\t// Input-Werte setzen\n\t\t\tthis.wIn.value = cfg.cellWidth;\n\t\t\tthis.hIn.value = cfg.cellHeight;\n\t\t\tthis.orV.checked = cfg.orientation === 'vertical';\n\t\t\tthis.orH.checked = !this.orV.checked;\n\t\t\t\n\t\t\t// Synchronisiere mit den Orientation Buttons\n\t\t\tthis.syncOrientationButtons();\n  \t\tthis.incM.checked = cfg.incM;\n\t\t\tthis.mc4.checked = cfg.mc4;\n\t\t\tthis.solarkabel.checked = cfg.solarkabel || false; // Fallback für alte Konfigurationen\n  \t\tthis.holz.checked = cfg.holz;\n\t\t\tthis.quetschkabelschuhe.checked = cfg.quetschkabelschuhe || false; // Fallback für alte Konfigurationen\n\t\t\tif (this.kabelbinder) this.kabelbinder.checked = cfg.kabelbinder || false; // Fallback für alte Konfigurationen\n\t\t\tif (this.erdungsband) this.erdungsband.checked = cfg.erdungsband || false; // Fallback für alte Konfigurationen\n\t\t\tif (this.ulicaModule) this.ulicaModule.checked = cfg.ulicaModule || false; // Fallback für alte Konfigurationen\n\n\t\t\t// STATE Werte setzen - WICHTIG: Vor setup() setzen\n\t\t\tthis.cols = cfg.cols;\n\t\t\tthis.rows = cfg.rows;\n\t\t\tthis.selection = cfg.selection.map(r => [...r]);\n\n\t\t\t// Setup aufrufen (baut Grid mit korrekter Auswahl auf)\n\t\t\tthis.setup();\n\n\t\t\t// Produktliste und Summary aktualisieren\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\n\t\t\tthis.renderConfigList();\n\t\t\tthis.updateSaveButtons();\n\t\t\t\n\t\t\t// Detail-Ansicht aktualisieren wenn aktiv\n\t\t\tthis.updateDetailView();\n\t\t}\n\t\t\n\t\t// Spezielle Funktion für Cache-Load ohne Orientation-Überschreibung\n\t\tloadConfigFromCache(idx) {\n\t\t\tconst cfg = this.configs[idx];\n\t\t\tthis.currentConfig = idx;\n\n\t\t\t// Input-Werte setzen (OHNE Orientation)\n\t\t\tthis.wIn.value = cfg.cellWidth;\n\t\t\tthis.hIn.value = cfg.cellHeight;\n\t\t\t// Wichtig: UI-Orientation strikt aus der Konfiguration setzen (damit buildGrid korrekt rendert)\n\t\t\tif (this.orV && this.orH && typeof cfg.orientation === 'string') {\n\t\t\t\tthis.orV.checked = cfg.orientation === 'vertical';\n\t\t\t\tthis.orH.checked = !this.orV.checked;\n\t\t\t\tthis.syncOrientationButtons?.();\n\t\t\t}\n\t\t\t\n\t\t\tthis.incM.checked = cfg.incM;\n\t\t\tthis.mc4.checked = cfg.mc4;\n\t\t\tthis.solarkabel.checked = cfg.solarkabel || false;\n\t\t\tthis.holz.checked = cfg.holz;\n\t\t\tthis.quetschkabelschuhe.checked = cfg.quetschkabelschuhe || false;\n\t\t\tif (this.kabelbinder) this.kabelbinder.checked = cfg.kabelbinder || false;\n\t\t\tif (this.erdungsband) this.erdungsband.checked = cfg.erdungsband || false;\n\t\t\tif (this.ulicaModule) this.ulicaModule.checked = cfg.ulicaModule || false;\n\n  \t\t// STATE Werte setzen\n  \t\tthis.cols = cfg.cols;\n  \t\tthis.rows = cfg.rows;\n  \t\tthis.selection = cfg.selection.map(r => [...r]);\n\n\t\t\t// Setup aufrufen\n  \t\tthis.setup();\n\n\t\t\t// Produktliste und Summary aktualisieren\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\n  \t\tthis.renderConfigList();\n  \t\tthis.updateSaveButtons();\n\t\t\t\n\t\t\t// Detail-Ansicht aktualisieren wenn aktiv\n\t\t\tthis.updateDetailView();\n\t\t}\n\t\t\n\t\t// Spezielle Funktion für Cache-Load der ersten Konfiguration mit korrekter Orientation\n\t\tloadFirstConfigFromCache() {\n\t\t\tif (this.configs.length === 0) return;\n\t\t\t\n\t\t\tconst cfg = this.configs[0];\n\t\t\tthis.currentConfig = 0;\n\n\t\t\t// Input-Werte setzen\n\t\t\tthis.wIn.value = cfg.cellWidth;\n\t\t\tthis.hIn.value = cfg.cellHeight;\n\t\t\t// Wichtig: UI-Orientation strikt aus der Konfiguration setzen (damit buildGrid korrekt rendert)\n\t\t\tif (this.orV && this.orH && typeof cfg.orientation === 'string') {\n\t\t\t\tthis.orV.checked = cfg.orientation === 'vertical';\n\t\t\t\tthis.orH.checked = !this.orV.checked;\n\t\t\t\tthis.syncOrientationButtons?.();\n\t\t\t}\n\t\t\t\n\t\t\tthis.incM.checked = cfg.incM;\n\t\t\tthis.mc4.checked = cfg.mc4;\n\t\t\tthis.solarkabel.checked = cfg.solarkabel || false;\n\t\t\tthis.holz.checked = cfg.holz;\n\t\t\tthis.quetschkabelschuhe.checked = cfg.quetschkabelschuhe || false;\n\t\t\tif (this.erdungsband) this.erdungsband.checked = cfg.erdungsband || false;\n\t\t\tif (this.ulicaModule) this.ulicaModule.checked = cfg.ulicaModule || false;\n\n\t\t\t// STATE Werte setzen\n\t\t\tthis.cols = cfg.cols;\n\t\t\tthis.rows = cfg.rows;\n\t\t\tthis.selection = cfg.selection.map(r => [...r]);\n\n\t\t\t// Setup aufrufen\n\t\t\tthis.setup();\n\n\t\t\t// Produktliste und Summary aktualisieren\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\n\t\t\tthis.renderConfigList();\n\t\t\tthis.updateSaveButtons();\n\t\t\t\n\t\t\t// Detail-Ansicht aktualisieren wenn aktiv\n\t\t\tthis.updateDetailView();\n\t\t}\n\t\t\n\t\t// Funktion um die erste Konfiguration mit der globalen Orientation zu aktualisieren\n\t\tupdateFirstConfigOrientation(globalOrientation) {\n\t\t\tif (this.configs.length > 0) {\n\t\t\t\tthis.configs[0].orientation = globalOrientation;\n\t\t\t}\n\t\t}\n    \n    \t\tshowToast(message = 'Gespeichert', duration = 1500) {\n  \t\tconst toast = document.getElementById('toast');\n  \t\tif (!toast) return;\n  \t\ttoast.textContent = message;\n  \t\ttoast.classList.remove('hidden');\n\n  \t\tclearTimeout(this.toastTimeout);\n  \t\tthis.toastTimeout = setTimeout(() => {\n    \t\ttoast.classList.add('hidden');\n  \t\t}, duration);\n\t\t}\n\n    saveNewConfig(customName = null) {\n  \t\t// 1. Aktuelle Auswahl in der vorherigen Konfiguration speichern\n  \t\tif (this.currentConfig !== null) {\n  \t\t\tthis.updateConfig(); // Speichere aktuelle Änderungen in vorheriger Config\n  \t\t}\n  \t\t\n  \t\t// 2. Temporär currentConfig auf null setzen für neue Konfiguration\n  \t\tthis.currentConfig = null;\n\n      // 2a. Behalte aktuelle Maße der Module (wIn/hIn) und Grid-Dimensionen bei\n      //     – keine Rücksetzung auf Default-Werte\n      //     Grid-Orientierung setzen wir weiterhin auf vertikal als Start, falls gewünscht\n\t\t\tif (this.orH && this.orV) {\n\t\t\t\tthis.orH.checked = false;\n\t\t\t\tthis.orV.checked = true;\n\t\t\t\tthis.syncOrientationButtons?.();\n\t\t\t}\n  \t\t\n  \t\t// 3. Neue Konfiguration mit leerem Grid erstellen\n\t\t\tconst emptySelection = Array.from({ length: this.rows }, () =>\n  \t\t\tArray.from({ length: this.cols }, () => false)\n  \t\t);\n  \t\t\n  \t\t// 4. Aktuelle Auswahl temporär speichern und durch leere ersetzen\n  \t\tconst originalSelection = this.selection;\n  \t\tthis.selection = emptySelection;\n  \t\t\n  \t\tconst cfg = this._makeConfigObject(customName);\n  \t\tthis.configs.push(cfg);\n  \t\t\n    \t\t// 5. Neue Konfiguration auswählen und Grid neu aufbauen\n    \t\tthis.currentConfig = this.configs.length - 1;\n    \t\tthis.setup(); // Baut Grid mit leerer Auswahl neu auf\n\n    \t\t// Direkt zur Detail-Ansicht der neuen Konfiguration wechseln\n    \t\tthis.showDetailView(this.currentConfig);\n  \t\t\n  \t\tthis.renderConfigList();\n\t\tthis.updateConfigList(); // Config-Liste in Overview updaten\n  \t\tthis.updateSaveButtons();\n\t\t// 6. Detail-Ansicht aktualisieren wenn aktiv\n\t\tthis.updateDetailView();\n\t\t\n\t\tthis.showToast(`Neue Konfiguration \"${cfg.name}\" erstellt`);\n\t\t}\n\n    renameCurrentConfig(newName) {\n      if (this.currentConfig !== null && this.currentConfig >= 0 && this.currentConfig < this.configs.length) {\n        // Aktuelle Konfiguration umbenennen\n        this.configs[this.currentConfig].name = newName;\n        // Sofort DOM aktualisieren\n        const titleEl = document.getElementById('current-config-title');\n        if (titleEl) titleEl.textContent = newName;\n        if (this.configListEl) {\n          const items = this.configListEl.querySelectorAll('.config-item');\n          if (items && items[this.currentConfig]) {\n            const nameEl = items[this.currentConfig].querySelector('.config-item-name');\n            if (nameEl) nameEl.textContent = newName;\n          }\n        }\n        this.renderConfigList();\n        this.updateSaveButtons();\n        // Neu: Direkt in Cache sichern, damit der Name nach Reload erhalten bleibt\n        this.updateConfig();\n        this.saveToCache();\n        this.showAutoSaveIndicator();\n      }\n\t\t}\n\n    updateConfig() {\n      const idx = this.currentConfig;\n      this.configs[idx] = this._makeConfigObject();\n      this.renderConfigList();\n      this.updateSaveButtons();\n      // Gesamtpreis sofort aktualisieren nach Config-Update\n      this.updateCurrentTotalPrice();\n    }\n    \n    deleteConfig(configIndex) {\n  \t\tconst configName = this.configs[configIndex].name;\n  \t\tif (!confirm(`Willst du \"${configName}\" wirklich löschen?`)) return;\n\n  \t\tthis.configs.splice(configIndex, 1);\n  \t\t\n  \t\t// Nach dem Löschen: Wähle die nächste Konfiguration oder erstelle eine neue\n  \t\tif (this.configs.length > 0) {\n  \t\t\t// Wenn die gelöschte Konfiguration die aktuelle war\n  \t\t\tif (configIndex === this.currentConfig) {\n  \t\t\t\t// Wähle die nächste Konfiguration (oder die vorherige wenn es die letzte war)\n  \t\t\t\tconst newIndex = Math.min(configIndex, this.configs.length - 1);\n  \t\t\t\tthis.loadConfig(newIndex);\n  \t\t\t} else if (configIndex < this.currentConfig) {\n  \t\t\t\t// Eine Konfiguration vor der aktuellen wurde gelöscht, Index anpassen\n  \t\t\t\tthis.currentConfig--;\n  \t\t\t\tthis.renderConfigList();\n  \t\t\t} else {\n  \t\t\t\t// Eine Konfiguration nach der aktuellen wurde gelöscht, nur Liste neu rendern\n  \t\t\t\tthis.renderConfigList();\n  \t\t\t}\n  \t\t} else {\n  \t\t\t// Keine Konfigurationen mehr - erstelle eine neue\n  \t\t\tthis.createNewConfig();\n  \t\t}\n\n  \t\tthis.updateSaveButtons();\n\t\t}\n\n    createNewConfig() {\n      // Erstelle eine neue Konfiguration mit aktuellen Maßen und leerer Auswahl\n      this.currentConfig = null;\n      const keepCols = this.cols;\n      const keepRows = this.rows;\n      const emptySel = Array.from({ length: keepRows }, () => Array.from({ length: keepCols }, () => false));\n      const prevSel = this.selection;\n      this.selection = emptySel;\n      const newConfig = this._makeConfigObject();\n      this.configs.push(newConfig);\n      this.currentConfig = this.configs.length - 1;\n      this.setup(); // Grid mit leerer Auswahl neu aufbauen (Maße wIn/hIn bleiben unverändert)\n\n      this.renderConfigList();\n      this.updateSaveButtons();\n\t\t}\n    _makeConfigObject(customName = null) {\n      // Für neue Konfigurationen: Finde die nächste verfügbare Nummer\n      let configName;\n      if (customName) {\n        // Benutzerdefinierter Name\n        configName = customName;\n      } else if (this.currentConfig !== null) {\n        // Bestehende Konfiguration: Behalte den Namen\n        configName = this.configs[this.currentConfig].name;\n      } else {\n        // Neue Konfiguration: Finde nächste Nummer\n        let nextNumber = 1;\n        while (this.configs.some(cfg => cfg.name === `Konfiguration ${nextNumber}`)) {\n          nextNumber++;\n        }\n        configName = `Konfiguration ${nextNumber}`;\n      }\n      \n      return {\n        name:        configName,\n        selection:   this.selection.map(r => [...r]),\n        // Für neue Konfigurationen immer vertikal als Startzustand speichern\n        orientation: (this.orV && this.orV.checked) ? 'vertical' : 'horizontal',\n        incM:        this.incM && this.incM.checked,\n        mc4:         this.mc4 && this.mc4.checked,\n        solarkabel:  this.solarkabel && this.solarkabel.checked,\n        holz:        this.holz && this.holz.checked,\n        quetschkabelschuhe: this.quetschkabelschuhe && this.quetschkabelschuhe.checked,\n        kabelbinder: this.kabelbinder && this.kabelbinder.checked,\n        erdungsband: this.erdungsband ? this.erdungsband.checked : false,\n        ulicaModule: this.ulicaModule ? this.ulicaModule.checked : false,\n        cols:        this.cols,\n        rows:        this.rows,\n        cellWidth:   parseFloat(this.wIn ? this.wIn.value : '179'),\n        cellHeight:  parseFloat(this.hIn ? this.hIn.value : '113')\n      };\n    }\n\n    renderConfigList() {\n      // Verwende das gleiche HTML-Design wie updateConfigList()\n  \t\tthis.configListEl.innerHTML = '';\n      \n  \t\tthis.configs.forEach((cfg, idx) => {\n    \t\tconst div = document.createElement('div');\n    \t\tdiv.className = 'config-item' + (idx === this.currentConfig ? ' active' : '');\n        \n        const totalPrice = this.calculateConfigPrice(cfg);\n        const canDelete = this.configs.length >= 2;\n        \n        div.innerHTML = `\n          <div class=\"config-item-info\">\n            <div class=\"config-item-name\">${cfg.name || `Konfiguration #${idx + 1}`}</div>\n            <div class=\"config-item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</div>\n          </div>\n          <div class=\"config-item-actions\">\n            <button class=\"icon-btn\" onclick=\"solarGrid.editConfigNameInList(${idx})\" title=\"Bearbeiten\">\n              <img src=\"https://cdn.prod.website-files.com/68498852db79a6c114f111ef/689369877a18221f25a4b743_Pen.png\" alt=\"Bearbeiten\" style=\"width: 16px; height: 16px;\">\n            </button>\n            ${canDelete ? `\n            <button class=\"icon-btn delete\" onclick=\"solarGrid.deleteConfigFromList(${idx})\" title=\"Löschen\">\n              <img src=\"https://cdn.prod.website-files.com/68498852db79a6c114f111ef/68936c5481f2a4db850a01f5_Trashbin.png\" alt=\"Löschen\" style=\"width: 16px; height: 16px;\">\n            </button>` : ''}\n            <div class=\"config-item-arrow\">\n              <img src=\"https://cdn.prod.website-files.com/68498852db79a6c114f111ef/68936986bd441749c46190e8_ChevronRight.png\" alt=\"Pfeil\" style=\"width: 10px; height: 16px;\">\n            </div>\n          </div>\n        `;\n        \n        div.addEventListener('click', (e) => {\n          // Verhindere Klick wenn auf Action-Button geklickt wurde\n          if (e.target.closest('.config-item-actions')) return;\n          \n          // Auto-Save der aktuellen Konfiguration vor dem Wechsel\n          if (this.currentConfig !== null && this.currentConfig !== idx) {\n    \t\t\t\tthis.updateConfig();\n  \t\t\t\t}\n          \n          // Wechsle immer in die Detail-Ansicht der gewählten Konfiguration\n          this.showDetailView(idx);\n          this.showToast('Konfiguration geladen', 1000);\n        });\n        \n    \t\tthis.configListEl.appendChild(div);\n  \t\t});\n\t\t}\n\n    // Performance: Schnellerer Array-Vergleich\n    arraysEqual(a, b) {\n      if (a.length !== b.length) return false;\n      for (let i = 0; i < a.length; i++) {\n        if (a[i].length !== b[i].length) return false;\n        for (let j = 0; j < a[i].length; j++) {\n          if (a[i][j] !== b[i][j]) return false;\n        }\n      }\n      return true;\n    }\n\n    updateSummaryOnChange() {\n      // Performance: Debounced Updates\n      if (this.updateTimeout) {\n        clearTimeout(this.updateTimeout);\n      }\n      \n      this.updateTimeout = setTimeout(async () => {\n        // FEATURE 5: Performance-Monitoring - Update Time\n        const startTime = performance.now();\n        \n        // Auto-Save Indicator anzeigen\n        this.showAutoSaveIndicator();\n        \n        // Detail-Ansicht aktualisieren falls aktiv\n        if (document.getElementById('config-detail-view')?.classList.contains('active')) {\n          this.updateDetailView();\n        }\n        \n        // Maße aus Inputs stets in aktuelle Config spiegeln\n        try {\n          if (this.currentConfig !== null && this.configs[this.currentConfig]) {\n            this.configs[this.currentConfig].cellWidth = parseFloat(this.wIn ? this.wIn.value : '179');\n            this.configs[this.currentConfig].cellHeight = parseFloat(this.hIn ? this.hIn.value : '113');\n            this.configs[this.currentConfig].cols = this.cols;\n            this.configs[this.currentConfig].rows = this.rows;\n          }\n        } catch(_) {}\n\n        // Totals neu berechnen und persistieren (debounced Kontext)\n        try { this.recomputeTotalsDebounced && this.recomputeTotalsDebounced(); } catch(_) {}\n        // Zusätzlich: aktuellen State sofort in den Cache schreiben (kein alter Merge)\n        try {\n          const snap = this.totalPartsCache || this.computeAllTotalsSnapshot();\n          this.saveTotalsToCache(snap);\n        } catch(_) {}\n        \n        // Gesamtpreis aktualisieren (NACH Cache-Update)\n        this.updateCurrentTotalPrice();\n        this.updateOverviewTotalPrice();\n        \n        // Update config-list und overview wenn eine Konfiguration ausgewählt ist\n        if (this.currentConfig !== null) {\n          // Speichere die Konfiguration automatisch\n          this.updateConfig();\n          this.updateConfigList();\n        }\n        \n        // Automatisches Cache-Speichern bei jeder Änderung\n        this.saveToCache();\n        \n        this.performanceMetrics.updateTime = performance.now() - startTime;\n        this.updateTimeout = null;\n      }, this.updateDelay);\n    }\n\n\n\n\t\t// ISOLIERTE synchrone Berechnung für Fallback\n\t\tcalculatePartsDirectly(data) {\n\t\t\tconst { selection, rows, cols, cellWidth, cellHeight, orientation, options } = data;\n\t\t\tconst ulicaModule = options?.ulicaModule === true;\n\t\t\tconst parts = {\n\t\t\t\tSolarmodul: 0, UlicaSolarBlackJadeFlow: 0, Endklemmen: 0, Mittelklemmen: 0,\n\t\t\t\tDachhaken: 0, Schrauben: 0, Endkappen: 0,\n\t\t\t\tSchienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0\n\t\t\t};\n\n\t\t\tfor (let y = 0; y < rows; y++) {\n\t\t\t\tif (!Array.isArray(selection[y])) continue;\n\t\t\t\tlet run = 0;\n\n\t\t\t\tfor (let x = 0; x < cols; x++) {\n\t\t\t\t\tif (selection[y]?.[x]) {\n\t\t\t\t\t\trun++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (run) { \n\t\t\t\t\t\tthis.processGroupDirectly(run, parts, cellWidth, cellHeight, orientation, ulicaModule); \n\t\t\t\t\t\trun = 0; \n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (run) {\n\t\t\t\t\tthis.processGroupDirectly(run, parts, cellWidth, cellHeight, orientation, ulicaModule);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn parts;\n\t\t}\n\n\t\t// FALLBACK: Kopie der Worker-Berechnung\n\t\tprocessGroupDirectly(len, parts, cellWidth, cellHeight, orientation, ulicaModule = false) {\n\t\t\tconst isVertical = orientation === 'vertical';\n\t\t\tconst actualCellWidth = isVertical ? cellHeight : cellWidth;\n\t\t\t\n\t\t\tconst totalLen = len * actualCellWidth;\n\t\t\tconst floor360 = Math.floor(totalLen / 360);\n\t\t\tconst rem360 = totalLen - floor360 * 360;\n\t\t\tconst floor240 = Math.ceil(rem360 / 240);\n\t\t\tconst pure360 = Math.ceil(totalLen / 360);\n\t\t\tconst pure240 = Math.ceil(totalLen / 240);\n\t\t\t\n\t\t\tconst variants = [\n\t\t\t\t{cnt360: floor360, cnt240: floor240},\n\t\t\t\t{cnt360: pure360,  cnt240: 0},\n\t\t\t\t{cnt360: 0,        cnt240: pure240}\n\t\t\t].map(v => ({\n\t\t\t\t...v,\n\t\t\t\trails: v.cnt360 + v.cnt240,\n\t\t\t\twaste: v.cnt360 * 360 + v.cnt240 * 240 - totalLen\n\t\t\t}));\n\t\t\t\n\t\t\tconst minRails = Math.min(...variants.map(v => v.rails));\n\t\t\tconst best = variants\n\t\t\t\t.filter(v => v.rails === minRails)\n\t\t\t\t.reduce((a, b) => a.waste <= b.waste ? a : b);\n\t\t\t\n\t\t\tconst {cnt360, cnt240} = best;\n\t\t\t\n\t\t\tparts.Schiene_360_cm     += cnt360 * 2;\n\t\t\tparts.Schiene_240_cm     += cnt240 * 2;\n\t\t\tparts.Schienenverbinder  += (cnt360 + cnt240 - 1) * 4;\n\t\t\tparts.Endklemmen         += 4;\n\t\t\tparts.Mittelklemmen      += len > 1 ? (len - 1) * 2 : 0;\n\t\t\tparts.Dachhaken          += len > 1 ? len * 3 : 4;\n\t\t\tparts.Endkappen          += 4;  // Gleich wie Endklemmen\n\t\t\tparts.Solarmodul         += len;\n\t\t\t// UlicaSolarBlackJadeFlow hinzufügen wenn ulica-module Checkbox aktiviert ist\n\t\t\tif (ulicaModule) {\n\t\t\t\tparts.UlicaSolarBlackJadeFlow += len;\n\t\t\t}\n\t\t\t// Schrauben basierend auf Dachhaken berechnen\n\t\t\tparts.Schrauben          += len > 1 ? len * 3 : 4; // Basierend auf Dachhaken\n\t\t\tparts.Tellerkopfschraube += len > 1 ? (len * 3) * 2 : 8; // Basierend auf Dachhaken * 2\n\t\t}\n    resetAllConfigurations() {\n    \t// Bestätigungsabfrage\n    \tif (!confirm('Möchten Sie wirklich alle Konfigurationen löschen und von vorne anfangen?')) {\n        return;\n      }\n      \n    \t// Cache löschen\n    \tthis.cacheManager.clearCache();\n    \t\n    \t// Alle Konfigurationen löschen\n    \tthis.configs = [];\n    \tthis.currentConfig = null;\n    \t\n    \t// Grid auf Default zurücksetzen\n    \tthis.cols = this.default.cols;\n    \tthis.rows = this.default.rows;\n    \tthis.selection = Array.from({ length: this.rows }, () =>\n    \t\tArray.from({ length: this.cols }, () => false)\n    \t);\n    \t\n    \t// Grid visuell aktualisieren - alle Module abwählen\n    \tthis.buildGrid();\n    \t\n    \t// Input-Felder auf Default zurücksetzen\n    \tif (this.wIn) this.wIn.value = this.default.width;\n    \tif (this.hIn) this.hIn.value = this.default.height;\n    \t\n    \t// Checkboxen auf Default zurücksetzen (ALLE abwählen)\n    \tif (this.incM) this.incM.checked = false;\n    \tif (this.mc4) this.mc4.checked = false;\n\t\t// Optimierer zurücksetzen\n\t\ttry {\n\t\t\tconst hCb = document.getElementById('huawei-opti');\n\t\t\tconst bCb = document.getElementById('brc-opti');\n\t\t\tconst qEl = document.getElementById('opti-qty');\n\t\t\tif (hCb) hCb.checked = false;\n\t\t\tif (bCb) bCb.checked = false;\n\t\t\tif (qEl) qEl.value = '1';\n\t\t} catch (_) {}\n    \tif (this.solarkabel) this.solarkabel.checked = false;\n    \tif (this.holz) this.holz.checked = false;\n    \tif (this.quetschkabelschuhe) this.quetschkabelschuhe.checked = false;\n    \tif (this.erdungsband) this.erdungsband.checked = false;\n    \tif (this.ulicaModule) this.ulicaModule.checked = false;\n    \t\n    \t// Module Dropdown auf Default zurücksetzen\n    \tif (this.moduleSelect) {\n    \t\tthis.moduleSelect.value = '';\n    \t\tthis.enableInputs();\n    \t}\n    \t\n    \t// Neue erste Konfiguration anlegen (Standard-Setup übernimmt Orientation)\n    \tthis.createNewConfig();\n\n    \t// Additional-Products visuell zurücksetzen\n    \ttry {\n    \t\tconst additionalProductsListEl = document.getElementById('additional-products-list');\n    \t\tif (additionalProductsListEl) additionalProductsListEl.innerHTML = '';\n    \t} catch(_) {}\n    \t\n    \t// Preise aktualisieren\n    \tthis.updateCurrentTotalPrice();\n    \tthis.updateOverviewTotalPrice && this.updateOverviewTotalPrice();\n    \t\n    \tthis.showToast('Alle Konfigurationen wurden zurückgesetzt', 2000);\n    }\n    \n    // NEUE FUNKTION: Speichere alle Konfigurationen und Einstellungen im Cache\n    saveToCache() {\n    \ttry {\n        // Memory: Cache Size Management - Begrenze Cache-Größe\n        this.manageCacheSize();\n        // Memory: Optimierte Clones - nur bei Bedarf deep-clonen\n        const deepCloneSelection = (sel) => {\n          if (!Array.isArray(sel)) return sel;\n          // Nur bei großen Arrays (>100 Zellen) deep-clonen, sonst shallow copy\n          const totalCells = sel.reduce((sum, row) => sum + (Array.isArray(row) ? row.length : 0), 0);\n          if (totalCells <= 100) return sel.slice(); // Shallow copy für kleine Arrays\n          \n          // Deep copy nur für große Arrays - aber optimiert\n          return sel.map(r => Array.isArray(r) ? r.slice() : r);\n        };\n        const deepCloneConfig = (cfg) => ({\n          ...cfg,\n          selection: deepCloneSelection(cfg.selection)\n        });\n        const cacheData = {\n          configs: Array.isArray(this.configs) ? this.configs.map(deepCloneConfig) : [],\n          currentConfig: this.currentConfig,\n          selection: deepCloneSelection(this.selection), // Aktuelle Grid-Auswahl\n    \t\t\t// Aktuelle Grid-Einstellungen\n    \t\t\tcols: this.cols,\n    \t\t\trows: this.rows,\n    \t\t\tcellWidth: parseInt(this.wIn ? this.wIn.value : '179', 10),\n    \t\t\tcellHeight: parseInt(this.hIn ? this.hIn.value : '113', 10),\n    \t\t\torientation: this.orV && this.orV.checked ? 'vertical' : 'horizontal',\n    \t\t\t\t\t\t// Checkbox-Einstellungen\n\t\t\tincludeModules: this.incM ? this.incM.checked : false,\n\t\t\tmc4: this.mc4 ? this.mc4.checked : false,\n\t\t\tsolarkabel: this.solarkabel ? this.solarkabel.checked : false,\n\t\t\tholz: this.holz ? this.holz.checked : false,\n\t\t\tquetschkabelschuhe: this.quetschkabelschuhe ? this.quetschkabelschuhe.checked : false,\n\t\t\terdungsband: this.erdungsband ? this.erdungsband.checked : false,\n\t\t\tulicaModule: this.ulicaModule ? this.ulicaModule.checked : false,\n\t\t\t// Opti-State (global)\n\t\t\thuaweiOpti: (document.getElementById('huawei-opti')?.checked) || false,\n\t\t\tbrcOpti: (document.getElementById('brc-opti')?.checked) || false,\n\t\t\toptiQty: parseInt(document.getElementById('opti-qty')?.value || '1', 10),\n\t\t\t// Module Dropdown Auswahl\n\t\t\tmoduleSelectValue: this.moduleSelect ? this.moduleSelect.value : '',\n    \t\t\t// Grid-Struktur\n    \t\t\tgridStructure: {\n    \t\t\t\tcols: this.cols,\n    \t\t\t\trows: this.rows,\n    \t\t\t\tcellWidth: parseInt(this.wIn ? this.wIn.value : '179', 10),\n    \t\t\t\tcellHeight: parseInt(this.hIn ? this.hIn.value : '113', 10)\n    \t\t\t}\n    \t\t};\n    \t\t\n    \t\t// Verwende CacheManager für bessere Performance und Error Handling\n        this.cacheManager.saveData(cacheData);\n    \t\t\n    \t\t// Zeige Auto-Save Indicator\n    \t\tthis.showAutoSaveIndicator();\n        } catch (error) {\n    \t\tconsole.error('Fehler beim Speichern des Caches:', error);\n    \t}\n    }\n    \n    // NEUE FUNKTION: Lade Konfigurationen aus dem Cache\n    loadFromCache() {\n    \ttry {\n    \t\t// Verwende CacheManager für bessere Error Handling\n    \t\tconst data = this.cacheManager.loadData();\n    \t\tif (!data) {\n    \t\t\tconsole.log('Kein Cache gefunden oder Cache abgelaufen');\n      return false;\n    }\n\n    \t\t// Prüfe localStorage Verfügbarkeit\n    \t\tif (!this.cacheManager.isLocalStorageAvailable()) {\n    \t\t\tthis.showToast('Es wurde nichts im Speicher gefunden', 3000);\n        return false;\n      }\n    \t\t\n    \t\t// Lade Konfigurationen\n        if (data.configs && Array.isArray(data.configs)) {\n          // Deep-Kopie beim Laden\n          const deepCloneSelection = (sel) => Array.isArray(sel) ? sel.map(r => Array.isArray(r) ? r.slice() : r) : sel;\n          const deepCloneConfig = (cfg) => ({\n            ...cfg,\n            selection: deepCloneSelection(cfg.selection)\n          });\n          this.configs = data.configs.map(deepCloneConfig);\n    \t\t\tthis.currentConfig = data.currentConfig;\n    \t\t\t\n    \t\t\t// Lade Grid-Auswahl\n        if (data.selection && Array.isArray(data.selection)) {\n          this.selection = data.selection.map(r => Array.isArray(r) ? r.slice() : r);\n    \t\t}\n    \t\t\t\n    \t\t\t// Lade Grid-Einstellungen\n    \t\t\tif (data.cols && data.rows) {\n    \t\t\t\tthis.cols = data.cols;\n    \t\t\t\tthis.rows = data.rows;\n    \t\t\t}\n    \t\t\t\n    \t\t\t// Lade Checkbox-Einstellungen\n    \t\t\tif (this.incM && typeof data.includeModules === 'boolean') {\n    \t\t\t\tthis.incM.checked = data.includeModules;\n    \t\t\t}\n    \t\t\tif (this.mc4 && typeof data.mc4 === 'boolean') {\n    \t\t\t\tthis.mc4.checked = data.mc4;\n    \t\t\t}\n    \t\t\tif (this.solarkabel && typeof data.solarkabel === 'boolean') {\n    \t\t\t\tthis.solarkabel.checked = data.solarkabel;\n    \t\t\t}\n    \t\t\tif (this.holz && typeof data.holz === 'boolean') {\n    \t\t\t\tthis.holz.checked = data.holz;\n    \t\t\t}\n    \t\t\tif (this.quetschkabelschuhe && typeof data.quetschkabelschuhe === 'boolean') {\n    \t\t\t\tthis.quetschkabelschuhe.checked = data.quetschkabelschuhe;\n    \t\t\t}\n    \t\t\tif (this.erdungsband && typeof data.erdungsband === 'boolean') {\n    \t\t\t\tthis.erdungsband.checked = data.erdungsband;\n    \t\t\t}\n    \t\t\t\t\t\tif (this.ulicaModule && typeof data.ulicaModule === 'boolean') {\n\t\t\t\tthis.ulicaModule.checked = data.ulicaModule;\n\t\t\t}\n\t\t\t\n\t\t\t// Opti-State laden (Checkboxen + Menge)\n\t\t\ttry {\n\t\t\t\tconst hCb = document.getElementById('huawei-opti');\n\t\t\t\tconst bCb = document.getElementById('brc-opti');\n\t\t\t\tconst qEl = document.getElementById('opti-qty');\n\t\t\t\tif (hCb && typeof data.huaweiOpti === 'boolean') hCb.checked = data.huaweiOpti;\n\t\t\t\tif (bCb && typeof data.brcOpti === 'boolean') bCb.checked = data.brcOpti;\n\t\t\t\tif (qEl && typeof data.optiQty === 'number') qEl.value = String(Math.max(1, data.optiQty));\n\t\t\t\tif (qEl) qEl.style.display = ((hCb && hCb.checked) || (bCb && bCb.checked)) ? '' : 'none';\n\t\t\t} catch (_) {}\n\t\t\t\n\t\t\t// Lade Module Dropdown Auswahl\n\t\t\tif (this.moduleSelect && typeof data.moduleSelectValue === 'string') {\n\t\t\t\tthis.moduleSelect.value = data.moduleSelectValue;\n\t\t\t\t// Wenn ein Modul ausgewählt ist, Inputs entsprechend sperren/freigeben\n\t\t\t\tif (data.moduleSelectValue && data.moduleSelectValue !== 'custom') {\n\t\t\t\t\tthis.disableInputs();\n\t\t\t\t} else {\n\t\t\t\t\tthis.enableInputs();\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Lade Grid-Dimensionen\n\t\t\tif (this.wIn && data.cellWidth) {\n\t\t\t\tthis.wIn.value = data.cellWidth;\n\t\t\t}\n\t\t\tif (this.hIn && data.cellHeight) {\n\t\t\t\tthis.hIn.value = data.cellHeight;\n\t\t\t}\n    \t\t\t\n\t\t\t// Lade die gewünschte Konfiguration aus dem Cache, ohne Orientation zu überschreiben\n\t\t\t// Lade die zuletzt aktive Konfiguration (Index aus Cache), aber orientiere UI strikt an dieser Config\n\t\t\tconst safeIndex = (Number.isInteger(data.currentConfig) && data.currentConfig >= 0 && data.currentConfig < this.configs.length)\n\t\t\t\t? data.currentConfig\n\t\t\t\t: 0;\n\t\t\tif (this.configs.length > 0) {\n\t\t\t\tthis.loadConfigFromCache(safeIndex);\n\t\t\t}\n    \t\t\t// Grid und UI nach dem Laden wiederherstellen\n    \t\t\tthis.setup(); // Grid-Event-Listener wiederherstellen\n    \t\t\tthis.buildGrid(); // Grid visuell wiederherstellen\n    \t\t\tthis.buildList(); // Produktliste wiederherstellen\n    \t\t\t\n    \t\t\t// Event-Listener für alle UI-Elemente wiederherstellen\n    \t\t\tthis.setupAllEventListeners();\n    \t\t\t\n    \t\t\t// Aktualisiere UI nach dem Laden\n    \t\t\tthis.updateConfigList();\n    \t\t\tthis.updateCurrentTotalPrice();\n    \t\t\tthis.updateOverviewTotalPrice();\n    \t\t\t\n    \t\t\tthis.showToast('Konfiguration aus Cache geladen', 2000);\n                return true;\n    \t\t}\n    \t} catch (error) {\n    \t\tconsole.error('Fehler beim Laden des Caches:', error);\n    \t\tthis.cacheManager.clearCache();\n    \t\tthis.showToast('Datei im Speicher ist beschädigt und konnte nicht geladen werden!', 3000);\n    \t}\n    \t\n    \treturn false;\n    }\n    \n        generateHiddenCartForms() {\n      const webflowForms = document.querySelectorAll('form[data-node-type=\"commerce-add-to-cart-form\"]');\n      this.webflowFormMap = {};\n      this.webflowFormMapBrutto = {};\n      \n      webflowForms.forEach((form) => {\n        const productId = form.getAttribute('data-commerce-product-id');\n        const skuId = form.getAttribute('data-commerce-sku-id');\n        \n        const productKey = Object.keys(PRODUCT_MAP).find(key => \n          PRODUCT_MAP[key].productId === productId || PRODUCT_MAP[key].variantId === skuId\n        );\n        \n        if (productKey) {\n          this.webflowFormMap[productKey] = form;\n        }\n\n        const bruttoKey = Object.keys(PRODUCT_MAP_BRUTTO || {}).find(key => {\n          const info = PRODUCT_MAP_BRUTTO[key];\n          return info && (info.productId === productId || info.variantId === skuId);\n        });\n        if (bruttoKey) {\n          this.webflowFormMapBrutto[bruttoKey] = form;\n        }\n      });\n      \n      this.hideWebflowForms();\n      // CartCompatibility-Check entfernt - nicht mehr benötigt mit Foxy.io\n    }\n\n    hideWebflowForms() {\n      // Immer ALLE Webflow Add-to-Cart Forms verstecken – auch wenn sie nicht im Konfigurator genutzt werden\n      const allForms = document.querySelectorAll('form[data-node-type=\"commerce-add-to-cart-form\"]');\n      allForms.forEach(form => {\n        if (form && form.style) {\n          form.style.cssText = `\n            position: absolute !important;\n            left: -9999px !important;\n            top: -9999px !important;\n            width: 1px !important;\n            height: 1px !important;\n            overflow: hidden !important;\n            clip: rect(0, 0, 0, 0) !important;\n            white-space: nowrap !important;\n            border: 0 !important;\n            margin: 0 !important;\n            padding: 0 !important;\n            visibility: hidden !important;\n          `;\n          form.setAttribute('aria-hidden', 'true');\n          form.setAttribute('tabindex', '-1');\n        }\n      });\n    }\n\n    // Foxy.io Formular-Mapping (CMS-Listen sind dynamisch)\n    initFoxyFormMap() {\n      this.foxyFormsByName = new Map();\n      let attemptsLeft = 15; // ~4,5s bei 300ms Intervall\n      const tryScan = () => {\n        this.refreshFoxyFormMap();\n        if (this.foxyFormsByName.size === 0 && attemptsLeft-- > 0) {\n          setTimeout(tryScan, 300);\n        }\n      };\n      tryScan();\n\n      try { this._foxyObserver && this._foxyObserver.disconnect(); } catch(_) {}\n      if (this.debounceTimer) {\n        clearTimeout(this.debounceTimer);\n        this.debounceTimer = null;\n      }\n      let lastMutationTime = 0;\n      const THROTTLE_MS = 100; // Throttling: max 1x pro 100ms\n      \n      const debounced = () => { \n        clearTimeout(this.debounceTimer); \n        this.debounceTimer = setTimeout(() => this.refreshFoxyFormMap(), 60); \n      };\n      \n      this._foxyObserver = new MutationObserver((mutations) => {\n        const now = Date.now();\n        if (now - lastMutationTime < THROTTLE_MS) {\n          return; // Throttling: zu früh, ignoriere\n        }\n        lastMutationTime = now;\n        \n        for (const m of mutations) {\n          if (m.addedNodes && m.addedNodes.length) { \n            debounced(); \n            break; \n          }\n        }\n      });\n      this._foxyObserver.observe(document.body, { childList: true, subtree: true });\n    }\n\n    refreshFoxyFormMap() {\n      const map = new Map();\n      const data = new Map();\n      const forms = document.querySelectorAll('form[action*=\"foxycart.com/cart\"]');\n      forms.forEach((form) => {\n        const getVal = (sel) => {\n          const el = form.querySelector(sel);\n          return el && typeof el.value === 'string' ? el.value.trim() : '';\n        };\n        const nameInput = form.querySelector('input[name=\"name\"]');\n        const val = nameInput && typeof nameInput.value === 'string' ? nameInput.value.trim() : '';\n        if (val) {\n          map.set(val, form);\n          data.set(val, {\n            name: val,\n            price: getVal('input[name=\"price\"]'),\n            code: getVal('input[name=\"code\"]'),\n            image: getVal('input[name=\"image\"]'),\n            url: getVal('input[name=\"url\"]'),\n            description: getVal('input[name=\"description\"]'),\n            weight: getVal('input[name=\"weight\"]'),\n            width: getVal('input[name=\"width\"]'),\n            height: getVal('input[name=\"height\"]'),\n            length: getVal('input[name=\"length\"]')\n          });\n        }\n      });\n      this.foxyFormsByName = map;\n      this.foxyDataByName = data;\n    }\n\n    findFoxyFormByName(name) {\n      const wanted = String(name || '').trim();\n      if (!wanted) return null;\n      const normalize = (s) => s.replace(/[\\u2013\\u2014]/g, '-').replace(/\\s+/g, ' ').trim().toLowerCase();\n\n      if (this.foxyFormsByName && this.foxyFormsByName.has(wanted)) return this.foxyFormsByName.get(wanted);\n      try {\n        const sel = `form[action*=\\\"foxycart.com/cart\\\"] input[name=\\\"name\\\"][value=\\\"${CSS.escape(wanted)}\\\"]`;\n        const input = document.querySelector(sel);\n        if (input) return input.closest('form');\n      } catch(_) {}\n      const forms = document.querySelectorAll('form[action*=\"foxycart.com/cart\"]');\n      const nWanted = normalize(wanted);\n      let best = null;\n      forms.forEach((form) => {\n        const val = form.querySelector('input[name=\"name\"]')?.value;\n        if (!val) return;\n        if (normalize(val) === nWanted && !best) best = form;\n      });\n      if (best) return best;\n      forms.forEach((form) => {\n        if (best) return;\n        const val = form.querySelector('input[name=\"name\"]')?.value;\n        if (val && normalize(val).includes(nWanted)) best = form;\n      });\n      return best;\n    }\n\n    addProductToCart(productKey, quantity) {\n      // Validiere productKey - überspringe leere oder ungültige Produkte\n      if (!productKey || productKey.trim() === '') {\n        console.warn('[SolarGrid] Leerer productKey übersprungen');\n        return;\n      }\n      \n      // Foxy.io: Formular per Produktname finden und submitten\n      const displayName = PRODUCT_NAME_MAP[productKey] || productKey.replace(/_/g, ' ');\n      if (!displayName || displayName.trim() === '') {\n        console.warn('[SolarGrid] Leerer displayName übersprungen für productKey:', productKey);\n        return;\n      }\n      \n      const form = this.findFoxyFormByName ? this.findFoxyFormByName(displayName) : null;\n      if (!form) {\n        // Fallback: synthetisches Foxy-Form in verstecktem Iframe submitten\n        try {\n          this._ensureFoxySilentTarget();\n          const tempForm = document.createElement('form');\n          tempForm.action = 'https://unterkonstruktion.foxycart.com/cart';\n          tempForm.method = 'POST';\n          tempForm.target = 'foxy_silent';\n          tempForm.style.position = 'absolute';\n          tempForm.style.left = '-9999px';\n          tempForm.style.top = '-9999px';\n          // Pflichtfelder\n          const pricePerPack = getPackPriceForQuantity(productKey, VE[productKey] || 1);\n          tempForm.innerHTML = `\n            <input type=\"hidden\" name=\"name\" value=\"${displayName}\">\n            <input type=\"hidden\" name=\"price\" value=\"${Number(pricePerPack).toFixed(2)}\">\n            <input type=\"hidden\" name=\"code\" value=\"\">\n            <input type=\"hidden\" name=\"quantity\" value=\"${Math.max(1, parseInt(quantity, 10) || 1)}\">\n          `;\n          document.body.appendChild(tempForm);\n          tempForm.submit();\n          setTimeout(() => { try { tempForm.remove(); } catch(_) {} }, 2000);\n          return; // Fallback erfolgreich ausgelöst\n        } catch (e) {\n          console.warn(`[SolarGrid] Foxy-Fallback fehlgeschlagen für '${displayName}':`, e);\n          return;\n        }\n      }\n      try {\n        const qtyInput = form.querySelector('input[name=\"quantity\"]');\n        if (qtyInput) qtyInput.value = Math.max(1, parseInt(quantity, 10) || 1);\n        const customerInput = form.querySelector('input[name=\"customer_type\"]');\n        try {\n          const raw = localStorage.getItem('solarTool_customerType');\n          if (customerInput && raw) {\n            const parsed = JSON.parse(raw);\n            const type = parsed && parsed.type ? String(parsed.type) : '';\n            if (type) customerInput.value = type;\n          }\n        } catch(_) {}\n        const submitBtn = form.querySelector('button[data-fc-add-to-cart]') || form.querySelector('button[type=\"submit\"]');\n        if (typeof form.requestSubmit === 'function') {\n          form.requestSubmit(submitBtn || undefined);\n        } else {\n          (submitBtn && submitBtn.click()) || form.submit();\n        }\n      } catch (e) {\n        console.warn('[SolarGrid] Foxy-Submit Fehler:', e);\n      }\n    }\n\n    _ensureFoxySilentTarget() {\n      try {\n        let iframe = document.getElementById('foxy_silent');\n        if (!iframe) {\n          iframe = document.createElement('iframe');\n          iframe.name = 'foxy_silent';\n          iframe.id = 'foxy_silent';\n          iframe.width = '1';\n          iframe.height = '1';\n          iframe.style.position = 'absolute';\n          iframe.style.left = '-9999px';\n          iframe.style.top = '-9999px';\n          iframe.setAttribute('aria-hidden', 'true');\n          iframe.setAttribute('tabindex', '-1');\n          document.body.appendChild(iframe);\n        }\n      } catch (_) {}\n    }\n\n    // Warte auf Navigations-/Load-Ack des versteckten iFrames nach einem POST\n    async _waitForFoxyIframeAck(timeoutMs = 2500) {\n      return new Promise(resolve => {\n        try {\n          const iframe = document.getElementById('foxy_silent');\n          if (!iframe) return resolve(false);\n          let settled = false;\n          const onLoad = () => { if (!settled) { settled = true; resolve(true); } };\n          iframe.addEventListener('load', onLoad, { once: true });\n          setTimeout(() => { if (!settled) { settled = true; resolve(false); } }, timeoutMs);\n        } catch(_) { resolve(false); }\n      });\n    }\n\n    clickWebflowButtonSafely(form, button, productKey, quantity, isLastItem) {\n      const qtyInput = form.querySelector('input[name=\"commerce-add-to-cart-quantity-input\"]');\n      if (qtyInput) qtyInput.value = quantity;\n      // Siehe oben: required selects füllen\n      try {\n        form.querySelectorAll('select[required]').forEach(sel => {\n          if (!sel.value) {\n            const first = sel.querySelector('option[value]:not([value=\"\"])');\n            if (first) sel.value = first.value;\n          }\n        });\n      } catch (e) {}\n      \n      // Iframe-Workaround entfernt: wir klicken direkt und warten sequenziell über DOM-Änderungen/Timeouts\n      button.click();\n    }\n\n    addPartsListToCart(parts) {\n      // 1) Totals aus Cache verwenden (falls vorhanden), sonst live berechnen\n      let totals = this.loadTotalsFromCache() || null;\n      if (!totals) {\n        try { totals = this.computeAllTotalsSnapshot(); this.saveTotalsToCache(totals); } catch(_) { totals = parts || {}; }\n      }\n      // deterministisch sortieren (stabil für Debugging)\n      const entries = Object.entries(totals)\n        .filter(([_, qty]) => qty > 0)\n        .sort(([aKey],[bKey]) => aKey.localeCompare(bKey));\n      if (!entries.length) return;\n      \n      // Immer: Sequenzielle GET-Requests via versteckte Links (robust, keine iFrames)\n      {\n        // Stabil: Sequenzielle GET-Requests via versteckte Links, keine iframe-Probleme\n        try { this.showLoading('Warenkorb wird befüllt…'); } catch(_) {}\n        const sanitizePrice = (v) => {\n          const n = typeof v === 'string' ? v.replace(/[^0-9.,-]/g,'').replace(/,/g,'.') : String(v||'');\n          const num = parseFloat(n);\n          return Number.isFinite(num) ? num.toFixed(2) : '0.00';\n        };\n        const sleep = (ms) => new Promise(r => setTimeout(r, ms));\n        (async () => {\n          // Link-basierte GET-Requests (keine iFrames)\n          const getData = (displayName) => this.foxyDataByName && this.foxyDataByName.get(displayName);\n          for (const [key, qtyRaw] of entries) {\n            // qtyRaw sollte bereits die Pack-Menge sein (aus computeAllTotalsSnapshot),\n            // aber im Fallback-Fall (parts direkt) könnten es Stückzahlen sein.\n            // Prüfe: Wenn qtyRaw > VE, dann ist es wahrscheinlich eine Stückzahl und muss umgerechnet werden.\n            const ve = VE[key] || 1;\n            const numQty = Number(qtyRaw) || 0;\n            if (numQty <= 0) { await sleep(120); continue; }\n            \n            // Wenn qtyRaw größer als VE ist, dann ist es wahrscheinlich eine Stückzahl\n            // Ansonsten ist es bereits eine Pack-Menge (kann auch < 1 sein bei sehr kleinen Mengen)\n            const packs = numQty > ve \n              ? Math.ceil(numQty / ve)  // Stückzahl → Pack-Menge umrechnen\n              : Math.max(1, Math.ceil(numQty)); // Bereits Pack-Menge, mindestens 1 Pack wenn > 0\n            if (!packs || packs <= 0) { await sleep(120); continue; }\n            \n            // Validiere Key und displayName - überspringe leere oder ungültige Produkte\n            if (!key || key.trim() === '') { await sleep(120); continue; }\n            const displayName = PRODUCT_NAME_MAP[key] || key.replace(/_/g, ' ');\n            if (!displayName || displayName.trim() === '') { await sleep(120); continue; }\n            \n            const d = getData(displayName) || {};\n            const price = d.price ? sanitizePrice(d.price) : sanitizePrice(getPackPriceForQuantity(key, packs));\n            \n            // Debug: Logge alle Produktdaten\n            console.log(`[Foxy Debug] Link-Produkt ${key}:`, {\n              displayName,\n              price,\n              packs,\n              meta: d\n            });\n            \n            // Baue URL mit Query-Parametern (wie im Link Example)\n            const params = new URLSearchParams();\n            params.append('name', displayName);\n            params.append('price', price);\n            params.append('quantity', String(packs));\n            if (d.code) params.append('code', d.code);\n            if (d.image) params.append('image', d.image);\n            if (d.url) params.append('url', d.url);\n            if (d.description) params.append('description', d.description);\n            if (d.weight) params.append('weight', d.weight);\n            if (d.width) params.append('width', d.width);\n            if (d.height) params.append('height', d.height);\n            if (d.length) params.append('length', d.length);\n            if (d.coupon) params.append('coupon', d.coupon);\n            \n            const foxyUrl = `https://unterkonstruktion.foxycart.com/cart?${params.toString()}`;\n            console.log(`[Foxy Debug] GET-URL: ${foxyUrl}`);\n            \n            // WICHTIG: Logge die gesendete Menge für Vergleich\n            console.log(`[Foxy Debug] SENDEN: ${displayName} - Pack-Menge: ${packs}`);\n            \n            // Erstelle versteckten Link und klicke ihn (GET wie in der Doku)\n            const link = document.createElement('a');\n            link.href = foxyUrl;\n            link.style.position = 'absolute';\n            link.style.left = '-9999px';\n            link.style.top = '-9999px';\n            link.style.visibility = 'hidden';\n            document.body.appendChild(link);\n            try {\n              link.click();\n              console.log(`[Foxy Debug] LINK GESENDET: ${displayName} – Menge ${packs}`);\n            } catch (e) {\n              console.error(`[Foxy Debug] Link-Klick Fehler für ${displayName}:`, e);\n            }\n            try { link.remove(); } catch(_) {}\n            await sleep(250); // kurze Pause zwischen Links\n          }\n          try { this.hideLoading(); } catch(_) {}\n          \n          // Zusammenfassung der gesendeten Mengen\n          console.log(`[Foxy Debug] ZUSAMMENFASSUNG - Gesendete Produkte:`);\n          for (const [key, qtyRaw] of entries) {\n            const qty = Math.max(0, Math.floor(Number(qtyRaw)));\n            const ve = VE[key] || 1;\n            const isPallet = (key === 'SolarmodulPalette' || key === 'UlicaSolarBlackJadeFlowPalette');\n            const isSingleModule = (key === 'Solarmodul' || key === 'UlicaSolarBlackJadeFlow');\n            const packs = isPallet ? Math.floor(qty / ve) : (isSingleModule ? qty : Math.ceil(qty / ve));\n            if (packs > 0) {\n              const displayName = PRODUCT_NAME_MAP[key] || key.replace(/_/g, ' ');\n              console.log(`[Foxy Debug] - ${displayName}: ${packs} Stück (Konfigurator: ${qty}, VE: ${ve})`);\n            }\n          }\n          console.log(`[Foxy Debug] Bitte vergleiche diese Mengen mit dem Warenkorb!`);\n          \n          // Keine Weiterleitung gewünscht\n        })();\n        return;\n      }\n    }\n\n    async addSingleItemAndWait(productKey, quantity, isLast) {\n      // Safeguards\n      const preferBrutto = false; // Kundentyp entfernt\n      let mappedForm = null;\n      // webflowFormMapBrutto entfernt - Kundentyp existiert nicht mehr\n      if (!mappedForm && this.webflowFormMap) {\n        mappedForm = this.webflowFormMap[productKey] || null;\n      }\n      if (!mappedForm) {\n        // Versuche, Formen neu zu sammeln\n        await this.ensureWebflowFormsMapped();\n        if (preferBrutto && this.webflowFormMapBrutto) {\n          mappedForm = this.webflowFormMapBrutto[productKey] || null;\n        }\n        if (!mappedForm && this.webflowFormMap) {\n          mappedForm = this.webflowFormMap[productKey] || null;\n        }\n        if (!mappedForm) {\n          const info = getCartProductInfo(productKey);\n          if (info) {\n            mappedForm = document.querySelector(`[data-commerce-product-id=\"${info.productId}\"]`) ||\n                         document.querySelector(`[data-commerce-sku-id=\"${info.variantId}\"]`);\n          }\n        }\n      }\n      if (!mappedForm) {\n        this.showToast(`Produktformular nicht gefunden: ${productKey}`, 2000);\n        return;\n      }\n      const addBtn = mappedForm.querySelector('input[data-node-type=\"commerce-add-to-cart-button\"]');\n      if (!addBtn) {\n        this.showToast(`Add-to-Cart Button fehlt: ${productKey}`, 2000);\n        return;\n      }\n      \n      // Fortschrittsmeldung optional\n      // this.showToast(`Füge hinzu: ${productKey} x${quantity}`, 1200);\n      \n      // DOM-Änderung oder Timeout abwarten\n      const waitForAck = this.waitForCartAcknowledge(1500);\n      this.clickWebflowButtonSafely(mappedForm, addBtn, productKey, quantity, isLast);\n      await waitForAck;\n    }\n\n    async ensureCartObservers() {\n      // Observer für Cart-Änderungen\n      if (!this.cartAckObserver) {\n        const list = document.querySelector('.w-commerce-commercecartlist') || document.querySelector('.w-commerce-commercecartcontainerwrapper');\n        if (list) {\n          this.cartAckObserver = new MutationObserver(() => {\n            if (this.cartAckResolve) {\n              const r = this.cartAckResolve;\n              this.cartAckResolve = null;\n              r();\n            }\n          });\n          this.cartAckObserver.observe(list, { childList: true, subtree: true });\n        }\n      }\n      \n      // Observer für Webflow-Formulare (für asynchrones Rendering)\n      if (!this.webflowFormsObserver) {\n        this.webflowFormsObserver = new MutationObserver(() => {\n          this.generateHiddenCartForms();\n        });\n        this.webflowFormsObserver.observe(document.body, { childList: true, subtree: true });\n      }\n      \n      await this.ensureWebflowFormsMapped();\n    }\n\n    waitForCartAcknowledge(timeoutMs = 1500) {\n      return new Promise((resolve) => {\n        let settled = false;\n        const timer = setTimeout(() => {\n          if (!settled) {\n            settled = true;\n            if (this.cartAckResolve === resolve) this.cartAckResolve = null;\n            resolve();\n          }\n        }, timeoutMs);\n        \n        this.cartAckResolve = () => {\n          if (!settled) {\n            settled = true;\n            clearTimeout(timer);\n            resolve();\n          }\n        };\n      });\n    }\n\n    async ensureWebflowFormsMapped() {\n      // Falls Mapping leer ist, nochmal scannen\n      if (!this.webflowFormMap || Object.keys(this.webflowFormMap).length === 0 || !this.webflowFormMapBrutto) {\n        this.generateHiddenCartForms();\n        // kurze Wartezeit, falls Webflow synchron nachrendert\n        await new Promise(r => setTimeout(r, 50));\n      }\n    }\n\n    hideCartContainer() {\n      const cartContainer = document.querySelector('.w-commerce-commercecartcontainerwrapper');\n      if (cartContainer) {\n        cartContainer.style.display = 'none';\n        // Sicherstellen, dass Cart am Ende wieder geöffnet werden kann\n        cartContainer.classList.add('st-cart-hidden');\n      }\n    }\n    showCartContainer() {\n      const cartContainer = document.querySelector('.w-commerce-commercecartcontainerwrapper');\n      if (cartContainer) {\n        cartContainer.style.display = '';\n        cartContainer.classList.remove('st-cart-hidden');\n        // Cart zuverlässig öffnen: versuche mehrfach, da Webflow DOM evtl. leicht verzögert ist\n        try {\n          const isCartActuallyOpen = () => {\n            try{\n              // Heuristiken: Wrapper sichtbar und hat offene Klasse/Attribute\n              const wrapper = document.querySelector('.w-commerce-commercecartcontainerwrapper');\n              if (!wrapper) return false;\n              const cs = window.getComputedStyle(wrapper);\n              if (cs.display === 'none' || cs.visibility === 'hidden') return false;\n              // Manche Webflow-Themes setzen Klasse auf <body> beim offenen Cart\n              if (document.body && document.body.classList && (document.body.classList.contains('w-commerce-commercecartopen') || document.body.classList.contains('wf-commerce-cart-open'))) return true;\n              // Prüfe auf Dialogrolle\n              const dialog = wrapper.querySelector('[role=\"dialog\"], .w-commerce-commercecartcontainer');\n              if (dialog){\n                const dcs = window.getComputedStyle(dialog);\n                if (dcs.display !== 'none' && dcs.visibility !== 'hidden') return true;\n              }\n              return false;\n            }catch(_){ return false; }\n          };\n          const isVisible = (el) => {\n            if (!el) return false;\n            const cs = window.getComputedStyle(el);\n            if (cs.display === 'none' || cs.visibility === 'hidden') return false;\n            if (el.disabled) return false;\n            // Auch übergeordnete Hiding-Container berücksichtigen\n            let p = el;\n            while (p) {\n              const ps = window.getComputedStyle(p);\n              if (ps.display === 'none' || ps.visibility === 'hidden') return false;\n              p = p.parentElement;\n            }\n            return el.offsetParent !== null || el.getClientRects().length > 0;\n          };\n          const tryOpen = (attempt = 0) => {\n            if (isCartActuallyOpen()) return; // schon offen → nicht togglen\n            const selectorUnion = [\n              '[data-node-type=\"commerce-cart-open-link\"]',\n              '.w-commerce-commercecartopenlink',\n              '[data-node-type*=\"cart-open\"], [data-node-type*=\"commerce-cart-open\"]',\n              'a[href=\"#cart\"]'\n            ].join(',');\n            const candidates = Array.from(document.querySelectorAll(selectorUnion));\n            const openBtn = candidates.find(isVisible) || candidates[0] || null;\n            if (openBtn && typeof openBtn.click === 'function') {\n              openBtn.click();\n              // Nach dem Klick kurz prüfen; wenn offen, keine weiteren Retries\n              setTimeout(() => { /* noop: early check */ }, 0);\n              return;\n            }\n            if (attempt < 8) setTimeout(() => tryOpen(attempt + 1), 160);\n          };\n          // kleiner Delay, damit Webflow den letzten Add-Event verarbeiten kann\n          setTimeout(() => tryOpen(0), 80);\n        } catch (e) {}\n      }\n    }\n\n    async addCurrentToCart() {\n      try {\n        this.showLoading('PDF wird erstellt und Warenkorb wird befüllt…');\n        const parts = await this._buildPartsFor(this.selection, this.incM.checked, this.mc4.checked, this.solarkabel.checked, this.holz.checked, this.quetschkabelschuhe.checked, this.kabelbinder ? this.kabelbinder.checked : false, this.erdungsband ? this.erdungsband.checked : false, this.ulicaModule ? this.ulicaModule.checked : false);\n      const itemCount = Object.values(parts).reduce((sum, qty) => sum + qty, 0);\n      \n      if (itemCount === 0) {\n        this.showToast('Keine Produkte ausgewählt ⚠️', 2000);\n        this.hideLoading();\n        return;\n      }\n      \n      // Sende Daten an Webhook\n      this.sendCurrentConfigToWebhook().then(success => {\n        if (success) {\n        } else {\n        }\n      });\n      \n      // Opti-Zusatz (einmalig) hinzufügen\n      try {\n        const hCb = document.getElementById('huawei-opti');\n        const bCb = document.getElementById('brc-opti');\n        const qEl = document.getElementById('opti-qty');\n        if (hCb && bCb && qEl && (hCb.checked || bCb.checked)) {\n          const qty = Math.max(1, parseInt(qEl.value || '1', 10));\n          if (bCb.checked) parts.BRCOpti = (parts.BRCOpti || 0) + qty; else parts.HuaweiOpti = (parts.HuaweiOpti || 0) + qty;\n        }\n      } catch (_) {}\n      this.addPartsListToCart(parts);\n      this.showToast(`${itemCount} Produkte werden zum Warenkorb hinzugefügt...`, 3000);\n        \n        // PDF für aktuelle Konfiguration generieren\n        if (this.pdfGenerator && this.pdfGenerator.isAvailable()) {\n          setTimeout(() => {\n            this.pdfGenerator.generatePDF('current');\n          }, 500); // Kurze Verzögerung damit Warenkorb-Toast zuerst angezeigt wird\n        }\n      } catch (error) {\n        this.showToast('Fehler beim Berechnen der Produkte ❌', 2000);\n        this.hideLoading();\n      }\n    }\n\n    async addAllToCart() {\n      // QUEUE: Verwende SimpleCartQueue nur für addAllToCart\n      if (!this.simpleCartQueue) {\n        this.simpleCartQueue = new SimpleCartQueue();\n      }\n      \n      return await this.simpleCartQueue.execute(async () => {\n      try {\n      // Kein Auto-Save beim Warenkorb-Button-Klick - Config-Items sollen nicht neu gebaut werden\n      this.showLoading('PDF wird erstellt und Warenkorb wird befüllt…');\n      \n        // SCHRITT 1: Erstelle vollständigen ISOLIERTEN Snapshot aller Konfigurationen\n        const configSnapshot = this.createConfigSnapshot();\n        \n        // SCHRITT 2: PDF ZUERST mit isolierten Daten erstellen\n        if (this.pdfGenerator && this.pdfGenerator.isAvailable()) {\n          this.showToast('PDF wird erstellt...', 2000);\n          await this.pdfGenerator.generatePDFFromSnapshot(configSnapshot);\n          \t\t\tthis.showToast('PDF erfolgreich erstellt', 1500);\n        }\n        \n      // SCHRITT 3: Berechne Produkte für Warenkorb (mit Live-Data für aktuellen Zustand)\n      // Zusatzprodukte dürfen NICHT pro Konfiguration summiert werden, sondern nur aus der globalen Zusatzproduktliste stammen.\n      const allBundles = await Promise.all(this.configs.map(async (cfg, idx) => {\n        const p = (idx === this.currentConfig)\n          ? await this._buildPartsFor(this.selection, (this.incM && this.incM.checked) !== false, this.mc4 && this.mc4.checked, this.solarkabel && this.solarkabel.checked, this.holz && this.holz.checked, this.quetschkabelschuhe && this.quetschkabelschuhe.checked, this.kabelbinder ? this.kabelbinder.checked : false, this.erdungsband ? this.erdungsband.checked : false, this.ulicaModule ? this.ulicaModule.checked : false)\n          : await this._buildPartsFor(cfg.selection, (cfg.incM === false) ? false : true, !!cfg.mc4, !!cfg.solarkabel, !!cfg.holz, !!cfg.quetschkabelschuhe, !!cfg.kabelbinder, !!cfg.erdungsband, !!cfg.ulicaModule);\n        // Zusatzprodukte aus Einzel-Bundles entfernen – sie werden später einmalig aus der UI-Liste gelesen\n        delete p.MC4_Stecker;\n        delete p.Solarkabel;\n        delete p.Holzunterleger;\n        delete p.Ringkabelschuhe;\n        delete p.Kabelbinder;\n        delete p.BlechBohrschrauben;\n        delete p.Erdungsband;\n        return p;\n      }));\n      \n      // Wenn keine Konfiguration ausgewählt ist (sollte nicht passieren), füge aktuelle Auswahl hinzu\n      if (this.currentConfig === null && this.configs.length === 0) {\n            const currentParts = await this._buildPartsFor(this.selection, this.incM.checked, this.mc4.checked, this.solarkabel.checked, this.holz.checked, this.quetschkabelschuhe.checked, this.kabelbinder ? this.kabelbinder.checked : false, this.erdungsband ? this.erdungsband.checked : false, this.ulicaModule ? this.ulicaModule.checked : false);\n            allBundles.push(currentParts);\n      }\n      \n      const total = {};\n      allBundles.forEach(parts => {\n        Object.entries(parts).forEach(([k, v]) => {\n          total[k] = (total[k] || 0) + v;\n        });\n      });\n      // Bündelung über ALLE Konfigurationen: bilde Paletten aus Gesamtmodul-Zahlen\n      this.bundleTotalModulesIntoPallets(total);\n\n      // SCHRITT 3b: Zusatzprodukte einmalig aus der globalen Zusatzproduktliste übernehmen\n      try {\n        const extras = this.readExtrasFromSummaryList();\n        Object.entries(extras).forEach(([k, v]) => {\n          if (v > 0) total[k] = v;\n          // MC4 als 1 Paket, nicht mengenabhängig\n          if (k === 'MC4_Stecker' && v > 0) total[k] = 1;\n        });\n      } catch(_) {}\n      // Opti-Zusatz aus globaler UI berücksichtigen\n      try {\n        const hCb = document.getElementById('huawei-opti');\n        const bCb = document.getElementById('brc-opti');\n        const qEl = document.getElementById('opti-qty');\n        if (hCb && bCb && qEl && (hCb.checked || bCb.checked)) {\n          const qty = Math.max(1, parseInt(qEl.value || '1', 10));\n          if (bCb.checked) total.BRCOpti = (total.BRCOpti || 0) + qty; else total.HuaweiOpti = (total.HuaweiOpti || 0) + qty;\n        }\n      } catch (_) {}\n      \n      const totalItemCount = Object.values(total).reduce((sum, qty) => sum + qty, 0);\n      \n      if (totalItemCount === 0) {\n        this.showToast('Keine Konfigurationen vorhanden ⚠️', 2000);\n        return;\n      }\n      \n        // SCHRITT 4: Sende alle Konfigurationen an Webhook (NACH PDF)\n        const webhookSuccess = await this.sendAllConfigsToWebhook();\n        if (webhookSuccess) {\n          // Success handling if needed\n        } else {\n          // Error handling if needed  \n        }\n      \n        // SCHRITT 5: Füge zum Warenkorb hinzu\n      this.addPartsListToCart(total);\n      this.showToast(`${totalItemCount} Produkte aus allen Konfigurationen werden hinzugefügt...`, 3000);\n        \n      } catch (error) {\n        console.error('Fehler in addAllToCart:', error);\n        this.showToast('Fehler beim Berechnen der Konfigurationen ❌', 2000);\n        this.hideLoading();\n      }\n      }, 'addAllToCart');\n    }\n\n    async _buildPartsFor(sel, incM, mc4, solarkabel, holz, quetschkabelschuhe, kabelbinder, erdungsband, ulicaModule) {\n      // ISOLATION: Erstelle isolierte Berechnung ohne globale Zustandsänderungen\n      try {\n        // Erstelle isolierte Grid-Instanz für Berechnung\n        const isolatedGrid = {\n          selection: sel,\n          rows: this.rows,\n          cols: this.cols,\n          cellWidth: this.cellWidth || 179,\n          cellHeight: this.cellHeight || 113,\n          orientation: this.orV && this.orV.checked ? 'vertical' : 'horizontal'\n        };\n        \n        // Berechne Parts mit isolierten Daten\n        let parts = await this.calculatePartsIsolated(isolatedGrid);\n        \n\t\t\t// Module nur entfernen, wenn Flags explizit false sind\n\t\t\tif (incM === false) delete parts.Solarmodul;\n\t\t\tif (ulicaModule === false) delete parts.UlicaSolarBlackJadeFlow;\n        \n\t\t\t// Zusatzprodukte basierend auf Checkboxen (korrekte Keys setzen/löschen)\n        const moduleCount = (sel || []).flat().filter(Boolean).length;\n        if (mc4 && moduleCount > 0) {\n          const veMc4 = VE.MC4_Stecker || 20;\n          const packs = Math.ceil(moduleCount / 30);\n          parts.MC4_Stecker = packs * veMc4;\n        } else {\n          delete parts.MC4_Stecker;\n        }\n        if (solarkabel) {\n          parts.Solarkabel = 1;\n        } else {\n          delete parts.Solarkabel;\n        }\n        if (holz) {\n          parts.Holzunterleger = 1; // pauschal 1 VE\n        } else {\n          delete parts.Holzunterleger;\n        }\n        if (quetschkabelschuhe) {\n          parts.Ringkabelschuhe = 1; // pauschal 1 VE\n        } else {\n          delete parts.Ringkabelschuhe;\n        }\n        if (kabelbinder) {\n          parts.Kabelbinder = 1; // pauschal 1 VE\n        } else {\n          delete parts.Kabelbinder;\n        }\n        \n        // Erdungsband hinzufügen wenn aktiviert\n        if (erdungsband) {\n          parts.Erdungsband = this.calculateErdungsbandIsolated(sel);\n          // Blech-Bohrschrauben automatisch hinzufügen wenn Erdungsband aktiviert\n          parts.BlechBohrschrauben = 1;\n        } else {\n          delete parts.Erdungsband;\n          delete parts.BlechBohrschrauben;\n        }\n        \n        // Palettenlogik anwenden (36er Bündel je Modultyp)\n        try {\n          const ulicaSelected = ulicaModule === true;\n          const pieceKey = ulicaSelected ? 'UlicaSolarBlackJadeFlow' : 'Solarmodul';\n          const palletKey = ulicaSelected ? 'UlicaSolarBlackJadeFlowPalette' : 'SolarmodulPalette';\n          const count = Number(parts[pieceKey] || 0);\n          \n          if (count > 0) {\n            const palletCount = Math.floor(count / 36);\n            const remainingPieces = count % 36;\n            \n            if (palletCount > 0) {\n              parts[palletKey] = palletCount;\n            }\n            if (remainingPieces > 0) {\n              parts[pieceKey] = remainingPieces;\n            } else {\n              delete parts[pieceKey];\n            }\n          }\n        } catch (_) {}\n        \n      return parts;\n      } catch (error) {\n        console.warn('[SolarGrid] _buildPartsFor isolation error:', error);\n        return {};\n      }\n    }\n    \n    // ISOLIERTE calculateParts ohne globale Zustandsänderungen\n    async calculatePartsIsolated(isolatedGrid) {\n      try {\n        // Verwende isolierte Daten statt globale this.selection\n        const selection = isolatedGrid.selection;\n        const rows = isolatedGrid.rows;\n        const cols = isolatedGrid.cols;\n        const cellWidth = isolatedGrid.cellWidth;\n        const cellHeight = isolatedGrid.cellHeight;\n        const orientation = isolatedGrid.orientation;\n        \n        // Berechne Parts mit isolierten Parametern\n        const parts = {};\n        \n        // Module zählen\n        const moduleCount = (selection || []).flat().filter(Boolean).length;\n        if (moduleCount > 0) {\n          parts.Solarmodul = moduleCount;\n        }\n        \n        // Dachhaken berechnen\n        const dachhakenCount = Math.ceil(moduleCount / 2);\n        if (dachhakenCount > 0) {\n          parts.Dachhaken = dachhakenCount;\n        }\n        \n        // Schienen berechnen\n        const schienenCount = Math.ceil(moduleCount / 2);\n        if (schienenCount > 0) {\n          parts.Schiene_240_cm = schienenCount;\n        }\n        \n        // Weitere Berechnungen...\n        return parts;\n      } catch (error) {\n        console.warn('[SolarGrid] calculatePartsIsolated error:', error);\n        return {};\n      }\n    }\n    \n    // ISOLIERTE Erdungsband-Berechnung\n    calculateErdungsbandIsolated(selection) {\n      try {\n        const moduleCount = (selection || []).flat().filter(Boolean).length;\n        return Math.ceil(moduleCount / 10); // 1 Erdungsband pro 10 Module\n      } catch (error) {\n        return 0;\n      }\n    }\n\n    _buildCartItems(parts) {\n      return Object.entries(parts).map(([k,v]) => {\n        const ve = VE[k] || 1;\n        const packs = Math.ceil(v / ve);\n        const m = PRODUCT_MAP[k]; // Nur noch ein Produkt-Mapping\n        return (!m || packs <= 0) ? null : {\n          productId: m.productId,\n          variantId: m.variantId,\n          quantity:  packs\n        };\n      }).filter(Boolean);\n    }\n    // ===== PDF HELPER METHODS =====\n    \n    // Hole aktuelle Konfigurationsdaten für PDF\n    getCurrentConfigData() {\n      return {\n        name: this.currentConfig !== null && this.configs[this.currentConfig] ? \n              this.configs[this.currentConfig].name : 'Aktuelle Konfiguration',\n        cols: this.cols,\n        rows: this.rows,\n        selection: this.selection.map(row => [...row]), // Deep copy\n        orientation: this.orV.checked ? 'vertical' : 'horizontal',\n        includeModules: this.incM.checked,\n        mc4: this.mc4.checked,\n        cable: this.solarkabel.checked,\n        wood: this.holz.checked,\n        quetschkabelschuhe: this.quetschkabelschuhe.checked,\n        erdungsband: this.erdungsband ? this.erdungsband.checked : false,\n        ulicaModule: this.ulicaModule ? this.ulicaModule.checked : false\n      };\n    }\n\n    // NEUE METHODE: Globale Checkbox-Logik - aktualisiert alle Konfigurationen\n    updateAllConfigurationsForCheckboxes() {\n      // Aktualisiere alle gespeicherten Konfigurationen mit aktuellen Checkbox-Werten\n      this.configs.forEach((config, index) => {\n        config.incM = this.incM.checked;\n        config.mc4 = this.mc4.checked;\n        config.solarkabel = this.solarkabel.checked;\n        config.holz = this.holz.checked;\n        config.quetschkabelschuhe = this.quetschkabelschuhe.checked;\n        if (this.erdungsband) config.erdungsband = this.erdungsband.checked;\n        if (this.ulicaModule) config.ulicaModule = this.ulicaModule.checked;\n      });\n      \n      // Aktualisiere Summary und Produktliste\n      this.updateSummaryOnChange();\n      \n      // Aktualisiere auch die Produktliste in der detailed-overview\n      this.buildList();\n    }\n    // NEUE METHODE: Erstelle vollständigen isolierten Config-Snapshot für PDF\n    createConfigSnapshot() {\n      // Auto-Save der aktuellen Konfiguration falls nötig\n      if (this.currentConfig !== null) {\n        this.updateConfig();\n      }\n      \n      // Erstelle KOMPLETT ISOLIERTE Kopie aller Konfigurationsdaten\n      const snapshot = {\n        timestamp: new Date().toISOString(),\n        totalConfigs: this.configs.length,\n        currentConfigIndex: this.currentConfig,\n        configs: []\n      };\n      \n      // Durchlaufe alle Konfigurationen und erstelle Deep Copies\n      for (let index = 0; index < this.configs.length; index++) {\n        const config = this.configs[index];\n        \n        // Hole Daten - für aktuelle Config verwende Live-Daten\n        let targetSelection, targetCols, targetRows, targetOrientation;\n        let targetIncM, targetMc4, targetCable, targetWood, targetQuetschkabelschuhe, targetErdungsband, targetUlicaModule, targetCellWidth, targetCellHeight;\n        \n        if (index === this.currentConfig) {\n          // Aktuelle Konfiguration: MOMENTAUFNAHME der Live-Daten\n          targetSelection = this.selection ? this.selection.map(row => [...row]) : [];\n          targetCols = this.cols;\n          targetRows = this.rows;\n          targetOrientation = this.orV.checked ? 'vertical' : 'horizontal';\n          targetIncM = this.incM.checked;\n          targetMc4 = this.mc4.checked;\n          targetCable = this.solarkabel.checked;\n          targetWood = this.holz.checked;\n          targetQuetschkabelschuhe = this.quetschkabelschuhe.checked;\n          targetErdungsband = this.erdungsband ? this.erdungsband.checked : false;\n          targetUlicaModule = this.ulicaModule ? this.ulicaModule.checked : false;\n          console.log('Current ulicaModule checkbox state:', targetUlicaModule);\n          targetCellWidth = parseInt(this.wIn.value, 10);\n          targetCellHeight = parseInt(this.hIn.value, 10);\n        } else {\n          // Andere Konfigurationen: Deep Copy der gespeicherten Daten\n          targetSelection = config.selection ? config.selection.map(row => [...row]) : [];\n          targetCols = config.cols;\n          targetRows = config.rows;\n          targetOrientation = config.orientation;\n          targetIncM = config.incM;\n          targetMc4 = config.mc4;\n          targetCable = config.solarkabel;\n          targetWood = config.holz;\n          targetQuetschkabelschuhe = config.quetschkabelschuhe;\n          targetErdungsband = config.erdungsband;\n          targetUlicaModule = config.ulicaModule;\n          targetCellWidth = config.cellWidth;\n          targetCellHeight = config.cellHeight;\n        }\n        \n        // Normalisiere Selection für die Zieldimensionen\n        const normalizedSelection = Array.from({ length: targetRows || 5 }, (_, y) =>\n          Array.from({ length: targetCols || 5 }, (_, x) => {\n            if (targetSelection[y] && Array.isArray(targetSelection[y]) && x < targetSelection[y].length) {\n              return targetSelection[y][x] === true;\n            }\n            return false;\n          })\n        );\n        \n        // Erstelle isolierte Config-Kopie\n        const isolatedConfig = {\n          name: config.name || `Konfiguration ${index + 1}`,\n          index: index,\n          cols: targetCols || 5,\n          rows: targetRows || 5,\n          selection: normalizedSelection,\n          cellWidth: targetCellWidth || 179,\n          cellHeight: targetCellHeight || 113,\n          orientation: targetOrientation || 'horizontal',\n          includeModules: targetIncM === true,\n          mc4: targetMc4 || false,\n          cable: targetCable || false,\n          wood: targetWood || false,\n          quetschkabelschuhe: targetQuetschkabelschuhe || false,\n          erdungsband: targetErdungsband || false,\n          ulicaModule: targetUlicaModule === true,\n          // Zusätzliche Metadaten für Debugging\n          selectedCells: normalizedSelection.flat().filter(v => v).length,\n          totalCells: (targetCols || 5) * (targetRows || 5)\n        };\n        \n        snapshot.configs.push(isolatedConfig);\n      }\n      \n      return snapshot;\n    }\n\n    // DEPRECATED: Alte Methode für Backward Compatibility\n    getAllConfigsData() {\n      const snapshot = this.createConfigSnapshot();\n      return snapshot.configs;\n    }\n    \n    // ===== GRID PREVIEW METHODS =====\n    \n    showGridPreview(config) {\n      console.log('showGridPreview called with config:', config);\n      \n      // Speichere aktuellen Zustand für späteres Zurücksetzen (immer, nicht nur beim ersten Mal)\n      this.originalPreviewState = {\n        selection: this.selection ? this.selection.map(row => [...row]) : null,\n        cols: this.cols,\n        rows: this.rows,\n        orientation: this.orV ? this.orV.checked : false,\n        cellWidth: parseInt(this.wIn ? this.wIn.value : '179', 10),\n        cellHeight: parseInt(this.hIn ? this.hIn.value : '113', 10)\n      };\n      \n      console.log('Original state saved:', this.originalPreviewState);\n      \n      try {\n        // Erstelle Preview-Grid\n        this.createPreviewGrid(config);\n        \n        // Smooth Animation: Verstecke Hauptgrid und zeige Preview-Grid\n        this.hideMainGrid();\n        this.showPreviewGrid();\n        \n        // Füge Animation-Klassen hinzu\n        const mainGrid = document.getElementById('grid');\n        const previewGrid = document.getElementById('preview-grid');\n        \n        if (mainGrid) mainGrid.classList.add('grid-fade-out');\n        if (previewGrid) previewGrid.classList.add('grid-fade-in');\n        \n        console.log('Grid preview shown successfully');\n      } catch (error) {\n        console.error('Error in showGridPreview:', error);\n        // Fallback: Zeige Hauptgrid wieder an\n        this.showMainGrid();\n      }\n    }\n    \n    createPreviewGrid(config) {\n      console.log('createPreviewGrid called with config:', config);\n      \n      const previewGrid = document.getElementById('preview-grid');\n      \n      if (!previewGrid) {\n        console.error('Preview grid element not found');\n        return;\n      }\n      \n      console.log('Preview grid element found, building preview...');\n      \n      // Starte mit aktuellem Grid als Basis\n      let previewCols = this.cols;\n      let previewRows = this.rows;\n      let previewSelection = this.selection ? this.selection.map(row => [...row]) : \n        Array.from({ length: previewRows }, () => Array.from({ length: previewCols }, () => false));\n      \n            // Wende Konfiguration auf Preview an\n      if (config.useCurrentGrid) {\n        // Kurze Eingabe: Verwende aktuelles Grid als Basis\n        previewCols = config.cols;\n        previewRows = config.rows;\n        // Behalte aktuelle Selection\n        previewSelection = this.selection ? this.selection.map(row => [...row]) : \n          Array.from({ length: previewRows }, () => Array.from({ length: previewCols }, () => false));\n      } else if (config.cols && config.rows) {\n        // Neue Grid-Größe\n        previewCols = config.cols;\n        previewRows = config.rows;\n        \n        // Erstelle neue Selection basierend auf Modul-Anzahl oder leere Selection\n        if (config.moduleCount) {\n          previewSelection = this.createModuleSelection(config.moduleCount, previewCols, previewRows);\n        } else {\n          previewSelection = Array.from({ length: previewRows }, () =>\n            Array.from({ length: previewCols }, () => false)\n          );\n        }\n      } else if (config.moduleCount) {\n         // Nur Modul-Anzahl geändert - behalte Grid-Größe\n         const hasSpacing = config.adjustSpacing === 'withSpacing' || \n                           (config.rowConfig && config.rowConfig.spacing);\n         previewSelection = this.createModuleSelection(config.moduleCount, previewCols, previewRows, hasSpacing);\n       } else if (config.rowConfig) {\n        // Reihen-Konfiguration anwenden\n        const { numRows, modulesPerRow, spacing } = config.rowConfig;\n        previewRows = numRows + (spacing ? 1 : 0); // +1 für Abstand\n        \n        // Erstelle Selection mit Abstand\n        previewSelection = Array.from({ length: previewRows }, (_, rowIndex) =>\n          Array.from({ length: previewCols }, (_, colIndex) => {\n            if (spacing && rowIndex === Math.floor(numRows / 2)) {\n              return false; // Abstand-Reihe\n            }\n            return rowIndex < numRows && colIndex < modulesPerRow;\n          })\n        );\n      } else if (config.adjustSpacing) {\n        // Abstand-Konfiguration anwenden\n        if (config.adjustSpacing === 'withSpacing') {\n          // Füge Abstand zwischen Reihen hinzu\n          const newRows = previewRows + Math.ceil(previewRows / 2);\n          const newSelection = Array.from({ length: newRows }, () =>\n            Array.from({ length: previewCols }, () => false)\n          );\n          \n          // Kopiere Module mit Abstand\n          let newRowIndex = 0;\n          for (let oldRow = 0; oldRow < previewRows; oldRow++) {\n            for (let col = 0; col < previewCols; col++) {\n              if (previewSelection[oldRow] && previewSelection[oldRow][col]) {\n                newSelection[newRowIndex][col] = true;\n              }\n            }\n            newRowIndex += 2; // Überspringe Abstand-Reihe\n          }\n          \n          previewRows = newRows;\n          previewSelection = newSelection;\n        }\n      }\n      \n      // Baue Preview-Grid\n      this.buildPreviewGrid(previewGrid, previewSelection, previewCols, previewRows);\n    }\n    buildPreviewGrid(previewGrid, selection, cols, rows) {\n      \n      \n      // Verwende die gleiche Berechnungslogik wie das Hauptgrid\n      const RAIL_GAP = 2;\n      const remPx = parseFloat(getComputedStyle(document.documentElement).fontSize);\n      \n      // Original Zellengrößen aus Input - bei Orientierung entsprechend anwenden\n      const inputW = parseInt(this.wIn ? this.wIn.value : '179', 10) || 179;\n      const inputH = parseInt(this.hIn ? this.hIn.value : '113', 10) || 113;\n      \n      // Bei vertikaler Orientierung: Breite und Höhe der Zellen tauschen\n      const isVertical = this.orV ? this.orV.checked : false;\n      const originalCellW = isVertical ? inputH : inputW;\n      const originalCellH = isVertical ? inputW : inputH;\n\t\t// Maximale verfügbare Größe (wie im Hauptgrid)\n\t\tconst maxWidth = this.wrapper ? this.wrapper.clientWidth - 160 : 800;\n\t\tconst maxHeight = this.wrapper ? this.wrapper.clientHeight - 160 : 600;\n      \n      // Berechne benötigte Gesamtgröße mit Original-Zellgrößen (inklusive Gaps für Schienen)\n      const totalWidthWithRailGaps = cols * originalCellW + (cols - 1) * RAIL_GAP;\n      const totalHeightWithRailGaps = rows * originalCellH + (rows - 1) * RAIL_GAP;\n      \n      // Berechne Skalierungsfaktoren für beide Dimensionen\n      const scaleX = maxWidth / totalWidthWithRailGaps;\n      const scaleY = maxHeight / totalHeightWithRailGaps;\n      \n      // Verwende den kleineren Skalierungsfaktor, um Proportionen zu erhalten\n      const scale = Math.min(scaleX, scaleY, 1);\n      \n      // Berechne finale Zellgrößen\n      const w = originalCellW * scale;\n      const h = originalCellH * scale;\n      \n      \n      \n      // Bestimme visuelle Gap: 0 wenn viele Spalten/Zeilen, sonst RAIL_GAP * scale\n      const shouldHideGap = cols >= 15 || rows >= 10;\n      const visualGap = shouldHideGap ? 0 : RAIL_GAP * scale;\n      \n      // Grid-Styling setzen\n      previewGrid.style.gridTemplateColumns = `repeat(${cols}, ${w}px)`;\n      previewGrid.style.gridTemplateRows = `repeat(${rows}, ${h}px)`;\n      previewGrid.style.gap = `${visualGap}px`;\n      \n      // Grid leeren\n      previewGrid.innerHTML = '';\n      \n      // Zellen erstellen\n      for (let row = 0; row < rows; row++) {\n        for (let col = 0; col < cols; col++) {\n          const cell = document.createElement('div');\n          cell.className = 'preview-grid-cell';\n          cell.dataset.row = row;\n          cell.dataset.col = col;\n          \n          // Selection anwenden\n          if (selection && selection[row] && selection[row][col]) {\n            cell.classList.add('selected');\n          }\n          \n          previewGrid.appendChild(cell);\n        }\n      }\n    }\n    \n    hideMainGrid() {\n      const mainGrid = document.getElementById('grid');\n      if (mainGrid) {\n        mainGrid.style.display = 'none';\n        mainGrid.style.visibility = 'hidden';\n        mainGrid.style.opacity = '0';\n      }\n    }\n    \n    showPreviewGrid() {\n      const previewGrid = document.getElementById('preview-grid');\n      if (previewGrid) {\n        previewGrid.style.display = 'grid';\n        previewGrid.style.visibility = 'visible';\n        previewGrid.style.opacity = '1';\n      }\n    }\n    \n    hidePreviewGrid() {\n      const previewGrid = document.getElementById('preview-grid');\n      if (previewGrid) {\n        previewGrid.style.display = 'none';\n        previewGrid.style.visibility = 'hidden';\n        previewGrid.style.opacity = '0';\n      }\n    }\n    \n    showMainGrid() {\n      const mainGrid = document.getElementById('grid');\n      if (mainGrid) {\n        mainGrid.style.display = 'grid';\n        mainGrid.style.visibility = 'visible';\n        mainGrid.style.opacity = '1';\n      }\n    }\n    \n    createModuleSelection(moduleCount, cols, rows, spacing = false) {\n      const selection = Array.from({ length: rows }, () =>\n        Array.from({ length: cols }, () => false)\n      );\n      \n      if (spacing) {\n        // Mit Abstand: Module in erste und letzte Reihe\n        const modulesPerRow = Math.ceil(moduleCount / 2);\n        let modulesPlaced = 0;\n        \n        // Erste Reihe\n        for (let col = 0; col < Math.min(modulesPerRow, cols) && modulesPlaced < moduleCount; col++) {\n          selection[0][col] = true;\n          modulesPlaced++;\n        }\n        \n        // Letzte Reihe (falls noch Module übrig)\n        if (modulesPlaced < moduleCount && rows > 2) {\n          for (let col = 0; col < Math.min(moduleCount - modulesPlaced, cols); col++) {\n            selection[rows - 1][col] = true;\n            modulesPlaced++;\n          }\n        }\n      } else {\n        // Ohne Abstand: Normale Auswahl von links nach rechts, oben nach unten\n        let modulesPlaced = 0;\n        for (let row = 0; row < rows && modulesPlaced < moduleCount; row++) {\n          for (let col = 0; col < cols && modulesPlaced < moduleCount; col++) {\n            selection[row][col] = true;\n            modulesPlaced++;\n          }\n        }\n      }\n      \n      return selection;\n    }\n    \n    clearGridPreview() {\n      console.log('Clearing grid preview');\n      \n      // Smooth Animation: Entferne Animation-Klassen\n      const mainGrid = document.getElementById('grid');\n      const previewGrid = document.getElementById('preview-grid');\n      \n      if (mainGrid) mainGrid.classList.remove('grid-fade-out');\n      if (previewGrid) previewGrid.classList.remove('grid-fade-in');\n      \n      // Kurze Verzögerung für Animation\n      setTimeout(() => {\n        // Verstecke Preview-Grid und zeige Hauptgrid\n        this.hidePreviewGrid();\n        this.showMainGrid();\n        \n        // Verwende gespeicherten ursprünglichen Zustand\n        if (this.originalPreviewState) {\n          this.selection = this.originalPreviewState.selection;\n          this.cols = this.originalPreviewState.cols;\n          this.rows = this.originalPreviewState.rows;\n          \n          if (this.orV && this.orH && this.originalPreviewState.orientation !== null) {\n            this.orV.checked = this.originalPreviewState.orientation;\n            this.orH.checked = !this.originalPreviewState.orientation;\n          }\n          \n          // Zusätzliche Eigenschaften wiederherstellen\n          if (this.wIn && this.originalPreviewState.cellWidth) {\n            this.wIn.value = this.originalPreviewState.cellWidth;\n          }\n          if (this.hIn && this.originalPreviewState.cellHeight) {\n            this.hIn.value = this.originalPreviewState.cellHeight;\n          }\n          \n          // Grid wiederherstellen\n          this.updateSize();\n          this.buildGrid();\n          \n          // Gespeicherten Zustand löschen\n          this.originalPreviewState = null;\n          console.log('Grid preview cleared and original state restored');\n        }\n        \n        // Sicherheitscheck: Stelle sicher, dass das Grid sichtbar ist\n        setTimeout(() => {\n          const mainGrid = document.getElementById('grid');\n          if (mainGrid && mainGrid.style.display === 'none') {\n            this.showMainGrid();\n          }\n        }, 100);\n      }, 150); // Kurze Verzögerung für smooth Animation\n    }\n    \n    setupResizeObserver() {\n      // Performance: Resize Observer für responsive Updates\n      if (this.wrapper && window.ResizeObserver) {\n        this.resizeObserver = new ResizeObserver((entries) => {\n          // Debounced resize updates\n          if (this.resizeTimeout) {\n            clearTimeout(this.resizeTimeout);\n          }\n          \n          this.resizeTimeout = setTimeout(() => {\n            this.updateSize();\n            this.resizeTimeout = null;\n          }, 150); // 150ms debounce\n        });\n        \n        this.resizeObserver.observe(this.wrapper);\n      }\n    }\n    // FEATURE 8: Pinch-to-Zoom Setup\n    setupPinchToZoom() {\n      if (!this.wrapper) return;\n      \n      let initialDistance = 0;\n      let initialZoom = 1;\n      \n      this.wrapper.addEventListener('touchstart', (e) => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          initialDistance = this.getTouchDistance(e.touches[0], e.touches[1]);\n          initialZoom = this.zoomLevel;\n        }\n      });\n      \n      this.wrapper.addEventListener('touchmove', (e) => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const currentDistance = this.getTouchDistance(e.touches[0], e.touches[1]);\n          const scale = currentDistance / initialDistance;\n          const newZoom = Math.max(this.minZoom, Math.min(this.maxZoom, initialZoom * scale));\n          \n          this.setZoom(newZoom);\n        }\n      });\n      \n      this.wrapper.addEventListener('touchend', (e) => {\n        if (e.touches.length < 2) {\n          initialDistance = 0;\n          initialZoom = 1;\n        }\n      });\n    }\n    \n    getTouchDistance(touch1, touch2) {\n      const dx = touch1.clientX - touch2.clientX;\n      const dy = touch1.clientY - touch2.clientY;\n      return Math.sqrt(dx * dx + dy * dy);\n    }\n    \n    setZoom(zoomLevel) {\n      this.zoomLevel = zoomLevel;\n      this.wrapper.style.transform = `scale(${zoomLevel})`;\n      this.wrapper.style.transformOrigin = 'center center';\n    }\n    \n    cleanup() {\n      // Memory-Leak Prävention: Alle Timeouts löschen\n      if (this.updateTimeout) {\n        clearTimeout(this.updateTimeout);\n        this.updateTimeout = null;\n      }\n      \n      if (this.previewTimeout) {\n        clearTimeout(this.previewTimeout);\n        this.previewTimeout = null;\n      }\n      \n      if (this.resizeTimeout) {\n        clearTimeout(this.resizeTimeout);\n        this.resizeTimeout = null;\n      }\n      \n      if (this.debounceTimer) {\n        clearTimeout(this.debounceTimer);\n        this.debounceTimer = null;\n      }\n      \n      if (this.toastTimeout) {\n        clearTimeout(this.toastTimeout);\n        this.toastTimeout = null;\n      }\n      \n      if (this.autoSaveTimeout) {\n        clearTimeout(this.autoSaveTimeout);\n        this.autoSaveTimeout = null;\n      }\n      \n      if (this._recomputeTotalsTimer) {\n        clearTimeout(this._recomputeTotalsTimer);\n        this._recomputeTotalsTimer = null;\n      }\n      \n      // Resize Observer cleanup\n      if (this.resizeObserver) {\n        this.resizeObserver.disconnect();\n        this.resizeObserver = null;\n      }\n      \n      // Foxy Observer cleanup\n      if (this._foxyObserver) {\n        this._foxyObserver.disconnect();\n        this._foxyObserver = null;\n      }\n      \n      // Memory: Debounce Timer cleanup\n      if (this.debounceTimer) {\n        clearTimeout(this.debounceTimer);\n        this.debounceTimer = null;\n      }\n      \n      // Memory: Event Listener cleanup\n      this.cleanupEventListeners();\n      \n      // Memory: DOM Reference cleanup\n      this.cleanupDOMReferences();\n      \n      // Memory: Web Worker cleanup\n      this.cleanupWorkers();\n      \n      // FEATURE 5: Performance-Monitoring Cleanup\n      if (this.performanceMetrics) {\n        this.performanceMetrics = null;\n      }\n    }\n    \n    // Memory: Event Listener Cleanup\n    cleanupEventListeners() {\n      try {\n        // Input-Event-Listener cleanup\n        const inputs = [this.wIn, this.hIn].filter(el => el);\n        inputs.forEach(el => {\n          el.removeEventListener('change', this.handleInputChange);\n        });\n        \n        // Modul-Auswahl-Event-Listener cleanup\n        if (this.moduleSelect) {\n          this.moduleSelect.removeEventListener('change', this.handleModuleSelectChange);\n        }\n        \n        // Orientation-Event-Listener cleanup\n        if (this.orH && this.orV) {\n          [this.orH, this.orV].forEach(el => {\n            el.removeEventListener('change', this.handleOrientationChange);\n          });\n        }\n        \n        // Checkbox-Event-Listener cleanup\n        [this.incM, this.mc4, this.solarkabel, this.holz, this.quetschkabelschuhe, this.kabelbinder, this.erdungsband, this.ulicaModule]\n          .filter(el => el).forEach(el => {\n            el.removeEventListener('change', this.handleCheckboxChange);\n          });\n        \n        // Expansion-Button-Event-Listener cleanup\n        if (this.boundExpansionClick) {\n          document.querySelectorAll('[data-dir=\"right\"], [data-dir=\"left\"]').forEach(btn => {\n            btn.removeEventListener('click', this.boundExpansionClick);\n          });\n          this.boundExpansionClick = null;\n        }\n        \n        // Grid-Event-Listener cleanup\n        if (this.gridEl) {\n          this.gridEl.removeEventListener('click', this.handleGridClick);\n        }\n        \n      } catch (error) {\n        console.warn('[SolarGrid] Event listener cleanup error:', error);\n      }\n    }\n    \n    // Memory: DOM Reference Cleanup\n    cleanupDOMReferences() {\n      try {\n        // DOM Element References nullen\n        this.gridEl = null;\n        this.wrapper = null;\n        this.prodList = null;\n        this.listHolder = null;\n        this.wIn = null;\n        this.hIn = null;\n        this.moduleSelect = null;\n        this.orH = null;\n        this.orV = null;\n        this.incM = null;\n        this.mc4 = null;\n        this.solarkabel = null;\n        this.holz = null;\n        this.quetschkabelschuhe = null;\n        this.kabelbinder = null;\n        this.erdungsband = null;\n        this.ulicaModule = null;\n        \n        // Cache References nullen\n        this.configListEl = null;\n        this.foxyFormsByName = null;\n        \n        // Array References nullen und Garbage Collection triggern\n        this.cleanupArrays();\n        \n      } catch (error) {\n        console.warn('[SolarGrid] DOM reference cleanup error:', error);\n      }\n    }\n    \n    // Memory: Web Worker Cleanup\n    cleanupWorkers() {\n      try {\n        // CalculationManager Worker cleanup\n        if (this.calculationManager && typeof this.calculationManager.cleanup === 'function') {\n          this.calculationManager.cleanup();\n          this.calculationManager = null;\n        }\n        \n        // Weitere Worker-Instanzen falls vorhanden\n        if (this.worker) {\n          this.worker.terminate();\n          this.worker = null;\n        }\n        \n      } catch (error) {\n        console.warn('[SolarGrid] Worker cleanup error:', error);\n      }\n    }\n    \n    // Memory: Cache Size Management\n    manageCacheSize() {\n      try {\n        const MAX_CACHE_SIZE = 20; // Reduziert: Maximale Anzahl Konfigurationen\n        const MAX_CACHE_AGE = 24 * 60 * 60 * 1000; // Reduziert: 1 Tag in ms\n        \n        // Begrenze Anzahl der Konfigurationen\n        if (this.configs && this.configs.length > MAX_CACHE_SIZE) {\n          // Behalte die neuesten Konfigurationen\n          this.configs = this.configs.slice(-MAX_CACHE_SIZE);\n          console.log(`[SolarGrid] Cache size limited to ${MAX_CACHE_SIZE} configurations`);\n        }\n        \n        // Entferne alte Konfigurationen basierend auf Timestamp\n        if (this.configs && this.configs.length > 0) {\n          const now = Date.now();\n          this.configs = this.configs.filter(config => {\n            if (!config.timestamp) return true; // Behalte Konfigurationen ohne Timestamp\n            const age = now - new Date(config.timestamp).getTime();\n            return age < MAX_CACHE_AGE;\n          });\n        }\n        \n        // Memory: Bereinige große Arrays in Konfigurationen\n        if (this.configs) {\n          this.configs.forEach(config => {\n            if (config.selection && Array.isArray(config.selection)) {\n              const totalCells = config.selection.reduce((sum, row) => \n                sum + (Array.isArray(row) ? row.length : 0), 0);\n              if (totalCells > 500) { // Reduziert: Frühere Komprimierung\n                // Komprimiere große Selection-Arrays aggressiver\n                config.selection = config.selection.map(row => \n                  Array.isArray(row) ? row.slice(0, 25) : row); // Reduziert: 25 statt 50\n              }\n            }\n          });\n        }\n        \n      } catch (error) {\n        console.warn('[SolarGrid] Cache size management error:', error);\n      }\n    }\n    \n    // Memory: Array Garbage Collection\n    cleanupArrays() {\n      try {\n        // Explizite Array-Bereinigung\n        if (this.selection) {\n          this.selection.forEach(row => {\n            if (Array.isArray(row)) {\n              row.length = 0; // Leere Array-Inhalte\n            }\n          });\n          this.selection.length = 0; // Leere das Array\n          this.selection = null;\n        }\n        \n        if (this.configs) {\n          this.configs.forEach(config => {\n            if (config.selection && Array.isArray(config.selection)) {\n              config.selection.forEach(row => {\n                if (Array.isArray(row)) {\n                  row.length = 0;\n                }\n              });\n              config.selection.length = 0;\n            }\n          });\n          this.configs.length = 0;\n          this.configs = null;\n        }\n        \n        if (this.moduleData) {\n          Object.keys(this.moduleData).forEach(key => {\n            delete this.moduleData[key];\n          });\n          this.moduleData = null;\n        }\n        \n        // Memory: Explizite Garbage Collection triggern (falls verfügbar)\n        if (typeof gc === 'function') {\n          gc();\n        }\n        \n      } catch (error) {\n        console.warn('[SolarGrid] Array cleanup error:', error);\n      }\n      \n      // FEATURE 8: Pinch-to-Zoom Cleanup\n      if (this.zoomObserver) {\n        this.zoomObserver = null;\n      }\n      \n      // Event-Listener entfernen\n      if (this.gridEl) {\n        this.gridEl.innerHTML = '';\n      }\n      \n      // PDF Generator cleanup\n      if (this.pdfGenerator) {\n        this.pdfGenerator = null;\n      }\n    }\n\n    // --- Vorab-Berechnung aller Produkt-Gesamtmengen ---\n    computeAllTotalsSnapshot() {\n      // Aggregiert alle Konfigurationen + Zusatzprodukte gemäß aktuellem UI-State\n      const totals = {};\n      const add = (key, qty) => { if (!qty || qty <= 0) return; totals[key] = (totals[key] || 0) + qty; };\n\n      // Durch alle Konfigurationen iterieren (Deep-Inputs aus gespeicherten Configs)\n      for (let i = 0; i < (this.configs?.length || 0); i++) {\n        const cfg = this.configs[i]; if (!cfg) continue;\n        // Temporär mit isolierten Daten rechnen\n        const originalSel = this.selection; const originalRows = this.rows; const originalCols = this.cols;\n        const originalOrV = this.orV && this.orV.checked;\n        try {\n          this.selection = (cfg.selection || []).map(r => Array.isArray(r) ? r.slice() : r);\n          this.rows = cfg.rows; this.cols = cfg.cols;\n          if (this.orV) { this.orV.checked = (cfg.orientation === 'vertical'); }\n          const p = this.calculatePartsSync();\n          Object.entries(p).forEach(([k,v]) => add(k, v));\n        } catch(_) {\n        } finally {\n          this.selection = originalSel; this.rows = originalRows; this.cols = originalCols;\n          if (this.orV) { this.orV.checked = originalOrV; }\n        }\n      }\n\n      // Zusatzprodukte global nachziehen (Huawei/BRC Optimierer, Erdungsband, Quetsch etc.)\n      try {\n        // Optimierer: Menge aus UI\n        const hCb = document.getElementById('huawei-opti');\n        const bCb = document.getElementById('brc-opti');\n        const qEl = document.getElementById('opti-qty');\n        const optiQty = Math.max(1, parseInt(qEl && qEl.value || '1', 10));\n        if (hCb && hCb.checked) add('HuaweiOpti', optiQty);\n        if (bCb && bCb.checked) add('BRCOpti', optiQty);\n        \n        // Kabelbinder: 1x wenn Checkbox aktiv\n        if (document.getElementById('kabelbinder')?.checked) {\n          add('Kabelbinder', 1);\n        }\n        \n        // Ringkabelschuhe: 1x wenn Checkbox aktiv\n        if (document.getElementById('quetschkabelschuhe')?.checked) {\n          add('Ringkabelschuhe', 1);\n        }\n        \n        // Erdungsband: Berechne Menge basierend auf allen Konfigurationen\n        if (document.getElementById('erdungsband')?.checked) {\n          let totalErdungsband = 0;\n          for (let i = 0; i < (this.configs?.length || 0); i++) {\n            const cfg = this.configs[i];\n            if (!cfg) continue;\n            const moduleCount = (cfg.selection || []).flat().filter(Boolean).length;\n            totalErdungsband += Math.ceil(moduleCount / 10); // 1 Erdungsband pro 10 Module\n          }\n          if (totalErdungsband > 0) add('Erdungsband', totalErdungsband);\n        }\n        \n        // Blech-Bohrschrauben: 1x wenn Erdungsband aktiv\n        if (document.getElementById('erdungsband')?.checked) {\n          add('BlechBohrschrauben', 1);\n        }\n      } catch(_) {}\n\n    // Tellerkopfschraube 2 × Dachhaken (falls nicht bereits global konsistent)\n    if (totals.Dachhaken && !totals.Tellerkopfschraube) add('Tellerkopfschraube', totals.Dachhaken * 2);\n\n    // Modul-Inklusionsregeln gemäß UI-Checkboxen anwenden\n    try {\n      const includeModules = this.incM ? this.incM.checked !== false : true; // default true\n      const ulicaEnabled = this.ulicaModule ? this.ulicaModule.checked === true : false;\n      if (!includeModules) delete totals.Solarmodul;\n      if (!ulicaEnabled) delete totals.UlicaSolarBlackJadeFlow;\n    } catch(_) {}\n\n    // Globale Palettenbündelung über alle Konfigurationen anwenden (36er)\n    try { this.bundleTotalModulesIntoPallets(totals); } catch(_) {}\n\n    // In Pack-Mengen (Stückzahl der zu sendenden Produkte) umwandeln\n    const sendTotals = {};\n    try {\n      Object.entries(totals).forEach(([k, v]) => {\n        const ve = VE[k] || 1;\n        const packs = Math.ceil((Number(v) || 0) / ve);\n        if (packs > 0) sendTotals[k] = packs;\n      });\n    } catch(_) {}\n\n    // Konsolen-Ausgabe (Pack-Mengen)\n    try {\n      const rows = Object.entries(sendTotals)\n        .sort(([a],[b]) => a.localeCompare(b))\n        .map(([k,v]) => ({ key: k, name: PRODUCT_NAME_MAP[k] || k, qty: v }));\n      console.groupCollapsed('[Totals] Aktualisiert (Packs)');\n      console.table(rows);\n      console.groupEnd();\n    } catch(_) {}\n\n    return sendTotals;\n    }\n\n    saveTotalsToCache(snapshot) {\n      try {\n        // WICHTIG: Nicht alten Cache-Stand zurückschreiben. Stattdessen aktuellen In-Memory-State verwenden\n        const deepCloneSelection = (sel) => Array.isArray(sel) ? sel.map(r => Array.isArray(r) ? r.slice() : r) : sel;\n        const deepCloneConfig = (cfg) => ({\n          ...cfg,\n          selection: deepCloneSelection(cfg.selection)\n        });\n        const cacheData = {\n          configs: Array.isArray(this.configs) ? this.configs.map(deepCloneConfig) : [],\n          currentConfig: this.currentConfig,\n          selection: deepCloneSelection(this.selection),\n          cols: this.cols,\n          rows: this.rows,\n          cellWidth: parseInt(this.wIn ? this.wIn.value : '179', 10),\n          cellHeight: parseInt(this.hIn ? this.hIn.value : '113', 10),\n          orientation: this.orV && this.orV.checked ? 'vertical' : 'horizontal',\n          includeModules: this.incM ? this.incM.checked : false,\n          mc4: this.mc4 ? this.mc4.checked : false,\n          solarkabel: this.solarkabel ? this.solarkabel.checked : false,\n          holz: this.holz ? this.holz.checked : false,\n          quetschkabelschuhe: this.quetschkabelschuhe ? this.quetschkabelschuhe.checked : false,\n          erdungsband: this.erdungsband ? this.erdungsband.checked : false,\n          ulicaModule: this.ulicaModule ? this.ulicaModule.checked : false,\n          huaweiOpti: (document.getElementById('huawei-opti')?.checked) || false,\n          brcOpti: (document.getElementById('brc-opti')?.checked) || false,\n          optiQty: parseInt(document.getElementById('opti-qty')?.value || '1', 10),\n          moduleSelectValue: this.moduleSelect ? this.moduleSelect.value : '',\n          gridStructure: {\n            cols: this.cols,\n            rows: this.rows,\n            cellWidth: parseInt(this.wIn ? this.wIn.value : '179', 10),\n            cellHeight: parseInt(this.hIn ? this.hIn.value : '113', 10)\n          },\n          totals: snapshot\n        };\n        this.cacheManager.saveData(cacheData);\n        this.totalPartsCache = snapshot;\n      } catch(_) {}\n    }\n\n    loadTotalsFromCache() {\n      try {\n        const data = this.cacheManager.loadData();\n        const totals = data && data.totals ? data.totals : null;\n        if (totals) { this.totalPartsCache = totals; }\n        return totals;\n      } catch(_) { return null; }\n    }\n\n    recomputeTotalsDebounced() {\n      if (this._recomputeTotalsTimer) clearTimeout(this._recomputeTotalsTimer);\n      this._recomputeTotalsTimer = setTimeout(() => {\n        const snap = this.computeAllTotalsSnapshot();\n        this.saveTotalsToCache(snap);\n      }, 150);\n    }\n  }\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    // Kundentyp-UI (Listen/Buttons) wird global im customer-type-popup.js verwaltet\n    const grid = new SolarGrid();\n    // Foxy: kein Webflow-Mapping mehr – stattdessen Foxy-Form-Mapping initialisieren, falls vorhanden\n    if (typeof grid.initFoxyFormMap === 'function') {\n      grid.initFoxyFormMap();\n    }\n    \n    // CMS-Suche wird in cms-search.js initialisiert\n    // Verstecke Collection-List/Wrapper der Foxy-Forms (bleiben im DOM für Submit nutzbar)\n    try {\n      const wrappers = document.querySelectorAll('.w-dyn-list, .w-dyn-items, .w-dyn-item, .rt-component-section');\n      wrappers.forEach(el => {\n        if (!el || !el.style) return;\n        el.style.position = 'absolute';\n        el.style.left = '-9999px';\n        el.style.top = '-9999px';\n        el.style.width = '1px';\n        el.style.height = '1px';\n        el.style.overflow = 'hidden';\n        el.style.clip = 'rect(0, 0, 0, 0)';\n        el.style.whiteSpace = 'nowrap';\n      });\n    } catch(_) {}\n    window.solarGrid = grid;\n  });\n\n  // Memory: Einheitlicher Cleanup beim Verlassen der Seite\n  window.addEventListener('beforeunload', () => {\n    try {\n      // CalculationManager cleanup\n    if (calculationManager) {\n      calculationManager.destroy();\n    }\n    \n      // SolarGrid cleanup\n      if (window.solarGrid && typeof window.solarGrid.cleanup === 'function') {\n      window.solarGrid.cleanup();\n      }\n      \n      // Alle Timeouts löschen\n      const highestTimeoutId = setTimeout(() => {}, 0);\n      for (let i = 0; i < highestTimeoutId; i++) {\n        clearTimeout(i);\n      }\n      \n      // Alle Intervals löschen\n      const highestIntervalId = setInterval(() => {}, 0);\n      for (let i = 0; i < highestIntervalId; i++) {\n        clearInterval(i);\n      }\n      \n    } catch (error) {\n      console.warn('[SolarGrid] Cleanup on unload error:', error);\n    }\n  });\n\n  window.debugFoxy = {\n    list: () => {\n      const out = [];\n      try {\n        if (!window.solarGrid || !window.solarGrid.foxyDataByName) return out;\n        window.solarGrid.foxyDataByName.forEach((v, k) => out.push({ key: k, ...v }));\n      } catch(_) {}\n      console.table(out);\n      return out;\n    },\n    get: (name) => {\n      try {\n        if (window.solarGrid && window.solarGrid.foxyDataByName) return window.solarGrid.foxyDataByName.get(name) || null;\n      } catch(_) {}\n      return null;\n    }\n  };\n})();"],"mappings":"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","ignoreList":[]}