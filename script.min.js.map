{"version":3,"names":["CacheManager","constructor","this","cacheKey","cacheTimeout","debounceTimeout","debounceDelay","isLocalStorageAvailable","test","localStorage","setItem","removeItem","e","console","warn","saveData","data","clearTimeout","setTimeout","cacheData","timestamp","Date","now","version","JSON","stringify","log","toLocaleString","error","loadData","cachedData","getItem","parse","clearCache","isCacheValid","VE","Endklemmen","Schrauben","Dachhaken","Mittelklemmen","Endkappen","Schienenverbinder","Schiene_240_cm","Schiene_360_cm","Solarmodul","UlicaSolarBlackJadeFlow","MC4_Stecker","Solarkabel","Holzunterleger","Erdungsklemme","Quetschkabelschuhe","Erdungsband","Tellerkopfschraube","PRICE_MAP","PRODUCT_MAP","productId","variantId","PRODUCT_NAME_MAP","PRODUCT_IMAGES","calculationManager","worker","pendingCalculations","Map","calculationId","isWorkerReady","initWorker","Worker","onmessage","type","id","has","resolve","get","delete","reject","Error","message","onerror","calculate","Promise","set","postMessage","calculateSync","calculatePartsSync","calculateExtendedPartsSync","selection","rows","cols","cellWidth","cellHeight","orientation","options","parts","y","Array","isArray","run","x","processGroupSync","len","totalLen","floor360","Math","floor","rem360","variants","cnt360","cnt240","ceil","map","v","rails","waste","minRails","min","best","filter","reduce","a","b","ulicaModule","includeModules","mc4Connectors","panelCount","flat","length","solarkabel","woodUnderlay","erdungsband","destroy","terminate","clear","priceCache","cache","lastUpdate","timestampKey","cacheDuration","isUpdating","loadFromStorage","scheduleNextUpdate","parsedData","parseInt","Object","entries","updatePricesFromHTML","saveToStorage","cacheObject","fromEntries","toString","promises","keys","async","productKey","price","getPriceFromHTMLAsync","results","all","forEach","extractPriceFromHTML","productInfo","productForm","document","querySelector","priceElement","priceText","textContent","innerHTML","replace","priceMatch","match","parseFloat","getPrice","nextUpdate","timeUntilUpdate","max","forceUpdate","getPriceFromCache","window","debugPriceCache","getCache","getCacheAge","ageMs","round","testQuetschkabelschuhe","priceMap","cacheValue","fallback","resetAndReload","SolarPDFGenerator","solarGrid","jsPDF","jspdf","html2canvas","html2pdf","companyLogoUrl","headerLogoBlueUrl","isAvailable","generatePDFFromSnapshot","snapshot","showToast","configs","renderSnapshotIntoPdfTemplate","rootEl","getElementById","prevStyle","getAttribute","style","position","left","top","opacity","pointerEvents","zIndex","background","container","images","from","querySelectorAll","img","complete","naturalWidth","done","addEventListener","once","waitForImages","r","requestAnimationFrame","pages","pdf","unit","format","i","pageEl","width","height","boxSizing","canvas","scale","backgroundColor","useCORS","allowTaint","logging","w","h","imgData","toDataURL","addPage","addImage","fileName","generateFileName","save","setAttribute","err","root","dateStr","toLocaleDateString","config","page","createElement","className","minHeight","padding","name","selectedCells","gridImg","captureGridVisualizationFromSnapshot","src","productsPage","renderProductsIntoTable","htmlLayout","excludeAdditionalProducts","tbody","trim","makeFooter","footer","right","bottom","color","display","alignItems","justifyContent","fontSize","alt","appendChild","additionalParts","computeAdditionalProductsForSnapshot","k","dateStr2","additionalPage","renderAdditionalProductsIntoTable","tbodyEl","totalEl","calculatePartsFromSnapshot","totalPrice","ADDITIONAL_KEYS","Set","key","value","ve","packs","rowPrice","push","sort","localeCompare","productName","toFixed","join","anyMc4","some","c","mc4","anyCable","cable","anyWood","wood","holz","anyQuetsch","quetschkabelschuhe","totalSelectedCells","sum","Boolean","result","generatePDF","mode","fullSnapshot","createConfigSnapshot","snapshotToExport","idx","currentConfigIndex","only","totalConfigs","addHeader","pageWidth","setTextColor","setFontSize","setFont","text","getInvertedLogoBase64","originalBase64","_invertedLogoBase64Promise","Image","onload","ctx","getContext","drawImage","imageData","getImageData","putImageData","addFooter","pageHeight","footerY","setFillColor","rect","logoBase64","loadImageAsBase64","invertedLogoBase64","logoHeight","logoWidth","logoX","logoY","url","crossOrigin","naturalHeight","imageSmoothingEnabled","calculateTotalPriceFromSnapshot","addConfigurationToPDFFromSnapshot","isFirstPage","positionRef","checkPageBreak","neededSpace","dimensions","totalCells","setDrawColor","setLineWidth","gridImage","maxHeight","targetWidth","computedHeight","centerX","centerY","addProductTableFromSnapshot","captureGridVisualization","tempContainer","body","cellSize","cellGap","gridEl","gap","gridTemplateColumns","gridTemplateRows","border","borderRadius","normalizedSelection","_","originalRows","originalCols","targetRows","targetCols","cell","isSelected","offsetWidth","offsetHeight","removeChild","captureGridImageForWebhook","configData","isVertical","baseCellSize","boxShadow","transition","pattern","gridLines","backgroundImage","backgroundSize","totalWidth","totalHeight","fillStyle","fillRect","startX","startY","cellX","cellY","strokeStyle","lineWidth","strokeRect","lineX","beginPath","moveTo","lineTo","stroke","lineY","base64Image","canvasWidth","canvasHeight","dataURLLength","dataURLStart","substring","maxWidthPx","maxHeightPx","gapBase","modW","Number","modH","orientVertical","unitW","unitH","rawGridW","rawGridH","cellW","cellH","actualW","actualH","third","yPosition","roundedRect","rowCount","quantity","packsNeeded","totalForProduct","align","line","calculationData","row","incM","calculatePartsDirectly","MC4","calculateErdungsband","addProductTable","calculateConfigParts","needed","pricePerPack","totalProductPrice","moduleCount","toISOString","slice","timeStr","toTimeString","configName","SmartConfigParser","patterns","gridSize","moduleCheckbox","rowPattern","spacing","gridCompact","gridSpaced","checkboxCombination","saveConfig","deleteConfig","deleteModules","resetGrid","distributionEqual","distributionRows","distributionColumns","distributionRandom","spacingDouble","spacingRowsOnly","spacingColumnsOnly","checkboxAllExcept","checkboxOnly","checkboxWithout","checkboxWithAll","saveWithName","parseWordNumber","word","wordNumbers","ein","eine","zwei","drei","vier","sechs","sieben","acht","neun","zehn","toLowerCase","parseCheckboxCombinations","input","checkboxes","modules","split","includes","part","trimmedPart","parseInput","gridMatch","spacingMatch","spacingRows","adjustSpacing","actualRows","rowConfig","modulesPerRow","totalModules","gridCompactMatch","gridSpacedMatch","rowMatch","spacingOnlyMatch","numRows","intelligentDistribution","baseModulesPerRow","extraModules","neededRows","distributionEqualMatch","distributionRowsMatch","distributionColumnsMatch","distributionRandomMatch","distribution","moduleMatch","spacingDoubleMatch","spacingRowsOnlyMatch","spacingColumnsOnlyMatch","calculateOptimalGrid","optimalRows","sqrt","orientationMatch","checkboxAllExceptMatch","checkboxOnlyMatch","checkboxWithoutMatch","checkboxWithAllMatch","exceptWord","exceptItem","onlyItems","items","item","checkboxCombinations","values","moduleCheckboxMatch","mc4Match","cableMatch","woodMatch","quetschkabelschuheMatch","ulicaMatch","watt","selectedModule","saveWithNameMatch","action","useCurrentGrid","factors","applyConfiguration","oldSelection","oldCols","oldRows","orV","checked","orH","orientHBtn","orientVBtn","classList","toggle","handleAction","hasOwnProperty","moduleSelect","handleModuleSelectChange","updateAllConfigurationsForCheckboxes","newSelection","updateSize","buildGrid","buildList","updateSummaryOnChange","adjustGridSpacing","applyRowConfiguration","autoSelectModules","hideHelpAfterFirstUse","applyPreviewToMainGrid","hidePreviewGrid","showMainGrid","renameCurrentConfig","saveNewConfig","currentConfig","clearModuleSelection","resetGridToDefault","helpSection","count","expandGridForModules","selected","targetCount","newCols","newRows","spacingConfig","occupiedRows","originalRow","maxModuleX","currentTargetRow","occupiedRow","moduleX","neededCols","expandGridForRowConfig","currentRow","modulesPlaced","rowIndex","modulesInThisRow","BulkSelector","firstClick","isSelecting","bulkMode","isDragging","dragStart","mousePressed","setupKeyListener","setupGlobalMouseEvents","toggleBulkMode","showBulkModeIndicator","clearHighlight","active","el","remove","indicator","cssText","head","initializeBulkSelection","originalBuildGrid","bind","addBulkSelectionToGrid","index","newCell","cloneNode","parentNode","replaceChild","preventDefault","handleDragStart","highlightRange","handleDragEnd","ctrlKey","metaKey","trackInteraction","updateConfig","updateConfigList","selectRange","start","end","minX","maxX","minY","maxY","shouldSelect","wasSelected","cells","isSelectMode","undefined","add","resetDragState","calculateRangeSize","clearFirstClickMarker","isCurrentlySelected","SolarGrid","wrapper","wIn","hIn","listHolder","prodList","saveBtn","addBtn","summaryBtn","configListEl","resetBtn","continueLaterBtn","moduleData","moduleCheckboxMapping","default","updateTimeout","updateDelay","resizeObserver","resizeTimeout","zoomLevel","minZoom","maxZoom","zoomObserver","performanceMetrics","gridRenderTime","updateTime","memoryUsage","fps","errorCount","sessionId","generateSessionId","sessionStartTime","firstInteractionTime","lastInteractionTime","interactionCount","webhookUrl","pdfGenerator","cacheManager","init","saveToUrl","random","substr","formatDuration","milliseconds","totalSeconds","hours","minutes","seconds","padStart","getSessionData","sessionDurationMs","timeToFirstInteractionMs","timeSinceLastInteractionMs","sessionDuration","timeToFirstInteraction","timeSinceLastInteraction","getProductSummary","calculateParts","productQuantities","generateGridVisualization","html","css","getConfigData","targetConfig","summary","gridVisualization","allProductQuantities","Schiene240cm","Schiene360cm","sessionData","analytics","selectionPercentage","gridArea","averageCellSize","sendConfigToWebhook","analyticsData","userAgent","navigator","screenResolution","screen","featureUsage","dragToSelect","smartConfig","smartConfigUsed","mobileDevice","checkMobileDevice","base64Only","base64","mimeType","fetch","method","headers","ok","sendCurrentConfigToWebhook","sendAllConfigsToWebhook","successCount","cfg","originalSelection","originalOrientation","originalSolarkabel","originalIncM","originalMc4","originalHolz","configIndex","totalConfigsInSession","success","innerWidth","showMobileWarning","mobileWarning","continueBtn","closeBtn","sessionStorage","target","loadFromCache","rawData","URLSearchParams","location","search","json","decodeURIComponent","atob","loadConfig","setupAllEventListeners","addCurrentToCart","addAllToCart","generateContinueLink","initSidebarNavigation","setup","defaultConfig","_makeConfigObject","setupResizeObserver","setupPinchToZoom","initSmartConfigFeatures","initAutoSaveIndicator","initConfigList","backToOverviewBtn","showOverview","editConfigBtn","editConfigName","deleteConfigBtn","deleteCurrentConfig","expressCheckoutBtn","nextConfigBtn","addAllToCartBtn","addAllConfigsToCart","resetAllConfigurations","addConfigBtn","detailView","overviewView","clearAllInputFields","titleEl","nameEl","contains","initAdditionalProductsListeners","showDetailView","updateDetailView","updateCurrentTotalPrice","totalPriceEl","calculateConfigPrice","renderConfigList","updateOverviewTotalPrice","renderAdditionalProducts","autoSaveTimeout","showAutoSaveIndicator","saveIcon","animation","additionalProductsPrice","calculateAdditionalProductsPrice","total","additionalProductsListEl","packagesNeeded","checkboxId","checkbox","focus","select","saveEdit","newName","cancelEdit","editConfigNameInList","configItem","evt","stopPropagation","alert","confirm","splice","deleteConfigFromList","event","processGroupDirectly","partName","pricePerPackage","smartParser","bulkSelector","ensurePermanentVisibility","initSmartConfigCloseButton","initQuickConfigInterface","usageTips","checkAndHideHelp","closeButton","initSmartConfig","quickInput","newQuickInput","previewTimeout","updateInputValidation","showConfigPreview","self","clearGridPreview","initializeSmartConfigHelp","readyState","inputElement","showGridPreview","trigger","dropdown","isHovered","hoverTimeout","hideDropdown","visibility","transform","example","scrollIntoView","behavior","block","oldSel","updateSaveButtons","removeEventListener","handleInputChange","handleOrientationChange","syncOrientationButtons","handleCheckboxChange","boundExpansionClick","handleExpansionClick","btn","boundOrientationClick","handleOrientationButtonClick","ensureOrientationButtonsSync","isVerticalActive","isHorizontalActive","radioVerticalChecked","radioHorizontalChecked","selectedValue","enableInputs","clearModuleCheckboxes","module","disableInputs","handleModuleCheckboxChange","dir","dataset","isPlus","addColumnRight","removeColumnRight","addColumnLeft","removeColumnLeft","addRowTop","removeRowTop","addRowBottom","removeRowBottom","orientationProcessing","clickedBtn","currentTarget","disabled","cursor","updateGridAfterStructureChange","pop","unshift","shift","fill","getComputedStyle","documentElement","inputW","inputH","originalCellW","originalCellH","maxWidth","clientWidth","clientHeight","scaleX","scaleY","visualGap","setProperty","finalWidth","finalHeight","fragment","createDocumentFragment","click","itemTotal","div","itemDetails","itemVE","erdungsbandtotal","defaultVertical","orientHSetup","orientVSetup","resetToDefaultGrid","colsIn","rowsIn","p","processGroup","mapImage","moduleHeight","erdungsbandMatrix","analyzeFieldForErdungsband","assignErdungsbandLength","checkLeftFieldsErdungsband","leftUpper","leftLower","checkLeftFieldsRecursive","checkX","loadConfigFromCache","loadFirstConfigFromCache","updateFirstConfigOrientation","globalOrientation","duration","toast","toastTimeout","customName","emptySelection","newIndex","createNewConfig","newConfig","nextNumber","canDelete","closest","arraysEqual","j","startTime","performance","saveToCache","moduleSelectValue","gridStructure","generateHiddenCartForms","webflowForms","webflowFormMap","form","skuId","find","hideWebflowForms","addProductToCart","isLastItem","qtyInput","addToCartButton","clickWebflowButtonSafely","button","iframe","originalTarget","hasLoaded","addPartsListToCart","qty","hideCartContainer","allButLast","lastEntry","showCartContainer","lastKey","lastQty","cartContainer","_buildPartsFor","itemCount","then","configSnapshot","allBundles","currentParts","totalItemCount","sel","_buildCartItems","m","getCurrentConfigData","targetSelection","targetOrientation","targetIncM","targetMc4","targetCable","targetWood","targetQuetschkabelschuhe","targetErdungsband","targetUlicaModule","targetCellWidth","targetCellHeight","isolatedConfig","getAllConfigsData","originalPreviewState","createPreviewGrid","hideMainGrid","showPreviewGrid","mainGrid","previewGrid","previewCols","previewRows","previewSelection","createModuleSelection","hasSpacing","colIndex","newRowIndex","oldRow","col","buildPreviewGrid","ResizeObserver","observe","initialDistance","initialZoom","touches","getTouchDistance","newZoom","setZoom","touch1","touch2","dx","clientX","dy","clientY","transformOrigin","cleanup","disconnect","grid"],"sources":["script.js"],"sourcesContent":["(function() {\n  const ADD_TO_CART_DELAY = 400;\n  // Global debug toggle: disable noisy logs in production\n  const DEBUG_MODE = false;\n  if (!DEBUG_MODE) {\n    // Console bleibt aktiv für Debugging\n  }\n  \n  // Cache-Manager für 24h Persistierung\n  class CacheManager {\n    constructor() {\n      this.cacheKey = 'solarTool_continueCache';\n      this.cacheTimeout = 24 * 60 * 60 * 1000; // 24 Stunden\n      this.debounceTimeout = null;\n      this.debounceDelay = 500; // 500ms Delay für Performance\n    }\n    \n    // Prüfe ob localStorage verfügbar ist\n    isLocalStorageAvailable() {\n      try {\n        const test = '__localStorage_test__';\n        localStorage.setItem(test, test);\n        localStorage.removeItem(test);\n        return true;\n      } catch (e) {\n        console.warn('localStorage nicht verfügbar:', e);\n        return false;\n      }\n    }\n    \n    // Speichere Daten mit Debouncing\n    saveData(data) {\n      if (!this.isLocalStorageAvailable()) {\n        console.warn('localStorage nicht verfügbar - Cache wird nicht gespeichert');\n        return;\n      }\n      \n      // Debounce für Performance\n      if (this.debounceTimeout) {\n        clearTimeout(this.debounceTimeout);\n      }\n      \n      this.debounceTimeout = setTimeout(() => {\n        try {\n          const cacheData = {\n            ...data,\n            timestamp: Date.now(),\n            version: '1.0' // Für zukünftige Kompatibilität\n          };\n          \n          localStorage.setItem(this.cacheKey, JSON.stringify(cacheData));\n          console.log('Cache gespeichert:', new Date().toLocaleString());\n        } catch (error) {\n          console.error('Fehler beim Speichern des Caches:', error);\n        }\n      }, this.debounceDelay);\n    }\n    \n    // Lade Daten aus dem Cache\n    loadData() {\n      if (!this.isLocalStorageAvailable()) {\n        console.warn('localStorage nicht verfügbar - Cache wird nicht geladen');\n        return null;\n      }\n      \n      try {\n        const cachedData = localStorage.getItem(this.cacheKey);\n        if (!cachedData) {\n          console.log('Kein Cache gefunden');\n          return null;\n        }\n        \n        const data = JSON.parse(cachedData);\n        const cacheAge = Date.now() - data.timestamp;\n        \n        // Prüfe Cache-Alter\n        if (cacheAge > this.cacheTimeout) {\n          console.log('Cache ist abgelaufen (24h) - wird gelöscht');\n          this.clearCache();\n          return null;\n        }\n        \n        console.log('Cache geladen:', new Date().toLocaleString());\n        return data;\n      } catch (error) {\n        console.error('Fehler beim Laden des Caches:', error);\n        this.clearCache();\n        return null;\n      }\n    }\n    \n    // Lösche Cache\n    clearCache() {\n      try {\n        localStorage.removeItem(this.cacheKey);\n        console.log('Cache gelöscht');\n      } catch (error) {\n        console.error('Fehler beim Löschen des Caches:', error);\n      }\n    }\n    \n    // Prüfe Cache-Alter\n    isCacheValid() {\n      const data = this.loadData();\n      return data !== null;\n    }\n  }\n  \n  // Zentrale Produkt-Konfiguration (direkt eingebettet)\n  const VE = {\n    Endklemmen: 100,\n    Schrauben: 100,\n    Dachhaken: 20,\n    Mittelklemmen: 100,\n    Endkappen: 50,\n    Schienenverbinder: 50,\n    Schiene_240_cm: 8,\n    Schiene_360_cm: 8,\n    Solarmodul: 1,\n    UlicaSolarBlackJadeFlow: 1,\n    MC4_Stecker: 1,\n    Solarkabel: 1,\n    Holzunterleger: 50,\n    // NEUE PRODUKTE (aus Berechnung raus, später hinzufügen)\n    Erdungsklemme: 1,\n    Quetschkabelschuhe: 100,\n    Erdungsband: 1,\n    Tellerkopfschraube: 100\n  };\n  \n  const PRICE_MAP = {\n    Solarmodul: 59.00,\n    UlicaSolarBlackJadeFlow: 89.00,\n    Endklemmen: 9.99,\n    Schrauben: 9.99,\n    Dachhaken: 9.99,\n    Mittelklemmen: 4.99,\n    Endkappen: 9.99,\n    Schienenverbinder: 9.99,\n    Schiene_240_cm: 8.99,\n    Schiene_360_cm: 9.99,\n    MC4_Stecker: 99.00,\n    Solarkabel: 29.99,\n    Holzunterleger: 25.00,\n    // NEUE PRODUKTE (aus Berechnung raus, später hinzufügen)\n    Erdungsklemme: 25.00,\n    Quetschkabelschuhe: 10.00,\n    Erdungsband: 0.00,\n    Tellerkopfschraube: 30.00\n  };\n  \n  const PRODUCT_MAP = {\n    Solarmodul: { productId:'685003af0e41d945fb0198d8', variantId:'685003af4a8e88cb58c89d46' },\n    UlicaSolarBlackJadeFlow: { productId:'689455ed543f0cbb26ba54e9', variantId:'689455ed7d7ddfd326d5dbf9' },\n    Endklemmen: { productId:'6853c34fe99f6e3d878db38b', variantId:'6853c350edab8f13fc18c1b9' },\n    Schrauben: { productId:'6853c2782b14f4486dd26f52', variantId:'6853c2798bf6755ddde26a8e' },\n    Dachhaken: { productId:'6853c1d0f350bf620389664c', variantId:'6853c1d04d7c01769211b8d6' },\n    Mittelklemmen: { productId:'68531088654d1468dca962c', variantId:'6853c1084c04541622ba3e26' },\n    Endkappen: { productId:'6853be0895a5a578324f9682', variantId:'6853be0805e96b5a16c705cd' },\n    Schienenverbinder: { productId:'6853c2018bf6755ddde216a8', variantId:'6853c202c488ee61eb51a3dc' },\n    Schiene_240_cm: { productId:'6853bd882f00db0c9a42d653', variantId:'6853bd88c4173dbe72bab10f' },\n    Schiene_360_cm: { productId:'6853bc8f3f6abf360c605142', variantId:'6853bc902f00db0c9a423d97' },\n    MC4_Stecker: { productId:'687fcc9f66078f7098826ccc', variantId:'687fcca02c6537b9a9493fa7' },\n    Solarkabel: { productId:'687fd60dc599f5e95d783f99', variantId:'687fd60dd3a8ae1f00a6d6d1' },\n    Holzunterleger: { productId:'688780821dbbf26153a85117', variantId:'688780ad795c82663cd6e69b' },\n    // NEUE PRODUKTE (aus Berechnung raus, später hinzufügen)\n    Erdungsklemme: { productId:'6887e8aaa6ca43c15254d224', variantId:'6887e8abb439562cbc88db5d' },\n    Quetschkabelschuhe: { productId:'68876153200e1a5e28a1b709', variantId:'6887615388988b2ccda11067' },\n    Erdungsband: { productId:'688760e01c9c7973ee287386', variantId:'688760e0835845affc493354' },\n    Tellerkopfschraube: { productId:'688760a7124e867cf2b20051', variantId:'688760a7f246d23f70575fb1' }\n  };\n  \n  const PRODUCT_NAME_MAP = {\n    'Solarmodul': 'Ulica Solar Black Jade-Flow 450 W',\n    'UlicaSolarBlackJadeFlow': 'Ulica Solar Black Jade-Flow 500 W',\n    'Schrauben': 'Schraube M10x25',\n    'Solarkabel': 'Solarkabel 100M',\n    'Holzunterleger': 'Unterlegholz für Dachhaken - 50 Stück',\n    // NEUE PRODUKTE (aus Berechnung raus, später hinzufügen)\n    'Erdungsklemme': 'Erdungsklemme - ?? Stücl',\n    'Quetschkabelschuhe': 'Quetschkabelschuhe - 100 Stück',\n    'Erdungsband': 'Erdungsband',\n    'Tellerkopfschraube': 'Tellerkopfschraube 8x100'\n  };\n  \n  const PRODUCT_IMAGES = {\n    Solarmodul: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    UlicaSolarBlackJadeFlow: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    Endklemmen: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c316b21cb7d04ba2ed22_DSC04815-min.jpg',\n    Schrauben: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c2704f5147533229ccde_DSC04796-min.jpg',\n    Dachhaken: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c1c8a2835b7879f46811_DSC04760-min.jpg',\n    Mittelklemmen: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c0d0c2d922d926976bd4_DSC04810-min.jpg',\n    Endkappen: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853bdfbe7cffc653f6a4605_DSC04788-min.jpg',\n    Schienenverbinder: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c21f0c39e927fce0db3b_DSC04780-min.jpg',\n    Schiene_240_cm: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853bce018164af4b4a187f1_DSC04825-min.jpg',\n    Schiene_360_cm: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853bcd5726d1d33d4b86ba4_DSC04824-min.jpg',\n    MC4_Stecker: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/687fcdab153f840ea15b5e7b_iStock-2186771695.jpg',\n    Solarkabel: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/687fd566bdbb6de2e5f362f0_DSC04851.jpg',\n    Holzunterleger: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    // NEUE PRODUKTE (aus Berechnung raus, später hinzufügen)\n    Erdungsklemme: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    Quetschkabelschuhe: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6887614c64676f0b0c8d5037_Kabelschuh%20Platzhalter.jpg',\n    Erdungsband: 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png',\n    Tellerkopfschraube: 'https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c2704f5147533229ccde_DSC04796-min.jpg'\n  };\n  \n  // Zentrale Konfiguration ist jetzt direkt eingebettet\n\n  // ===== BACKGROUND CALCULATION MANAGER =====\n  class CalculationManager {\n    constructor() {\n      this.worker = null;\n      this.pendingCalculations = new Map();\n      this.calculationId = 0;\n      this.isWorkerReady = false;\n      \n      this.initWorker();\n    }\n\n    initWorker() {\n      try {\n        this.worker = new Worker('./calculation-worker.js');\n        \n        this.worker.onmessage = (e) => {\n          const { type, id, data, error } = e.data;\n          \n          if (type === 'ready') {\n            this.isWorkerReady = true;\n            return;\n          }\n          \n          if (type === 'result' && this.pendingCalculations.has(id)) {\n            const { resolve } = this.pendingCalculations.get(id);\n            this.pendingCalculations.delete(id);\n            resolve(data);\n          }\n          \n          if (type === 'error' && this.pendingCalculations.has(id)) {\n            const { reject } = this.pendingCalculations.get(id);\n            this.pendingCalculations.delete(id);\n            reject(new Error(error.message));\n          }\n          \n          // Worker Debug-Logs an Haupt-Console weiterleiten\n          if (type === 'debug') {\n            console.log(...data);\n          }\n        };\n        \n        this.worker.onerror = (error) => {\n          this.isWorkerReady = false;\n        };\n        \n      } catch (error) {\n        this.isWorkerReady = false;\n      }\n    }\n\n    async calculate(type, data) {\n      if (!this.isWorkerReady || !this.worker) {\n        // Fallback: Synchrone Berechnung im Main Thread\n        return this.calculateSync(type, data);\n      }\n\n      return new Promise((resolve, reject) => {\n        const id = ++this.calculationId;\n        this.pendingCalculations.set(id, { resolve, reject });\n        \n        // Timeout für Berechnungen\n        setTimeout(() => {\n          if (this.pendingCalculations.has(id)) {\n            this.pendingCalculations.delete(id);\n            reject(new Error('Calculation timeout'));\n          }\n        }, 10000); // 10 Sekunden Timeout\n        \n        this.worker.postMessage({ type, data, id });\n      });\n    }\n\n    // Fallback-Berechnungen für den Fall, dass Web Worker nicht verfügbar ist\n    calculateSync(type, data) {\n      switch (type) {\n        case 'calculateParts':\n          return this.calculatePartsSync(data);\n        case 'calculateExtendedParts':\n          return this.calculateExtendedPartsSync(data);\n        default:\n          throw new Error(`Unsupported sync calculation: ${type}`);\n      }\n    }\n\n    calculatePartsSync(data) {\n      // FALLBACK: Verwende Calculation Worker direkt\n      try {\n        // Simuliere Worker-Aufruf synchron\n        const { selection, rows, cols, cellWidth, cellHeight, orientation, options = {} } = data;\n        const parts = {\n          Solarmodul: 0, UlicaSolarBlackJadeFlow: 0, Endklemmen: 0, Mittelklemmen: 0,\n          Dachhaken: 0, Schrauben: 0, Endkappen: 0,\n          Schienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0\n        };\n\n        // Verwende die korrekte Schienenlogik (wie im Worker)\n        for (let y = 0; y < rows; y++) {\n          if (!Array.isArray(selection[y])) continue;\n          let run = 0;\n\n          for (let x = 0; x < cols; x++) {\n            if (selection[y]?.[x]) run++;\n            else if (run) { \n              this.processGroupSync(run, parts, cellWidth, cellHeight, orientation, options); \n              run = 0; \n            }\n          }\n          if (run) this.processGroupSync(run, parts, cellWidth, cellHeight, orientation, options);\n        }\n\n        return parts;\n      } catch (error) {\n        console.error('calculatePartsSync error:', error);\n        return {\n          Solarmodul: 0, Endklemmen: 0, Mittelklemmen: 0,\n          Dachhaken: 0, Schrauben: 0, Endkappen: 0,\n          Schienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0\n        };\n      }\n    }\n\n    processGroupSync(len, parts, cellWidth, cellHeight, orientation, options = {}) {\n      // FALLBACK: Kopie der Worker-Berechnung\n      const isVertical = orientation === 'vertical';\n      const actualCellWidth = isVertical ? cellHeight : cellWidth;\n      \n      const totalLen = len * actualCellWidth;\n      const floor360 = Math.floor(totalLen / 360);\n      const rem360 = totalLen - floor360 * 360;\n      const floor240 = Math.ceil(rem360 / 240);\n      const pure360 = Math.ceil(totalLen / 360);\n      const pure240 = Math.ceil(totalLen / 240);\n      \n      const variants = [\n        {cnt360: floor360, cnt240: floor240},\n        {cnt360: pure360,  cnt240: 0},\n        {cnt360: 0,        cnt240: pure240}\n      ].map(v => ({\n        ...v,\n        rails: v.cnt360 + v.cnt240,\n        waste: v.cnt360 * 360 + v.cnt240 * 240 - totalLen\n      }));\n      \n      const minRails = Math.min(...variants.map(v => v.rails));\n      const best = variants\n        .filter(v => v.rails === minRails)\n        .reduce((a, b) => a.waste <= b.waste ? a : b);\n      \n      const {cnt360, cnt240} = best;\n      parts.Schiene_360_cm     += cnt360 * 2;\n      parts.Schiene_240_cm     += cnt240 * 2;\n      parts.Schienenverbinder  += (cnt360 + cnt240 - 1) * 4;\n      parts.Endklemmen         += 4;\n      parts.Mittelklemmen      += len > 1 ? (len - 1) * 2 : 0;\n      parts.Dachhaken          += len > 1 ? len * 3 : 4;\n      parts.Endkappen          += 4; // Gleich wie Endklemmen\n      parts.Solarmodul         += len;\n      // UlicaSolarBlackJadeFlow hinzufügen wenn ulica-module Checkbox aktiviert ist\n      if (options.ulicaModule === true) {\n        parts.UlicaSolarBlackJadeFlow += len;\n      }\n      parts.Schrauben          += len > 1 ? len * 3 : 4; // Basierend auf Dachhaken\n      parts.Tellerkopfschraube += len > 1 ? (len * 3) * 2 : 8; // Basierend auf Dachhaken * 2\n    }\n\n    calculateExtendedPartsSync(data) {\n      let parts = this.calculatePartsSync(data);\n      const { options } = data;\n      \n      if (!options.includeModules) {\n        delete parts.Solarmodul;\n      }\n      \n      if (options.ulicaModule !== true) {\n        delete parts.UlicaSolarBlackJadeFlow;\n      }\n      \n      if (options.mc4Connectors) {\n        const panelCount = data.selection.flat().filter(v => v).length;\n        parts.MC4_Stecker = Math.ceil(panelCount / 30);\n      }\n      \n      if (options.solarkabel) {\n        parts.Solarkabel = 1;\n      }\n      \n      if (options.woodUnderlay) {\n        parts.Holzunterleger = 1; // Pauschal 1x zur Gesamtbestellung\n      }\n      \n      if (options.erdungsband) {\n        // Erdungsband-Berechnung hier hinzufügen wenn nötig\n        // parts.Erdungsband = calculateErdungsband(...);\n      }\n      \n      return parts;\n    }\n\n    destroy() {\n      if (this.worker) {\n        this.worker.terminate();\n        this.worker = null;\n      }\n      this.pendingCalculations.clear();\n      this.isWorkerReady = false;\n    }\n  }\n\n  // Warte, bis alle Bilder in einem Container geladen sind (verhindert leere html2canvas Renders)\n  function waitForImages(container) {\n    const images = Array.from(container.querySelectorAll('img'));\n    if (images.length === 0) return Promise.resolve();\n    return Promise.all(images.map(img => new Promise(resolve => {\n      if (img.complete && img.naturalWidth > 0) return resolve();\n      const done = () => resolve();\n      img.addEventListener('load', done, { once: true });\n      img.addEventListener('error', done, { once: true });\n    })));\n  }\n\n  // (Fallback entfernt, wir setzen ausschließlich auf html2pdf.js)\n  // Globale Calculation Manager Instanz\n  const calculationManager = new CalculationManager();\n\n  // ===== PRICE CACHING SYSTEM =====\n  class PriceCache {\n    constructor() {\n      this.cache = new Map();\n      this.lastUpdate = null;\n      this.cacheKey = 'solarTool_priceCache';\n      this.timestampKey = 'solarTool_priceTimestamp';\n      this.cacheDuration = 24 * 60 * 60 * 1000; // 24 Stunden in Millisekunden\n      this.isUpdating = false;\n      \n      this.loadFromStorage();\n      this.scheduleNextUpdate();\n    }\n\n    loadFromStorage() {\n      try {\n        const cachedData = localStorage.getItem(this.cacheKey);\n        const timestamp = localStorage.getItem(this.timestampKey);\n        \n        if (cachedData && timestamp) {\n          const parsedData = JSON.parse(cachedData);\n          this.lastUpdate = parseInt(timestamp, 10);\n          \n          // Prüfe ob Cache noch gültig ist\n          if (Date.now() - this.lastUpdate < this.cacheDuration) {\n            this.cache = new Map(Object.entries(parsedData));\n            return;\n          }\n        }\n      } catch (error) {\n      }\n      \n      // Cache ist ungültig oder nicht vorhanden - lade Preise neu\n      this.updatePricesFromHTML();\n    }\n\n    saveToStorage() {\n      try {\n        const cacheObject = Object.fromEntries(this.cache);\n        localStorage.setItem(this.cacheKey, JSON.stringify(cacheObject));\n        localStorage.setItem(this.timestampKey, this.lastUpdate.toString());\n      } catch (error) {\n      }\n    }\n\n    async updatePricesFromHTML() {\n      if (this.isUpdating) return;\n      \n      this.isUpdating = true;\n      \n      const promises = Object.keys(PRODUCT_MAP).map(async (productKey) => {\n        const price = await this.getPriceFromHTMLAsync(productKey);\n        this.cache.set(productKey, price);\n        return { productKey, price };\n      });\n\n      try {\n        const results = await Promise.all(promises);\n        this.lastUpdate = Date.now();\n        this.saveToStorage();\n        \n        results.forEach(({ productKey, price }) => {\n        });\n      } catch (error) {\n      } finally {\n        this.isUpdating = false;\n      }\n    }\n\n    async getPriceFromHTMLAsync(productKey) {\n      return new Promise((resolve) => {\n        // Verwende setTimeout um DOM-Zugriffe nicht zu blockieren\n        setTimeout(() => {\n          const price = this.extractPriceFromHTML(productKey);\n          resolve(price);\n        }, 0);\n      });\n    }\n\n    extractPriceFromHTML(productKey) {\n      try {\n      const productInfo = PRODUCT_MAP[productKey];\n      if (!productInfo) return PRICE_MAP[productKey] || 0;\n      \n      const productId = productInfo.productId;\n      const variantId = productInfo.variantId;\n      \n      const productForm = document.querySelector(`[data-commerce-product-id=\"${productId}\"]`) ||\n                         document.querySelector(`[data-commerce-sku-id=\"${variantId}\"]`);\n      \n      if (productForm) {\n        const priceElement = productForm.querySelector('[data-wf-sku-bindings*=\"f_price_\"]');\n        \n        if (priceElement) {\n          let priceText = priceElement.textContent || priceElement.innerHTML;\n          priceText = priceText.replace(/&nbsp;/g, ' ').replace(/&euro;/g, '€');\n          const priceMatch = priceText.match(/(\\d+(?:[.,]\\d{1,2})?)/);\n          \n          if (priceMatch) {\n            const price = parseFloat(priceMatch[1].replace(',', '.'));\n            return price;\n          }\n        }\n      }\n    } catch (error) {\n    }\n    \n    return PRICE_MAP[productKey] || 0;\n    }\n\n    getPrice(productKey) {\n      if (this.cache.has(productKey)) {\n        return this.cache.get(productKey);\n      }\n      \n      // Fallback auf hardcoded Preis wenn nicht im Cache\n      const fallbackPrice = PRICE_MAP[productKey] || 0;\n      return fallbackPrice;\n    }\n\n    scheduleNextUpdate() {\n      // Berechne Zeit bis zum nächsten Update\n      const nextUpdate = this.lastUpdate ? \n        this.lastUpdate + this.cacheDuration : \n        Date.now() + this.cacheDuration;\n      \n      const timeUntilUpdate = Math.max(0, nextUpdate - Date.now());\n      \n      setTimeout(() => {\n        this.updatePricesFromHTML();\n        this.scheduleNextUpdate(); // Plane nächstes Update\n      }, timeUntilUpdate);\n      \n    }\n\n    // Manuelle Aktualisierung für Debugging\n    forceUpdate() {\n      return this.updatePricesFromHTML();\n    }\n  }\n\n  // Entfernt - wird jetzt über zentrale Konfiguration verwaltet\n\n  // Globale Price Cache Instanz (nach PRODUCT_MAP Definition)\n  const priceCache = new PriceCache();\n\n  // Debug-Funktionen für Price Cache (nur für Entwicklung)\n  window.debugPriceCache = {\n    forceUpdate: () => priceCache.forceUpdate(),\n    getCache: () => Object.fromEntries(priceCache.cache),\n    getCacheAge: () => {\n      if (!priceCache.lastUpdate) return 'Nie aktualisiert';\n      const ageMs = Date.now() - priceCache.lastUpdate;\n      const ageHours = Math.round(ageMs / (1000 * 60 * 60));\n      return `${ageHours} Stunden alt`;\n    },\n    clearCache: () => {\n      localStorage.removeItem(priceCache.cacheKey);\n      localStorage.removeItem(priceCache.timestampKey);\n      priceCache.cache.clear();\n      priceCache.lastUpdate = null;\n    },\n    // NEUE Debug-Funktion für Quetschkabelschuhe\n    testQuetschkabelschuhe: () => {\n      console.log('Testing Quetschkabelschuhe price...');\n      console.log('PRICE_MAP:', PRICE_MAP.Quetschkabelschuhe);\n      console.log('Cache value:', priceCache.getPrice('Quetschkabelschuhe'));\n      console.log('Direct fallback:', PRICE_MAP['Quetschkabelschuhe'] || 0);\n      return {\n        priceMap: PRICE_MAP.Quetschkabelschuhe,\n        cacheValue: priceCache.getPrice('Quetschkabelschuhe'),\n        fallback: PRICE_MAP['Quetschkabelschuhe'] || 0\n      };\n    },\n    // Cache bereinigen und neu laden\n    resetAndReload: () => {\n      console.log('Resetting price cache...');\n      window.debugPriceCache.clearCache();\n      priceCache.loadFromStorage();\n      priceCache.forceUpdate();\n      console.log('Cache reset complete');\n    }\n  };\n\n  // Funktion um Preise aus Cache zu lesen (ersetzt getPriceFromHTML)\n  function getPriceFromCache(productKey) {\n    return priceCache.getPrice(productKey);\n  }\n\n  // Legacy-Funktion für Rückwärtskompatibilität\n  function getPriceFromHTML(productKey) {\n    return getPriceFromCache(productKey);\n  }\n\n  // ===== PDF GENERATOR =====\n  class SolarPDFGenerator {\n    constructor(solarGrid) {\n      this.solarGrid = solarGrid;\n      this.jsPDF = window.jspdf?.jsPDF;\n      this.html2canvas = window.html2canvas;\n      this.html2pdf = window.html2pdf; // html2pdf.js (optional, moderner Pfad)\n      // Weiße Footer-Logo-Variante (für dunklen Footer-Hintergrund)\n      this.companyLogoUrl = 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/688f3fff157b70cefcaa97df_Schneider%20logo.png';\n      // Blaues Header-Logo\n      this.headerLogoBlueUrl = 'https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6893249274128869974e58ec_schneider%20logo%20png.png';\n    }\n\n    // Prüfe ob PDF-Libraries verfügbar sind\n    isAvailable() {\n      return !!(this.jsPDF && this.html2canvas);\n    }\n\n    // NEU: Stabile PDF-Generation per html2canvas + jsPDF (ohne html2pdf Kette)\n    async generatePDFFromSnapshot(snapshot) {\n      if (!this.jsPDF || !this.html2canvas) {\n        console.error('jsPDF/html2canvas nicht verfügbar');\n        this.solarGrid.showToast('PDF-Generierung nicht verfügbar', 3000);\n        return;\n      }\n      if (!snapshot?.configs?.length) {\n        this.solarGrid.showToast('Keine Konfiguration zum Exportieren', 3000);\n        return;\n      }\n      try {\n        // 1) Template rendern\n        await this.renderSnapshotIntoPdfTemplate(snapshot);\n        const rootEl = document.getElementById('pdf-root');\n        if (!rootEl) throw new Error('#pdf-root nicht gefunden');\n        const prevStyle = rootEl.getAttribute('style') || '';\n\n        // 2) Sichtbar aber unsichtbar machen (für zuverlässiges Rendering)\n        rootEl.style.position = 'fixed';\n        rootEl.style.left = '0';\n        rootEl.style.top = '0';\n        rootEl.style.opacity = '0.01';\n        rootEl.style.pointerEvents = 'none';\n        rootEl.style.zIndex = '9999';\n        rootEl.style.background = '#ffffff';\n\n        // 3) Sicherstellen, dass alle Bilder fertig sind\n        await waitForImages(rootEl);\n        await new Promise(r => requestAnimationFrame(r));\n        await new Promise(r => setTimeout(r, 30));\n\n        const pages = Array.from(rootEl.querySelectorAll('.pdf-page'));\n        if (pages.length === 0) throw new Error('Keine .pdf-page Elemente');\n        console.log('[PDF] capturing pages:', pages.length);\n\n        // 4) PDF initialisieren – Pixel-Format exakt zu unseren CSS-Werten\n        const pdf = new this.jsPDF({ unit: 'px', format: [794, 1123], orientation: 'portrait' });\n\n        for (let i = 0; i < pages.length; i++) {\n          const pageEl = pages[i];\n          // Garantierte Maße pro Seite\n          pageEl.style.width = '794px';\n          pageEl.style.height = '1123px';\n          pageEl.style.boxSizing = 'border-box';\n\n          // Canvas erzeugen\n          const canvas = await this.html2canvas(pageEl, {\n            scale: 2,\n            backgroundColor: '#ffffff',\n            useCORS: true,\n            allowTaint: true,\n            logging: true\n          });\n          console.log('[PDF] canvas created', { w: canvas.width, h: canvas.height });\n          const imgData = canvas.toDataURL('image/jpeg', 0.98);\n          if (i > 0) pdf.addPage();\n          pdf.addImage(imgData, 'JPEG', 0, 0, 794, 1123);\n        }\n\n        // 5) Speichern und Root zurücksetzen\n        const fileName = this.generateFileName(snapshot.configs);\n        pdf.save(fileName);\n        rootEl.setAttribute('style', prevStyle);\n      } catch (err) {\n        console.error('PDF-Erstellung fehlgeschlagen:', err);\n        this.solarGrid.showToast('PDF-Erstellung fehlgeschlagen', 3000);\n      }\n    }\n\n    // Rendert den Snapshot in das versteckte A4-HTML-Template (#pdf-root)\n    async renderSnapshotIntoPdfTemplate(snapshot) {\n      const root = document.getElementById('pdf-root');\n      if (!root) return;\n      // Leeren\n      root.innerHTML = '';\n      const dateStr = new Date().toLocaleDateString('de-DE');\n\n      for (let i = 0; i < snapshot.configs.length; i++) {\n        const config = snapshot.configs[i];\n        // Seite klonen\n        const page = document.createElement('div');\n        page.className = 'pdf-page';\n        page.style.width = '794px';\n        page.style.minHeight = '1123px';\n        page.style.padding = '48px 48px 64px 48px';\n        page.style.boxSizing = 'border-box';\n        page.style.position = 'relative';\n\n        page.innerHTML = `\n          <header style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:10mm;\">\n            <div>\n              <div style=\"font-size:18pt; font-weight:700; color:#0e1e34;\">${config.name || 'Konfiguration'}</div>\n              <div style=\"font-size:10pt; color:#677; margin-top:2mm;\">${dateStr}</div>\n            </div>\n            <div style=\"display:flex; align-items:center; gap:8px; color:#0e1e34; font-size:10pt;\"><img src=\"${this.headerLogoBlueUrl}\" alt=\"Logo\" style=\"height:12mm; width:auto;\"/></div>\n          </header>\n          <section style=\"border:1px solid #e5e7eb; border-radius:8px; padding:6mm; margin-bottom:8mm;\">\n            <div style=\"font-size:12pt; font-weight:700; color:#0e1e34;\">Projekt</div>\n            <div style=\"font-size:10pt; color:#111; margin-top:2mm;\">${(config.name || 'Unbenannt')}</div>\n          </section>\n          <section style=\"margin-bottom:8mm;\">\n            <div style=\"font-size:11pt; font-weight:700; color:#0e1e34; margin-bottom:4mm;\">Grid-Übersicht</div>\n            <div style=\"font-size:10pt; color:#111; margin-bottom:4mm;\">\n              Grid: ${config.cols} × ${config.rows} Module (${config.selectedCells} ausgewählt) · Orientierung: ${config.orientation === 'vertical' ? 'Vertikal' : 'Horizontal'}\n            </div>\n            <img class=\"pdf-grid-image\" alt=\"Grid\" style=\"width:170mm; border-radius:6px; border:1px solid #e5e7eb; box-shadow:0 2px 8px rgba(0,0,0,0.06);\" />\n          </section>\n        `;\n\n        // Grid-Bild generieren\n        try {\n          const gridImg = await this.captureGridVisualizationFromSnapshot(config);\n          if (gridImg) page.querySelector('.pdf-grid-image').src = gridImg;\n        } catch {}\n\n        // Produktliste als eigene Seite (ohne Zusatzprodukte)\n        const productsPage = document.createElement('div');\n        productsPage.className = 'pdf-page';\n        productsPage.style.width = '794px';\n        productsPage.style.minHeight = '1123px';\n        productsPage.style.padding = '48px 48px 64px 48px';\n        productsPage.style.boxSizing = 'border-box';\n        productsPage.style.position = 'relative';\n\n        productsPage.innerHTML = `\n          <header style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:10mm;\">\n            <div>\n              <div style=\"font-size:18pt; font-weight:700; color:#0e1e34;\">${config.name || 'Konfiguration'}</div>\n              <div style=\"font-size:10pt; color:#677; margin-top:2mm;\">${dateStr}</div>\n            </div>\n            <div style=\"display:flex; align-items:center; gap:8px; color:#0e1e34; font-size:10pt;\"><img src=\"${this.headerLogoBlueUrl}\" alt=\"Logo\" style=\"height:12mm; width:auto;\"/></div>\n          </header>\n          <div style=\"background:#FFB101; color:#000; border-radius:8px; padding:6mm; font-weight:700; margin-bottom:6mm;\">PRODUKT-LISTE</div>\n          <table style=\"width:100%; border-collapse:collapse; font-size:10pt;\">\n            <thead>\n              <tr style=\"background:#0e1e34; color:#fff;\">\n                <th style=\"text-align:left; padding:3mm 4mm; border-top-left-radius:6px; width:20mm;\">Anzahl</th>\n                <th style=\"text-align:left; padding:3mm 4mm;\">Produkt</th>\n                <th style=\"text-align:right; padding:3mm 4mm; width:35mm;\">Benötigte Menge</th>\n                <th style=\"text-align:right; padding:3mm 4mm; border-top-right-radius:6px; width:30mm;\">Preis</th>\n              </tr>\n            </thead>\n            <tbody class=\"pdf-table-body\"></tbody>\n          </table>\n          <div class=\"pdf-total\" style=\"margin-top:8mm; background:#0e1e34; color:#fff; border-radius:8px; padding:6mm; display:flex; justify-content:space-between; align-items:center;\">\n            <div style=\"font-weight:700;\">GESAMTPREIS</div>\n            <div class=\"pdf-total-price\" style=\"font-size:14pt; font-weight:700;\"></div>\n          </div>\n        `;\n\n        // Produkte rendern (neues Tabellenlayout: Anzahl | Produkt+VE | benötigte Menge | Preis)\n        // Zusatzprodukte werden hier explizit ausgeschlossen – sie kommen gesammelt auf eine separate Seite\n        await this.renderProductsIntoTable(config, productsPage.querySelector('.pdf-table-body'), productsPage.querySelector('.pdf-total-price'), {\n          htmlLayout: true,\n          excludeAdditionalProducts: true\n        });\n\n        // Safety: falls Tabelle leer ist, füge Platzhalterzeile ein\n        const tbody = productsPage.querySelector('.pdf-table-body');\n        if (tbody && !tbody.innerHTML.trim()) {\n          tbody.innerHTML = '<tr><td style=\"padding:3mm 4mm;\" colspan=\"4\">Keine Produkte ausgewählt</td></tr>';\n        }\n\n        // Footer für beide Seiten mit Logo\n        const makeFooter = () => {\n          const footer = document.createElement('div');\n          footer.style.position = 'absolute';\n          footer.style.left = '0';\n          footer.style.right = '0';\n          footer.style.bottom = '0';\n          footer.style.height = '18mm';\n          footer.style.background = '#0e1e34';\n          footer.style.color = '#fff';\n          footer.style.display = 'flex';\n          footer.style.alignItems = 'center';\n          footer.style.justifyContent = 'space-between';\n          footer.style.padding = '0 16mm';\n          footer.style.boxSizing = 'border-box';\n          footer.style.fontSize = '8pt';\n          const left = document.createElement('div');\n          left.textContent = 'Schneider Unterkonstruktion - Solar Konfigurator';\n          const right = document.createElement('img');\n          right.src = this.companyLogoUrl;\n          right.alt = 'Logo';\n          right.style.height = '12mm';\n          right.style.width = 'auto';\n          footer.appendChild(left);\n          footer.appendChild(right);\n          return footer;\n        };\n\n        page.appendChild(makeFooter());\n        productsPage.appendChild(makeFooter());\n\n        root.appendChild(page);\n        root.appendChild(productsPage);\n      }\n\n      // Nach allen Konfigurationen: optionale Zusatzprodukte-Seite (einmal pro PDF)\n      try {\n        const additionalParts = this.computeAdditionalProductsForSnapshot(snapshot);\n        const additionalKeys = Object.keys(additionalParts).filter(k => additionalParts[k] > 0);\n        if (additionalKeys.length > 0) {\n          const dateStr2 = new Date().toLocaleDateString('de-DE');\n          const additionalPage = document.createElement('div');\n          additionalPage.className = 'pdf-page';\n          additionalPage.style.width = '794px';\n          additionalPage.style.minHeight = '1123px';\n          additionalPage.style.padding = '48px 48px 64px 48px';\n          additionalPage.style.boxSizing = 'border-box';\n          additionalPage.style.position = 'relative';\n\n          additionalPage.innerHTML = `\n            <header style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:10mm;\">\n              <div>\n                <div style=\"font-size:18pt; font-weight:700; color:#0e1e34;\">Für alle Konfigurationen</div>\n                <div style=\"font-size:10pt; color:#677; margin-top:2mm;\">${dateStr2}</div>\n              </div>\n              <div style=\"display:flex; align-items:center; gap:8px; color:#0e1e34; font-size:10pt;\"><img src=\"${this.headerLogoBlueUrl}\" alt=\"Logo\" style=\"height:12mm; width:auto;\"/></div>\n            </header>\n            <div style=\"background:#FFB101; color:#000; border-radius:8px; padding:6mm; font-weight:700; margin-bottom:6mm;\">ZUSATZPRODUKTE</div>\n            <table style=\"width:100%; border-collapse:collapse; font-size:10pt;\">\n              <thead>\n                <tr style=\"background:#0e1e34; color:#fff;\">\n                  <th style=\"text-align:left; padding:3mm 4mm; border-top-left-radius:6px; width:20mm;\">Anzahl</th>\n                  <th style=\"text-align:left; padding:3mm 4mm;\">Produkt</th>\n                  <th style=\"text-align:right; padding:3mm 4mm; width:35mm;\">Benötigte Menge</th>\n                  <th style=\"text-align:right; padding:3mm 4mm; border-top-right-radius:6px; width:30mm;\">Preis</th>\n                </tr>\n              </thead>\n              <tbody class=\"pdf-additional-table-body\"></tbody>\n            </table>\n            <div class=\"pdf-total\" style=\"margin-top:8mm; background:#0e1e34; color:#fff; border-radius:8px; padding:6mm; display:flex; justify-content:space-between; align-items:center;\">\n              <div style=\"font-weight:700;\">GESAMTPREIS</div>\n              <div class=\"pdf-additional-total-price\" style=\"font-size:14pt; font-weight:700;\"></div>\n            </div>\n          `;\n\n          // Render Zusatzprodukte-Tabelle\n          await this.renderAdditionalProductsIntoTable(snapshot, additionalPage.querySelector('.pdf-additional-table-body'), additionalPage.querySelector('.pdf-additional-total-price'));\n\n          // Footer\n          const footer = document.createElement('div');\n          footer.style.position = 'absolute';\n          footer.style.left = '0';\n          footer.style.right = '0';\n          footer.style.bottom = '0';\n          footer.style.height = '18mm';\n          footer.style.background = '#0e1e34';\n          footer.style.color = '#fff';\n          footer.style.display = 'flex';\n          footer.style.alignItems = 'center';\n          footer.style.justifyContent = 'space-between';\n          footer.style.padding = '0 16mm';\n          footer.style.boxSizing = 'border-box';\n          footer.style.fontSize = '8pt';\n          const left = document.createElement('div');\n          left.textContent = 'Schneider Unterkonstruktion - Solar Konfigurator';\n          const right = document.createElement('img');\n          right.src = this.companyLogoUrl;\n          right.alt = 'Logo';\n          right.style.height = '12mm';\n          right.style.width = 'auto';\n          footer.appendChild(left);\n          footer.appendChild(right);\n          additionalPage.appendChild(footer);\n\n          root.appendChild(additionalPage);\n        }\n      } catch (e) {\n        console.warn('Zusatzprodukte-Seite konnte nicht erzeugt werden:', e);\n      }\n    }\n\n    async renderProductsIntoTable(config, tbodyEl, totalEl, options = {}) {\n      const parts = await this.calculatePartsFromSnapshot(config);\n      let totalPrice = 0;\n      const rows = [];\n      const ADDITIONAL_KEYS = new Set(['MC4_Stecker', 'Solarkabel', 'Holzunterleger', 'Quetschkabelschuhe']);\n      for (const [key, value] of Object.entries(parts || {})) {\n        if (value <= 0) continue;\n        if (options.excludeAdditionalProducts && ADDITIONAL_KEYS.has(key)) continue;\n        const ve = VE[key] || 1;\n        const packs = Math.ceil(value / ve);\n        const price = getPriceFromCache(key);\n        const rowPrice = packs * price;\n        totalPrice += rowPrice;\n        rows.push({ key, value, ve, packs, rowPrice });\n      }\n      // Sortiere nach Produktname\n      rows.sort((a, b) => a.key.localeCompare(b.key));\n      if (options.htmlLayout) {\n        tbodyEl.innerHTML = rows.map(r => {\n          const productName = PRODUCT_NAME_MAP[r.key] || r.key.replace(/_/g, ' ');\n          return `\n            <tr style=\"border-bottom:1px solid #eee;\">\n              <td style=\"padding:3mm 4mm; width:20mm; font-weight:700;\">${r.packs}x</td>\n              <td style=\"padding:3mm 4mm;\">\n                <div style=\"font-weight:700; font-size:11pt;\">${productName}</div>\n                <div style=\"color:#888; font-size:9pt;\">${r.ve} Stück</div>\n              </td>\n              <td style=\"padding:3mm 4mm; text-align:right; width:35mm;\">${r.value}</td>\n              <td style=\"padding:3mm 4mm; text-align:right; width:30mm;\">${r.rowPrice.toFixed(2)} €</td>\n            </tr>\n          `;\n        }).join('');\n      } else {\n        tbodyEl.innerHTML = rows.map(r => `\n          <tr style=\"border-bottom:1px solid #eee;\">\n            <td style=\"padding:3mm 4mm;\">${r.key}</td>\n            <td style=\"padding:3mm 4mm; text-align:right;\">${r.value}</td>\n            <td style=\"padding:3mm 4mm; text-align:right;\">${r.ve}</td>\n            <td style=\"padding:3mm 4mm; text-align:right;\">${r.rowPrice.toFixed(2)} €</td>\n          </tr>\n        `).join('');\n      }\n      if (totalEl) totalEl.textContent = `${totalPrice.toFixed(2)} €`;\n    }\n\n    // Aggregiert Zusatzprodukte einmalig über alle Konfigurationen im Snapshot\n    computeAdditionalProductsForSnapshot(snapshot) {\n      try {\n        const configs = Array.isArray(snapshot?.configs) ? snapshot.configs : [];\n        const anyMc4 = configs.some(c => c.mc4 === true);\n        const anyCable = configs.some(c => c.cable === true || c.solarkabel === true);\n        const anyWood = configs.some(c => c.wood === true || c.holz === true);\n        const anyQuetsch = configs.some(c => c.quetschkabelschuhe === true);\n\n        const totalSelectedCells = configs.reduce((sum, c) => {\n          if (typeof c.selectedCells === 'number') return sum + c.selectedCells;\n          if (Array.isArray(c.selection)) {\n            return sum + c.selection.flat().filter(Boolean).length;\n          }\n          return sum;\n        }, 0);\n\n        const result = {};\n        if (anyMc4) {\n          result.MC4_Stecker = Math.max(1, Math.ceil((totalSelectedCells || 0) / 30));\n        }\n        if (anyCable) {\n          result.Solarkabel = 1;\n        }\n        if (anyWood) {\n          result.Holzunterleger = 1;\n        }\n        if (anyQuetsch) {\n          result.Quetschkabelschuhe = 1;\n        }\n        return result;\n      } catch (err) {\n        console.warn('computeAdditionalProductsForSnapshot failed:', err);\n        return {};\n      }\n    }\n\n    // Rendert Zusatzprodukte in eine Tabelle (HTML-Modus) und zeigt Gesamtpreis\n    async renderAdditionalProductsIntoTable(snapshot, tbodyEl, totalEl) {\n      const parts = this.computeAdditionalProductsForSnapshot(snapshot);\n      let totalPrice = 0;\n      const rows = Object.entries(parts).map(([key, value]) => {\n        const ve = VE[key] || 1;\n        const packs = Math.ceil(value / ve);\n        const price = getPriceFromCache(key);\n        const rowPrice = packs * price;\n        totalPrice += rowPrice;\n        return { key, value, ve, packs, rowPrice };\n      });\n      // Reihenfolge stabil nach Name\n      rows.sort((a, b) => a.key.localeCompare(b.key));\n      tbodyEl.innerHTML = rows.map(r => {\n        const productName = PRODUCT_NAME_MAP[r.key] || r.key.replace(/_/g, ' ');\n        return `\n          <tr style=\"border-bottom:1px solid #eee;\">\n            <td style=\"padding:3mm 4mm; width:20mm; font-weight:700;\">${r.packs}x</td>\n            <td style=\"padding:3mm 4mm;\">\n              <div style=\"font-weight:700; font-size:11pt;\">${productName}</div>\n              <div style=\"color:#888; font-size:9pt;\">${r.ve} Stück</div>\n            </td>\n            <td style=\"padding:3mm 4mm; text-align:right; width:35mm;\">${r.value}</td>\n            <td style=\"padding:3mm 4mm; text-align:right; width:30mm;\">${r.rowPrice.toFixed(2)} €</td>\n          </tr>\n        `;\n      }).join('');\n      if (totalEl) totalEl.textContent = `${totalPrice.toFixed(2)} €`;\n    }\n\n    // Abwärtskompatibler Wrapper: ermöglicht this.pdfGenerator.generatePDF('current'|'all')\n    async generatePDF(mode = 'current') {\n      if (!this.isAvailable()) {\n        console.warn('PDF Libraries nicht verfügbar');\n        this.solarGrid?.showToast?.('PDF-Generierung nicht verfügbar', 3000);\n        return;\n      }\n      try {\n        // Erzeuge Snapshot über SolarGrid\n        const fullSnapshot = this.solarGrid?.createConfigSnapshot\n          ? this.solarGrid.createConfigSnapshot()\n          : null;\n        if (!fullSnapshot || !Array.isArray(fullSnapshot.configs) || fullSnapshot.configs.length === 0) {\n          this.solarGrid?.showToast?.('Keine Konfiguration zum Exportieren', 3000);\n          return;\n        }\n        let snapshotToExport = fullSnapshot;\n        if (mode === 'current') {\n          const idx = typeof fullSnapshot.currentConfigIndex === 'number' ? fullSnapshot.currentConfigIndex : 0;\n          const only = fullSnapshot.configs[idx] || fullSnapshot.configs[0];\n          snapshotToExport = {\n            timestamp: fullSnapshot.timestamp,\n            totalConfigs: 1,\n            currentConfigIndex: 0,\n            configs: [only]\n          };\n        }\n        await this.generatePDFFromSnapshot(snapshotToExport);\n      } catch (err) {\n        console.error('generatePDF wrapper failed:', err);\n        this.solarGrid?.showToast?.('PDF-Erstellung fehlgeschlagen', 3000);\n      }\n    }\n\n    // Entfernt alte generatePDF-Umleitung: direkte Nutzung von generatePDFFromSnapshot()\n\n    // Entfernt ungenutzte calculateTotalPrice (wir nutzen calculateConfigPrice zentral)\n\n    // Header auf jeder Seite (neues Design)\n    addHeader(pdf, pageWidth, config) {\n      // NEUES DESIGN: Header minimal, weißer Hintergrund mit Titel in dunkelblau\n      pdf.setTextColor(14, 30, 52);\n      pdf.setFontSize(18);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text('Ihre Konfiguration', 20, 20);\n      pdf.setFontSize(10);\n      pdf.setFont('helvetica', 'normal');\n      pdf.text(new Date().toLocaleDateString('de-DE'), pageWidth - 40, 20);\n      pdf.setTextColor(0, 0, 0);\n      return 28; // Y-Start nach Header\n    }\n\n    // Interne Hilfsfunktion: invertiert ein Base64 PNG und cached das Ergebnis\n    async getInvertedLogoBase64(originalBase64) {\n      if (this._invertedLogoBase64Promise) return this._invertedLogoBase64Promise;\n      this._invertedLogoBase64Promise = new Promise((resolve, reject) => {\n        try {\n          const img = new Image();\n          img.onload = () => {\n            try {\n              const canvas = document.createElement('canvas');\n              canvas.width = img.width;\n              canvas.height = img.height;\n              const ctx = canvas.getContext('2d');\n              ctx.drawImage(img, 0, 0);\n              const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n              const data = imageData.data;\n              for (let i = 0; i < data.length; i += 4) {\n                data[i] = 255 - data[i];       // R\n                data[i + 1] = 255 - data[i + 1]; // G\n                data[i + 2] = 255 - data[i + 2]; // B\n                // Alpha bleibt\n              }\n              ctx.putImageData(imageData, 0, 0);\n              resolve(canvas.toDataURL('image/png'));\n            } catch (err) {\n              reject(err);\n            }\n          };\n          img.onerror = reject;\n          img.src = originalBase64;\n        } catch (e) {\n          reject(e);\n        }\n      });\n      return this._invertedLogoBase64Promise;\n    }\n\n    // Footer mit Logo (invertiert) – neues Design\n    async addFooter(pdf, pageWidth, pageHeight) {\n      const footerY = pageHeight - 25;\n      \n      // Footer Hintergrund\n      pdf.setFillColor(14, 30, 52);\n      pdf.rect(0, footerY, pageWidth, 25, 'F');\n      \n      // Footer Text\n      pdf.setTextColor(255, 255, 255);\n      pdf.setFontSize(8);\n      pdf.setFont('helvetica', 'normal');\n      pdf.text('Schneider Unterkonstruktion - Solar Konfigurator', 20, footerY + 8);\n      pdf.text('unterkonstruktion.de', 20, footerY + 15);\n      \n      // Logo rechts - neues PNG Logo\n      try {\n        // Logo von bereitgestellter URL laden und invertieren\n        const logoBase64 = await this.loadImageAsBase64(this.companyLogoUrl);\n        const invertedLogoBase64 = await this.getInvertedLogoBase64(logoBase64);\n        const logoHeight = 15; // Feste Höhe\n        const logoWidth = logoHeight * 3.1338028169; // Exaktes Verhältnis 3.1338028169:1\n        const logoX = pageWidth - logoWidth - 20; // 20px Abstand vom rechten Rand\n        const logoY = footerY + 5; // 5px Abstand vom oberen Footer-Rand\n\n        // Base64 Logo als Bild einbetten (invertiert)\n        pdf.addImage(invertedLogoBase64, 'PNG', logoX, logoY, logoWidth, logoHeight);\n      } catch (error) {\n        console.warn('Logo konnte nicht geladen werden:', error);\n        pdf.setFontSize(12);\n        pdf.setFont('helvetica', 'bold');\n        pdf.text('Schneider Unterkonstruktion', pageWidth - 120, footerY + 12);\n      }\n    }\n\n    // Lädt ein Bild (CORS-fähig) von URL und gibt ein Base64 PNG zurück\n    async loadImageAsBase64(url) {\n      return new Promise((resolve, reject) => {\n        try {\n          const img = new Image();\n          img.crossOrigin = 'anonymous';\n          img.onload = () => {\n            try {\n              const canvas = document.createElement('canvas');\n              canvas.width = img.naturalWidth || img.width;\n              canvas.height = img.naturalHeight || img.height;\n              const ctx = canvas.getContext('2d');\n              ctx.imageSmoothingEnabled = true;\n              ctx.drawImage(img, 0, 0);\n              resolve(canvas.toDataURL('image/png'));\n            } catch (e) {\n              reject(e);\n            }\n          };\n          img.onerror = reject;\n          img.src = url;\n        } catch (e) {\n          reject(e);\n        }\n      });\n    }\n\n    // Hilfsmethode für Gesamtpreis-Berechnung aus Snapshot\n    async calculateTotalPriceFromSnapshot(config) {\n      const parts = await this.calculatePartsFromSnapshot(config);\n      \n      let totalPrice = 0;\n      Object.entries(parts).forEach(([key, value]) => {\n        if (value > 0) {\n          const packs = Math.ceil(value / (VE[key] || 1));\n          const price = getPriceFromCache(key);\n          totalPrice += packs * price;\n        }\n      });\n\n      return totalPrice;\n    }\n\n    // NEUE ISOLIERTE Konfiguration zu PDF hinzufügen (aus Snapshot)\n    async addConfigurationToPDFFromSnapshot(pdf, config, isFirstPage) {\n      const pageWidth = 210; // A4 Breite in mm\n      const pageHeight = 297; // A4 Höhe in mm\n      const bottomMargin = 30; // Erhöhter Rand für Footer\n      \n      // Verwende Objekt für yPosition damit es von checkPageBreak geändert werden kann\n      const positionRef = { y: 25 };\n\n      // Hilfsfunktion für Seitenumbruch-Prüfung mit mehr Platz\n      const checkPageBreak = async (neededSpace = 20) => {\n        if (positionRef.y + neededSpace > pageHeight - bottomMargin) {\n          // Footer auf aktueller Seite hinzufügen\n          await this.addFooter(pdf, pageWidth, pageHeight);\n          // Neue Seite hinzufügen\n          pdf.addPage();\n          // Header auf neuer Seite\n          this.addHeader(pdf, pageWidth, config);\n          positionRef.y = 28;\n          return true;\n        }\n        return false;\n      };\n\n      console.log(`PDF-Seite für Konfiguration: ${config.name}`, {\n        dimensions: `${config.cols}x${config.rows}`,\n        selectedCells: config.selectedCells,\n        totalCells: config.totalCells\n      });\n\n      // Header zeichnen (auf jeder Seite identisch)\n      positionRef.y = this.addHeader(pdf, pageWidth, config);\n\n      // Projekt-Info Sektion: dezenter Container\n      await checkPageBreak(20);\n      pdf.setDrawColor(229, 231, 235); // #e5e7eb\n      pdf.setLineWidth(0.5);\n      pdf.rect(15, positionRef.y - 4, pageWidth - 30, 14);\n      pdf.setFont('helvetica', 'bold');\n      pdf.setFontSize(12);\n      pdf.setTextColor(14, 30, 52);\n      pdf.text(`Projekt: ${config.name || 'Unbenannt'}`, 20, positionRef.y + 6);\n      pdf.setTextColor(0, 0, 0);\n      positionRef.y += 22;\n\n      // Grid-Informationen\n      await checkPageBreak(20);\n      pdf.setFontSize(11);\n      pdf.setFont('helvetica', 'normal');\n      pdf.text(`Grid: ${config.cols} × ${config.rows} Module (${config.selectedCells} ausgewählt)`, 20, positionRef.y);\n      pdf.text(`Orientierung: ${config.orientation === 'vertical' ? 'Vertikal' : 'Horizontal'}`, 20, positionRef.y + 8);\n      positionRef.y += 20;\n\n      // Grid-Screenshot hinzufügen (ISOLIERT mit Snapshot-Daten)\n      try {\n        const gridImage = await this.captureGridVisualizationFromSnapshot(config);\n        if (gridImage) {\n          // Maximal 70% der A4-Höhe für das Grid-Bild\n          const maxHeight = Math.floor(pageHeight * 0.5); // 50% der Seite\n          const targetWidth = 170; // mm\n          // Berechne proportional die Bildhöhe anhand Zielbreite (Grid-Images werden im Verhältnis ~4:3 erzeugt)\n          let computedHeight = Math.round((targetWidth * 3) / 4);\n          if (computedHeight > maxHeight) {\n            // Skaliere runter, wenn höher als 70% der Seite\n            const scale = maxHeight / computedHeight;\n            computedHeight = Math.round(computedHeight * scale);\n          }\n\n          await checkPageBreak(computedHeight + 15);\n\n          // Zentriert platzieren\n          const centerX = (pageWidth - targetWidth) / 2;\n          const centerY = positionRef.y;\n          pdf.addImage(gridImage, 'PNG', centerX, centerY, targetWidth, computedHeight);\n          positionRef.y += computedHeight + 10;\n        }\n      } catch (error) {\n        console.warn('Grid-Screenshot fehlgeschlagen:', error);\n        positionRef.y += 10;\n      }\n\n      // Produkttabelle auf NEUE SEITE schieben, damit nichts abgeschnitten wird\n      await this.addFooter(pdf, pageWidth, pageHeight);\n      pdf.addPage();\n      this.addHeader(pdf, pageWidth, config);\n      positionRef.y = 28;\n      // Produkttabelle (ISOLIERT mit Snapshot-Daten)\n      await checkPageBreak(60);\n      positionRef.y = await this.addProductTableFromSnapshot(pdf, config, positionRef.y, checkPageBreak);\n\n      // Gesamtpreis hervorgehoben\n      await checkPageBreak(25);\n      const totalPrice = await this.calculateTotalPriceFromSnapshot(config);\n      pdf.setFillColor(14, 30, 52);\n      pdf.rect(15, positionRef.y - 5, pageWidth - 30, 20, 'F');\n      \n      pdf.setTextColor(255, 255, 255);\n      pdf.setFontSize(14);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text('GESAMTPREIS:', 20, positionRef.y + 8);\n      pdf.text(`${totalPrice.toFixed(2)} €`, 170, positionRef.y + 8);\n      \n      pdf.setTextColor(0, 0, 0);\n      positionRef.y += 30;\n\n      // Produkte pro Modul Informationen entfernt - nicht mehr notwendig\n\n      // Footer mit Logo auf der letzten Seite\n      await this.addFooter(pdf, pageWidth, pageHeight);\n    }\n\n    // Erfasse Grid-Visualisierung als Bild\n    async captureGridVisualization(config) {\n      // Alternative Methode: Erstelle temporäres Grid-Element für Screenshot\n      try {\n        const selection = config.selection || [];\n        const cols = config.cols || 5;\n        const rows = config.rows || 5;\n        \n        // Erstelle temporäres Container Element\n        const tempContainer = document.createElement('div');\n        tempContainer.style.position = 'absolute';\n        tempContainer.style.left = '-10000px';\n        tempContainer.style.top = '-10000px';\n        tempContainer.style.padding = '20px';\n        tempContainer.style.backgroundColor = '#ffffff';\n        document.body.appendChild(tempContainer);\n\n        // Erstelle Grid HTML mit kompaktem Design\n        const cellSize = 50; // Zellgröße beibehalten\n        const cellGap = 2; // Maximal 2px Abstand\n        \n        const gridEl = document.createElement('div');\n        gridEl.style.display = 'grid';\n        gridEl.style.gap = `${cellGap}px`;\n        gridEl.style.gridTemplateColumns = `repeat(${cols}, ${cellSize}px)`;\n        gridEl.style.gridTemplateRows = `repeat(${rows}, ${cellSize}px)`;\n        gridEl.style.padding = '2px'; // Kompakter äußerer Abstand\n        gridEl.style.backgroundColor = '#ffffff';\n        gridEl.style.border = '1px solid #000000'; // 1px schwarze Border\n        gridEl.style.borderRadius = '1rem'; // 1rem border-radius\n\n        // Normalisiere Selection-Array für die gewünschten Dimensionen\n        const normalizedSelection = Array.from({ length: rows }, (_, y) =>\n          Array.from({ length: cols }, (_, x) => {\n            // Prüfe ob die gespeicherte Selection diese Position abdeckt\n            if (selection[y] && Array.isArray(selection[y]) && x < selection[y].length) {\n              return selection[y][x] === true;\n            }\n            // Falls außerhalb der gespeicherten Dimensionen: false (nicht ausgewählt)\n            return false;\n          })\n        );\n\n        // Debug: Log der normalisierten Konfiguration\n        console.log('Grid Debug - Normalized:', {\n          originalRows: selection.length,\n          originalCols: selection[0] ? selection[0].length : 0,\n          targetRows: rows,\n          targetCols: cols,\n          normalizedSelection: normalizedSelection\n        });\n\n        // Erstelle alle Grid-Zellen\n        for (let y = 0; y < rows; y++) {\n          for (let x = 0; x < cols; x++) {\n            const cell = document.createElement('div');\n            \n            // Verwende die normalisierte Selection\n            const isSelected = normalizedSelection[y][x];\n            \n            // Debug: Log für problematische Bereiche\n            if (y >= rows - 2 || x >= cols - 2) { \n              console.log(`Cell [${y}][${x}]: isSelected =`, isSelected);\n            }\n            \n            // Basis-Styles für alle Zellen\n            cell.style.width = `${cellSize}px`;\n            cell.style.height = `${cellSize}px`;\n            cell.style.borderRadius = '1rem'; // 1rem border-radius\n            cell.style.border = '1px solid #000000'; // 1px schwarze Border\n            \n            if (isSelected) {\n              // Ausgewählte Zelle - Dunkelblaue Farbe\n              cell.style.backgroundColor = '#072544';\n            } else {\n              // Nicht-ausgewählte Zelle - hell-grau\n              cell.style.backgroundColor = '#f3f4f6';\n            }\n            \n            gridEl.appendChild(cell);\n          }\n        }\n        \n        tempContainer.appendChild(gridEl);\n\n        // Warte auf Rendering\n        await new Promise(resolve => requestAnimationFrame(resolve));\n        await new Promise(resolve => setTimeout(resolve, 100)); // Kurze Wartezeit, kein Bild-Download nötig\n\n        // Screenshot von temporärem Element\n        const canvas = await this.html2canvas(tempContainer, {\n          backgroundColor: '#ffffff',\n          scale: 2,\n          logging: false,\n          useCORS: true,\n          allowTaint: true,\n          width: tempContainer.offsetWidth,\n          height: tempContainer.offsetHeight\n        });\n\n        // Aufräumen\n        document.body.removeChild(tempContainer);\n        \n        return canvas.toDataURL('image/png');\n\n      } catch (error) {\n        console.warn('Grid-Screenshot fehlgeschlagen:', error);\n        return null;\n      }\n    }\n\n    // NEUE METHODE: Grid-Bild für Webhook generieren\n    async captureGridImageForWebhook(configData) {\n      try {\n        const selection = configData.selection || [];\n        const cols = configData.cols || 5;\n        const rows = configData.rows || 5;\n        \n        // Erstelle temporäres Container Element\n        const tempContainer = document.createElement('div');\n        tempContainer.style.position = 'absolute';\n        tempContainer.style.left = '-10000px';\n        tempContainer.style.top = '-10000px';\n        tempContainer.style.padding = '20px';\n        tempContainer.style.backgroundColor = '#ffffff';\n        document.body.appendChild(tempContainer);\n\n        // Grid-Eigenschaften für Webhook-optimierte Darstellung\n        const isVertical = configData.orientation === 'vertical';\n        const baseCellSize = 58; // Kompakter und moderner\n        const cellWidth = isVertical ? Math.round(baseCellSize * 0.62) : baseCellSize;\n        const cellHeight = isVertical ? baseCellSize : Math.round(baseCellSize * 0.62);\n        const cellGap = 2; // wie im UI\n        \n        const gridEl = document.createElement('div');\n        gridEl.style.display = 'grid';\n        gridEl.style.gap = `${cellGap}px`;\n        gridEl.style.gridTemplateColumns = `repeat(${cols}, ${cellWidth}px)`;\n        gridEl.style.gridTemplateRows = `repeat(${rows}, ${cellHeight}px)`;\n        gridEl.style.padding = '16px';\n        gridEl.style.backgroundColor = '#f5f7fa';\n        gridEl.style.border = '1px solid #e5e7eb';\n        gridEl.style.borderRadius = '12px';\n        gridEl.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';\n\n        // Grid-Zellen erstellen\n        for (let y = 0; y < rows; y++) {\n          for (let x = 0; x < cols; x++) {\n            const cell = document.createElement('div');\n            const isSelected = selection[y] && selection[y][x] === true;\n            \n            cell.style.width = `${cellWidth}px`;\n            cell.style.height = `${cellHeight}px`;\n            cell.style.borderRadius = '6px';\n            cell.style.border = '1px solid #d1d5db';\n            cell.style.transition = 'all 0.2s ease';\n            \n            if (isSelected) {\n              // Ausgewählte Zelle - modernes Solar-Panel-Design (nah am UI)\n              cell.style.backgroundColor = '#0b0b0b';\n              cell.style.border = '2px solid #cccccc';\n              cell.style.boxShadow = 'inset 0 2px 4px rgba(0,0,0,0.25)';\n              \n              // Solar-Panel-Pattern hinzufügen\n              const pattern = document.createElement('div');\n              pattern.style.width = '100%';\n              pattern.style.height = '100%';\n              pattern.style.background = `linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0) 40%),\n                linear-gradient(135deg, #0b0b0b 0%, #111111 50%, #0b0b0b 100%)`;\n              pattern.style.borderRadius = '4px';\n              pattern.style.position = 'relative';\n              \n              // Grid-Linien für Solarpanel-Look\n              const gridLines = document.createElement('div');\n              gridLines.style.position = 'absolute';\n              gridLines.style.top = '2px';\n              gridLines.style.left = '2px';\n              gridLines.style.right = '2px';\n              gridLines.style.bottom = '2px';\n              gridLines.style.backgroundImage = `\n                linear-gradient(to right, rgba(255,255,255,0.08) 1px, transparent 1px),\n                linear-gradient(to bottom, rgba(255,255,255,0.08) 1px, transparent 1px)\n              `;\n              gridLines.style.backgroundSize = '33% 50%';\n              \n              pattern.appendChild(gridLines);\n              cell.appendChild(pattern);\n            } else {\n              // Unausgewählte Zelle - neutral (wie UI)\n              cell.style.backgroundColor = '#f3f4f6';\n              cell.style.border = '1px solid #e5e7eb';\n            }\n            \n            gridEl.appendChild(cell);\n          }\n        }\n        \n        tempContainer.appendChild(gridEl);\n        \n        // Warte auf Rendering\n        await new Promise(resolve => requestAnimationFrame(resolve));\n        await new Promise(resolve => setTimeout(resolve, 150));\n\n        // Canvas für Screenshot erstellen\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        \n        // Canvas-Größe berechnen\n        const totalWidth = cols * cellWidth + (cols - 1) * cellGap + 40; // +40 für padding\n        const totalHeight = rows * cellHeight + (rows - 1) * cellGap + 40;\n        \n        canvas.width = totalWidth;\n        canvas.height = totalHeight;\n        \n        // Weißer Hintergrund\n        ctx.fillStyle = '#ffffff';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n        \n        // Grid manuell auf Canvas zeichnen\n        const startX = 20; // Padding\n        const startY = 20; // Padding\n        \n        for (let y = 0; y < rows; y++) {\n          for (let x = 0; x < cols; x++) {\n            const cellX = startX + x * (cellWidth + cellGap);\n            const cellY = startY + y * (cellHeight + cellGap);\n            const isSelected = selection[y] && selection[y][x] === true;\n            \n            if (isSelected) {\n              // Ausgewählte Zelle - Dunkelblau\n              ctx.fillStyle = '#072544';\n              ctx.fillRect(cellX, cellY, cellWidth, cellHeight);\n              \n              // Border\n              ctx.strokeStyle = '#0a4d75';\n              ctx.lineWidth = 2;\n              ctx.strokeRect(cellX, cellY, cellWidth, cellHeight);\n              \n              // Solar-Panel-Grid\n              ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n              ctx.lineWidth = 1;\n              \n              // Vertikale Linien\n              for (let i = 1; i < 3; i++) {\n                const lineX = cellX + (cellWidth / 3) * i;\n                ctx.beginPath();\n                ctx.moveTo(lineX, cellY + 2);\n                ctx.lineTo(lineX, cellY + cellHeight - 2);\n                ctx.stroke();\n              }\n              \n              // Horizontale Linie\n              const lineY = cellY + cellHeight / 2;\n              ctx.beginPath();\n              ctx.moveTo(cellX + 2, lineY);\n              ctx.lineTo(cellX + cellWidth - 2, lineY);\n              ctx.stroke();\n            } else {\n              // Unausgewählte Zelle - Hell grau\n              ctx.fillStyle = '#f8f9fa';\n              ctx.fillRect(cellX, cellY, cellWidth, cellHeight);\n              \n              // Border\n              ctx.strokeStyle = '#e9ecef';\n              ctx.lineWidth = 1;\n              ctx.strokeRect(cellX, cellY, cellWidth, cellHeight);\n            }\n          }\n        }\n        \n        // Grid-Rahmen dezent zeichnen (moderner Look)\n        ctx.strokeStyle = '#e5e7eb';\n        ctx.lineWidth = 1;\n        ctx.strokeRect(10, 10, totalWidth - 20, totalHeight - 20);\n        \n        // Canvas zu Base64 konvertieren\n        const base64Image = canvas.toDataURL('image/png');\n        \n        console.log('Canvas generated:', {\n          canvasWidth: canvas.width,\n          canvasHeight: canvas.height,\n          dataURLLength: base64Image.length,\n          dataURLStart: base64Image.substring(0, 50) + '...'\n        });\n        \n        // Cleanup\n        document.body.removeChild(tempContainer);\n        \n        return base64Image;\n        \n      } catch (error) {\n        console.error('Grid-Bild-Generierung fehlgeschlagen:', error);\n        return null;\n      }\n    }\n\n    // NEUE ISOLIERTE Grid-Capture mit echtem Seitenverhältnis und Fit-in-Box\n    async captureGridVisualizationFromSnapshot(config) {\n      try {\n        const selection = config.selection || [];\n        const cols = config.cols || 5;\n        const rows = config.rows || 5;\n\n        // 1) Ziel-Box im PDF (passend zu .pdf-grid-image in CSS)\n        const maxWidthPx = 670;               // ~170mm Inhaltsbreite\n        const maxHeightPx = Math.floor(1123 * 0.5); // 50% der A4-Höhe\n        const padding = 16;                   // Innenabstand des Grid-Rahmens\n        const gapBase = 2;                    // Basisabstand zwischen Zellen\n\n        // 2) Seitenverhältnis der Module aus realen Modulmaßen\n        const modW = Number(config.cellWidth || 179);\n        const modH = Number(config.cellHeight || 113);\n        const orientVertical = config.orientation === 'vertical';\n        const unitW = orientVertical ? modH : modW; // Rotation = Maße tauschen\n        const unitH = orientVertical ? modW : modH;\n\n        // 3) Rohmaße ohne Skalierung (nur Verhältnis, daher beliebige Einheit)\n        const rawGridW = unitW * cols + gapBase * (cols - 1) + padding * 2;\n        const rawGridH = unitH * rows + gapBase * (rows - 1) + padding * 2;\n        const scale = Math.min(maxWidthPx / rawGridW, maxHeightPx / rawGridH, 1);\n\n        const cellW = unitW * scale;\n        const cellH = unitH * scale;\n        const gap = Math.max(1, Math.round(gapBase * scale));\n\n        const actualW = Math.ceil(cols * cellW + (cols - 1) * gap + padding * 2);\n        const actualH = Math.ceil(rows * cellH + (rows - 1) * gap + padding * 2);\n\n        // 4) Zeichne direkt auf Canvas für exakte Kontrolle\n        const canvas = document.createElement('canvas');\n        canvas.width = actualW;\n        canvas.height = actualH;\n        const ctx = canvas.getContext('2d');\n\n        // Hintergrund + Rahmen\n        ctx.fillStyle = '#ffffff';\n        ctx.fillRect(0, 0, actualW, actualH);\n        ctx.strokeStyle = '#e5e7eb';\n        ctx.lineWidth = 1;\n        ctx.strokeRect(0.5, 0.5, actualW - 1, actualH - 1);\n\n        // Startkoordinaten\n        const startX = padding;\n        const startY = padding;\n\n        // 5) Zellen zeichnen (mit echten Proportionen)\n        for (let y = 0; y < rows; y++) {\n          for (let x = 0; x < cols; x++) {\n            const cellX = Math.round(startX + x * (cellW + gap));\n            const cellY = Math.round(startY + y * (cellH + gap));\n            const isSelected = !!(selection[y] && selection[y][x]);\n\n            // Hintergrund\n            if (isSelected) {\n              ctx.fillStyle = '#0b0b0b';\n              ctx.fillRect(cellX, cellY, Math.round(cellW), Math.round(cellH));\n              // Rahmen\n              ctx.strokeStyle = '#cccccc';\n              ctx.lineWidth = 2;\n              ctx.strokeRect(cellX + 0.5, cellY + 0.5, Math.round(cellW) - 1, Math.round(cellH) - 1);\n              // dezentes Panel-Muster\n              ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n              ctx.lineWidth = 1;\n              // vertikale Linien (2)\n              const third = Math.round(cellW / 3);\n              ctx.beginPath();\n              ctx.moveTo(cellX + third, cellY + 2);\n              ctx.lineTo(cellX + third, cellY + Math.round(cellH) - 2);\n              ctx.moveTo(cellX + 2 * third, cellY + 2);\n              ctx.lineTo(cellX + 2 * third, cellY + Math.round(cellH) - 2);\n              ctx.stroke();\n              // horizontale Mittellinie\n              ctx.beginPath();\n              ctx.moveTo(cellX + 2, cellY + Math.round(cellH / 2));\n              ctx.lineTo(cellX + Math.round(cellW) - 2, cellY + Math.round(cellH / 2));\n              ctx.stroke();\n            } else {\n              ctx.fillStyle = '#f3f4f6';\n              ctx.fillRect(cellX, cellY, Math.round(cellW), Math.round(cellH));\n              ctx.strokeStyle = '#e5e7eb';\n              ctx.lineWidth = 1;\n              ctx.strokeRect(cellX + 0.5, cellY + 0.5, Math.round(cellW) - 1, Math.round(cellH) - 1);\n            }\n          }\n        }\n\n        return canvas.toDataURL('image/png');\n      } catch (error) {\n        console.error('Grid-Screenshot fehlgeschlagen:', error);\n        return null;\n      }\n    }\n\n    // NEUE ISOLIERTE Produkttabelle aus Snapshot\n    async addProductTableFromSnapshot(pdf, config, yPosition, checkPageBreak) {\n      try {\n        console.log('addProductTableFromSnapshot called for:', config.name);\n        \n        // Berechne Produkte aus Snapshot-Daten (isoliert)\n        const parts = await this.calculatePartsFromSnapshot(config);\n        \n        console.log('Received parts:', parts, 'Keys count:', Object.keys(parts || {}).length);\n        console.log('Parts entries:', Object.entries(parts || {}));\n        console.log('UlicaSolarBlackJadeFlow in parts:', parts?.UlicaSolarBlackJadeFlow);\n        \n        if (!parts || Object.keys(parts).length === 0) {\n          console.log('No parts calculated, returning early');\n          return yPosition;\n        }\n\n        // NEUES DESIGN: Produkttabelle mit Header\n        await checkPageBreak(30);\n        \n        // Header im Stil der Sidebar (Orange, abgerundet)\n        pdf.setFillColor(255, 177, 1); // #FFB101\n        if (pdf.roundedRect) {\n          pdf.roundedRect(15, yPosition - 5, 180, 15, 3, 3, 'F');\n        } else {\n          pdf.rect(15, yPosition - 5, 180, 15, 'F');\n        }\n        \n        pdf.setTextColor(255, 255, 255);\n        pdf.setFontSize(12);\n        pdf.setFont('helvetica', 'bold');\n        pdf.text('PRODUKT-LISTE', 20, yPosition + 5);\n        \n        pdf.setTextColor(0, 0, 0);\n        yPosition += 20;\n\n        // Tabellen-Header im Stil der Sidebar-Elemente (Dunkelblau, abgerundet oben)\n        await checkPageBreak(15);\n        pdf.setFillColor(14, 30, 52); // #0e1e34\n        if (pdf.roundedRect) {\n          pdf.roundedRect(15, yPosition - 3, 180, 12, 3, 3, 'F');\n        } else {\n          pdf.rect(15, yPosition - 3, 180, 12, 'F');\n        }\n        \n        pdf.setTextColor(255, 255, 255);\n        pdf.setFontSize(9);\n        pdf.setFont('helvetica', 'bold');\n        // Neue Spalten: Anzahl | Produkt (+VE klein) | Benötigte Menge | Preis\n        pdf.text('Anzahl', 20, yPosition + 3);\n        pdf.text('Produkt', 45, yPosition + 3);\n        pdf.text('Benötigte Menge', 120, yPosition + 3);\n        pdf.text('Preis', 170, yPosition + 3);\n        \n        pdf.setTextColor(0, 0, 0);\n        yPosition += 15;\n\n        // Tabellen-Inhalt mit alternierenden Zeilen\n        pdf.setFont('helvetica', 'normal');\n        pdf.setFontSize(8);\n        let totalPrice = 0;\n        let rowCount = 0;\n\n        for (const [productKey, quantity] of Object.entries(parts)) {\n          console.log('Processing product:', productKey, 'quantity:', quantity);\n          if (quantity > 0) {\n            console.log('Adding to PDF:', productKey, 'quantity:', quantity);\n            await checkPageBreak(12);\n\n            // Alternierende Zeilen-Hintergründe\n            if (rowCount % 2 === 1) {\n              pdf.setFillColor(245, 245, 245); // #f5f5f5 wie Sidebar-Panels\n              pdf.rect(15, yPosition - 2, 180, 10, 'F');\n            }\n\n            const productName = PRODUCT_NAME_MAP[productKey] || productKey.replace(/_/g, ' ');\n            const ve = VE[productKey] || 1;\n            const packsNeeded = Math.ceil(quantity / ve);\n            const pricePerPack = getPriceFromCache(productKey);\n            const totalForProduct = packsNeeded * pricePerPack;\n            totalPrice += totalForProduct;\n\n            // Spalte 1: Anzahl (z.B. 1x, 2x)\n            pdf.setFont('helvetica', 'bold');\n            pdf.text(`${packsNeeded}x`, 22, yPosition + 2, { align: 'left' });\n\n            // Spalte 2: Produktname + kleine VE darunter (grau)\n            pdf.setFont('helvetica', 'bold');\n            pdf.setFontSize(10);\n            pdf.text(productName, 45, yPosition + 1);\n            pdf.setFont('helvetica', 'normal');\n            pdf.setFontSize(8);\n            pdf.setTextColor(128, 128, 128);\n            pdf.text(`${ve} Stück`, 45, yPosition + 6);\n            pdf.setTextColor(0, 0, 0);\n\n            // Spalte 3: benötigte Menge (wie bisher Menge)\n            pdf.setFont('helvetica', 'normal');\n            pdf.setFontSize(9);\n            pdf.text(`${quantity}`, 140, yPosition + 2, { align: 'right' });\n\n            // Spalte 4: Preis (Gesamtpreis für diese Position)\n            pdf.setFont('helvetica', 'bold');\n            pdf.text(`${totalForProduct.toFixed(2)} €`, 190, yPosition + 2, { align: 'right' });\n\n            yPosition += 12;\n            rowCount++;\n          }\n        }\n\n        // Gesamt-Linie\n        await checkPageBreak(15);\n        pdf.setDrawColor(233, 236, 239); // #e9ecef Trennlinie wie UI\n        pdf.setLineWidth(1);\n        pdf.line(15, yPosition, 195, yPosition);\n        yPosition += 5;\n\n        return yPosition;\n\n      } catch (error) {\n        console.error('Produkttabelle fehlgeschlagen:', error);\n        return yPosition;\n      }\n    }\n\n    // Isolierte Produktberechnung aus Snapshot\n    async calculatePartsFromSnapshot(config) {\n      try {\n        console.log('Calculating parts for config:', config.name, {\n          selectedCells: config.selectedCells,\n          rows: config.rows,\n          cols: config.cols,\n          includeModules: config.includeModules\n        });\n\n        // Erstelle isolierte Calculation-Data aus Snapshot\n        const calculationData = {\n          selection: config.selection.map(row => [...row]), // Deep copy\n          rows: config.rows,\n          cols: config.cols,\n          cellWidth: config.cellWidth || 179,\n          cellHeight: config.cellHeight || 113,\n          orientation: config.orientation || 'horizontal',\n          options: {\n            erdungsband: config.erdungsband || false,\n            ulicaModule: config.ulicaModule === true,\n            includeModules: config.includeModules === true || config.incM === true\n          }\n        };\n        \n\n\n        let parts;\n        try {\n          // Versuche Web Worker calculation\n          parts = await calculationManager.calculate('calculateParts', calculationData);\n        } catch (error) {\n          console.warn('calculationManager failed, using fallback:', error);\n          // Fallback zu direkter Berechnung\n          parts = this.calculatePartsDirectly(calculationData);\n        }\n\n        console.log('Parts calculated:', parts);\n        console.log('Config checkbox states:', {\n          includeModules: config.includeModules,\n          incM: config.incM,\n          ulicaModule: config.ulicaModule\n        });\n        console.log('Config object keys:', Object.keys(config));\n        console.log('Config ulicaModule value:', config.ulicaModule, 'type:', typeof config.ulicaModule);\n        console.log('CalculationData options:', calculationData.options);\n\n        // Module nur hinzufügen wenn Checkbox aktiviert ist\n        if (!config.includeModules && !config.incM) {\n          console.log('Deleting Solarmodul - both checkboxes false');\n          delete parts.Solarmodul;\n        }\n        \n        if (config.ulicaModule !== true) {\n          console.log('Deleting UlicaSolarBlackJadeFlow - ulicaModule is not true');\n          delete parts.UlicaSolarBlackJadeFlow;\n        } else {\n          console.log('Keeping UlicaSolarBlackJadeFlow - ulicaModule is true');\n        }\n\n        // Zusatzprodukte basierend auf Checkboxen\n        if (!config.mc4) {\n          console.log('Deleting MC4 - mc4 checkbox false');\n          delete parts.MC4;\n        }\n        if (!config.cable) {\n          console.log('Deleting Solarkabel - cable checkbox false');\n          delete parts.Solarkabel;\n        }\n        if (!config.wood) {\n          console.log('Deleting Holzunterleger - wood checkbox false');\n          delete parts.Holzunterleger;\n        }\n        if (!config.quetschkabelschuhe) {\n          console.log('Deleting Quetschkabelschuhe - quetschkabelschuhe checkbox false');\n          delete parts.Quetschkabelschuhe;\n        }\n\n        // Erdungsband hinzufügen wenn aktiviert\n        if (config.erdungsband) {\n          // Verwende die SolarGrid-Instanz für Erdungsband-Berechnung\n          parts.Erdungsband = this.solarGrid.calculateErdungsband();\n        } else {\n          delete parts.Erdungsband;\n        }\n\n        console.log('Final parts after processing:', parts);\n        return parts;\n\n      } catch (error) {\n        console.error('Part calculation from snapshot failed:', error);\n        return {};\n      }\n    }\n\n    // Füge Produkttabelle zum PDF hinzu\n    async addProductTable(pdf, config, yPosition, checkPageBreak) {\n      // NEUES DESIGN: Produkttabelle mit Header – Stil der Sidebar\n      await checkPageBreak(30);\n      pdf.setFillColor(255, 177, 1); // #FFB101\n      if (pdf.roundedRect) {\n        pdf.roundedRect(15, yPosition - 5, 180, 15, 3, 3, 'F');\n      } else {\n        pdf.rect(15, yPosition - 5, 180, 15, 'F');\n      }\n      \n      pdf.setTextColor(14, 30, 52); // Dark Text passend zur Sidebar\n      pdf.setFontSize(12);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text('PRODUKT-LISTE', 20, yPosition + 5);\n      \n      pdf.setTextColor(0, 0, 0);\n      yPosition += 20;\n\n      // Berechne Teile für diese Konfiguration\n      const parts = await this.calculateConfigParts(config);\n      \n      if (!parts || Object.keys(parts).length === 0) {\n        pdf.setFontSize(10);\n        pdf.setFont('helvetica', 'italic');\n        pdf.text('Keine Produkte berechnet.', 20, yPosition);\n        return yPosition + 10;\n      }\n\n      // Tabellen-Header im Stil der Sidebar (Dunkelblau, abgerundet)\n      await checkPageBreak(15);\n      pdf.setFillColor(14, 30, 52); // #0e1e34\n      if (pdf.roundedRect) {\n        pdf.roundedRect(15, yPosition - 3, 180, 12, 3, 3, 'F');\n      } else {\n        pdf.rect(15, yPosition - 3, 180, 12, 'F');\n      }\n      \n      pdf.setTextColor(255, 255, 255);\n      pdf.setFontSize(9);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text('Produkt', 20, yPosition + 3);\n      pdf.text('Menge', 70, yPosition + 3);\n      pdf.text('Pack', 100, yPosition + 3);\n      pdf.text('Preis/Pack', 130, yPosition + 3);\n      pdf.text('Gesamt', 170, yPosition + 3);\n      \n      pdf.setTextColor(0, 0, 0);\n      yPosition += 15;\n\n      // Tabellen-Inhalt mit alternierenden Zeilen\n      pdf.setFont('helvetica', 'normal');\n      pdf.setFontSize(8);\n      let totalPrice = 0;\n      let rowCount = 0;\n\n      for (const [productKey, needed] of Object.entries(parts)) {\n        if (needed > 0) {\n          await checkPageBreak(12);\n\n          // Alternierende Zeilen-Hintergründe – Sidebar-Panel-Farbe\n          if (rowCount % 2 === 1) {\n            pdf.setFillColor(245, 245, 245); // #f5f5f5\n            pdf.rect(15, yPosition - 2, 180, 10, 'F');\n          }\n\n          const ve = VE[productKey] || 1;\n          const packs = Math.ceil(needed / ve);\n          const pricePerPack = getPriceFromCache(productKey);\n          const totalProductPrice = packs * pricePerPack;\n          totalPrice += totalProductPrice;\n\n          const productName = PRODUCT_NAME_MAP[productKey] || productKey.replace(/_/g, ' ');\n\n          pdf.text(productName, 20, yPosition + 2);\n          pdf.text(needed.toString(), 70, yPosition + 2);\n          pdf.text(`${packs}×`, 100, yPosition + 2);\n          pdf.text(`${pricePerPack.toFixed(2)} €`, 130, yPosition + 2);\n          pdf.text(`${totalProductPrice.toFixed(2)} €`, 170, yPosition + 2);\n\n          yPosition += 10;\n          rowCount++;\n        }\n      }\n\n      // Gesamt-Linie – dezente UI-Trennlinie\n      await checkPageBreak(15);\n      pdf.setDrawColor(233, 236, 239); // #e9ecef\n      pdf.setLineWidth(1);\n      pdf.line(15, yPosition, 195, yPosition);\n      yPosition += 5;\n\n      return yPosition;\n    }\n\n    // Füge \"Produkte pro Modul\" Informationen hinzu\n\n\n    // Berechne Teile für eine spezifische Konfiguration - VOLLSTÄNDIG ISOLIERT\n    async calculateConfigParts(config) {\n      if (!config.selection || !config.cols || !config.rows) {\n        return {};\n      }\n\n      // ISOLIERTE Berechnung ohne Grid-Eigenschaften zu berühren!\n      const calculationData = {\n        selection: config.selection.map(row => [...row]), // Deep copy\n        rows: config.rows,\n        cols: config.cols,\n        cellWidth: config.cellWidth || 179,\n        cellHeight: config.cellHeight || 113,\n        orientation: config.orientation,\n        options: {\n          erdungsband: config.erdungsband || false,\n          ulicaModule: config.ulicaModule === true,\n          includeModules: config.includeModules === true || config.incM === true\n        }\n      };\n\n      let parts;\n      try {\n        // Direkte Berechnung mit calculationManager - KEINE Grid-Modification!\n        parts = await calculationManager.calculate('calculateParts', calculationData);\n      } catch (error) {\n        console.warn('calculationManager failed, using fallback:', error);\n        // Fallback zu isolierter Berechnung\n        parts = this.calculatePartsDirectly(calculationData);\n      }\n      \n      // Entferne Module wenn nicht ausgewählt\n      if (!config.includeModules && !config.incM) {\n        console.log('Deleting Solarmodul - both includeModules and incM false');\n        delete parts.Solarmodul;\n      }\n      \n      // Entferne Ulica-Module wenn nicht ausgewählt\n      if (config.ulicaModule !== true) {\n        console.log('Deleting UlicaSolarBlackJadeFlow - ulicaModule is not true');\n        delete parts.UlicaSolarBlackJadeFlow;\n      } else {\n        console.log('Keeping UlicaSolarBlackJadeFlow - ulicaModule is true');\n      }\n      \n      // Füge optionale Komponenten nur hinzu wenn ausgewählt\n      if (config.mc4) {\n        const moduleCount = config.selection.flat().filter(v => v).length;\n        parts.MC4_Stecker = Math.ceil(moduleCount / 30);\n        console.log('Added MC4_Stecker:', parts.MC4_Stecker, 'for', moduleCount, 'modules');\n      }\n      \n      if (config.cable) {\n        parts.Solarkabel = 1;\n        console.log('Added Solarkabel: 1');\n      }\n      \n      if (config.wood) {\n        parts.Holzunterleger = 1; // Pauschal 1x zur Gesamtbestellung\n        console.log('Added Holzunterleger: 1');\n      }\n\n      return parts;\n    }\n\n    // Entfernt: processGroup war ungenutzt, alle Berechnungen laufen über Worker/Direct\n\n    // Generiere Dateinamen basierend auf Konfiguration(en)\n    generateFileName(configs) {\n      const now = new Date();\n      const dateStr = now.toISOString().slice(0, 10); // YYYY-MM-DD\n      const timeStr = now.toTimeString().slice(0, 5).replace(':', '-'); // HH-MM\n      \n      let configName = 'Solar-Konfiguration';\n      \n      if (configs.length === 1) {\n        configName = configs[0].name || 'Konfiguration';\n      } else if (configs.length > 1) {\n        configName = `${configs.length}-Konfigurationen`;\n      }\n      \n      // Bereinige Dateinamen von ungültigen Zeichen\n      configName = configName.replace(/[<>:\"/\\\\|?*]/g, '-');\n      \n      return `${configName}_${dateStr}_${timeStr}.pdf`;\n    }\n  }\n\n  // ===== SMART CONFIGURATION PARSER =====\n  class SmartConfigParser {\n    constructor(solarGrid) {\n      this.solarGrid = solarGrid;\n      this.patterns = {\n        // \"5x4\" oder \"5 x 4\" → Grid-Größe\n        gridSize: /(\\d+)\\s*[x×]\\s*(\\d+)(?!\\s*mal)/i,\n        // \"20 module\" → Anzahl Module\n        moduleCount: /(\\d+)\\s*modul[e]?[n]?/i,\n        // \"mit modulen\" oder \"ohne module\" → Module-Checkbox\n        moduleCheckbox: /(?:mit|ohne)[\\s-]*modul[e]?[n]?(?!\\s*\\d)/i,\n        // \"horizontal\" oder \"vertikal\"\n        orientation: /(?:horizontal|vertikal|vertical)/i,\n        // \"mit mc4\" oder \"ohne mc4\"\n        mc4: /(?:mit|ohne)[\\s-]*mc4/i,\n        // \"mit kabel\" oder \"ohne kabel\"  \n        cable: /(?:mit|ohne)[\\s-]*(?:kabel|solarkabel)/i,\n        // \"mit holz\" oder \"ohne holz\"\n        wood: /(?:mit|ohne)[\\s-]*holz(?:unterleger)?/i,\n        // \"mit quetschkabelschuhe\" oder \"ohne quetschkabelschuhe\"\n        quetschkabelschuhe: /(?:mit|ohne)[\\s-]*(?:quetschkabelschuhe|kabelschuhe)/i,\n        // \"3 reihen mit 5 modulen\" oder \"drei reihen 5 module\" oder \"20 module in 4 reihen\" oder \"3 mal 6 module\"\n        rowPattern: /(?:(\\d+|ein|eine|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)\\s*(?:reihen?|zeilen?)\\s*(?:mit|à|a)?\\s*(\\d+)\\s*modul[e]?[n]?)|(?:(\\d+)\\s*modul[e]?[n]?\\s*(?:in|auf)?\\s*(\\d+|ein|eine|zwei|drei|vier|fünf|sechs|sieben|acht|neun|zehn)\\s*(?:reihen?|zeilen?))|(?:(\\d+)\\s*mal\\s*(\\d+)\\s*modul[e]?[n]?)/i,\n        // \"mit abstand\" oder \"ohne abstand\" oder \"1 reihe abstand\"\n        spacing: /(?:(?:mit|ohne)\\s*(?:abstand|lücke))|(?:(\\d+)\\s*(?:reihen?|zeilen?)\\s*(?:abstand|lücke))/i,\n        // \"kompakt\" oder \"mit lücken\" für Grid-Syntax\n        gridCompact: /(?:kompakt|ohne\\s*lücken)/i,\n        gridSpaced: /(?:mit\\s*lücken|mit\\s*abstand)/i,\n        // Kombinierte Checkbox-Logik mit \"und\" Verknüpfungen\n        checkboxCombination: /(?:^|\\s)(?:mit|und)\\s+(.+?)(?:\\s+und\\s+(.+?))*(?:\\s*$)/i,\n        // NEUE ACTION PATTERNS:\n        // \"Konfiguration speichern\", \"config speichern\", \"speichern\", \"save\"\n        saveConfig: /^(?:(?:konfiguration|konfig|config)\\s*)?(?:speichern|save)$/i,\n        // \"Konfiguration löschen\", \"config löschen\" (NICHT nur \"löschen\" oder \"delete\")\n        deleteConfig: /^(?:konfiguration|konfig|config)\\s*(?:löschen|delete)$/i,\n        // \"module löschen\" → Module-Auswahl löschen\n        deleteModules: /^modul[e]?[n]?\\s*löschen$/i,\n        // \"reset\", \"zurücksetzen\" → Grid zurücksetzen\n        resetGrid: /^(?:reset|zurücksetzen|zurücksetzen)$/i,\n        // Intelligente Modul-Verteilung\n        distributionEqual: /(?:gleichmäßig|gleich|optimal)/i,\n        distributionRows: /(?:in\\s*reihen|reihenweise)/i,\n        distributionColumns: /(?:in\\s*spalten|spaltenweise)/i,\n        distributionRandom: /(?:zufällig|random)/i,\n        // Erweiterte Abstand-Logik\n        spacingDouble: /(?:doppelter|doppeltem)\\s*abstand/i,\n        spacingRowsOnly: /(?:nur\\s*)?(?:zwischen\\s*)?reihen/i,\n        spacingColumnsOnly: /(?:nur\\s*)?(?:zwischen\\s*)?spalten/i,\n        // Kombinierte Checkbox-Syntax\n        checkboxAllExcept: /(?:alles\\s*außer|alle\\s*außer)/i,\n        checkboxOnly: /(?:nur|only)/i,\n        checkboxWithout: /(?:ohne\\s*zubehör|ohne\\s*extras)/i,\n        checkboxWithAll: /(?:mit\\s*allem|alles\\s*mit)/i,\n        // Speichern mit Namen\n        saveWithName: /(?:speichern\\s*als\\s*['\"]?([^'\"]+)['\"]?)/i,\n        // Ulica Modul Auswahl (500/450 W) inkl. Synonyme\n        ulicaModule: /ulica(?:\\s*(500|450)\\s*w?)?|black\\s*jade(?:[-\\s]*flow)?\\s*(500|450)?/i\n      };\n    }\n\n    // Hilfsfunktion: Wandelt Wortzahlen in Nummern um\n    parseWordNumber(word) {\n      const wordNumbers = {\n        'ein': 1, 'eine': 1, 'zwei': 2, 'drei': 3, 'vier': 4, 'fünf': 5,\n        'sechs': 6, 'sieben': 7, 'acht': 8, 'neun': 9, 'zehn': 10\n      };\n      \n      if (typeof word === 'string' && wordNumbers[word.toLowerCase()]) {\n        return wordNumbers[word.toLowerCase()];\n      }\n      \n      return parseInt(word) || 0;\n    }\n\n    // Hilfsfunktion: Parst Checkbox-Kombinationen mit \"und\" Verknüpfungen\n    parseCheckboxCombinations(input) {\n      const checkboxes = {\n        modules: null,  // null = nicht erkannt, true = mit, false = ohne\n        mc4: null,\n        cable: null,\n        wood: null,\n        quetschkabelschuhe: null\n      };\n\n      // Normalisiere Input für bessere Erkennung\n      const normalizedInput = input.toLowerCase()\n        .replace(/modulen?/g, 'module')\n        .replace(/solarkabeln?/g, 'solarkabel')\n        .replace(/holzunterlegern?/g, 'holzunterleger');\n\n      // Teile Input bei \"und\" oder \",\" auf und analysiere jeden Teil\n      let parts = normalizedInput.split(/\\s*(?:und|,)\\s*/);\n      \n      // Bereinige den ersten Teil, falls er mit \"mit\" oder \"ohne\" beginnt\n      if (parts[0] && (parts[0].includes('mit ') || parts[0].includes('ohne '))) {\n        parts[0] = parts[0].replace(/.*(?:mit|ohne)\\s+/, '');\n      }\n      \n      // Entferne leere Teile\n      parts = parts.filter(part => part.trim().length > 0);\n\n      for (const part of parts) {\n        const trimmedPart = part.trim();\n        \n        // Prüfe auf Module (aber nicht wenn es Teil einer Reihen-Konfiguration ist)\n        if (/\\bmodul[e]?[n]?\\b/.test(trimmedPart) && !/\\d+\\s*modul/.test(trimmedPart) && !/reihen/.test(trimmedPart)) {\n          // Prüfe ob \"ohne\" davor steht (auch im ursprünglichen Input)\n          if (/\\bohne[\\s-]+modul[e]?[n]?\\b/.test(trimmedPart) || /\\bohne[\\s-]+modul[e]?[n]?\\b/.test(input.toLowerCase())) {\n            checkboxes.modules = false;\n          } else {\n            checkboxes.modules = true;\n          }\n        }\n        \n        // Prüfe auf MC4\n        if (/\\bmc4\\b/.test(trimmedPart)) {\n          if (/\\bohne[\\s-]+mc4\\b/.test(trimmedPart) || /\\bohne[\\s-]+mc4\\b/.test(input.toLowerCase())) {\n            checkboxes.mc4 = false;\n          } else {\n            checkboxes.mc4 = true;\n          }\n        }\n        \n        // Prüfe auf Kabel\n        if (/\\b(?:kabel|solarkabel)\\b/.test(trimmedPart)) {\n          if (/\\bohne[\\s-]+(?:kabel|solarkabel)\\b/.test(trimmedPart) || /\\bohne[\\s-]+(?:kabel|solarkabel)\\b/.test(input.toLowerCase())) {\n            checkboxes.cable = false;\n          } else {\n            checkboxes.cable = true;\n          }\n        }\n        \n        // Prüfe auf Holzunterleger\n        if (/\\b(?:holz|holzunterleger)\\b/.test(trimmedPart)) {\n          if (/\\bohne[\\s-]+(?:holz|holzunterleger)\\b/.test(trimmedPart) || /\\bohne[\\s-]+(?:holz|holzunterleger)\\b/.test(input.toLowerCase())) {\n            checkboxes.wood = false;\n          } else {\n            checkboxes.wood = true;\n          }\n        }\n        \n        // Prüfe auf Quetschkabelschuhe\n        if (/\\b(?:quetschkabelschuhe|kabelschuhe)\\b/.test(trimmedPart)) {\n          if (/\\bohne[\\s-]+(?:quetschkabelschuhe|kabelschuhe)\\b/.test(trimmedPart) || /\\bohne[\\s-]+(?:quetschkabelschuhe|kabelschuhe)\\b/.test(input.toLowerCase())) {\n            checkboxes.quetschkabelschuhe = false;\n          } else {\n            checkboxes.quetschkabelschuhe = true;\n          }\n        }\n      }\n\n      return checkboxes;\n    }\n\n    parseInput(input) {\n      console.log('Parsing input:', input);\n      const config = {};\n      \n      try {\n\n      // Grid-Größe parsen\n      const gridMatch = input.match(this.patterns.gridSize);\n      if (gridMatch) {\n        config.cols = parseInt(gridMatch[1]);\n        config.rows = parseInt(gridMatch[2]);\n        \n        // Prüfe auf Abstand auch bei Grid-Größen-Angaben\n        const spacingMatch = input.match(this.patterns.spacing);\n        let spacingRows = 0;\n        \n        if (spacingMatch) {\n          if (spacingMatch[0].toLowerCase().includes('mit') && !spacingMatch[1]) {\n            spacingRows = 1; // Standard-Abstand\n          } else if (spacingMatch[1]) {\n            spacingRows = parseInt(spacingMatch[1]);\n          }\n          \n          // Wenn Abstand bei Grid-Größe, prüfe ob bereits Module vorhanden sind\n          if (spacingRows >= 0) { // >= 0 um auch \"ohne abstand\" zu unterstützen\n            // Überprüfe ob bereits eine Auswahl existiert (dynamische Anpassung)\n            const hasExistingSelection = this.solarGrid.selection && \n              this.solarGrid.selection.some(row => row && row.some(cell => cell === true));\n            \n            if (hasExistingSelection) {\n              // Dynamische Abstand-Anpassung auf bestehendes Grid\n              config.adjustSpacing = {\n                spacing: spacingRows,\n                targetCols: config.cols,\n                targetRows: config.rows\n              };\n            } else {\n              // Neue Grid-Erstellung mit Abstand (wie bisher)\n              const actualRows = Math.ceil(config.rows / (1 + Math.max(spacingRows, 1)));\n              const totalCells = config.cols * actualRows;\n              \n              config.rowConfig = {\n                rows: actualRows,\n                modulesPerRow: config.cols,\n                spacing: spacingRows,\n                totalModules: totalCells\n              };\n            }\n          }\n        }\n        \n        // Prüfe auf Grid-Syntax-Modifikatoren (kompakt/with lücken)\n        const gridCompactMatch = input.match(this.patterns.gridCompact);\n        const gridSpacedMatch = input.match(this.patterns.gridSpaced);\n        \n        if (gridCompactMatch) {\n          config.gridCompact = true; // Keine Abstände\n        } else if (gridSpacedMatch) {\n          config.gridSpaced = true; // Mit Abständen\n        }\n      }\n\n      // Reihen-Pattern parsen (hat Priorität vor einfacher moduleCount)\n      const rowMatch = input.match(this.patterns.rowPattern);\n      \n      // Separate Abstand-Anpassung nur wenn KEINE anderen Patterns gefunden wurden\n      // (z.B. nur \"mit abstand\" ohne Grid-Größe oder Module-Anzahl)\n      const hasOtherPatterns = gridMatch || rowMatch || input.match(this.patterns.moduleCount);\n      \n      if (!hasOtherPatterns) {\n        const spacingOnlyMatch = input.match(this.patterns.spacing);\n        if (spacingOnlyMatch) {\n          let spacingRows = 0;\n          \n          if (spacingOnlyMatch[0].toLowerCase().includes('ohne')) {\n            spacingRows = 0; // \"ohne abstand\"\n          } else if (spacingOnlyMatch[0].toLowerCase().includes('mit') && !spacingOnlyMatch[1]) {\n            spacingRows = 1; // \"mit abstand\" (Standard)\n          } else if (spacingOnlyMatch[1]) {\n            spacingRows = parseInt(spacingOnlyMatch[1]); // \"mit X reihen abstand\"\n          }\n          \n          // Prüfe ob bereits Module vorhanden sind\n          const hasExistingSelection = this.solarGrid.selection && \n            this.solarGrid.selection.some(row => row && row.some(cell => cell === true));\n          \n          if (hasExistingSelection) {\n            // Dynamische Abstand-Anpassung auf bestehendes Grid\n            config.adjustSpacing = {\n              spacing: spacingRows,\n              targetCols: null, // Keine spezifische Ziel-Spalten-Anzahl\n              targetRows: null  // Keine spezifische Ziel-Reihen-Anzahl\n            };\n            \n            // Früher Return, da dies die Hauptfunktion ist\n            return config;\n          } else {\n            // Keine Module vorhanden - Fehlermeldung\n            this.solarGrid.showToast(`⚠️ Keine Module vorhanden - erst Module auswählen, dann Abstand anpassen`, 3000);\n            return {};\n          }\n        }\n      }\n      if (rowMatch) {\n        let numRows, modulesPerRow;\n        \n        if (rowMatch[1] && rowMatch[2]) {\n          // \"3 reihen mit 5 modulen\" Format\n          numRows = this.parseWordNumber(rowMatch[1]);\n          modulesPerRow = parseInt(rowMatch[2]);\n        } else if (rowMatch[3] && rowMatch[4]) {\n          // \"20 module in 6 reihen\" Format\n          const totalModules = parseInt(rowMatch[3]);\n          numRows = this.parseWordNumber(rowMatch[4]);\n          // Berechne minimale Spalten für gleichmäßige Verteilung\n          modulesPerRow = Math.ceil(totalModules / numRows);\n          \n          // Speichere zusätzliche Info für intelligente Verteilung\n          config.intelligentDistribution = {\n            totalModules: totalModules,\n            numRows: numRows,\n            baseModulesPerRow: Math.floor(totalModules / numRows),\n            extraModules: totalModules % numRows\n          };\n        } else if (rowMatch[5] && rowMatch[6]) {\n          // \"3 mal 6 module\" Format\n          numRows = parseInt(rowMatch[5]);\n          modulesPerRow = parseInt(rowMatch[6]);\n        }\n        \n        if (numRows && modulesPerRow) {\n          // Prüfe auf Abstand-Spezifikation\n          const spacingMatch = input.match(this.patterns.spacing);\n          let spacingRows = 0;\n          \n          if (spacingMatch) {\n            if (spacingMatch[0].toLowerCase().includes('mit') && !spacingMatch[1]) {\n              spacingRows = 1; // Standard-Abstand\n            } else if (spacingMatch[1]) {\n              spacingRows = parseInt(spacingMatch[1]);\n            }\n          }\n          \n          config.rowConfig = {\n            rows: numRows,\n            modulesPerRow: modulesPerRow,\n            spacing: spacingRows,\n            totalModules: numRows * modulesPerRow\n          };\n          \n          // Berechne benötigte Grid-Größe\n          const neededRows = numRows + (numRows - 1) * spacingRows;\n          config.cols = modulesPerRow;\n          config.rows = neededRows;\n          \n        }\n      }\n      \n      // Intelligente Modul-Verteilung parsen\n      const distributionEqualMatch = input.match(this.patterns.distributionEqual);\n      const distributionRowsMatch = input.match(this.patterns.distributionRows);\n      const distributionColumnsMatch = input.match(this.patterns.distributionColumns);\n      const distributionRandomMatch = input.match(this.patterns.distributionRandom);\n      \n      if (distributionEqualMatch) {\n        config.distribution = 'equal';\n      } else if (distributionRowsMatch) {\n        config.distribution = 'rows';\n      } else if (distributionColumnsMatch) {\n        config.distribution = 'columns';\n      } else if (distributionRandomMatch) {\n        config.distribution = 'random';\n      }\n      \n      // Module-Anzahl parsen (nur wenn keine Reihen-Konfiguration)\n      else {\n        const moduleMatch = input.match(this.patterns.moduleCount);\n        if (moduleMatch) {\n          config.moduleCount = parseInt(moduleMatch[1]);\n          \n          // Prüfe auf Abstand auch bei einfacher Module-Anzahl\n          const spacingMatch = input.match(this.patterns.spacing);\n          const spacingDoubleMatch = input.match(this.patterns.spacingDouble);\n          const spacingRowsOnlyMatch = input.match(this.patterns.spacingRowsOnly);\n          const spacingColumnsOnlyMatch = input.match(this.patterns.spacingColumnsOnly);\n          let spacingRows = 0;\n          \n          if (spacingDoubleMatch) {\n            spacingRows = 2; // Doppelter Abstand\n          } else if (spacingRowsOnlyMatch) {\n            spacingRows = 1; // Nur zwischen Reihen\n            config.spacingRowsOnly = true;\n          } else if (spacingColumnsOnlyMatch) {\n            spacingRows = 1; // Nur zwischen Spalten\n            config.spacingColumnsOnly = true;\n          } else if (spacingMatch) {\n            if (spacingMatch[0].toLowerCase().includes('mit') && !spacingMatch[1]) {\n              spacingRows = 1; // Standard-Abstand\n            } else if (spacingMatch[1]) {\n              spacingRows = parseInt(spacingMatch[1]);\n            }\n          }\n          \n          // Automatisch optimale Grid-Größe berechnen\n          const gridSize = this.calculateOptimalGrid(config.moduleCount);\n          config.cols = gridSize.cols;\n          config.rows = gridSize.rows;\n          \n          // Wenn Abstand gewünscht, erstelle rowConfig für gleichmäßige Verteilung\n          if (spacingRows > 0) {\n            const optimalRows = Math.ceil(Math.sqrt(config.moduleCount / gridSize.cols));\n            const modulesPerRow = Math.ceil(config.moduleCount / optimalRows);\n            \n            config.rowConfig = {\n              rows: optimalRows,\n              modulesPerRow: modulesPerRow,\n              spacing: spacingRows,\n              totalModules: config.moduleCount\n            };\n            \n            // Angepasste Grid-Größe mit Abstand\n            config.rows = optimalRows + (optimalRows - 1) * spacingRows;\n            config.cols = Math.max(config.cols, modulesPerRow);\n          }\n        }\n      }\n\n      // Orientierung parsen (nur wenn explizit erwähnt)\n      const orientationMatch = input.match(this.patterns.orientation);\n      if (orientationMatch) {\n        config.orientation = orientationMatch[0].toLowerCase().includes('vertikal') || \n                            orientationMatch[0].toLowerCase().includes('vertical') ? 'vertical' : 'horizontal';\n      }\n\n      // Erweiterte Checkbox-Syntax parsen\n      const checkboxAllExceptMatch = input.match(this.patterns.checkboxAllExcept);\n      const checkboxOnlyMatch = input.match(this.patterns.checkboxOnly);\n      const checkboxWithoutMatch = input.match(this.patterns.checkboxWithout);\n      const checkboxWithAllMatch = input.match(this.patterns.checkboxWithAll);\n      \n      if (checkboxAllExceptMatch) {\n        // \"alles außer holz\" → Alle außer das spezifische Wort\n        const exceptWord = input.toLowerCase().match(/(?:alles\\s*außer|alle\\s*außer)\\s+(\\w+)/);\n        if (exceptWord) {\n          const exceptItem = exceptWord[1];\n          config.includeModules = exceptItem !== 'module' && exceptItem !== 'modulen';\n          config.mc4 = exceptItem !== 'mc4';\n          config.cable = exceptItem !== 'kabel' && exceptItem !== 'solarkabel';\n          config.wood = exceptItem !== 'holz' && exceptItem !== 'holzunterleger';\n          config.quetschkabelschuhe = exceptItem !== 'quetschkabelschuhe' && exceptItem !== 'kabelschuhe';\n        }\n      } else if (checkboxOnlyMatch) {\n        // \"nur module und mc4\" → Nur die spezifischen Items\n        const onlyItems = input.toLowerCase().match(/(?:nur|only)\\s+(.+?)(?:\\s+und\\s+(.+?))*(?:\\s*$)/);\n        if (onlyItems) {\n          const items = [onlyItems[1], onlyItems[2]].filter(Boolean);\n          config.includeModules = items.some(item => item.includes('module'));\n          config.mc4 = items.some(item => item.includes('mc4'));\n          config.cable = items.some(item => item.includes('kabel') || item.includes('solarkabel'));\n          config.wood = items.some(item => item.includes('holz'));\n          config.quetschkabelschuhe = items.some(item => item.includes('quetschkabelschuhe') || item.includes('kabelschuhe'));\n        }\n      } else if (checkboxWithoutMatch) {\n        // \"ohne zubehör\" → Nur Module\n        config.includeModules = true;\n        config.mc4 = false;\n        config.cable = false;\n        config.wood = false;\n        config.quetschkabelschuhe = false;\n      } else if (checkboxWithAllMatch) {\n        // \"mit allem\" → Alle aktivieren\n        config.includeModules = true;\n        config.mc4 = true;\n        config.cable = true;\n        config.wood = true;\n        config.quetschkabelschuhe = true;\n      } else {\n        // Checkbox-Kombinationen parsen (hat Priorität vor einzelnen Patterns)\n        const checkboxCombinations = this.parseCheckboxCombinations(input);\n        let hasCheckboxCombinations = Object.values(checkboxCombinations).some(value => value !== null);\n\n        if (hasCheckboxCombinations) {\n          // Setze nur die Werte, die explizit erkannt wurden (nicht null)\n          if (checkboxCombinations.modules !== null) config.includeModules = checkboxCombinations.modules;\n          if (checkboxCombinations.mc4 !== null) config.mc4 = checkboxCombinations.mc4;\n          if (checkboxCombinations.cable !== null) config.cable = checkboxCombinations.cable;\n          if (checkboxCombinations.wood !== null) config.wood = checkboxCombinations.wood;\n          if (checkboxCombinations.quetschkabelschuhe !== null) config.quetschkabelschuhe = checkboxCombinations.quetschkabelschuhe;\n                } else {\n          // Fallback: Einzelne Checkbox-Patterns parsen\n          \n          // Module-Checkbox parsen (getrennt von moduleCount)\n          const moduleCheckboxMatch = input.match(this.patterns.moduleCheckbox);\n          if (moduleCheckboxMatch) {\n            config.includeModules = moduleCheckboxMatch[0].toLowerCase().includes('mit');\n          }\n\n          // Optionen parsen (nur wenn explizit erwähnt)\n          const mc4Match = input.match(this.patterns.mc4);\n          if (mc4Match) {\n            config.mc4 = mc4Match[0].toLowerCase().includes('mit');\n          }\n\n          const cableMatch = input.match(this.patterns.cable);\n          if (cableMatch) {\n            config.cable = cableMatch[0].toLowerCase().includes('mit');\n          }\n\n          const woodMatch = input.match(this.patterns.wood);\n          if (woodMatch) {\n            config.wood = woodMatch[0].toLowerCase().includes('mit');\n          }\n\n          const quetschkabelschuheMatch = input.match(this.patterns.quetschkabelschuhe);\n          if (quetschkabelschuheMatch) {\n            config.quetschkabelschuhe = quetschkabelschuheMatch[0].toLowerCase().includes('mit');\n          }\n        }\n      }\n\n      // Ulica Modul Parsing (setzt spez. Modul + Checkbox)\n      const ulicaMatch = input.match(this.patterns.ulicaModule);\n      if (ulicaMatch) {\n        config.ulicaModule = true;\n        const watt = (ulicaMatch[1] || ulicaMatch[2] || '').toString();\n        if (watt === '450') {\n          config.selectedModule = 'ulica-450';\n        } else if (watt === '500') {\n          config.selectedModule = 'ulica-500';\n        } else {\n          // Default auf 500, wenn nicht eindeutig\n          config.selectedModule = 'ulica-500';\n        }\n        // Ulica schließt allgemeine Module aus\n        config.includeModules = false;\n      }\n\n      // NEUE ACTION PATTERNS PRÜFEN (höchste Priorität - vor allen anderen Patterns)\n      const saveWithNameMatch = input.match(this.patterns.saveWithName);\n      if (saveWithNameMatch) {\n        config.action = 'saveConfig';\n        config.configName = saveWithNameMatch[1];\n        return config;\n      }\n      \n      const saveConfigMatch = input.match(this.patterns.saveConfig);\n      if (saveConfigMatch) {\n        config.action = 'saveConfig';\n        return config;\n      }\n      \n      // KURZE EINGABEN: Verwende aktuelles Grid als Basis\n      const isShortInput = input.length < 20 && !input.match(/\\d/);\n      if (isShortInput) {\n        // Setze aktuelle Grid-Größe als Basis\n        config.cols = this.solarGrid.cols;\n        config.rows = this.solarGrid.rows;\n        config.useCurrentGrid = true;\n      }\n\n      const deleteConfigMatch = input.match(this.patterns.deleteConfig);\n      if (deleteConfigMatch) {\n        config.action = 'deleteConfig';\n        return config;\n      }\n\n      const deleteModulesMatch = input.match(this.patterns.deleteModules);\n      if (deleteModulesMatch) {\n        config.action = 'deleteModules';\n        return config;\n      }\n\n      const resetGridMatch = input.match(this.patterns.resetGrid);\n      if (resetGridMatch) {\n        config.action = 'resetGrid';\n        return config;\n      }\n\n      return config;\n      } catch (error) {\n        console.error('Error parsing input:', input, error);\n        return {};\n      }\n    }\n\n    calculateOptimalGrid(moduleCount) {\n      // Finde beste Rechteck-Aufteilung\n      const factors = [];\n      for (let i = 1; i <= Math.sqrt(moduleCount); i++) {\n        if (moduleCount % i === 0) {\n          factors.push([i, moduleCount / i]);\n        }\n      }\n      \n      // Bevorzuge quadratische oder leicht rechteckige Formen\n      const best = factors.reduce((a, b) => {\n        const ratioA = Math.max(a[0], a[1]) / Math.min(a[0], a[1]);\n        const ratioB = Math.max(b[0], b[1]) / Math.min(b[0], b[1]);\n        return ratioA <= ratioB ? a : b;\n      });\n\n      return { cols: Math.max(best[0], best[1]), rows: Math.min(best[0], best[1]) };\n    }\n\n    applyConfiguration(config) {\n      \n      // Speichere bestehende Auswahl\n      const oldSelection = this.solarGrid.selection ? \n        this.solarGrid.selection.map(row => [...row]) : null;\n      const oldCols = this.solarGrid.cols;\n      const oldRows = this.solarGrid.rows;\n      \n      // Grid-Größe setzen (nur wenn angegeben)\n      if (config.cols && config.rows) {\n        this.solarGrid.cols = config.cols;\n        this.solarGrid.rows = config.rows;\n      }\n\n      // Orientierung setzen (nur wenn angegeben)\n      if (config.orientation) {\n        if (this.solarGrid.orV) this.solarGrid.orV.checked = config.orientation === 'vertical';\n        if (this.solarGrid.orH) this.solarGrid.orH.checked = config.orientation === 'horizontal';\n        \n        // Synchronisiere mit den Orientation Buttons\n        const orientHBtn = document.getElementById('orient-h');\n        const orientVBtn = document.getElementById('orient-v');\n        if (orientHBtn && orientVBtn) {\n          orientHBtn.classList.toggle('active', config.orientation === 'horizontal');\n          orientVBtn.classList.toggle('active', config.orientation === 'vertical');\n        }\n      }\n\n      // NEUE ACTION PATTERNS HANDHABEN (höchste Priorität)\n      if (config.action) {\n        this.handleAction(config.action, config);\n        return; // Keine weitere Konfiguration anwenden\n      }\n\n      // Optionen setzen (nur die angegebenen)\n      if (config.hasOwnProperty('includeModules')) {\n        if (this.solarGrid.incM) this.solarGrid.incM.checked = config.includeModules;\n      }\n      if (config.hasOwnProperty('mc4')) {\n        if (this.solarGrid.mc4) this.solarGrid.mc4.checked = config.mc4;\n      }\n      if (config.hasOwnProperty('cable')) {\n        if (this.solarGrid.solarkabel) this.solarGrid.solarkabel.checked = config.cable;\n      }\n      if (config.hasOwnProperty('wood')) {\n        if (this.solarGrid.holz) this.solarGrid.holz.checked = config.wood;\n      }\n      if (config.hasOwnProperty('quetschkabelschuhe')) {\n        if (this.solarGrid.quetschkabelschuhe) this.solarGrid.quetschkabelschuhe.checked = config.quetschkabelschuhe;\n      }\n      if (config.hasOwnProperty('ulicaModule')) {\n        if (this.solarGrid.ulicaModule) this.solarGrid.ulicaModule.checked = config.ulicaModule === true;\n        // Exklusivität sicherstellen: Ulica aktiv => include-modules aus\n        if (config.ulicaModule === true && this.solarGrid.incM) {\n          this.solarGrid.incM.checked = false;\n        }\n      }\n\n      // Spezifische Modulauswahl anwenden (z.B. Ulica 500/450)\n      if (config.selectedModule && this.solarGrid.moduleSelect) {\n        this.solarGrid.moduleSelect.value = config.selectedModule;\n        // Triggert Breite/Höhe und Checkbox-Clear gemäß bestehender Logik\n        this.solarGrid.handleModuleSelectChange();\n      }\n\n      // Checkbox-Änderungen global auf alle Konfigurationen anwenden\n      // (sichert konsistentes Verhalten über alle Configs)\n      this.solarGrid.updateAllConfigurationsForCheckboxes();\n\n      // INTELLIGENTE Selection-Matrix-Erstellung\n      // NUR bei Grid-Größen-Änderung → Selection anpassen/löschen\n      // Bei reinen Checkbox-Änderungen → Selection beibehalten\n      const gridSizeChanged = (config.cols && config.cols !== oldCols) || \n                             (config.rows && config.rows !== oldRows);\n      \n      let newSelection;\n      if (gridSizeChanged) {\n        // Grid-Größe geändert: Verhalten hängt davon ab ob moduleCount/rowConfig folgt\n        if (config.moduleCount || config.rowConfig) {\n          // Wenn moduleCount oder rowConfig folgt: LEERE Matrix (autoSelect übernimmt)\n          newSelection = Array.from({ length: this.solarGrid.rows }, () =>\n            Array.from({ length: this.solarGrid.cols }, () => false)\n          );\n        } else {\n          // Nur Grid-Größe ohne Auto-Selection: Behalte was möglich ist\n          newSelection = Array.from({ length: this.solarGrid.rows }, (_, y) =>\n            Array.from({ length: this.solarGrid.cols }, (_, x) => {\n              if (oldSelection && y < oldSelection.length && x < oldSelection[y].length) {\n                return oldSelection[y][x];\n              }\n              return false;\n            })\n          );\n        }\n      } else {\n        // Keine Grid-Änderung: Behalte bestehende Selection komplett\n        newSelection = oldSelection || Array.from({ length: this.solarGrid.rows }, () =>\n          Array.from({ length: this.solarGrid.cols }, () => false)\n        );\n      }\n      \n      this.solarGrid.selection = newSelection;\n\n      // Grid mit neuen Dimensionen neu aufbauen\n      this.solarGrid.updateSize();\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n\n      // NEUE: Dynamische Abstand-Anpassung auf bestehendes Grid\n      if (config.adjustSpacing) {\n        this.adjustGridSpacing(config.adjustSpacing);\n      }\n      // Wenn Reihen-Konfiguration angegeben, verwende spezielle Selektion\n      else if (config.rowConfig) {\n        this.applyRowConfiguration(config.rowConfig, config.intelligentDistribution);\n      }\n      // Wenn Module-Anzahl angegeben, automatisch auswählen\n      else if (config.moduleCount) {\n        this.autoSelectModules(config.moduleCount);\n      }\n      \n      // Verstecke Tipps nach erster Nutzung\n      this.hideHelpAfterFirstUse();\n    }\n    \n    // Neue Methode: Preview-Grid verstecken und Konfiguration auf Hauptgrid anwenden\n    applyPreviewToMainGrid(config) {\n      \n      \n      // Verstecke Preview-Grid und zeige Hauptgrid\n      this.solarGrid.hidePreviewGrid();\n      this.solarGrid.showMainGrid();\n      \n      // Wende Konfiguration auf Hauptgrid an\n      this.applyConfiguration(config);\n    }\n    \n    // NEUE ACTION HANDLER METHODE\n    handleAction(action, config = {}) {\n      switch (action) {\n        case 'saveConfig':\n          if (config.configName) {\n            // Name der aktuellen Konfiguration ändern\n            this.solarGrid.renameCurrentConfig(config.configName);\n            \t\t\tthis.solarGrid.showToast(`Konfiguration umbenannt zu \"${config.configName}\"`, 2000);\n          } else {\n            // Normales Speichern\n            this.solarGrid.saveNewConfig();\n            \t\t\t\tthis.solarGrid.showToast('Konfiguration gespeichert', 2000);\n          }\n          break;\n          \n        case 'deleteConfig':\n          // Prüfe ob mindestens 2 Konfigurationen vorhanden sind\n          if (this.solarGrid.configs.length <= 1) {\n            this.solarGrid.showToast('⚠️ Kann letzte Konfiguration nicht löschen', 3000);\n            return;\n          }\n          // Lösche aktuelle Konfiguration\n          if (this.solarGrid.currentConfig !== null) {\n            this.solarGrid.deleteConfig(this.solarGrid.currentConfig);\n            \t\t\t\tthis.solarGrid.showToast('Konfiguration gelöscht', 2000);\n          }\n          break;\n          \n        case 'deleteModules':\n          // Lösche nur die Module-Auswahl, behalte Grid-Größe\n          this.clearModuleSelection();\n          \t\t\tthis.solarGrid.showToast('Module-Auswahl gelöscht', 2000);\n          break;\n          \n        case 'resetGrid':\n          this.solarGrid.resetGridToDefault();\n          this.solarGrid.showToast('⚡ Grid zurückgesetzt', 2000);\n          break;\n          \n        default:\n          console.warn('Unbekannte Action:', action);\n      }\n    }\n\n    // Hilfsmethode: Lösche nur Module-Auswahl (nicht Grid-Größe)\n    clearModuleSelection() {\n      // Setze alle Zellen auf false, behalte aber Grid-Dimensionen\n      for (let y = 0; y < this.solarGrid.rows; y++) {\n        for (let x = 0; x < this.solarGrid.cols; x++) {\n          if (this.solarGrid.selection[y]) {\n            this.solarGrid.selection[y][x] = false;\n          }\n        }\n      }\n      \n      // Grid und Liste neu aufbauen\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n    }\n\n    hideHelpAfterFirstUse() {\n      const helpSection = document.querySelector('.bulk-selection-help');\n      if (helpSection) {\n        helpSection.style.display = 'none';\n        // Speichere in localStorage, dass Tipps versteckt werden sollen\n        localStorage.setItem('solarTool_hideHelp', 'true');\n      }\n    }\n\n    autoSelectModules(count) {\n      \n      // Prüfe ob das aktuelle Grid groß genug ist\n      const currentCapacity = this.solarGrid.cols * this.solarGrid.rows;\n      \n      if (currentCapacity < count) {\n        this.expandGridForModules(count);\n      }\n      \n      // ROBUST: Initialisiere das komplette Selection-Array für alle Dimensionen\n      this.solarGrid.selection = Array.from({ length: this.solarGrid.rows }, () =>\n        Array.from({ length: this.solarGrid.cols }, () => false)\n      );\n      \n      // Selektiere Module von links nach rechts, oben nach unten\n      let selected = 0;\n      for (let y = 0; y < this.solarGrid.rows && selected < count; y++) {\n        for (let x = 0; x < this.solarGrid.cols && selected < count; x++) {\n          this.solarGrid.selection[y][x] = true;\n          selected++;\n        }\n      }\n      \n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n    }\n    \n    expandGridForModules(targetCount) {\n      const currentCapacity = this.solarGrid.cols * this.solarGrid.rows;\n      \n      if (currentCapacity >= targetCount) return;\n      \n      // Berechne optimale neue Grid-Größe\n      const optimalGrid = this.calculateOptimalGrid(targetCount);\n      \n      // Erweitere das Grid intelligent\n      let newCols = this.solarGrid.cols;\n      let newRows = this.solarGrid.rows;\n      \n      // Bevorzuge Spalten-Erweiterung (horizontal wachsen)\n      while (newCols * newRows < targetCount) {\n        if (newCols <= newRows) {\n          newCols++;\n        } else {\n          newRows++;\n        }\n      }\n      \n      \n      // Aktualisiere Grid-Dimensionen\n      this.solarGrid.cols = newCols;\n      this.solarGrid.rows = newRows;\n      \n      // Erweitere bestehende Auswahl-Matrix\n      const oldSelection = this.solarGrid.selection || [];\n      this.solarGrid.selection = Array.from({ length: newRows }, (_, y) =>\n        Array.from({ length: newCols }, (_, x) => {\n          // Behalte bestehende Auswahl bei\n          if (y < oldSelection.length && x < oldSelection[y].length) {\n            return oldSelection[y][x];\n          }\n          return false;\n        })\n      );\n      \n      // Grid neu aufbauen\n      this.solarGrid.updateSize();\n    }\n    \n    // NEUE METHODE: Dynamische Abstand-Anpassung für bestehende Grids\n    adjustGridSpacing(spacingConfig) {\n      const { spacing, targetCols, targetRows } = spacingConfig;\n      \n      // 1. Identifiziere alle belegten Reihen im aktuellen Grid\n      const occupiedRows = [];\n      for (let y = 0; y < this.solarGrid.rows; y++) {\n        if (this.solarGrid.selection[y] && this.solarGrid.selection[y].some(cell => cell === true)) {\n          // Sammle alle Module in dieser Reihe\n          const modules = [];\n          for (let x = 0; x < this.solarGrid.cols; x++) {\n            if (this.solarGrid.selection[y][x] === true) {\n              modules.push(x);\n            }\n          }\n          occupiedRows.push({ originalRow: y, modules: modules });\n        }\n      }\n      \n      if (occupiedRows.length === 0) return; // Keine Module vorhanden\n      \n      // 2. Berechne neue Grid-Größe basierend auf gewünschtem Abstand\n      let newRows;\n      if (spacing === 0) {\n        // \"ohne abstand\" - nur die belegten Reihen\n        newRows = occupiedRows.length;\n      } else {\n        // \"mit X reihen abstand\" - belegte Reihen + Abstände dazwischen\n        newRows = occupiedRows.length + (occupiedRows.length - 1) * spacing;\n      }\n      \n      // Berechne benötigte Spalten (mindestens so viele wie das breiteste Modul braucht)\n      const maxModuleX = Math.max(...occupiedRows.map(row => \n        row.modules.length > 0 ? Math.max(...row.modules) : 0\n      ));\n      const newCols = Math.max(\n        targetCols || this.solarGrid.cols, // Ziel-Spalten oder aktuelle Spalten\n        maxModuleX + 1                     // Mindestens so breit wie das breiteste Modul\n      );\n      \n      // 3. Passe Grid-Größe an\n      this.solarGrid.cols = newCols;\n      this.solarGrid.rows = newRows;\n      \n      // 4. Erstelle neue Selection-Matrix\n      const newSelection = Array.from({ length: newRows }, () =>\n        Array.from({ length: newCols }, () => false)\n      );\n      \n      // 5. Platziere Module an neuen Positionen mit korrektem Abstand\n      let currentTargetRow = 0;\n      for (let i = 0; i < occupiedRows.length; i++) {\n        const occupiedRow = occupiedRows[i];\n        \n        // Platziere alle Module dieser Reihe\n        for (const moduleX of occupiedRow.modules) {\n          if (moduleX < newCols) {\n            newSelection[currentTargetRow][moduleX] = true;\n          }\n        }\n        \n        // Springe zum nächsten verfügbaren Slot (mit Abstand)\n        if (i < occupiedRows.length - 1) { // Nicht beim letzten Element\n          currentTargetRow += 1 + spacing;\n        }\n      }\n      \n      // 6. Aktualisiere Selection und Grid\n      this.solarGrid.selection = newSelection;\n      this.solarGrid.updateSize();\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n      \n      // 7. Erfolgsmeldung\n      if (spacing === 0) {\n        this.solarGrid.showToast(`🔧 Abstände entfernt - ${occupiedRows.length} Reihen kompakt`, 2000);\n      } else {\n        this.solarGrid.showToast(`📏 ${spacing} Reihen Abstand hinzugefügt - ${newRows} Reihen total`, 2000);\n      }\n    }\n    \n    applyRowConfiguration(rowConfig, intelligentDistribution = null) {\n      if (intelligentDistribution) {\n      }\n      \n      const { rows, modulesPerRow, spacing, totalModules } = rowConfig;\n      \n      // Stelle sicher, dass das Grid die richtige Größe hat\n      const neededRows = rows + (rows - 1) * spacing;\n      const neededCols = modulesPerRow;\n      \n      if (this.solarGrid.rows < neededRows || this.solarGrid.cols < neededCols) {\n        this.expandGridForRowConfig(neededCols, neededRows);\n      }\n      \n      // ROBUSTE Selection-Array-Initialisierung für ALLE Dimensionen\n      // Stelle sicher, dass selection[][] für die aktuellen Dimensionen existiert\n      for (let y = 0; y < this.solarGrid.rows; y++) {\n        if (!this.solarGrid.selection[y]) {\n          this.solarGrid.selection[y] = [];\n        }\n        // Stelle sicher, dass alle X-Positionen existieren\n        for (let x = 0; x < this.solarGrid.cols; x++) {\n          this.solarGrid.selection[y][x] = false;\n        }\n      }\n      \n      // Selektiere Module in Reihen mit intelligenter Verteilung\n      let currentRow = 0;\n      let modulesPlaced = 0;\n      \n      for (let rowIndex = 0; rowIndex < rows; rowIndex++) {\n        let modulesInThisRow;\n        \n        if (intelligentDistribution) {\n          // Intelligente Verteilung: Gleichmäßig verteilen + Reste von oben\n          const { baseModulesPerRow, extraModules } = intelligentDistribution;\n          modulesInThisRow = baseModulesPerRow + (rowIndex < extraModules ? 1 : 0);\n        } else {\n          // Standard: Alle Reihen gleich voll\n          modulesInThisRow = Math.min(modulesPerRow, totalModules - modulesPlaced);\n        }\n        \n        // Selektiere Module in dieser Reihe - VERWENDE AKTUELLE GRID-DIMENSIONEN\n        for (let x = 0; x < modulesInThisRow && x < this.solarGrid.cols; x++) {\n          if (currentRow < this.solarGrid.rows) {\n            // Stelle sicher, dass die Position existiert\n            if (!this.solarGrid.selection[currentRow]) {\n              this.solarGrid.selection[currentRow] = [];\n            }\n            this.solarGrid.selection[currentRow][x] = true;\n            modulesPlaced++;\n          }\n        }\n        \n        \n        // Springe über Abstand-Reihen\n        currentRow += 1 + spacing;\n      }\n      \n      \n      // Grid neu aufbauen\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n    }\n    \n    expandGridForRowConfig(neededCols, neededRows) {\n      const oldSelection = this.solarGrid.selection || [];\n      \n      // Aktualisiere Grid-Dimensionen\n      this.solarGrid.cols = Math.max(this.solarGrid.cols, neededCols);\n      this.solarGrid.rows = Math.max(this.solarGrid.rows, neededRows);\n      \n      // Erweitere Auswahl-Matrix\n      this.solarGrid.selection = Array.from({ length: this.solarGrid.rows }, (_, y) =>\n        Array.from({ length: this.solarGrid.cols }, (_, x) => {\n          // Behalte bestehende Auswahl bei\n          if (y < oldSelection.length && x < oldSelection[y].length) {\n            return oldSelection[y][x];\n          }\n          return false;\n        })\n      );\n      \n      // Grid neu aufbauen\n      this.solarGrid.updateSize();\n    }\n  }\n\n  // ===== BULK SELECTOR =====\n  class BulkSelector {\n    constructor(solarGrid) {\n      this.solarGrid = solarGrid;\n      this.firstClick = null;\n      this.isSelecting = false;\n      this.bulkMode = false; // Neuer Toggle-Modus für Shift\n      \n      // NEUE: Drag-to-Select Properties\n      this.isDragging = false;\n      this.dragStart = null;\n      this.mousePressed = false;\n      \n      this.setupKeyListener();\n      this.setupGlobalMouseEvents();\n    }\n\n    setupKeyListener() {\n      // FEATURE 2: Shift+Klick entfernt - nur noch Drag-and-Drop\n      // Keine Keyboard-Listener mehr für Shift-Toggle\n      // Bulk-Modus wird nur noch über Drag-and-Drop aktiviert\n    }\n\n    toggleBulkMode() {\n      this.bulkMode = !this.bulkMode;\n      \n      if (this.bulkMode) {\n        this.showBulkModeIndicator(true);\n        this.firstClick = null; // Reset bei Aktivierung\n      } else {\n        this.showBulkModeIndicator(false);\n        this.firstClick = null;\n        this.clearHighlight();\n      }\n    }\n\n    showBulkModeIndicator(active) {\n      // Entferne bestehende Indikatoren\n      document.querySelectorAll('.bulk-mode-indicator').forEach(el => el.remove());\n      \n      if (active) {\n        const indicator = document.createElement('div');\n        indicator.className = 'bulk-mode-indicator';\n        indicator.innerHTML = '🔄 Bulk-Modus aktiv - Klicke auf zwei Zellen um einen Bereich auszuwählen';\n        indicator.style.cssText = `\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          background: #f5a623;\n          color: white;\n          padding: 8px 16px;\n          border-radius: 8px;\n          font-size: 14px;\n          font-weight: bold;\n          z-index: 1000;\n          box-shadow: 0 4px 12px rgba(245, 166, 35, 0.3);\n          animation: slideIn 0.3s ease;\n        `;\n        \n        // Animation hinzufügen\n        const style = document.createElement('style');\n        style.textContent = `\n          @keyframes slideIn {\n            from { transform: translateX(100%); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n          }\n        `;\n        if (document.head) {\n          document.head.appendChild(style);\n        }\n        if (document.body) {\n          document.body.appendChild(indicator);\n        }\n      }\n    }\n\n    initializeBulkSelection() {\n      // Erweitere die bestehende Grid-Erstellung\n      const originalBuildGrid = this.solarGrid.buildGrid.bind(this.solarGrid);\n      \n      this.solarGrid.buildGrid = () => {\n        originalBuildGrid();\n        // Warte kurz bis DOM aktualisiert ist, dann füge Bulk Selection hinzu\n        setTimeout(() => {\n          this.addBulkSelectionToGrid();\n        }, 10);\n      };\n      \n      // Initialisiere Bulk Selection auch für das bestehende Grid\n      setTimeout(() => {\n        this.addBulkSelectionToGrid();\n      }, 100);\n    }\n\n    addBulkSelectionToGrid() {\n      const cells = this.solarGrid.gridEl.querySelectorAll('.grid-cell');\n      \n      cells.forEach((cell, index) => {\n        const x = index % this.solarGrid.cols;\n        const y = Math.floor(index / this.solarGrid.cols);\n        \n        // Entferne alte Event Listener\n        const newCell = cell.cloneNode(true);\n        cell.parentNode.replaceChild(newCell, cell);\n        \n        // FEATURE 1: Snap-to-Grid + Touch-Optimierung\n        // NEUE: Drag-to-Select Event Listeners mit Touch-Support\n        newCell.addEventListener('mousedown', (e) => {\n          e.preventDefault(); // Verhindert Textauswahl während Drag\n          this.handleDragStart(e, x, y, newCell);\n        });\n        \n        // Touch-Events für Mobile-Optimierung\n        newCell.addEventListener('touchstart', (e) => {\n          e.preventDefault();\n          this.handleDragStart(e, x, y, newCell);\n        });\n        \n        newCell.addEventListener('mouseenter', (e) => {\n          if (this.mousePressed && this.dragStart) {\n            // FEATURE 1: Snap-to-Grid - Live-Preview mit Grid-Snap\n            this.isDragging = true;\n            this.highlightRange(this.dragStart, { x, y });\n          }\n        });\n        \n        // Touch-Move für Mobile\n        newCell.addEventListener('touchmove', (e) => {\n          if (this.mousePressed && this.dragStart) {\n            e.preventDefault();\n            this.isDragging = true;\n            this.highlightRange(this.dragStart, { x, y });\n          }\n        });\n        \n        newCell.addEventListener('mouseup', (e) => {\n          if (this.mousePressed && this.dragStart) {\n            e.preventDefault();\n            this.handleDragEnd(e, x, y);\n          }\n        });\n        \n        // Touch-End für Mobile\n        newCell.addEventListener('touchend', (e) => {\n          if (this.mousePressed && this.dragStart) {\n            e.preventDefault();\n            this.handleDragEnd(e, x, y);\n          }\n        });\n\n        // FEATURE 2: Shift+Klick entfernt - nur noch Drag-and-Drop\n        // Füge neue Event Listener hinzu\n        newCell.addEventListener('click', (e) => {\n          // Verhindere Click-Verarbeitung wenn gerade ein Drag beendet wurde\n          if (this.isDragging || (this.mousePressed && this.dragStart)) {\n            return;\n          }\n          \n          // Normaler Click-Modus (Bulk-Modus entfernt)\n          if (!this.solarGrid.selection[y]) this.solarGrid.selection[y] = [];\n          \n          if (e.ctrlKey || e.metaKey) {\n            // Ctrl+Click: Toggle ohne firstClick zu ändern\n            this.solarGrid.selection[y][x] = !this.solarGrid.selection[y][x];\n          } else {\n            // Normaler Click: Toggle\n            this.solarGrid.selection[y][x] = !this.solarGrid.selection[y][x];\n          }\n          \n          newCell.classList.toggle('selected');\n          this.solarGrid.trackInteraction();\n          this.solarGrid.buildList();\n          this.solarGrid.updateSummaryOnChange();\n          \n          // Update config-list und overview wenn eine Konfiguration ausgewählt ist\n          if (this.solarGrid.currentConfig !== null) {\n            // Speichere die Konfiguration automatisch\n            this.solarGrid.updateConfig();\n            this.solarGrid.updateConfigList();\n          }\n        });\n\n        newCell.addEventListener('mouseleave', () => {\n          // Nur Highlight löschen wenn nicht gerade gedraggt wird\n          if (!this.mousePressed) {\n            this.clearHighlight();\n          }\n        });\n      });\n    }\n\n    selectRange(start, end) {\n      const minX = Math.min(start.x, end.x);\n      const maxX = Math.max(start.x, end.x);\n      const minY = Math.min(start.y, end.y);\n      const maxY = Math.max(start.y, end.y);\n\n      // Wenn die erste Zelle ausgewählt war, deselektiere den gesamten Bereich\n      // Wenn die erste Zelle leer war, wähle den gesamten Bereich aus\n      const shouldSelect = !start.wasSelected;\n      \n\n      for (let y = minY; y <= maxY; y++) {\n        if (!this.solarGrid.selection[y]) this.solarGrid.selection[y] = [];\n        for (let x = minX; x <= maxX; x++) {\n          this.solarGrid.selection[y][x] = shouldSelect;\n        }\n      }\n\n      this.solarGrid.buildGrid();\n      this.solarGrid.buildList();\n      this.solarGrid.updateSummaryOnChange();\n    }\n\n    highlightRange(start, end) {\n      this.clearHighlight();\n      \n      const minX = Math.min(start.x, end.x);\n      const maxX = Math.max(start.x, end.x);\n      const minY = Math.min(start.y, end.y);\n      const maxY = Math.max(start.y, end.y);\n\n      const cells = this.solarGrid.gridEl.querySelectorAll('.grid-cell');\n      \n      // Ermittle ob wir im Auswahl- oder Abwahl-Modus sind\n      const isSelectMode = start.wasSelected !== undefined ? !start.wasSelected : true;\n      \n      for (let y = minY; y <= maxY; y++) {\n        for (let x = minX; x <= maxX; x++) {\n          const index = y * this.solarGrid.cols + x;\n          if (cells[index]) {\n            // Basis-Highlight (gelber Rahmen)\n            cells[index].classList.add('bulk-highlight');\n            \n            // Intelligente Preview je nach Modus\n            if (isSelectMode) {\n              // Auswahl-Modus: Zeige Solarpanel-Preview mit 30% Opacity\n              cells[index].classList.add('drag-preview-select');\n            } else {\n              // Abwahl-Modus: Zeige Unselected-Preview mit 30% Opacity\n              cells[index].classList.add('drag-preview-deselect');\n            }\n          }\n        }\n      }\n    }\n\n    clearHighlight() {\n      // Entferne alle Highlight- und Preview-Klassen\n      const highlighted = this.solarGrid.gridEl.querySelectorAll('.bulk-highlight, .drag-preview-select, .drag-preview-deselect');\n      highlighted.forEach(cell => {\n        cell.classList.remove('bulk-highlight', 'drag-preview-select', 'drag-preview-deselect');\n      });\n      \n      // Entferne auch alle Drag-Marker\n      const dragMarkers = this.solarGrid.gridEl.querySelectorAll('.drag-start-marker, .drag-select-mode, .drag-deselect-mode');\n      dragMarkers.forEach(cell => {\n        cell.classList.remove('drag-start-marker', 'drag-select-mode', 'drag-deselect-mode');\n      });\n    }\n    \n    // NEUE METHODEN für Drag-to-Select\n    resetDragState() {\n      this.mousePressed = false;\n      this.isDragging = false;\n      this.dragStart = null;\n      this.clearHighlight();\n    }\n    \n    calculateRangeSize(start, end) {\n      const minX = Math.min(start.x, end.x);\n      const maxX = Math.max(start.x, end.x);\n      const minY = Math.min(start.y, end.y);  \n      const maxY = Math.max(start.y, end.y);\n      \n      return (maxX - minX + 1) * (maxY - minY + 1);\n    }\n\n    clearFirstClickMarker() {\n      const cells = this.solarGrid.gridEl.querySelectorAll('.grid-cell');\n      cells.forEach(cell => cell.classList.remove('first-click-marker'));\n    }\n    \n    // FEATURE 1: Snap-to-Grid + Touch-Optimierung - Neue Methoden\n    handleDragStart(e, x, y, cell) {\n      // Erfasse aktuellen Status der Start-Zelle für intelligentes Toggle\n      const isCurrentlySelected = this.solarGrid.selection[y]?.[x] || false;\n      \n      // Starte Drag-to-Select Modus\n      this.mousePressed = true;\n      this.isDragging = false; // Wird erst bei mousemove aktiviert\n      this.dragStart = { x, y, wasSelected: isCurrentlySelected };\n      \n      // Visuelle Markierung der Start-Zelle\n      this.clearHighlight();\n      cell.classList.add('drag-start-marker');\n      \n      // Visueller Hinweis auf Toggle-Modus\n      if (isCurrentlySelected) {\n        cell.classList.add('drag-deselect-mode');\n      } else {\n        cell.classList.add('drag-select-mode');\n      }\n    }\n    \n    handleDragEnd(e, x, y) {\n      if (this.isDragging || (this.dragStart.x === x && this.dragStart.y === y)) {\n        // Drag beendet ODER Single-Click (gleiche Zelle)\n        this.selectRange(this.dragStart, { x, y });\n        \n        // KEINE Toast-Nachrichten mehr bei Drag-Operationen\n        // Alle Toast-Nachrichten für Drag-Operationen wurden entfernt\n      }\n      \n      // Reset Drag-Zustand\n      this.resetDragState();\n    }\n    \n    // FEATURE 1: Snap-to-Grid + Touch-Optimierung - Globale Events\n    setupGlobalMouseEvents() {\n      // Globaler Mouse-Up Event um Drag-Operations außerhalb des Grids zu beenden\n      document.addEventListener('mouseup', (e) => {\n        if (this.mousePressed) {\n          // Drag wurde außerhalb des Grids beendet - ohne Auswahl\n          this.resetDragState();\n        }\n      });\n      \n      // Touch-End für Mobile\n      document.addEventListener('touchend', (e) => {\n        if (this.mousePressed) {\n          // Touch wurde außerhalb des Grids beendet - ohne Auswahl\n          this.resetDragState();\n        }\n      });\n      \n      // Grid-Leave Event um Drag-Preview zu stoppen\n      this.solarGrid.gridEl.addEventListener('mouseleave', () => {\n        if (this.mousePressed && !this.isDragging) {\n          // Mouse verlässt Grid während Drag-Start - Reset ohne Auswahl\n          this.resetDragState();\n        }\n      });\n      \n      // Touch-Leave für Mobile\n      this.solarGrid.gridEl.addEventListener('touchcancel', () => {\n        if (this.mousePressed && !this.isDragging) {\n          // Touch verlässt Grid während Drag-Start - Reset ohne Auswahl\n          this.resetDragState();\n        }\n      });\n      \n      // Verhindere Kontext-Menu während Drag-Operationen\n      this.solarGrid.gridEl.addEventListener('contextmenu', (e) => {\n        if (this.isDragging || this.mousePressed) {\n          e.preventDefault();\n        }\n      });\n      \n      // Verhindere Zoom-Gesten während Drag-Operationen\n      this.solarGrid.gridEl.addEventListener('touchmove', (e) => {\n        if (this.isDragging || this.mousePressed) {\n          e.preventDefault();\n        }\n      });\n    }\n  }\n\n  class SolarGrid {\n    constructor() {\n      this.gridEl        = document.getElementById('grid');\n      this.wrapper       = document.querySelector('.grid-wrapper');\n      this.wIn           = document.getElementById('width-input');\n      this.hIn           = document.getElementById('height-input');\n      this.orH           = document.getElementById('orient-h');\n      this.orV           = document.getElementById('orient-v');\n      this.incM          = document.getElementById('include-modules');\n      this.mc4           = document.getElementById('mc4');\n      this.solarkabel    = document.getElementById('solarkabel');\n      this.holz          = document.getElementById('holz');\n      this.quetschkabelschuhe = document.getElementById('quetschkabelschuhe');\n      this.erdungsband   = document.getElementById('erdungsband');\n      this.ulicaModule   = document.getElementById('ulica-module');\n      \n\n      \t\tthis.listHolder    = document.querySelector('.product-section');\n      this.prodList      = document.querySelector('.product-section #produktliste');\n\n      this.saveBtn       = document.getElementById('save-config-btn');\n      this.addBtn        = document.getElementById('add-to-cart-btn');\n      this.summaryBtn    = document.getElementById('summary-add-cart-btn');\n      this.configListEl  = document.getElementById('config-list');\n      this.resetBtn      = document.getElementById('reset-btn');\n      this.continueLaterBtn = document.getElementById('continue-later-btn');\n      this.moduleSelect = document.getElementById('module-select');\n      \n      // Modul-Daten\n      this.moduleData = {\n        'ulica-500': { name: 'Ulica Black Jade-Flow 500W', width: 195.2, height: 113.4 },\n        'ulica-450': { name: 'Ulica Black Jade-Flow 450W', width: 176.2, height: 113.4 },\n        'trina-vertex-s-plus': { name: 'Trina Vertex S+', width: 176.2, height: 113.4 },\n        'aiko-neostar-3s-plus': { name: 'Aiko Neostar 3S+', width: 176.2, height: 113.4 }\n      };\n      \n      // Modul-Checkbox-Mapping\n      this.moduleCheckboxMapping = {\n        'include-modules': 'ulica-450',\n        'ulica-module': 'ulica-500'\n      };\n\n      this.selection     = [];\n      this.configs       = [];\n      this.currentConfig = null;\n      this.default       = { cols:5, rows:5, width:176, height:113 };\n      \n      // Performance: Debouncing für häufige Updates\n      this.updateTimeout = null;\n      this.updateDelay = 100; // ms\n      \n      // Performance: Resize Observer für responsive Updates\n      this.resizeObserver = null;\n      this.resizeTimeout = null;\n      \n      // FEATURE 8: Pinch-to-Zoom\n      this.zoomLevel = 1;\n      this.minZoom = 0.5;\n      this.maxZoom = 3;\n      this.zoomObserver = null;\n      \n      // FEATURE 5: Performance-Monitoring (entfernbar)\n      this.performanceMetrics = {\n        gridRenderTime: 0,\n        updateTime: 0,\n        memoryUsage: 0,\n        fps: 0,\n        errorCount: 0\n      };\n      \n      // Tracking für Session-Daten\n      this.sessionId = this.generateSessionId();\n      this.sessionStartTime = Date.now();\n      this.firstInteractionTime = null;\n      this.lastInteractionTime = Date.now();\n      this.interactionCount = 0;\n      this.webhookUrl = 'https://hook.eu2.make.com/c7lkudk1v2a2xsr291xbvfs2cb25b84k';\n\n      // PDF Generator initialisieren\n      this.pdfGenerator = new SolarPDFGenerator(this);\n      \n      // Cache Manager für 24h Persistierung\n      this.cacheManager = new CacheManager();\n\n      this.init();\n    }\n\n    // No-op URL saver to avoid TypeError from old onclick bindings\n    saveToUrl() {\n      try {\n        // Optional: could push state or update query params here\n        return;\n      } catch (_) {\n        return;\n      }\n    }\n\n    // ===== WEBHOOK FUNKTIONEN =====\n    \n    generateSessionId() {\n      // Generiere eine einzigartige Session-ID basierend auf Timestamp und Zufallszahl\n      const timestamp = Date.now().toString(36);\n      const randomPart = Math.random().toString(36).substr(2, 9);\n      return `session_${timestamp}_${randomPart}`;\n    }\n    \n    trackInteraction() {\n      if (!this.firstInteractionTime) {\n        this.firstInteractionTime = Date.now();\n      }\n      this.lastInteractionTime = Date.now();\n      this.interactionCount++;\n    }\n\n    formatDuration(milliseconds) {\n      if (!milliseconds || milliseconds < 0) return \"00:00:00\";\n      \n      const totalSeconds = Math.floor(milliseconds / 1000);\n      const hours = Math.floor(totalSeconds / 3600);\n      const minutes = Math.floor((totalSeconds % 3600) / 60);\n      const seconds = totalSeconds % 60;\n      \n      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n    }\n\n    getSessionData() {\n      const now = Date.now();\n      const sessionDurationMs = now - this.sessionStartTime;\n      const timeToFirstInteractionMs = this.firstInteractionTime ? this.firstInteractionTime - this.sessionStartTime : 0;\n      const timeSinceLastInteractionMs = now - this.lastInteractionTime;\n      \n      return {\n        sessionDuration: this.formatDuration(sessionDurationMs),\n        timeToFirstInteraction: this.formatDuration(timeToFirstInteractionMs),\n        timeSinceLastInteraction: this.formatDuration(timeSinceLastInteractionMs),\n        interactionCount: this.interactionCount,\n        sessionStartTime: this.sessionStartTime,\n        firstInteractionTime: this.firstInteractionTime,\n        lastInteractionTime: this.lastInteractionTime,\n        // FEATURE 5: Performance-Monitoring - Metriken hinzufügen\n        performanceMetrics: this.performanceMetrics\n      };\n    }\n\n    getProductSummary() {\n      const parts = this.calculateParts();\n      if (!this.incM.checked) delete parts.Solarmodul;\n      // Zusatzprodukte werden nicht mehr zu einzelnen Konfigurationen hinzugefügt\n      // Sie werden nur noch in der Overview berechnet\n\n      const entries = Object.entries(parts).filter(([,v]) => v > 0);\n      let totalPrice = 0;\n      const productQuantities = {};\n      \n      // Berechne Preise und sammle Quantities\n      entries.forEach(([k,v]) => {\n        const packs = Math.ceil(v / VE[k]);\n        const price = getPriceFromCache(k);\n        const itemTotal = packs * price;\n        totalPrice += itemTotal;\n        \n        // Verwende den Produktnamen ohne Unterstriche als Key\n        const productKey = k.replace(/_/g, '');\n        productQuantities[productKey] = v;\n      });\n        \n        return {\n        totalPrice \n      };\n    }\n\n    generateGridVisualization(selection, cols, rows, cellWidth, cellHeight) {\n      // Generate HTML for the grid\n      let html = `<div class=\"grid\" style=\"--cols: ${cols}; --rows: ${rows}; --cell-size: ${cellWidth}px; --cell-height: ${cellHeight}px; --cell-gap: 2px;\">`;\n      \n      for (let y = 0; y < rows; y++) {\n        for (let x = 0; x < cols; x++) {\n          const isSelected = selection[y] && selection[y][x];\n          const cellClass = isSelected ? 'cell selected' : 'cell';\n          html += `<div class=\"${cellClass}\"></div>`;\n        }\n      }\n      \n      html += '</div>';\n      \n      // Generate CSS for the grid\n      const css = `.grid { \n        display: grid; \n        gap: var(--cell-gap); \n        grid-template-columns: repeat(var(--cols), var(--cell-size)); \n        grid-template-rows: repeat(var(--rows), var(--cell-height)); \n        margin: auto; \n        background: transparent; \n      } \n      .cell { \n        background: #000000; \n        border-radius: 6px; \n        width: var(--cell-size); \n        height: var(--cell-height); \n        transition: all 0.15s ease; \n      } \n      .cell.selected { \n        background: #7f7f7f; \n      }`;\n      \n      return { html, css };\n    }\n\n    getConfigData(config = null) {\n      const targetConfig = config || {\n        cols: this.cols,\n        rows: this.rows,\n        cellWidth: parseInt(this.wIn.value, 10),\n        cellHeight: parseInt(this.hIn.value, 10),\n        orientation: this.orV.checked ? 'vertical' : 'horizontal',\n        selection: this.selection,\n        incM: this.incM.checked\n        // Zusatzprodukte werden nicht mehr zu einzelnen Konfigurationen hinzugefügt\n      };\n\n      const summary = this.getProductSummary();\n      const gridVisualization = this.generateGridVisualization(\n        targetConfig.selection, \n        targetConfig.cols, \n        targetConfig.rows, \n        targetConfig.cellWidth, \n        targetConfig.cellHeight\n      );\n      \n      // Berechne Produkt-Quantitäten für Webhook - ALLE Produkte, auch mit 0\n      const parts = this.calculatePartsDirectly({\n        selection: targetConfig.selection,\n        cols: targetConfig.cols,\n        rows: targetConfig.rows,\n        cellWidth: targetConfig.cellWidth,\n        cellHeight: targetConfig.cellHeight,\n        orientation: targetConfig.orientation,\n        incM: targetConfig.incM\n        // Zusatzprodukte werden nicht mehr zu einzelnen Konfigurationen hinzugefügt\n      });\n      \n      const allProductQuantities = {\n        Solarmodul: parts.Solarmodul || 0,\n        Endklemmen: parts.Endklemmen || 0,\n        Schrauben: parts.Schrauben || 0,\n        Dachhaken: parts.Dachhaken || 0,\n        Mittelklemmen: parts.Mittelklemmen || 0,\n        Endkappen: parts.Endkappen || 0,\n        Schienenverbinder: parts.Schienenverbinder || 0,\n        Schiene240cm: parts.Schiene_240_cm || 0,\n        Schiene360cm: parts.Schiene_360_cm || 0\n        // Zusatzprodukte werden nicht mehr zu einzelnen Konfigurationen hinzugefügt\n      };\n      \n      return {\n        timestamp: new Date().toISOString(),\n        sessionId: this.sessionId,\n        sessionData: this.getSessionData(),\n        config: {\n          cols: targetConfig.cols,\n          rows: targetConfig.rows,\n          cellWidth: targetConfig.cellWidth,\n          cellHeight: targetConfig.cellHeight,\n          orientation: targetConfig.orientation,\n          gridVisualization: gridVisualization,\n          options: {\n            includeModules: targetConfig.incM\n            // Zusatzprodukte werden nicht mehr zu einzelnen Konfigurationen hinzugefügt\n          }\n        },\n        summary: summary,\n        productQuantities: allProductQuantities,\n        totalPrice: summary.totalPrice, // Verwende den korrekten Gesamtpreis aus getProductSummary\n        analytics: {\n          totalCells: targetConfig.cols * targetConfig.rows,\n          selectedCells: targetConfig.selection.flat().filter(v => v).length,\n          selectionPercentage: ((targetConfig.selection.flat().filter(v => v).length / (targetConfig.cols * targetConfig.rows)) * 100).toFixed(2),\n          gridArea: targetConfig.cols * targetConfig.rows,\n          averageCellSize: ((targetConfig.cellWidth + targetConfig.cellHeight) / 2).toFixed(2)\n        }\n      };\n    }\n\n    async sendConfigToWebhook(configData) {\n      try {\n        // FEATURE 10: Analytics zum Webhook hinzufügen\n        const analyticsData = {\n          ...configData,\n          analytics: {\n            sessionData: this.getSessionData(),\n            performanceMetrics: this.performanceMetrics,\n            userAgent: navigator.userAgent,\n            screenResolution: `${screen.width}x${screen.height}`,\n            timestamp: new Date().toISOString(),\n            featureUsage: {\n              dragToSelect: this.interactionCount > 0,\n              smartConfig: configData.smartConfigUsed || false,\n              mobileDevice: this.checkMobileDevice(),\n              zoomLevel: this.zoomLevel || 1\n            }\n          }\n        };\n\n        // NEUE: Füge Grid-Bild zu Webhook-Daten hinzu\n        const gridImage = await this.pdfGenerator.captureGridImageForWebhook(configData);\n        if (gridImage) {\n          // Berechne die tatsächlichen Canvas-Dimensionen\n          const cols = configData.cols || 5;\n          const rows = configData.rows || 5;\n          const cellWidth = 60;\n          const cellHeight = 60;\n          const cellGap = 2;\n          const padding = 40;\n          \n          const width = cols * cellWidth + (cols - 1) * cellGap + padding;\n          const height = rows * cellHeight + (rows - 1) * cellGap + padding;\n          \n          console.log('Grid Image Dimensions:', { cols, rows, width, height });\n          \n          // Erstelle sowohl Data-URL als auch reinen Base64-String für Kompatibilität\n          const base64Only = gridImage.split(',')[1];\n          \n          analyticsData.gridImage = {\n            data: gridImage, // Vollständiger Data-URL: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA...\n            base64: base64Only, // Reiner Base64-String für Fallback\n            format: 'data-url',\n            mimeType: 'image/png',\n            width: width,\n            height: height\n          };\n        }\n\n        const response = await fetch(this.webhookUrl, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(analyticsData)\n        });\n\n        if (response.ok) {\n          return true;\n        } else {\n          return false;\n        }\n      } catch (error) {\n        console.error('Webhook send error:', error);\n        return false;\n      }\n    }\n\n    async sendCurrentConfigToWebhook() {\n      const configData = this.getConfigData();\n      return await this.sendConfigToWebhook(configData);\n    }\n\n    async sendAllConfigsToWebhook() {\n      const results = [];\n      let successCount = 0;\n\n      // Sende jede Konfiguration einzeln\n      for (let idx = 0; idx < this.configs.length; idx++) {\n        const cfg = this.configs[idx];\n        \n        // Für die aktuell bearbeitete Konfiguration: Verwende aktuelle Werte\n        let currentConfig;\n        if (idx === this.currentConfig) {\n          currentConfig = {\n            cols: this.cols,\n            rows: this.rows,\n            cellWidth: parseInt(this.wIn.value, 10),\n            cellHeight: parseInt(this.hIn.value, 10),\n            orientation: this.orV.checked ? 'vertical' : 'horizontal',\n            selection: this.selection,\n            incM: this.incM.checked,\n            mc4: this.mc4.checked,\n            solarkabel: this.solarkabel.checked,\n            holz: this.holz.checked\n          };\n        } else {\n          currentConfig = {\n            cols: cfg.cols,\n            rows: cfg.rows,\n            cellWidth: cfg.cellWidth,\n            cellHeight: cfg.cellHeight,\n            orientation: cfg.orientation,\n            selection: cfg.selection,\n            incM: cfg.incM,\n            mc4: cfg.mc4,\n            solarkabel: cfg.solarkabel,\n            holz: cfg.holz\n          };\n        }\n\n        // Temporär setzen für Berechnung\n        const originalSelection = this.selection;\n        const originalOrientation = this.orV ? this.orV.checked : false;\n        const originalSolarkabel = this.solarkabel ? this.solarkabel.checked : false;\n        const originalIncM = this.incM ? this.incM.checked : false;\n        const originalMc4 = this.mc4 ? this.mc4.checked : false;\n        const originalHolz = this.holz ? this.holz.checked : false;\n        \n        this.selection = currentConfig.selection;\n        if (this.orV) this.orV.checked = currentConfig.orientation === 'vertical';\n        if (this.orH) this.orH.checked = !(currentConfig.orientation === 'vertical');\n        if (this.solarkabel) this.solarkabel.checked = currentConfig.solarkabel;\n        if (this.incM) this.incM.checked = currentConfig.incM;\n        if (this.mc4) this.mc4.checked = currentConfig.mc4;\n        if (this.holz) this.holz.checked = currentConfig.holz;\n\n        // Erstelle individuelle Konfigurationsdaten mit getConfigData\n        const configData = this.getConfigData(currentConfig);\n        \n        // Füge zusätzliche Metadaten hinzu\n        configData.configIndex = idx;\n        configData.configName = cfg.name;\n        configData.totalConfigsInSession = this.configs.length;\n\n        // Ursprüngliche Werte wiederherstellen\n        this.selection = originalSelection;\n        if (this.orV) this.orV.checked = originalOrientation;\n        if (this.orH) this.orH.checked = !originalOrientation;\n        if (this.solarkabel) this.solarkabel.checked = originalSolarkabel;\n        if (this.incM) this.incM.checked = originalIncM;\n        if (this.mc4) this.mc4.checked = originalMc4;\n        if (this.holz) this.holz.checked = originalHolz;\n\n        // Sende einzelne Konfiguration\n        try {\n          const success = await this.sendConfigToWebhook(configData);\n          if (success) {\n            successCount++;\n          } else {\n          }\n          results.push(success);\n          \n          // Kurze Pause zwischen Requests um Server nicht zu überlasten\n          if (idx < this.configs.length - 1) {\n            await new Promise(resolve => setTimeout(resolve, 100));\n          }\n        } catch (error) {\n          results.push(false);\n        }\n      }\n\n      return successCount === this.configs.length;\n    }\n\n    checkMobileDevice() {\n      // Mobile Device Detection\n      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||\n                       window.innerWidth <= 768 ||\n                       ('ontouchstart' in window && window.innerWidth <= 1024);\n      \n      if (isMobile) {\n        this.showMobileWarning();\n      }\n    }\n\n    showMobileWarning() {\n      const mobileWarning = document.getElementById('mobile-warning');\n      const continueBtn = document.getElementById('mobile-continue');\n      const closeBtn = document.getElementById('mobile-close');\n      \n      if (mobileWarning) {\n        // Check if user has already dismissed the warning in this session\n        const hasSeenWarning = sessionStorage.getItem('mobile-warning-seen');\n        \n        if (!hasSeenWarning) {\n          mobileWarning.classList.remove('hidden');\n          \n          // Event Listeners für Buttons\n          continueBtn?.addEventListener('click', () => {\n            mobileWarning.classList.add('hidden');\n            sessionStorage.setItem('mobile-warning-seen', 'true');\n          });\n          \n          closeBtn?.addEventListener('click', () => {\n            mobileWarning.classList.add('hidden');\n            sessionStorage.setItem('mobile-warning-seen', 'true');\n          });\n          \n          // Schließen bei Klick außerhalb des Modals\n          mobileWarning.addEventListener('click', (e) => {\n            if (e.target === mobileWarning) {\n              mobileWarning.classList.add('hidden');\n              sessionStorage.setItem('mobile-warning-seen', 'true');\n            }\n          });\n        }\n      }\n    }\n\n    init() {\n      // Mobile Detection und Warning\n      this.checkMobileDevice();\n      \n      // Prüfe zuerst den Cache (höchste Priorität)\n      const cacheLoaded = this.loadFromCache();\n      \n      // Prüfe URL-Parameter als Fallback (nur wenn Cache nicht geladen wurde)\n      if (!cacheLoaded) {\n        const params = new URLSearchParams(window.location.search);\n    \t\tconst rawData = params.get('configData');\n    \t\tif (rawData) {\n      \t\ttry {\n        \t\tconst json = decodeURIComponent(atob(rawData));\n        \t\tconst configs = JSON.parse(json);\n        \t\t// Lade alle Konfigurationen aus der URL\n        \t\tif (Array.isArray(configs)) {\n        \t\t\tthis.configs = configs;\n        \t\t\tthis.loadConfig(0); // Lade die erste Konfiguration\n        \t\t} else {\n        \t\t\t// Einzelne Konfiguration (alte URL-Format)\n        \t\t\tthis.configs.push(configs);\n        \t\t\tthis.loadConfig(0);\n        \t\t}\n      \t\t} catch (e) {\n      \t\t}\n    \t\t}\n      }\n\n  \t\t// Event-Listener für alle UI-Elemente setzen\n\t\tthis.setupAllEventListeners();\n\n  \t\t// Prüfe ob Buttons existieren bevor Event-Listener hinzugefügt werden\n  \t\tif (this.saveBtn) {\n  \t\t\tthis.saveBtn.addEventListener('click', () => {\n  \t\t\t\tthis.trackInteraction();\n  \t\t\t\tthis.saveNewConfig();\n  \t\t\t});\n  \t\t}\n  \t\tif (this.addBtn) {\n  \t\t\tthis.addBtn.addEventListener('click', () => {\n  \t\t\t\tthis.trackInteraction();\n  \t\t\t\tthis.addCurrentToCart();\n  \t\t\t});\n  \t\t}\n  \t\tif (this.summaryBtn) {\n  \t\t\tthis.summaryBtn.addEventListener('click', () => {\n  \t\t\t\tthis.trackInteraction();\n  \t\t\t\tthis.addAllToCart();\n  \t\t\t});\n  \t\t}\n  \t\t\t\tif (this.resetBtn) {\n\t\t\tthis.resetBtn.addEventListener('click', () => {\n\t\t\t\tthis.trackInteraction();\n\t\t\t\tthis.resetGridToDefault();\n\t\t\t});\n\t\t}\n  \t\tif (this.continueLaterBtn) {\n  \t\t\tthis.continueLaterBtn.addEventListener('click', () => {\n\t\t\t\tthis.trackInteraction();\n\t\t\t\tthis.generateContinueLink();\n\t\t\t});\n\t\t}\n\n\t\t// Sidebar Toggle Funktionalität\n\t\tconst sidebarToggle = document.getElementById('sidebar-toggle');\n\t\t// Neue Sidebar Navigation\n\t\tthis.initSidebarNavigation();\n\n  \t\twindow.addEventListener('resize', () => {\n    \t\tthis.updateSize();\n    \t\tthis.buildGrid();\n    \t\tthis.buildList();\n    \t\tthis.updateSummaryOnChange();\n  \t\t});\n      \n\t\t\t// Wenn keine Konfigurationen aus URL/CACHE geladen wurden, erstelle eine Standard-Konfiguration\n\t\t\tif (this.configs.length === 0) {\n\t\t\t\tthis.cols = this.default.cols;\n\t\t\t\tthis.rows = this.default.rows;\n\t\t\t\tthis.setup();\n\n\t\t\t\tconst defaultConfig = this._makeConfigObject();\n\t\t\t\tthis.configs.push(defaultConfig);\n\t\t\t\tthis.loadConfig(0);\n\n\t\t\t\t// Standard-Orientation nur für echte Default-Erstellung setzen\n\t\t\t\tif (this.orH && this.orV) {\n\t\t\t\t\tthis.orH.checked = false;\n\t\t\t\t\tthis.orV.checked = true;\n\t\t\t\t\t// Synchronisiere mit den Orientation Buttons\n\t\t\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\t\t\tif (orientHBtn && orientVBtn) {\n\t\t\t\t\t\torientHBtn.classList.remove('active');\n\t\t\t\t\t\torientVBtn.classList.add('active');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Performance: Resize Observer für responsive Updates\n\t\t\tthis.setupResizeObserver();\n\t\t\t\n\t\t\t// FEATURE 8: Pinch-to-Zoom Setup\n\t\t\tthis.setupPinchToZoom();\n\t\t\t\n\t\t\t// Initialisiere Smart Config Features\n\t\t\tthis.initSmartConfigFeatures();\n\t\t\t\n\t\t\t// Initialisiere Auto-Save Indicator\n\t\t\tthis.initAutoSaveIndicator();\n\t\t\t\n\t\t\t// Initialisiere Config-Liste\n\t\t\tthis.initConfigList();\n\t\t\t\n\t\t\t// Hinweis: Keine erzwungene Standard-Orientation hier setzen, um Cache/URL-Werte nicht zu überschreiben\n\t\t}\n\t\t\n\t\tinitSidebarNavigation() {\n\t\t\t// Navigation zwischen Detail-Ansicht und Übersicht\n\t\t\tconst backToOverviewBtn = document.getElementById('back-to-overview');\n\t\t\tconst detailView = document.getElementById('config-detail-view');\n\t\t\tconst overviewView = document.getElementById('config-overview');\n\t\t\t\n\t\t\tif (backToOverviewBtn) {\n\t\t\t\tbackToOverviewBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.showOverview();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Edit Config Name\n\t\t\tconst editConfigBtn = document.getElementById('edit-config-name');\n\t\t\tif (editConfigBtn) {\n\t\t\t\teditConfigBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.editConfigName();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Delete Current Config\n\t\t\tconst deleteConfigBtn = document.getElementById('delete-current-config');\n\t\t\tif (deleteConfigBtn) {\n\t\t\t\tdeleteConfigBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.deleteCurrentConfig();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Express Checkout (alter \"In den Warenkorb\" Button)\n\t\t\tconst expressCheckoutBtn = document.getElementById('express-checkout-btn');\n\t\t\tif (expressCheckoutBtn) {\n\t\t\t\texpressCheckoutBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.addCurrentToCart();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Nächste Konfiguration (alter \"Konfiguration speichern\" Button)\n\t\t\tconst nextConfigBtn = document.getElementById('next-config-btn');\n\t\t\tif (nextConfigBtn) {\n\t\t\t\tnextConfigBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.saveNewConfig();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Gesamte Auswahl in Warenkorb\n\t\t\tconst addAllToCartBtn = document.getElementById('add-all-to-cart-btn');\n\t\t\tif (addAllToCartBtn) {\n\t\t\t\taddAllToCartBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.addAllConfigsToCart();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Alle Konfigurationen zurücksetzen\n\t\t\tconst continueLaterBtn = document.getElementById('continue-later-btn');\n\t\t\tif (continueLaterBtn) {\n\t\t\t\tcontinueLaterBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.resetAllConfigurations();\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Add Config Button\n\t\t\tconst addConfigBtn = document.getElementById('add-config-btn');\n\t\t\tif (addConfigBtn) {\n\t\t\t\taddConfigBtn.addEventListener('click', () => {\n\t\t\t\t\tthis.saveNewConfig();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\tshowOverview() {\n\t\t\t// Aktuelle Konfiguration speichern um Progress nicht zu verlieren\n\t\t\tif (this.currentConfig !== null) {\n\t\t\t\tthis.updateConfig();\n\t\t\t}\n\t\t\t\n\t\t\tconst detailView = document.getElementById('config-detail-view');\n\t\t\tconst overviewView = document.getElementById('config-overview');\n\t\t\t\n\t\t\tif (detailView && overviewView) {\n\t\t\t\tdetailView.classList.remove('active');\n\t\t\t\toverviewView.classList.add('active');\n\t\t\t\t\n\t\t\t\t// Alle Input-Felder entfernen\n\t\t\t\tthis.clearAllInputFields();\n\t\t\t\t\n\t\t\t\t// Config-Liste aktualisieren\n\t\t\t\tthis.updateConfigList();\n\t\t\t}\n\t\t}\n\t\t\n\t\tclearAllInputFields() {\n\t\t\t// Entferne alle Input-Felder aus der Detail-Ansicht\n\t\t\tconst titleEl = document.getElementById('current-config-title');\n\t\t\tif (titleEl) {\n\t\t\t\tconst existingInputs = titleEl.parentNode.querySelectorAll('.config-title-input');\n\t\t\t\texistingInputs.forEach(input => input.remove());\n\t\t\t\ttitleEl.style.display = 'block';\n\t\t\t}\n\t\t\t\n\t\t\t// Entferne alle Input-Felder aus der Config-Liste\n\t\t\tconst configItems = document.querySelectorAll('.config-item');\n\t\t\tconfigItems.forEach(item => {\n\t\t\t\tconst nameEl = item.querySelector('.config-item-name');\n\t\t\t\tif (nameEl) {\n\t\t\t\t\tconst existingInputs = nameEl.parentNode.querySelectorAll('input[type=\"text\"]');\n\t\t\t\t\texistingInputs.forEach(input => input.remove());\n\t\t\t\t\tnameEl.style.display = 'block';\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\t// Initialisiere Config-Liste beim Start\n\t\tinitConfigList() {\n\t\t\tif (document.getElementById('config-overview')?.classList.contains('active')) {\n\t\t\t\tthis.updateConfigList();\n\t\t\t}\n\t\t\t\n\t\t\t// Event-Listener für Zusatzprodukte-Checkboxen\n\t\t\tthis.initAdditionalProductsListeners();\n\t\t}\n\t\t\n\t\tshowDetailView(configIndex = null) {\n\t\t\tconst detailView = document.getElementById('config-detail-view');\n\t\t\tconst overviewView = document.getElementById('config-overview');\n\t\t\t\n\t\t\tif (detailView && overviewView) {\n\t\t\t\toverviewView.classList.remove('active');\n\t\t\t\tdetailView.classList.add('active');\n\t\t\t\t\n\t\t\t\tif (configIndex !== null) {\n\t\t\t\t\tthis.loadConfig(configIndex);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Detail-Ansicht aktualisieren\n\t\t\t\tthis.updateDetailView();\n\t\t\t}\n\t\t}\n\t\t\n\t\t\t\tupdateDetailView() {\n\t\t\tconst currentConfig = this.configs[this.currentConfig];\n\t\t\tif (!currentConfig) return;\n\t\t\t\n\t\t\t// Titel aktualisieren\n\t\t\tconst titleEl = document.getElementById('current-config-title');\n\t\t\tif (titleEl) {\n\t\t\t\ttitleEl.textContent = currentConfig.name || `Konfiguration #${this.currentConfig + 1}`;\n\t\t\t}\n\t\t\t\n\t\t\t// Gesamtpreis aktualisieren\n\t\t\tthis.updateCurrentTotalPrice();\n\t\t}\n\t\t\n\t\tupdateCurrentTotalPrice() {\n\t\t\tconst totalPriceEl = document.getElementById('current-total-price');\n\t\t\tif (totalPriceEl) {\n\t\t\t\t// Verwende die gleiche Berechnungslogik wie calculateConfigPrice\n\t\t\t\tconst currentConfig = {\n\t\t\t\t\tselection: this.selection,\n\t\t\t\t\tcols: this.cols,\n\t\t\t\t\trows: this.rows,\n\t\t\t\t\tcellWidth: parseInt(this.wIn?.value || '179'),\n\t\t\t\t\tcellHeight: parseInt(this.hIn?.value || '113'),\n\t\t\t\t\torientation: this.orV?.checked ? 'vertical' : 'horizontal',\n\t\t\t\t\tulicaModule: document.getElementById('ulica-module')?.checked || false\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tconst totalPrice = this.calculateConfigPrice(currentConfig);\n\t\t\t\ttotalPriceEl.textContent = `${totalPrice.toFixed(2).replace('.', ',')} €`;\n\t\t\t}\n\t\t}\n\t\t\n    updateConfigList() {\n      // Delegiere auf zentrale Render-Methode, um Doppelungen zu vermeiden\n      this.renderConfigList();\n      this.updateOverviewTotalPrice();\n      this.renderAdditionalProducts();\n    }\n\t\t\n\t\tinitAutoSaveIndicator() {\n\t\t\t// Auto-Save Indicator Setup\n\t\t\tthis.autoSaveTimeout = null;\n\t\t}\n\t\t\n\t\tshowAutoSaveIndicator() {\n\t\t\tconst indicator = document.getElementById('auto-save-indicator');\n\t\t\tif (!indicator) return;\n\t\t\t\n\t\t\t// Zeige Indicator\n\t\t\tindicator.classList.remove('hidden');\n\t\t\t\n\t\t\t// Animation neu starten\n\t\t\tconst saveIcon = indicator.querySelector('.save-icon');\n\t\t\tif (saveIcon) {\n\t\t\t\t// Animation zurücksetzen und neu starten\n\t\t\t\tsaveIcon.style.animation = 'none';\n\t\t\t\tsaveIcon.offsetHeight; // Trigger reflow\n\t\t\t\tsaveIcon.style.animation = 'rotate360 0.8s ease-in-out';\n\t\t\t}\n\t\t\t\n\t\t\t// Verstecke nach 1 Sekunde\n\t\t\tif (this.autoSaveTimeout) {\n\t\t\t\tclearTimeout(this.autoSaveTimeout);\n\t\t\t}\n\t\t\t\n\t\t\tthis.autoSaveTimeout = setTimeout(() => {\n\t\t\t\tindicator.classList.add('hidden');\n\t\t\t}, 1000);\n\t\t}\n\t\t\n\t\tupdateOverviewTotalPrice() {\n\t\t\tconst totalPriceEl = document.getElementById('overview-total-price');\n\t\t\tif (!totalPriceEl) return;\n\t\t\t\n\t\t\t// Berechne Gesamtpreis aller Konfigurationen\n\t\t\tlet totalPrice = 0;\n\t\t\tthis.configs.forEach(config => {\n\t\t\t\ttotalPrice += this.calculateConfigPrice(config);\n\t\t\t});\n\t\t\t\n\t\t\t// Füge Zusatzprodukte hinzu\n\t\t\tconst additionalProductsPrice = this.calculateAdditionalProductsPrice();\n\t\t\ttotalPrice += additionalProductsPrice;\n\t\t\t\n\t\t\ttotalPriceEl.textContent = `${totalPrice.toFixed(2).replace('.', ',')} €`;\n\t\t}\n\t\t\n\t\tcalculateAdditionalProductsPrice() {\n\t\t\tlet totalPrice = 0;\n\t\t\t\n\t\t\t// MC4 Stecker\n\t\t\tif (document.getElementById('mc4')?.checked) {\n\t\t\t\tconst moduleCount = this.configs.reduce((total, config) => {\n\t\t\t\t\treturn total + config.selection.flat().filter(v => v).length;\n\t\t\t\t}, 0);\n\t\t\t\tconst packagesNeeded = Math.ceil(moduleCount / 30); // 1 Packung pro 30 Module\n\t\t\t\tconst pricePerPackage = getPriceFromCache('MC4_Stecker');\n\t\t\t\ttotalPrice += packagesNeeded * pricePerPackage;\n\t\t\t}\n\t\t\t\n\t\t\t// Solarkabel\n\t\t\tif (document.getElementById('solarkabel')?.checked) {\n\t\t\t\tconst packagesNeeded = 1; // 1x Solarkabel 100M\n\t\t\t\tconst pricePerPackage = getPriceFromCache('Solarkabel');\n\t\t\t\ttotalPrice += packagesNeeded * pricePerPackage;\n\t\t\t}\n\t\t\t\n\t\t\t// Holzunterleger\n\t\t\tif (document.getElementById('holz')?.checked) {\n\t\t\t\tconst packagesNeeded = 1; // 1x Unterlegholz für Dachhaken - 50 Stück\n\t\t\t\tconst pricePerPackage = getPriceFromCache('Holzunterleger');\n\t\t\t\ttotalPrice += packagesNeeded * pricePerPackage;\n\t\t\t}\n\t\t\t\n\t\t\t// Quetschkabelschuhe\n\t\t\tif (document.getElementById('quetschkabelschuhe')?.checked) {\n\t\t\t\tconst packagesNeeded = 1; // 1x Quetschkabelschuhe - 100 Stück\n\t\t\t\tconst pricePerPackage = getPriceFromCache('Quetschkabelschuhe');\n\t\t\t\ttotalPrice += packagesNeeded * pricePerPackage;\n\t\t\t}\n\t\t\t\n\t\t\treturn totalPrice;\n\t\t}\n\t\t\n\t\trenderAdditionalProducts() {\n\t\t\tconst additionalProductsListEl = document.getElementById('additional-products-list');\n\t\t\tif (!additionalProductsListEl) return;\n\t\t\t\n\t\t\tadditionalProductsListEl.innerHTML = '';\n\t\t\t\n\t\t\t// MC4 Stecker\n\t\t\tif (document.getElementById('mc4')?.checked) {\n\t\t\t\tconst moduleCount = this.configs.reduce((total, config) => {\n\t\t\t\t\treturn total + config.selection.flat().filter(v => v).length;\n\t\t\t\t}, 0);\n\t\t\t\tconst packagesNeeded = Math.ceil(moduleCount / 30); // 1 Packung pro 30 Module\n\t\t\t\tconst pricePerPackage = getPriceFromCache('MC4_Stecker');\n\t\t\t\tconst totalPrice = packagesNeeded * pricePerPackage;\n\t\t\t\t\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">${packagesNeeded}x</span>\n\t\t\t\t\t\t<span class=\"item-name\">MC4 Stecker</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</div>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t\t\n\t\t\t// Solarkabel\n\t\t\tif (document.getElementById('solarkabel')?.checked) {\n\t\t\t\tconst packagesNeeded = 1;\n\t\t\t\tconst pricePerPackage = getPriceFromCache('Solarkabel');\n\t\t\t\tconst totalPrice = packagesNeeded * pricePerPackage;\n\t\t\t\t\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">1x</span>\n\t\t\t\t\t\t<span class=\"item-name\">Solarkabel 100M</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</div>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t\t\n\t\t\t// Holzunterleger\n\t\t\tif (document.getElementById('holz')?.checked) {\n\t\t\t\tconst packagesNeeded = 1;\n\t\t\t\tconst pricePerPackage = getPriceFromCache('Holzunterleger');\n\t\t\t\tconst totalPrice = packagesNeeded * pricePerPackage;\n\t\t\t\t\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">1x</span>\n\t\t\t\t\t\t<span class=\"item-name\">Unterlegholz für Dachhaken - 50 Stück</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</div>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t\t\n\t\t\t// Quetschkabelschuhe\n\t\t\tif (document.getElementById('quetschkabelschuhe')?.checked) {\n\t\t\t\tconst packagesNeeded = 1;\n\t\t\t\tconst pricePerPackage = getPriceFromCache('Quetschkabelschuhe');\n\t\t\t\tconst totalPrice = packagesNeeded * pricePerPackage;\n\t\t\t\t\n\t\t\t\tconst item = document.createElement('div');\n\t\t\t\titem.className = 'additional-product-item';\n\t\t\t\titem.innerHTML = `\n\t\t\t\t\t<div class=\"item-left\">\n\t\t\t\t\t\t<span class=\"item-quantity\">1x</span>\n\t\t\t\t\t\t<span class=\"item-name\">Quetschkabelschuhe - 100 Stück</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</div>\n\t\t\t\t`;\n\t\t\t\tadditionalProductsListEl.appendChild(item);\n\t\t\t}\n\t\t}\n\t\t\n\t\tinitAdditionalProductsListeners() {\n\t\t\t// Event-Listener für Zusatzprodukte-Checkboxen\n\t\t\tconst additionalProductCheckboxes = ['mc4', 'solarkabel', 'holz', 'quetschkabelschuhe'];\n\t\t\t\n\t\t\tadditionalProductCheckboxes.forEach(checkboxId => {\n\t\t\t\tconst checkbox = document.getElementById(checkboxId);\n\t\t\t\tif (checkbox) {\n\t\t\t\t\tcheckbox.addEventListener('change', () => {\n\t\t\t\t\t\t// Update Gesamtpreis und Zusatzprodukte-Liste\n\t\t\t\t\t\tthis.updateOverviewTotalPrice();\n\t\t\t\t\t\tthis.renderAdditionalProducts();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\teditConfigName() {\n\t\t\tconst titleEl = document.getElementById('current-config-title');\n\t\t\tif (!titleEl) return;\n\t\t\t\n\t\t\t// Entferne alle existierenden Input-Felder\n\t\t\tconst existingInputs = titleEl.parentNode.querySelectorAll('.config-title-input');\n\t\t\texistingInputs.forEach(input => input.remove());\n\t\t\t\n\t\t\t// Stelle sicher, dass der Titel sichtbar ist\n\t\t\ttitleEl.style.display = 'block';\n\t\t\t\n\t\t\t// Erstelle Input-Feld\n\t\t\tconst input = document.createElement('input');\n\t\t\tinput.type = 'text';\n\t\t\tinput.value = titleEl.textContent;\n\t\t\tinput.className = 'config-title-input';\n\t\t\tinput.style.cssText = `\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\tfont-size: 24px;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tcolor: #000000;\n\t\t\t\tbackground: white;\n\t\t\t\tborder: 2px solid #FFB101;\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tpadding: 4px 8px;\n\t\t\t\twidth: 200px;\n\t\t\t\toutline: none;\n\t\t\t\tz-index: 1000;\n\t\t\t`;\n\t\t\t\n\t\t\t// Füge Input hinzu ohne Titel zu ersetzen\n\t\t\ttitleEl.parentNode.appendChild(input);\n\t\t\tinput.focus();\n\t\t\tinput.select();\n\t\t\t\n\t\t\t// Event-Listener für Enter und Blur\n\t\t\tconst saveEdit = function() {\n\t\t\t\tconst newName = input.value.trim();\n\t\t\t\tif (newName && this.currentConfig !== null) {\n\t\t\t\t\tthis.configs[this.currentConfig].name = newName;\n\t\t\t\t\ttitleEl.textContent = newName;\n\t\t\t\t\tthis.updateConfigList();\n\t\t\t\t\tthis.updateConfig();\n\t\t\t\t\tthis.showAutoSaveIndicator();\n\t\t\t\t}\n\t\t\t\tinput.remove();\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\tconst cancelEdit = function() {\n\t\t\t\tinput.remove();\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\tinput.addEventListener('blur', saveEdit);\n\t\t\tinput.addEventListener('keydown', function(e) {\n\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tsaveEdit();\n\t\t\t\t} else if (e.key === 'Escape') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tcancelEdit();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\teditConfigNameInList(configIndex) {\n\t\t\tconst config = this.configs[configIndex];\n\t\t\tif (!config) return;\n\t\t\t\n\t\t\t// Finde das config-item Element\n\t\t\tconst configItems = document.querySelectorAll('.config-item');\n\t\t\tconst configItem = configItems[configIndex];\n\t\t\tif (!configItem) return;\n\t\t\t\n\t\t\t// Finde das name Element\n\t\t\tconst nameEl = configItem.querySelector('.config-item-name');\n\t\t\tif (!nameEl) return;\n\t\t\t\n\t\t\t// Entferne alle existierenden Input-Felder in diesem Item\n\t\t\tconst existingInputs = nameEl.parentNode.querySelectorAll('input[type=\"text\"]');\n\t\t\texistingInputs.forEach(input => input.remove());\n\t\t\t\n\t\t\t// Stelle sicher, dass der Name sichtbar ist\n\t\t\tnameEl.style.display = 'block';\n\t\t\t\n\t\t\t// Erstelle Input-Feld\n\t\t\tconst input = document.createElement('input');\n\t\t\tinput.type = 'text';\n\t\t\tinput.value = nameEl.textContent;\n\t\t\tinput.className = 'inline-edit-input';\n\t\t\t\n\t\t\t// Input absolut über dem Namen platzieren, ohne Layout zu verschieben\n\t\t\tnameEl.appendChild(input);\n\t\t\t// Interaktionen im Input sollen die Item-Navigation nicht auslösen\n\t\t\t['click','mousedown','pointerdown'].forEach(evt => {\n\t\t\t\tinput.addEventListener(evt, (e) => e.stopPropagation());\n\t\t\t});\n\t\t\tinput.focus();\n\t\t\tinput.select();\n\t\t\t\n\t\t\t// Event-Listener für Enter und Blur\n\t\t\tconst saveEdit = function() {\n\t\t\t\tconst newName = input.value.trim();\n\t\t\t\tif (newName) {\n\t\t\t\t\tconfig.name = newName;\n\t\t\t\t\tnameEl.textContent = newName;\n\t\t\t\t\tthis.updateConfig();\n\t\t\t\t\tthis.showAutoSaveIndicator();\n\t\t\t\t}\n\t\t\t\tif (input.parentNode) input.remove();\n\t\t\t\tthis.updateConfigList();\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\tconst cancelEdit = function() {\n\t\t\t\tif (input.parentNode) input.remove();\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\tinput.addEventListener('blur', saveEdit);\n\t\t\tinput.addEventListener('keydown', function(e) {\n\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tsaveEdit();\n\t\t\t\t} else if (e.key === 'Escape') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tcancelEdit();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\tdeleteCurrentConfig() {\n\t\t\tif (this.configs.length <= 1) {\n\t\t\t\talert('Die letzte Konfiguration kann nicht gelöscht werden.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tconst currentConfig = this.configs[this.currentConfig];\n\t\t\tconst configName = currentConfig?.name || `Konfiguration #${this.currentConfig + 1}`;\n\t\t\t\n\t\t\tif (confirm(`Möchten Sie \"${configName}\" wirklich löschen?`)) {\n\t\t\t\tthis.configs.splice(this.currentConfig, 1);\n\t\t\t\t\n\t\t\t\t// Aktive Konfiguration anpassen\n\t\t\t\tif (this.currentConfig >= this.configs.length) {\n\t\t\t\t\tthis.currentConfig = this.configs.length - 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.loadConfig(this.currentConfig);\n\t\t\t\tthis.saveToUrl();\n\t\t\t\t\n\t\t\t\t// Zurück zur Übersicht und Config-Liste updaten\n\t\t\t\tthis.showOverview();\n\t\t\t}\n\t\t}\n\t\t\n\t\tdeleteConfigFromList(configIndex) {\n\t\t\tif (this.configs.length <= 1) {\n\t\t\t\talert('Die letzte Konfiguration kann nicht gelöscht werden.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tconst config = this.configs[configIndex];\n\t\t\tconst configName = config?.name || `Konfiguration #${configIndex + 1}`;\n\t\t\t\n\t\t\tif (confirm(`Möchten Sie \"${configName}\" wirklich löschen?`)) {\n\t\t\t\tthis.configs.splice(configIndex, 1);\n\t\t\t\t\n\t\t\t\t// Aktive Konfiguration anpassen\n\t\t\t\tif (this.currentConfig >= this.configs.length) {\n\t\t\t\t\tthis.currentConfig = this.configs.length - 1;\n\t\t\t\t} else if (this.currentConfig > configIndex) {\n\t\t\t\t\tthis.currentConfig--;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.loadConfig(this.currentConfig);\n\t\t\t\tthis.saveToUrl();\n\t\t\t\tthis.updateConfigList();\n\t\t\t}\n\t\t\t\n\t\t\t// Event propagation stoppen\n\t\t\tevent.stopPropagation();\n\t\t}\n\t\t\n\t\tcalculateConfigPrice(config) {\n\t\t\t// Verwende die ursprüngliche Berechnungslogik\n\t\t\tconst parts = {\n\t\t\t\tSolarmodul: 0, Endklemmen: 0, Mittelklemmen: 0,\n\t\t\t\tDachhaken: 0, Schrauben: 0, Endkappen: 0,\n\t\t\t\tSchienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0,\n\t\t\t\tUlicaSolarBlackJadeFlow: 0\n\t\t\t};\n\n\t\t\t// Berechne Teile für jede Zeile\n\t\t\tfor (let y = 0; y < config.rows; y++) {\n\t\t\t\tif (!Array.isArray(config.selection[y])) continue;\n\t\t\t\tlet run = 0;\n\n\t\t\t\tfor (let x = 0; x < config.cols; x++) {\n\t\t\t\t\tif (config.selection[y]?.[x]) {\n\t\t\t\t\t\trun++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (run) { \n\t\t\t\t\t\tthis.processGroupDirectly(run, parts, config.cellWidth || 179, config.cellHeight || 113, config.orientation || 'vertical', config.ulicaModule || false); \n\t\t\t\t\t\trun = 0; \n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (run) {\n\t\t\t\t\tthis.processGroupDirectly(run, parts, config.cellWidth || 179, config.cellHeight || 113, config.orientation || 'vertical', config.ulicaModule || false);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Module nur hinzufügen wenn Checkbox aktiviert ist\n\t\t\tconst includeModules = document.getElementById('include-modules')?.checked || false;\n\t\t\tconst ulicaModule = document.getElementById('ulica-module')?.checked || false;\n\t\t\t\n\t\t\tif (!includeModules) {\n\t\t\t\tdelete parts.Solarmodul;\n\t\t\t}\n\t\t\t\n\t\t\tif (!ulicaModule) {\n\t\t\t\tdelete parts.UlicaSolarBlackJadeFlow;\n\t\t\t}\n\t\t\t\n\t\t\tlet totalPrice = 0;\n\t\t\t\n\t\t\tObject.entries(parts).forEach(([partName, quantity]) => {\n\t\t\t\tif (quantity > 0) {\n\t\t\t\t\tconst packagesNeeded = Math.ceil(quantity / (VE[partName] || 1));\n\t\t\t\t\tconst pricePerPackage = getPriceFromCache(partName);\n\t\t\t\t\ttotalPrice += packagesNeeded * pricePerPackage;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\treturn totalPrice;\n\t\t}\n\t\t\n\n\t\t\n\t\taddAllConfigsToCart() {\n\t\t\t// Verwende die gleiche Logik wie addAllToCart()\n\t\t\tthis.addAllToCart();\n\t\t}\n\t\t\n\t\tinitSmartConfigFeatures() {\n\t\t\tconsole.log('Initializing Smart Config Features...');\n\t\t\tthis.smartParser = new SmartConfigParser(this);\n\t\t\tthis.bulkSelector = new BulkSelector(this);\n\t\t\tthis.bulkSelector.initializeBulkSelection();\n\t\t\t\n\t\t\t// Stelle sicher, dass Smart Config und Tipps permanent sichtbar sind\n\t\t\tthis.ensurePermanentVisibility();\n\t\t\t\n\t\t\t// Initialisiere Smart Config Close Button\n\t\t\tthis.initSmartConfigCloseButton();\n\t\t\t\n\t\t\t// Initialisiere Quick Config Interface mit verbesserter Fehlerbehandlung\n\t\t\tthis.initQuickConfigInterface();\n\t\t\t\n\t\t\tconsole.log('Smart Config Features initialized');\n\t\t}\n\t\t\n\t\tensurePermanentVisibility() {\n\t\t\t// Stelle sicher, dass Tipps permanent sichtbar sind\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst usageTips = document.querySelector('.usage-tips');\n\t\t\t\tif (usageTips) {\n\t\t\t\t\tusageTips.style.display = 'block';\n\t\t\t\t\tusageTips.classList.remove('hidden');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Stelle sicher, dass Smart Config Container permanent sichtbar sind\n\t\t\t\tconst smartConfigContainers = document.querySelectorAll('.smart-config-container');\n\t\t\t\tsmartConfigContainers.forEach(container => {\n\t\t\t\t\tcontainer.style.display = 'flex';\n\t\t\t\t\tcontainer.classList.remove('hidden');\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Entferne localStorage-Einstellungen, die das Verstecken verursachen\n\t\t\t\tlocalStorage.removeItem('solarTool_hideHelp');\n\t\t\t\tlocalStorage.removeItem('solarTool_hideSmartConfig');\n\t\t\t\t\n\t\t\t}, 100);\n\t\t}\n\t\t\n\t\tcheckAndHideHelp() {\n\t\t\t// Tipps sollen permanent sichtbar bleiben - diese Funktion wird deaktiviert\n\t\t\t// const shouldHideHelp = localStorage.getItem('solarTool_hideHelp');\n\t\t\t// if (shouldHideHelp === 'true') {\n\t\t\t// \tsetTimeout(() => {\n\t\t\t// \t\tconst helpSection = document.querySelector('.bulk-selection-help');\n\t\t\t// \t\tif (helpSection) {\n\t\t\t// \t\t\thelpSection.style.display = 'none';\n\t\t\t// \t\t}\n\t\t\t// \t}, 600);\n\t\t\t// }\n\t\t}\n\t\t\n\t\tinitSmartConfigCloseButton() {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst closeButton = document.getElementById('smart-config-close');\n\t\t\t\tconst container = document.querySelector('.smart-config-container');\n\t\t\t\tif (closeButton && container) {\n\t\t\t\t\tcloseButton.addEventListener('click', () => {\n\t\t\t\t\t\t// Smart Config Container soll permanent sichtbar bleiben - Close-Button deaktiviert\n\t\t\t\t\t\t// container.style.display = 'none';\n\t\t\t\t\t\t// localStorage.setItem('solarTool_hideSmartConfig', 'true');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, 600);\n\t\t}\n\n\n\n\t\tinitQuickConfigInterface() {\n\t\t\t// Verbesserte Initialisierung mit mehreren Versuchen\n\t\t\tconst initSmartConfig = () => {\n\t\t\t\tconst quickInput = document.getElementById('quick-config-input');\n\t\t\t\t\n\t\t\t\tif (!quickInput) {\n\t\t\t\t\tconsole.warn('Smart Config Input Element nicht gefunden, versuche erneut...');\n\t\t\t\t\tsetTimeout(initSmartConfig, 100);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconsole.log('Smart Config Interface initialisiert (ohne Button)');\n\t\t\t\t\n\t\t\t\t// Entferne bestehende Event-Listener (falls vorhanden)\n\t\t\t\tconst newQuickInput = quickInput.cloneNode(true);\n\t\t\t\tquickInput.parentNode.replaceChild(newQuickInput, quickInput);\n\t\t\t\t\n\t\t\t\t// Automatische Anwendung der Konfiguration\n\t\t\t\tconst applyConfiguration = (input) => {\n\t\t\t\t\tif (input && input.trim()) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconsole.log('Smart Config Input:', input);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Clear preview timeout when applying configuration\n\t\t\t\t\t\t\tif (this.previewTimeout) {\n\t\t\t\t\t\t\t\tclearTimeout(this.previewTimeout);\n\t\t\t\t\t\t\t\tthis.previewTimeout = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconst config = this.smartParser.parseInput(input);\n\t\t\t\t\t\t\tconsole.log('Parsed config:', config);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (Object.keys(config).length > 0) {\n\t\t\t\t\t\t\t\tthis.smartParser.applyPreviewToMainGrid(config);\n\t\t\t\t\t\t\t\tnewQuickInput.value = ''; // Input leeren\n\t\t\t\t\t\t\t\tthis.showToast('✅ Konfiguration angewendet', 1500);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.showToast('⚠️ Keine gültige Konfiguration erkannt', 2000);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Smart Config Error:', error);\n\t\t\t\t\t\t\tthis.showToast(`❌ Fehler: ${error.message}`, 3000);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t// Enter-Taste Support - automatische Anwendung\n\t\t\t\tnewQuickInput.addEventListener('keypress', (e) => {\n\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tapplyConfiguration(newQuickInput.value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Feld verlassen (blur) Support - automatische Anwendung\n\t\t\t\tnewQuickInput.addEventListener('blur', () => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tconst input = newQuickInput.value.trim();\n\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\tapplyConfiguration(input);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 100); // Kurze Verzögerung für bessere UX\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Live-Grid-Preview bei jedem Tastendruck\n\t\t\t\tnewQuickInput.addEventListener('input', (e) => {\n\t\t\t\t\tconst input = e.target.value.trim();\n\t\t\t\t\t\n\t\t\t\t\t// Clear previous timeout\n\t\t\t\t\tif (this.previewTimeout) {\n\t\t\t\t\t\tclearTimeout(this.previewTimeout);\n\t\t\t\t\t\tthis.previewTimeout = null;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Update input validation status\n\t\t\t\t\tthis.updateInputValidation(newQuickInput, input);\n\t\t\t\t\t\n\t\t\t\t\tif (input.length > 0) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst config = this.smartParser.parseInput(input);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Zeige Preview für gültige Konfigurationen\n\t\t\t\t\t\t\tif (config.cols || config.rows || config.moduleCount || config.orientation || config.adjustSpacing || config.rowConfig || config.action) {\n\t\t\t\t\t\t\t\tthis.showConfigPreview(config);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Automatische Anwendung nach 2 Sekunden Inaktivität\n\t\t\t\t\t\t\t\tconst self = this;\n\t\t\t\t\t\t\t\tthis.previewTimeout = setTimeout(() => {\n\t\t\t\t\t\t\t\t\tif (self && self.clearGridPreview) {\n\t\t\t\t\t\t\t\t\t\t// Automatisch anwenden wenn gültige Konfiguration\n\t\t\t\t\t\t\t\t\t\tif (Object.keys(config).length > 0) {\n\t\t\t\t\t\t\t\t\t\t\tself.smartParser.applyPreviewToMainGrid(config);\n\t\t\t\t\t\t\t\t\t\t\tnewQuickInput.value = ''; // Input leeren\n\t\t\t\t\t\t\t\t\t\t\tself.showToast('✅ Konfiguration automatisch angewendet', 1500);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tself.clearGridPreview();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, 2000); // Reduziert von 3 auf 2 Sekunden für bessere UX\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Keine gültige Konfiguration - Preview löschen\n\t\t\t\t\t\t\t\tthis.clearGridPreview();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Smart Config Preview Error:', error);\n\t\t\t\t\t\t\t// Bei Parsing-Fehler Preview löschen\n\t\t\t\t\t\t\tthis.clearGridPreview();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Input leer - Preview löschen\n\t\t\t\t\t\tthis.clearGridPreview();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Smart Config Help Dropdown Event-Handler initialisieren\n\t\t\t\tthis.initializeSmartConfigHelp();\n\t\t\t};\n\t\t\t\n\t\t\t// Starte Initialisierung mit mehreren Versuchen\n\t\t\tsetTimeout(initSmartConfig, 100);\n\t\t\tsetTimeout(initSmartConfig, 500);\n\t\t\tsetTimeout(initSmartConfig, 1000);\n\t\t\t\n\t\t\t// Zusätzlicher Versuch nach DOMContentLoaded\n\t\t\tif (document.readyState === 'loading') {\n\t\t\t\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\t\t\t\tsetTimeout(initSmartConfig, 100);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\tupdateInputValidation(inputElement, input) {\n\t\t\t// Entferne alle Validierungs-Klassen\n\t\t\tinputElement.classList.remove('input-valid', 'input-invalid', 'input-loading');\n\t\t\t\n\t\t\tif (input.length === 0) {\n\t\t\t\treturn; // Keine Validierung für leere Eingabe\n\t\t\t}\n\t\t\t\n\t\t\t// Zeige Loading-Status\n\t\t\tinputElement.classList.add('input-loading');\n\t\t\t\n\t\t\t// Kurze Verzögerung für bessere UX\n\t\t\tsetTimeout(() => {\n\t\t\t\ttry {\n\t\t\t\t\tconst config = this.smartParser.parseInput(input);\n\t\t\t\t\tconsole.log('Input validation result:', config);\n\t\t\t\t\t\n\t\t\t\t\t// Prüfe ob gültige Konfiguration\n\t\t\t\t\tif (config.cols || config.rows || config.moduleCount || config.orientation || config.adjustSpacing || config.rowConfig || config.action) {\n\t\t\t\t\t\tinputElement.classList.remove('input-loading');\n\t\t\t\t\t\tinputElement.classList.add('input-valid');\n\t\t\t\t\t\tconsole.log('Input is valid');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinputElement.classList.remove('input-loading');\n\t\t\t\t\t\tinputElement.classList.add('input-invalid');\n\t\t\t\t\t\tconsole.log('Input is invalid');\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Input validation error:', error);\n\t\t\t\t\tinputElement.classList.remove('input-loading');\n\t\t\t\t\tinputElement.classList.add('input-invalid');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t}\n\n\t\tshowConfigPreview(config) {\n\t\t\tconsole.log('Showing config preview:', config);\n\t\t\t\n\t\t\t// Grid-Preview für alle Konfigurationen die das Grid beeinflussen\n\t\t\tif (config.cols || config.rows || config.moduleCount || config.orientation || config.adjustSpacing || config.rowConfig) {\n\t\t\t\t// this ist die SolarGrid Instanz selbst, also können wir direkt auf ihre Methoden zugreifen\n\t\t\t\tif (this && typeof this.showGridPreview === 'function') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.showGridPreview(config);\n\t\t\t\t\t\tconsole.log('Grid preview shown successfully');\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('Error showing grid preview:', error);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error('showGridPreview method not available!');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('No grid-affecting config found, skipping preview');\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Smart Config Help Dropdown Initialisierung\n\t\tinitializeSmartConfigHelp() {\n\t\t\t// Trigger wird auch in setupSmartConfig aufgerufen\n\t\t\tconst trigger = document.getElementById('smart-help-trigger');\n\t\t\tconst dropdown = document.getElementById('smart-help-dropdown');\n\t\t\t\n\t\t\tif (!trigger || !dropdown) return; // Falls die Elemente nicht existieren\n\t\t\t\n\t\t\tlet isHovered = false;\n\t\t\tlet hoverTimeout = null;\n\t\t\t\n\t\t\t// JavaScript-basierte Hover-Funktionalität (überschreibt CSS)\n\t\t\tconst showDropdown = () => {\n\t\t\t\tdropdown.style.opacity = '1';\n\t\t\t\tdropdown.style.visibility = 'visible';\n\t\t\t\tdropdown.style.transform = 'translateY(0)';\n\t\t\t};\n\t\t\t\n\t\t\tconst hideDropdown = () => {\n\t\t\t\tdropdown.style.opacity = '0';\n\t\t\t\tdropdown.style.visibility = 'hidden';\n\t\t\t\tdropdown.style.transform = 'translateY(-10px)';\n\t\t\t};\n\t\t\t\n\t\t\t// Hover Events für Trigger\n\t\t\ttrigger.addEventListener('mouseenter', () => {\n\t\t\t\tisHovered = true;\n\t\t\t\tif (hoverTimeout) clearTimeout(hoverTimeout);\n\t\t\t\tshowDropdown();\n\t\t\t});\n\t\t\t\n\t\t\ttrigger.addEventListener('mouseleave', () => {\n\t\t\t\tisHovered = false;\n\t\t\t\thoverTimeout = setTimeout(() => {\n\t\t\t\t\tif (!isHovered) hideDropdown();\n\t\t\t\t}, 100); // Kleine Verzögerung für sanfteren Übergang\n\t\t\t});\n\t\t\t\n\t\t\t// Hover Events für Dropdown selbst\n\t\t\tdropdown.addEventListener('mouseenter', () => {\n\t\t\t\tisHovered = true;\n\t\t\t\tif (hoverTimeout) clearTimeout(hoverTimeout);\n\t\t\t});\n\t\t\t\n\t\t\tdropdown.addEventListener('mouseleave', () => {\n\t\t\t\tisHovered = false;\n\t\t\t\thoverTimeout = setTimeout(() => {\n\t\t\t\t\tif (!isHovered) hideDropdown();\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t\t\n\t\t\t// Verhindere dass Dropdown schließt wenn darauf geklickt wird\n\t\t\tdropdown.addEventListener('click', (e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t\t\n\t\t\t// Schließe Dropdown bei Klick außerhalb\n\t\t\tdocument.addEventListener('click', (e) => {\n\t\t\t\tif (!trigger.contains(e.target) && !dropdown.contains(e.target)) {\n\t\t\t\t\tisHovered = false;\n\t\t\t\t\thideDropdown();\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t// Beispiel-Click Handler für sofortige Anwendung (ohne Ctrl+Click Tipp)\n\t\t\tdocument.querySelectorAll('.example').forEach(example => {\n\t\t\t\texample.addEventListener('click', (e) => {\n\t\t\t\t\te.stopPropagation(); // Verhindere Click-Outside-Handler\n\t\t\t\t\t\n\t\t\t\t\tconst quickInput = document.getElementById('quick-config-input');\n\t\t\t\t\tif (quickInput) {\n\t\t\t\t\t\t// Entferne Anführungszeichen und setze Wert\n\t\t\t\t\t\tquickInput.value = example.textContent.replace(/\"/g, '');\n\t\t\t\t\t\tquickInput.focus();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Zeige Vorschau\n\t\t\t\t\t\tif (quickInput.value.length > 3) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst config = this.smartParser.parseInput(quickInput.value);\n\t\t\t\t\t\t\t\tthis.showConfigPreview(config);\n\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t// Ignoriere Parsing-Fehler\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Schließe Dropdown nach Beispiel-Auswahl\n\t\t\t\t\t\tisHovered = false;\n\t\t\t\t\t\thideDropdown();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Optional: Scroll zur Smart Config Section\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tquickInput.scrollIntoView({ behavior: 'smooth', block: 'center' });\n\t\t\t\t\t\t}, 100);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n    \n    setup() {\n  \t\t// Verwende Standard-Werte falls nicht bereits gesetzt\n  \t\tif (!this.cols || !this.rows) {\n  \t\t\tthis.cols = this.default.cols;\n  \t\t\tthis.rows = this.default.rows;\n  \t\t}\n  \t\tif (!this.cols || !this.rows) {\n    \t\talert('Spalten und Zeilen müssen > 0 sein');\n    \t\treturn;\n  \t\t}\n\n  \t\t// Nur dann eine neue leere Auswahl erstellen, wenn noch keine existiert oder die Dimensionen nicht stimmen\n    \tif (\n    \t\t!Array.isArray(this.selection) ||\n    \t\tthis.selection.length !== this.rows ||\n    \t\tthis.selection[0]?.length !== this.cols\n  \t\t) {\n    \t\tconst oldSel = this.selection;\n    \t\tthis.selection = Array.from({ length: this.rows }, (_, y) =>\n      \t\tArray.from({ length: this.cols }, (_, x) => oldSel?.[y]?.[x] || false)\n    \t\t);\n  \t\t}\n\n  \t\tif (this.listHolder) {\n  \t\t\tthis.listHolder.style.display = 'block';\n  \t\t}\n  \t\tthis.updateSize();\n  \t\tthis.buildGrid();\n  \t\tthis.buildList();\n  \t\tthis.updateSaveButtons();\n\t\t}\n\t\t\n\t\t// Neue Funktion für Grid-Event-Listener\n\n\t\t\n\t\t// Neue Funktion für alle Event-Listener\n\t\tsetupAllEventListeners() {\n\t\t\t// Input-Event-Listener\n\t\t\tconst inputs = [this.wIn, this.hIn].filter(el => el);\n\t\t\tinputs.forEach(el => {\n\t\t\t\tel.removeEventListener('change', this.handleInputChange);\n\t\t\t\tel.addEventListener('change', this.handleInputChange.bind(this));\n\t\t\t});\n\t\t\t\n\t\t\t// Modul-Auswahl-Event-Listener\n\t\t\tif (this.moduleSelect) {\n\t\t\t\tthis.moduleSelect.removeEventListener('change', this.handleModuleSelectChange);\n\t\t\t\tthis.moduleSelect.addEventListener('change', this.handleModuleSelectChange.bind(this));\n\t\t\t}\n\t\t\t\n\t\t\t// Orientation-Event-Listener\n\t\t\tif (this.orH && this.orV) {\n\t\t\t\t[this.orH, this.orV].forEach(el => {\n\t\t\t\t\tel.removeEventListener('change', this.handleOrientationChange);\n\t\t\t\t\tel.addEventListener('change', this.handleOrientationChange.bind(this));\n\t\t\t\t});\n\t\t\t\t// Synchronisiere Buttons nach Radio-Button Setup\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.syncOrientationButtons();\n\t\t\t\t}, 10);\n\t\t\t}\n\t\t\t\n\t\t\t\t\t// Checkbox-Event-Listener\n\t\t[this.incM, this.mc4, this.solarkabel, this.holz, this.quetschkabelschuhe, this.erdungsband, this.ulicaModule].filter(el => el).forEach(el => {\n\t\t\tel.removeEventListener('change', this.handleCheckboxChange);\n\t\t\tel.addEventListener('change', this.handleCheckboxChange.bind(this));\n\t\t});\n\t\t\n\t\t// Zusätzliche Event-Listener für Modul-Checkboxen im Dropdown\n\t\tdocument.querySelectorAll('#include-modules, #ulica-module').forEach(el => {\n\t\t\tel.removeEventListener('change', this.handleCheckboxChange);\n\t\t\tel.addEventListener('change', this.handleCheckboxChange.bind(this));\n\t\t});\n\t\t\t\n\t\t\t// Expansion-Button-Event-Listener mit stabiler Referenz\n\t\t\tif (!this.boundExpansionClick) {\n\t\t\t\tthis.boundExpansionClick = this.handleExpansionClick.bind(this);\n\t\t\t}\n\t\t\tdocument.querySelectorAll('[data-dir=\"right\"]').forEach(btn => {\n\t\t\t\tbtn.removeEventListener('click', this.boundExpansionClick);\n\t\t\t\tbtn.addEventListener('click', this.boundExpansionClick);\n\t\t\t});\n\t\t\tdocument.querySelectorAll('[data-dir=\"left\"]').forEach(btn => {\n\t\t\t\tbtn.removeEventListener('click', this.boundExpansionClick);\n\t\t\t\tbtn.addEventListener('click', this.boundExpansionClick);\n\t\t\t});\n\t\t\tdocument.querySelectorAll('[data-dir=\"top\"]').forEach(btn => {\n\t\t\t\tbtn.removeEventListener('click', this.boundExpansionClick);\n\t\t\t\tbtn.addEventListener('click', this.boundExpansionClick);\n\t\t\t});\n\t\t\tdocument.querySelectorAll('[data-dir=\"bottom\"]').forEach(btn => {\n\t\t\t\tbtn.removeEventListener('click', this.boundExpansionClick);\n\t\t\t\tbtn.addEventListener('click', this.boundExpansionClick);\n\t\t\t});\n\t\t\t\n\t\t\t// Orientation-Button-Event-Listener\n\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\tif (orientHBtn && orientVBtn) {\n\t\t\t\t// Verwende eine gebundene Referenz, damit removeEventListener korrekt funktioniert\n\t\t\t\tif (!this.boundOrientationClick) {\n\t\t\t\t\tthis.boundOrientationClick = this.handleOrientationButtonClick.bind(this);\n\t\t\t\t}\n\t\t\t\t[orientHBtn, orientVBtn].forEach(btn => {\n\t\t\t\t\tbtn.removeEventListener('click', this.boundOrientationClick);\n\t\t\t\t\tbtn.addEventListener('click', this.boundOrientationClick);\n\t\t\t\t});\n\t\t\t\t// Sofortige Synchronisation\n\t\t\t\tthis.syncOrientationButtons();\n\t\t\t} else {\n\t\t\t\t// Fallback: Versuche es später nochmal\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\t\t\tif (orientHBtn && orientVBtn) {\n\t\t\t\t\t\tif (!this.boundOrientationClick) {\n\t\t\t\t\t\t\tthis.boundOrientationClick = this.handleOrientationButtonClick.bind(this);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t[orientHBtn, orientVBtn].forEach(btn => {\n\t\t\t\t\t\t\tbtn.removeEventListener('click', this.boundOrientationClick);\n\t\t\t\t\t\t\tbtn.addEventListener('click', this.boundOrientationClick);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Synchronisiere Orientation Buttons nach dem Setup\n\t\t\t\t\t\tthis.syncOrientationButtons();\n\t\t\t\t\t}\n\t\t\t\t}, 50); // Reduzierte Verzögerung\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Event-Handler-Funktionen\n\t\t\n\t\t// Hilfsfunktion für robuste Orientation-Button-Synchronisation\n\t\tensureOrientationButtonsSync() {\n\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\t\n\t\t\tif (!orientHBtn || !orientVBtn || !this.orH || !this.orV) return;\n\t\t\t\n\t\t\t// Prüfe ob Buttons korrekt synchronisiert sind\n\t\t\tconst isVerticalActive = orientVBtn.classList.contains('active');\n\t\t\tconst isHorizontalActive = orientHBtn.classList.contains('active');\n\t\t\tconst radioVerticalChecked = this.orV.checked;\n\t\t\tconst radioHorizontalChecked = this.orH.checked;\n\t\t\t\n\t\t\t// Wenn Inkonsistenz festgestellt wird, korrigiere sie\n\t\t\tif ((isVerticalActive !== radioVerticalChecked) || (isHorizontalActive !== radioHorizontalChecked)) {\n\t\t\t\tthis.syncOrientationButtons();\n\t\t\t}\n\t\t}\n\t\t\n\t\thandleModuleSelectChange() {\n\t\t\tthis.trackInteraction();\n\t\t\tconst selectedValue = this.moduleSelect.value;\n\t\t\t\n\t\t\tif (selectedValue === '' || selectedValue === 'custom') {\n\t\t\t\t// Kein Modul ausgewählt oder Benutzerdefiniert - Inputs freigeben\n\t\t\t\tthis.enableInputs();\n\t\t\t\tthis.updateSize();\n\t\t\t\tthis.buildList();\n\t\t\t\tthis.updateSummaryOnChange();\n\t\t\t\t// Alle Modul-Checkboxen abwählen\n\t\t\t\tthis.clearModuleCheckboxes();\n\t\t\t} else if (this.moduleData[selectedValue]) {\n\t\t\t\t// Modul ausgewählt - Werte setzen und Inputs sperren\n\t\t\t\tconst module = this.moduleData[selectedValue];\n\t\t\t\tthis.wIn.value = module.width;\n\t\t\t\tthis.hIn.value = module.height;\n\t\t\t\t// Aktualisiere auch die aktuelle Konfiguration mit den neuen Zellgrößen\n\t\t\t\tif (this.currentConfig !== null && this.configs[this.currentConfig]) {\n\t\t\t\t\tthis.configs[this.currentConfig].cellWidth = module.width;\n\t\t\t\t\tthis.configs[this.currentConfig].cellHeight = module.height;\n\t\t\t\t}\n\t\t\t\tthis.disableInputs();\n\t\t\t\tthis.updateSize();\n\t\t\t\tthis.buildList();\n\t\t\t\tthis.updateSummaryOnChange();\n\t\t\t\t\n\t\t\t\t// Keine Checkbox-Interaktion mehr - nur Dropdown-Werte setzen\n\t\t\t\tthis.clearModuleCheckboxes();\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Neue Funktionen für Modul-Checkbox-Synchronisation\n\t\thandleModuleCheckboxChange(checkboxId) {\n\t\t\tthis.trackInteraction();\n\t\t\t\n\t\t\t// Nur eine Modul-Checkbox darf ausgewählt sein\n\t\t\tif (checkboxId === 'include-modules' && this.incM.checked) {\n\t\t\t\t// include-modules wurde ausgewählt - ulica-module abwählen\n\t\t\t\tif (this.ulicaModule) {\n\t\t\t\t\tthis.ulicaModule.checked = false;\n\t\t\t\t}\n\t\t\t\t// Dropdown auf ulica-450 setzen und Input-Werte anpassen\n\t\t\t\tif (this.moduleSelect) {\n\t\t\t\t\tthis.moduleSelect.value = 'ulica-450';\n\t\t\t\t\t// Input-Werte für ulica-450 setzen\n\t\t\t\t\tif (this.wIn) this.wIn.value = '176.2';\n\t\t\t\t\tif (this.hIn) this.hIn.value = '113.4';\n\t\t\t\t\tif (this.currentConfig !== null && this.configs[this.currentConfig]) {\n\t\t\t\t\t\tthis.configs[this.currentConfig].cellWidth = 176.2;\n\t\t\t\t\t\tthis.configs[this.currentConfig].cellHeight = 113.4;\n\t\t\t\t\t}\n\t\t\t\t\tthis.disableInputs();\n\t\t\t\t}\n\t\t\t} else if (checkboxId === 'ulica-module' && this.ulicaModule.checked) {\n\t\t\t\t// ulica-module wurde ausgewählt - include-modules abwählen\n\t\t\t\tif (this.incM) {\n\t\t\t\t\tthis.incM.checked = false;\n\t\t\t\t}\n\t\t\t\t// Dropdown auf ulica-500 setzen und Input-Werte anpassen\n\t\t\t\tif (this.moduleSelect) {\n\t\t\t\t\tthis.moduleSelect.value = 'ulica-500';\n\t\t\t\t\t// Input-Werte für ulica-500 setzen\n\t\t\t\t\tif (this.wIn) this.wIn.value = '195.2';\n\t\t\t\t\tif (this.hIn) this.hIn.value = '113.4';\n\t\t\t\t\tif (this.currentConfig !== null && this.configs[this.currentConfig]) {\n\t\t\t\t\t\tthis.configs[this.currentConfig].cellWidth = 195.2;\n\t\t\t\t\t\tthis.configs[this.currentConfig].cellHeight = 113.4;\n\t\t\t\t\t}\n\t\t\t\t\tthis.disableInputs();\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Grid und Berechnungen aktualisieren\n\t\t\tthis.updateSize();\n\t\t\tthis.buildGrid();\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\t\t\tthis.updateConfig();\n\t\t\t// Neu: Modul-Checkboxen gelten global -> auf alle Konfigurationen anwenden\n\t\t\tthis.updateAllConfigurationsForCheckboxes();\n\t\t}\n\t\t\n\t\tclearModuleCheckboxes() {\n\t\t\tif (this.incM) this.incM.checked = false;\n\t\t\tif (this.ulicaModule) this.ulicaModule.checked = false;\n\t\t}\n\t\t\n\t\thandleInputChange() {\n\t\t\tthis.trackInteraction();\n\t\t\tthis.updateSize();\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\t\t}\n\t\t\n\t\thandleOrientationChange() {\n\t\t\tthis.trackInteraction();\n\t\t\tthis.updateSize();\n\t\t\tthis.buildGrid();\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\t\t}\n\t\t\n\t\thandleCheckboxChange() {\n\t\t\tthis.trackInteraction();\n\t\t\t\n\t\t\t// Prüfe ob es sich um eine Modul-Checkbox handelt\n\t\t\tconst checkboxId = event.target.id;\n\t\t\tif (checkboxId === 'include-modules' || checkboxId === 'ulica-module') {\n\t\t\t\tthis.handleModuleCheckboxChange(checkboxId);\n\t\t\t} else {\n\t\t\t\t// Ursprüngliche Funktion: Update aller Konfigurationen für Checkboxen\n\t\t\t\tthis.updateAllConfigurationsForCheckboxes();\n\t\t\t}\n\t\t}\n\t\t\n\t\thandleExpansionClick(e) {\n\t\t\tthis.trackInteraction();\n\t\t\tconst dir = e.target.dataset.dir;\n\t\t\tconst isPlus = e.target.classList.contains('plus-btn');\n\t\t\t\n\t\t\tif (dir === 'right') {\n\t\t\t\tisPlus ? this.addColumnRight() : this.removeColumnRight();\n\t\t\t} else if (dir === 'left') {\n\t\t\t\tisPlus ? this.addColumnLeft() : this.removeColumnLeft();\n\t\t\t} else if (dir === 'top') {\n\t\t\t\tisPlus ? this.addRowTop() : this.removeRowTop();\n\t\t\t} else if (dir === 'bottom') {\n\t\t\t\tisPlus ? this.addRowBottom() : this.removeRowBottom();\n\t\t\t}\n\t\t}\n\t\t\n\t\thandleOrientationButtonClick(e) {\n\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\t\n\t\t\tif (!orientHBtn || !orientVBtn) return;\n\t\t\t\n\t\t\t// Verhindere mehrfache Klicks während der Verarbeitung\n\t\t\tif (this.orientationProcessing) return;\n\t\t\tthis.orientationProcessing = true;\n\t\t\t\n\t\t\t// Bestimme die neue Orientierung basierend auf dem Button, der den Handler ausgelöst hat\n\t\t\tconst clickedBtn = e.currentTarget || e.target;\n\t\t\tconst isVertical = clickedBtn === orientVBtn;\n\t\t\tconst newOrientation = isVertical ? 'vertical' : 'horizontal';\n\t\t\t\n\t\t\t// Sofortige visuelle Rückmeldung\n\t\t\torientHBtn.classList.remove('active');\n\t\t\torientVBtn.classList.remove('active');\n\t\t\tif (clickedBtn && clickedBtn.classList) clickedBtn.classList.add('active');\n\t\t\t\n\t\t\t// Radio-Buttons synchronisieren\n\t\t\tif (this.orV) this.orV.checked = isVertical;\n\t\t\tif (this.orH) this.orH.checked = !isVertical;\n\t\t\t\n\t\t\tthis.trackInteraction();\n\t\t\t\n\t\t\t// Sofortige Grid-Updates ohne Verzögerung\n\t\t\tthis.updateSize();\n\t\t\tthis.buildGrid();\n\t\t\t\n\t\t\t// Verzögerte Updates für Performance\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.buildList();\n\t\t\t\tthis.updateSummaryOnChange();\n\t\t\t\tthis.orientationProcessing = false;\n\t\t\t\t// Zusätzliche Synchronisation für Robustheit\n\t\t\t\tthis.ensureOrientationButtonsSync();\n\t\t\t}, 10); // Reduzierte Verzögerung für bessere Reaktionszeit\n\t\t}\n\t\t\n\t\t// NEUE FUNKTION: Synchronisiere Orientation Buttons\n\t\tsyncOrientationButtons() {\n\t\t\tconst orientHBtn = document.getElementById('orient-h');\n\t\t\tconst orientVBtn = document.getElementById('orient-v');\n\t\t\t\n\t\t\tif (!orientHBtn || !orientVBtn || !this.orH || !this.orV) return;\n\t\t\t\n\t\t\t// Entferne active Klasse von beiden Buttons\n\t\t\torientHBtn.classList.remove('active');\n\t\t\torientVBtn.classList.remove('active');\n\t\t\t\n\t\t\t// Setze active Klasse basierend auf Radio-Button Status\n\t\t\t// Priorisiere orV.checked für konsistente Logik\n\t\t\tif (this.orV.checked) {\n\t\t\t\torientVBtn.classList.add('active');\n\t\t\t} else if (this.orH.checked) {\n\t\t\t\torientHBtn.classList.add('active');\n\t\t\t} else {\n\t\t\t\t// Fallback: Standard auf vertikal setzen\n\t\t\t\tthis.orV.checked = true;\n\t\t\t\tthis.orH.checked = false;\n\t\t\t\torientVBtn.classList.add('active');\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Input-Sperr-Funktionen\n\t\tdisableInputs() {\n\t\t\tif (this.wIn) {\n\t\t\t\tthis.wIn.disabled = true;\n\t\t\t\tthis.wIn.style.backgroundColor = '#f0f0f0';\n\t\t\t\tthis.wIn.style.cursor = 'not-allowed';\n\t\t\t}\n\t\t\tif (this.hIn) {\n\t\t\t\tthis.hIn.disabled = true;\n\t\t\t\tthis.hIn.style.backgroundColor = '#f0f0f0';\n\t\t\t\tthis.hIn.style.cursor = 'not-allowed';\n\t\t\t}\n\t\t}\n\t\t\n\t\tenableInputs() {\n\t\t\tif (this.wIn) {\n\t\t\t\tthis.wIn.disabled = false;\n\t\t\t\tthis.wIn.style.backgroundColor = '';\n\t\t\t\tthis.wIn.style.cursor = '';\n\t\t\t}\n\t\t\tif (this.hIn) {\n\t\t\t\tthis.hIn.disabled = false;\n\t\t\t\tthis.hIn.style.backgroundColor = '';\n\t\t\t\tthis.hIn.style.cursor = '';\n\t\t\t}\n\t\t}\n\n    updateSaveButtons() {\n  \t\t// Immer den \"Neue Konfiguration speichern\" Button anzeigen\n  \t\tif (this.saveBtn) {\n  \t\t\tthis.saveBtn.style.display = 'inline-block';\n  \t\t}\n\t\t}\n    \n\n    \n    // Spalten-Methoden - Rechts (am Ende)\n    addColumnRight() {\n  \t\tthis.cols += 1;\n  \t\tfor (let row of this.selection) {\n    \t\trow.push(false);\n  \t\t}\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\tremoveColumnRight() {\n  \t\tif (this.cols <= 1) return;\n  \t\tthis.cols -= 1;\n  \t\tfor (let row of this.selection) {\n    \t\trow.pop();\n  \t\t}\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\t// Spalten-Methoden - Links (am Anfang)\n\t\taddColumnLeft() {\n  \t\tthis.cols += 1;\n  \t\tfor (let row of this.selection) {\n    \t\trow.unshift(false);\n  \t\t}\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\tremoveColumnLeft() {\n  \t\tif (this.cols <= 1) return;\n  \t\tthis.cols -= 1;\n  \t\tfor (let row of this.selection) {\n    \t\trow.shift();\n  \t\t}\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\t// Zeilen-Methoden - Unten (am Ende)\n\t\taddRowBottom() {\n  \t\tthis.rows += 1;\n  \t\tthis.selection.push(Array(this.cols).fill(false));\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\tremoveRowBottom() {\n  \t\tif (this.rows <= 1) return;\n  \t\tthis.rows -= 1;\n  \t\tthis.selection.pop();\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\t// Zeilen-Methoden - Oben (am Anfang)\n\t\taddRowTop() {\n  \t\tthis.rows += 1;\n  \t\tthis.selection.unshift(Array(this.cols).fill(false));\n  \t\tthis.updateGridAfterStructureChange();\n\t\t}\n\n\t\tremoveRowTop() {\n  \t\tif (this.rows <= 1) return;\n  \t\tthis.rows -= 1;\n  \t\tthis.selection.shift();\n  \t\tthis.updateGridAfterStructureChange();\n\t\t\t\t}\n\n    updateGridAfterStructureChange() {\n  \t\tthis.updateSize();\n  \t\tthis.buildGrid();\n  \t\tthis.buildList();\n  \t\tthis.updateSummaryOnChange();\n\t\t}\n    \n\n    \n\n    updateSize() {\n  \t\tconst RAIL_GAP = 2; // Immer 2cm für Schienen-Berechnungen\n  \t\tconst remPx = parseFloat(getComputedStyle(document.documentElement).fontSize);\n\n  \t\t\t\t// Original Zellengrößen aus Input - bei Orientierung entsprechend anwenden\n\t\tconst inputW = parseFloat(this.wIn ? this.wIn.value : '179') || 179;\n\t\tconst inputH = parseFloat(this.hIn ? this.hIn.value : '113') || 113;\n  \t\t\n  \t\t\t\t// Bei vertikaler Orientierung: Breite und Höhe der Zellen tauschen\n\t\tconst isVertical = this.orV ? this.orV.checked : false;\n  \t\tconst originalCellW = isVertical ? inputH : inputW;\n  \t\tconst originalCellH = isVertical ? inputW : inputH;\n  \t\t\n  \t\t\t\t// Maximale verfügbare Größe\n\t\t// 50px Abstand auf allen Seiten: links, rechts, oben, unten\n\t\t// Insgesamt 100px für Breite (50px links + 50px rechts) und 100px für Höhe (50px oben + 50px unten)\n\t\tconst maxWidth = this.wrapper ? this.wrapper.clientWidth - 100 : 800; // grid-wrapper Breite - 100px (50px links + 50px rechts)\n\t\tconst maxHeight = this.wrapper ? this.wrapper.clientHeight - 100 : 600; // grid-wrapper Höhe - 100px (50px oben + 50px unten)\n  \t\t\n  \t\t// Berechne benötigte Gesamtgröße mit Original-Zellgrößen (inklusive Gaps für Schienen)\n  \t\tconst totalWidthWithRailGaps = this.cols * originalCellW + (this.cols - 1) * RAIL_GAP;\n  \t\tconst totalHeightWithRailGaps = this.rows * originalCellH + (this.rows - 1) * RAIL_GAP;\n  \t\t\n  \t\t// Berechne Skalierungsfaktoren für beide Dimensionen\n  \t\tconst scaleX = maxWidth / totalWidthWithRailGaps;\n  \t\tconst scaleY = maxHeight / totalHeightWithRailGaps;\n  \t\t\n  \t\t// Verwende den kleineren Skalierungsfaktor, um Proportionen zu erhalten\n  \t\t// und sicherzustellen, dass das Grid nie die Grenzen überschreitet\n  \t\tconst scale = Math.min(scaleX, scaleY, 1);\n  \t\t\n  \t\t// Berechne finale Zellgrößen\n  \t\tconst w = originalCellW * scale;\n  \t\tconst h = originalCellH * scale;\n\n  \t\t// Bestimme visuelle Gap: 0 wenn viele Spalten/Zeilen, sonst RAIL_GAP * scale\n  \t\t// Gap verschwindet horizontal ab 15 Spalten, vertikal ab 10 Zeilen\n  \t\tconst shouldHideGap = this.cols >= 15 || this.rows >= 10;\n  \t\tconst visualGap = shouldHideGap ? 0 : RAIL_GAP * scale;\n\n  \t\t// CSS Variablen setzen\n  \t\tdocument.documentElement.style.setProperty('--cell-size', w + 'px');\n  \t\tdocument.documentElement.style.setProperty('--cell-width',  w + 'px');\n  \t\tdocument.documentElement.style.setProperty('--cell-height', h + 'px');\n  \t\tdocument.documentElement.style.setProperty('--cell-gap', visualGap + 'px');\n\n  \t\t// Grid-Größe direkt setzen - niemals größer als die maximalen Grenzen\n  \t\tconst finalWidth = Math.min(this.cols * w + (this.cols - 1) * visualGap, maxWidth);\n  \t\tconst finalHeight = Math.min(this.rows * h + (this.rows - 1) * visualGap, maxHeight);\n  \t\t\n  \t\t\t\tif (this.gridEl) {\n\t\t\tthis.gridEl.style.width = finalWidth + 'px';\n\t\t\tthis.gridEl.style.height = finalHeight + 'px';\n\t\t}\n\t\t}\n\n    buildGrid() {\n  \t\tif (!Array.isArray(this.selection)) return;\n  \t\t\n  \t\t// Performance: Verwende DocumentFragment für bessere Performance\n  \t\tconst fragment = document.createDocumentFragment();\n  \t\t\n  \t\t// CSS-Variablen setzen\n  \t\tdocument.documentElement.style.setProperty('--cols', this.cols);\n  \t\tdocument.documentElement.style.setProperty('--rows', this.rows);\n\n  \t\t// Batch-Erstellung aller Zellen - optimiert für Orientation Changes\n  \t\tfor (let y = 0; y < this.rows; y++) {\n    \t\tif (!Array.isArray(this.selection[y])) continue;\n\n    \t\tfor (let x = 0; x < this.cols; x++) {\n      \t\tconst cell = document.createElement('div');\n      \t\tcell.className = 'grid-cell';\n      \t\tif (this.selection[y]?.[x]) cell.classList.add('selected');\n      \t\t\n      \t\t// FEATURE 6: Screen Reader Support - ARIA-Labels\n      \t\tcell.setAttribute('role', 'button');\n      \t\tcell.setAttribute('tabindex', '0');\n      \t\tcell.setAttribute('aria-label', `Modul ${x + 1}, ${y + 1} - ${this.selection[y]?.[x] ? 'ausgewählt' : 'nicht ausgewählt'}`);\n      \t\tcell.setAttribute('aria-pressed', this.selection[y]?.[x] ? 'true' : 'false');\n\n      \t\t// Event-Listener optimiert\n      \t\tcell.addEventListener('click', () => {\n        \t\tif (!this.selection[y]) this.selection[y] = [];\n        \t\tthis.selection[y][x] = !this.selection[y][x];\n        \t\tcell.classList.toggle('selected');\n        \t\t\n        \t\t// FEATURE 6: Screen Reader Support - Update ARIA\n        \t\tcell.setAttribute('aria-pressed', this.selection[y][x] ? 'true' : 'false');\n        \t\tcell.setAttribute('aria-label', `Modul ${x + 1}, ${y + 1} - ${this.selection[y][x] ? 'ausgewählt' : 'nicht ausgewählt'}`);\n        \t\t\n        \t\t// Performance: Update aktuelle Konfiguration ohne Deep Copy\n        \t\tif (this.currentConfig !== null && this.configs[this.currentConfig]) {\n        \t\t\t// Direkte Referenz statt JSON.parse/stringify\n        \t\t\tthis.configs[this.currentConfig].selection = this.selection;\n        \t\t\t// Speichere die Konfiguration automatisch\n        \t\t\tthis.updateConfig();\n        \t\t}\n        \t\t\n        \t\tthis.trackInteraction();\n        \t\t// Performance: Sofortige Produktliste Update + Debounced Summary\n        \t\tthis.buildList();\n        \t\tthis.updateSummaryOnChange();\n        \t\t\n        \t\t// Update config-list und overview wenn eine Konfiguration ausgewählt ist\n        \t\tif (this.currentConfig !== null) {\n        \t\t\tthis.updateConfigList();\n        \t\t}\n      \t\t});\n       \n      \t\t// FEATURE 6: Screen Reader Support - Keyboard Navigation\n      \t\tcell.addEventListener('keydown', (e) => {\n        \t\tif (e.key === 'Enter' || e.key === ' ') {\n        \t\t\te.preventDefault();\n        \t\t\tcell.click();\n        \t\t}\n      \t\t});\n\n      \t\t// Animation entfernt für bessere Performance\n      \t\t// const dx = x - centerX;\n      \t\t// const dy = y - centerY;\n      \t\t// const distance = Math.sqrt(dx * dx + dy * dy);\n      \t\t// const delay = distance * delayPerUnit;\n      \t\t// cell.style.animationDelay = `${delay}ms`;\n      \t\t// setTimeout(() => cell.classList.remove('animate-in'), 400);\n      \t\tfragment.appendChild(cell);\n    \t\t}\n  \t\t}\n  \t\t\n  \t\t// Einmalige DOM-Manipulation\n  \t\tthis.gridEl.innerHTML = '';\n  \t\tthis.gridEl.appendChild(fragment);\n\t\t}\n    \n    async buildList() {\n      try {\n        // Performance: Cached panel count calculation\n        const panelCount = this.selection.flat().filter(v => v).length;\n        \n        // Verwende die gleiche Berechnungslogik wie calculateConfigPrice für Konsistenz\n        const currentConfig = {\n          selection: this.selection,\n          cols: this.cols,\n          rows: this.rows,\n          cellWidth: parseInt(this.wIn?.value || '179'),\n          cellHeight: parseInt(this.hIn?.value || '113'),\n          orientation: this.orV?.checked ? 'vertical' : 'horizontal',\n          ulicaModule: document.getElementById('ulica-module')?.checked || false\n        };\n        \n        // Verwende calculateConfigPrice Logik für die Teile-Berechnung\n        const parts = {\n          Solarmodul: 0, Endklemmen: 0, Mittelklemmen: 0,\n          Dachhaken: 0, Schrauben: 0, Endkappen: 0,\n          Schienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0,\n          UlicaSolarBlackJadeFlow: 0\n        };\n\n        // Berechne Teile für jede Zeile (gleiche Logik wie calculateConfigPrice)\n        for (let y = 0; y < currentConfig.rows; y++) {\n          if (!Array.isArray(currentConfig.selection[y])) continue;\n          let run = 0;\n\n          for (let x = 0; x < currentConfig.cols; x++) {\n            if (currentConfig.selection[y]?.[x]) {\n              run++;\n            }\n            else if (run) { \n              this.processGroupDirectly(run, parts, currentConfig.cellWidth || 179, currentConfig.cellHeight || 113, currentConfig.orientation || 'vertical', currentConfig.ulicaModule || false); \n              run = 0; \n            }\n          }\n          if (run) {\n            this.processGroupDirectly(run, parts, currentConfig.cellWidth || 179, currentConfig.cellHeight || 113, currentConfig.orientation || 'vertical', currentConfig.ulicaModule || false);\n          }\n        }\n        \n        // Module nur hinzufügen wenn Checkbox aktiviert ist (gleiche Logik wie calculateConfigPrice)\n        const includeModules = document.getElementById('include-modules')?.checked || false;\n        const ulicaModule = document.getElementById('ulica-module')?.checked || false;\n        \n        if (!includeModules) {\n          delete parts.Solarmodul;\n        }\n        \n        if (!ulicaModule) {\n          delete parts.UlicaSolarBlackJadeFlow;\n        }\n        \n        // Zusatzprodukte: Erdungsband wieder in die Produktliste aufnehmen wenn Checkbox aktiv\n        if (this.erdungsband && this.erdungsband.checked) {\n          parts.Erdungsband = this.calculateErdungsband();\n        } else {\n          delete parts.Erdungsband;\n        }\n\n\n      const entries = Object.entries(parts).filter(([,v]) => v > 0);\n      if (!entries.length) {\n        if (this.listHolder) {\n          this.listHolder.style.display = 'none';\n        }\n        return;\n      }\n      if (this.listHolder) {\n        this.listHolder.style.display = 'block';\n      }\n      if (this.prodList) {\n        // Performance: Reduziere DOM-Manipulation\n        const fragment = document.createDocumentFragment();\n        entries.forEach(([k,v]) => {\n          const packs = Math.ceil(v / VE[k]);\n          const price = getPriceFromCache(k);\n          const itemTotal = packs * price;\n          const div = document.createElement('div');\n          div.className = 'produkt-item';\n          \n          // Spezielle Behandlung für Erdungsband: Zeige Länge statt Anzahl\n          let itemDetails = `(${v})`;\n          let itemVE = `${VE[k]} Stück`;\n          if (k === 'Erdungsband' && this.erdungsbandtotal) {\n            itemDetails = `(${this.erdungsbandtotal} cm)`;\n            itemVE = `600 cm`;\n          }\n          \n          div.innerHTML = `\n            <div class=\"item-left\">\n              <span class=\"item-quantity\">${packs}×</span>\n              <div class=\"item-info\">\n                <span class=\"item-name\">${PRODUCT_NAME_MAP[k] || k.replace(/_/g,' ')}</span>\n                <span class=\"item-ve\">${itemVE}</span>\n              </div>\n              <span class=\"item-details\">${itemDetails}</span>\n            </div>\n            <span class=\"item-price\">${itemTotal.toFixed(2).replace('.', ',')} €</span>\n          `;\n          fragment.appendChild(div);\n        });\n        this.prodList.innerHTML = '';\n        this.prodList.appendChild(fragment);\n        this.prodList.style.display = 'block';\n      }\n      } catch (error) {\n        // Fallback: Verstecke Liste bei Fehler\n        if (this.listHolder) {\n          this.listHolder.style.display = 'none';\n        }\n      }\n    }\n    \n    resetGridToDefault() {\n  \t\tconst { cols, rows, width, height } = this.default;\n\n  \t\t// Setze Inputs und interne Werte\n  \t\tthis.wIn.value = width;\n  \t\tthis.hIn.value = height;\n  \t\t\n  \t\t// Setze Orientierung auf Standard (vertikal als Standard)\n\t\tconst defaultVertical = true; // Vertikal als Standard\n\t\tif (this.orH) this.orH.checked = !defaultVertical;\n\t\tif (this.orV) this.orV.checked = defaultVertical;\n\t\t\n\t\t// Synchronisiere Setup-Container Radio-Buttons\n\t\tconst orientHSetup = document.getElementById('orient-h-setup');\n\t\tconst orientVSetup = document.getElementById('orient-v-setup');\n\t\tif (orientHSetup && orientVSetup) {\n\t\t\torientHSetup.checked = !defaultVertical;\n\t\t\torientVSetup.checked = defaultVertical;\n\t\t}\n\n\t\t// Setze alle Checkboxen zurück für neue Konfiguration\n\t\tif (this.incM) this.incM.checked = false;\n\t\tif (this.mc4) this.mc4.checked = false;\n\t\tif (this.solarkabel) this.solarkabel.checked = false;\n\t\tif (this.holz) this.holz.checked = false;\n\t\tif (this.quetschkabelschuhe) this.quetschkabelschuhe.checked = false;\n\t\tif (this.erdungsband) this.erdungsband.checked = false;\n\t\tif (this.ulicaModule) this.ulicaModule.checked = false;\n\t\t\n\t\t// Module Dropdown auf Default zurücksetzen\n\t\tif (this.moduleSelect) {\n\t\t\tthis.moduleSelect.value = '';\n\t\t\tthis.enableInputs();\n\t\t}\n\n  \t\tthis.cols = cols;\n  \t\tthis.rows = rows;\n\n  \t\t// Leere Auswahl - alle Module abwählen\n  \t\tthis.selection = Array.from({ length: this.rows }, () =>\n    \t\tArray.from({ length: this.cols }, () => false)\n  \t\t);\n\n  \t\t// Aktualisiere alles\n  \t\tthis.setup();\n  \t\tthis.buildGrid();\n  \t\tthis.buildList();\n  \t\tthis.updateSummaryOnChange();\n\t\t}\n    \n    \tresetToDefaultGrid() {\n\t\tif (this.colsIn) this.colsIn.value = this.default.cols;\n\t\tif (this.rowsIn) this.rowsIn.value = this.default.rows;\n\t\tif (this.wIn) this.wIn.value = this.default.width;\n\t\tif (this.hIn) this.hIn.value = this.default.height;\n\t\tif (this.orH) this.orH.checked = false;\n\t\tif (this.orV) this.orV.checked = true;\n\n  \t\t// Setze cols/rows synchron\n  \t\tthis.cols = this.default.cols;\n  \t\tthis.rows = this.default.rows;\n\n  \t\t// Leere Auswahl\n  \t\tthis.selection = Array.from({ length: this.rows }, () =>\n    \t\tArray.from({ length: this.cols }, () => false)\n  \t\t);\n\n  \t\tthis.setup(); // jetzt stimmt alles beim Rebuild\n\t\t}\n    \n\n\n    async calculateParts() {\n      // Verwende immer den Fallback für Tellerkopfschraube-Berechnung\n      return this.calculatePartsSync();\n    }\n\n    // Fallback synchrone Berechnung (ursprüngliche Methode)\n    calculatePartsSync() {\n  \t\tconst p = {\n    \t\tSolarmodul: 0, UlicaSolarBlackJadeFlow: 0, Endklemmen: 0, Mittelklemmen: 0,\n    \t\tDachhaken: 0, Schrauben: 0, Endkappen: 0,\n    \t\tSchienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0,\n    \t\tErdungsband: 0\n  \t\t};\n\n  \t\tfor (let y = 0; y < this.rows; y++) {\n    \t\tif (!Array.isArray(this.selection[y])) continue;\n    \t\tlet run = 0;\n\n    \t\tfor (let x = 0; x < this.cols; x++) {\n      \t\tif (this.selection[y]?.[x]) run++;\n      \t\telse if (run) { this.processGroup(run, p); run = 0; }\n    \t\t}\n    \t\tif (run) this.processGroup(run, p);\n  \t\t}\n\n  \t\t// Erdungsband-Berechnung nur wenn gewünscht\n  \t\tif (this.erdungsband && this.erdungsband.checked) {\n  \t\t\tp.Erdungsband = this.calculateErdungsband();\n  \t\t}\n\n  \t\treturn p;\n\t\t}\n\n    processGroup(len, p) {\n      // Verwende die korrekte Schienenlogik (wie im Worker)\n      const isVertical = this.orV?.checked;\n      const actualCellWidth = isVertical ? parseFloat(this.hIn?.value || '113') : parseFloat(this.wIn?.value || '179');\n      \n      const totalLen = len * actualCellWidth;\n      const floor360 = Math.floor(totalLen / 360);\n      const rem360 = totalLen - floor360 * 360;\n      const floor240 = Math.ceil(rem360 / 240);\n      const pure360 = Math.ceil(totalLen / 360);\n      const pure240 = Math.ceil(totalLen / 240);\n      \n      const variants = [\n        {cnt360: floor360, cnt240: floor240},\n        {cnt360: pure360,  cnt240: 0},\n        {cnt360: 0,        cnt240: pure240}\n      ].map(v => ({\n        ...v,\n        rails: v.cnt360 + v.cnt240,\n        waste: v.cnt360 * 360 + v.cnt240 * 240 - totalLen\n      }));\n      \n      const minRails = Math.min(...variants.map(v => v.rails));\n      const best = variants\n        .filter(v => v.rails === minRails)\n        .reduce((a, b) => a.waste <= b.waste ? a : b);\n      \n      const {cnt360, cnt240} = best;\n      \n      p.Schiene_360_cm     += cnt360 * 2;\n      p.Schiene_240_cm     += cnt240 * 2;\n      p.Schienenverbinder  += (cnt360 + cnt240 - 1) * 4;\n      p.Endklemmen         += 4;\n      p.Mittelklemmen      += len > 1 ? (len - 1) * 2 : 0;\n      p.Dachhaken          += len > 1 ? len * 3 : 4;\n      p.Endkappen          += 4; // Gleich wie Endklemmen\n      p.Solarmodul         += len;\n      if (this.ulicaModule && this.ulicaModule.checked) {\n        p.UlicaSolarBlackJadeFlow += len;\n      }\n      p.Schrauben          += len > 1 ? len * 3 : 4; // Basierend auf Dachhaken\n      p.Tellerkopfschraube += len > 1 ? (len * 3) * 2 : 8; // Basierend auf Dachhaken * 2\n    }\n\n    mapImage(key) {\n      // Verwende zentrale Produkt-Konfiguration oder Fallback\n      return PRODUCT_IMAGES[key] || '';\n    }\n\n    // Erdungsband-Berechnung\n    calculateErdungsband() {\n      const isVertical = this.orV?.checked;\n      const moduleHeight = isVertical ? parseFloat(this.wIn?.value || '179') : parseFloat(this.hIn?.value || '113');\n      const gap = 2; // 2cm Lücke zwischen Modulen\n      \n      // Kopiere selection Matrix für Erdungsbandlength-Tracking\n      const erdungsbandMatrix = this.selection.map(row => [...row]);\n      \n      let erdungsbandtotal = 0;\n      \n      // Analysiere Grid von oben nach unten, links nach rechts\n      for (let y = 0; y < this.rows; y++) {\n        for (let x = 0; x < this.cols; x++) {\n          const result = this.analyzeFieldForErdungsband(x, y, erdungsbandMatrix, moduleHeight, gap);\n          erdungsbandtotal += result;\n        }\n      }\n      \n      // Speichere Erdungsbandtotal für Display\n      this.erdungsbandtotal = erdungsbandtotal;\n      \n      // Berechne Anzahl benötigter Erdungsbänder\n      return Math.ceil(erdungsbandtotal / 600);\n    }\n\n    // Analysiere ein Feld für Erdungsband\n    analyzeFieldForErdungsband(x, y, erdungsbandMatrix, moduleHeight, gap) {\n      // Schritt 1: Hat das Feld ein Modul?\n      if (!erdungsbandMatrix[y]?.[x]) {\n        return 0; // Kein Modul, nächstes Feld\n      }\n      \n      // Schritt 2: Hat das Modul ein weiteres Modul direkt darunter?\n      if (y + 1 >= this.rows || !erdungsbandMatrix[y + 1]?.[x]) {\n        return 0; // Kein Modul darunter, nächstes Feld\n      }\n      \n      // Schritt 3: Ist links vom aktuellen Feld ein weiteres Feld mit Modul?\n      if (x === 0 || !erdungsbandMatrix[y]?.[x - 1]) {\n        // Kein Modul links → Erdungsbandlength für aktuelles Feld + Feld darunter\n        return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n      }\n      \n      // Schritt 4: Hat das linke Feld ein Modul darunter?\n      if (y + 1 >= this.rows || !erdungsbandMatrix[y + 1]?.[x - 1]) {\n        // Kein Modul unter dem linken Feld → Erdungsbandlength für aktuelles Feld + Feld darunter\n        return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n      }\n      \n      // Schritt 5: Haben die beiden linken Felder bereits Erdungsbandlength?\n      return this.checkLeftFieldsErdungsband(x, y, erdungsbandMatrix, moduleHeight, gap);\n    }\n\n    // Prüfe linke Felder auf Erdungsbandlength\n    checkLeftFieldsErdungsband(x, y, erdungsbandMatrix, moduleHeight, gap) {\n      const leftUpper = erdungsbandMatrix[y]?.[x - 1];\n      const leftLower = erdungsbandMatrix[y + 1]?.[x - 1];\n      \n      if (leftUpper && leftLower) {\n        // Beide haben Module → Prüfe ob sie bereits Erdungsbandlength haben\n        if (leftUpper === 'erdungsband' && leftLower === 'erdungsband') {\n          // Beide haben Erdungsbandlength → Nichts tun\n          return 0;\n        } else if (leftUpper === 'erdungsband' && leftLower !== 'erdungsband') {\n          // Nur das obere hat Erdungsbandlength → Erdungsbandlength für aktuelles Feld + Feld darunter\n          return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n        } else {\n          // Keine Erdungsbandlength links → Rekursiv weiter links prüfen\n          return this.checkLeftFieldsRecursive(x, y, erdungsbandMatrix, moduleHeight, gap);\n        }\n      } else if (leftUpper && !leftLower) {\n        // Nur oberes Feld hat Modul → Erdungsbandlength für aktuelles Feld + Feld darunter\n        return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n      } else {\n        // Keine Module links → Erdungsbandlength für aktuelles Feld + Feld darunter\n        return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n      }\n    }\n\n    // Rekursiv weiter links prüfen\n    checkLeftFieldsRecursive(x, y, erdungsbandMatrix, moduleHeight, gap) {\n      let checkX = x - 2; // Ein Feld weiter links\n      \n      while (checkX >= 0) {\n        // Schritt 3: Hat das Feld links ein Modul?\n        if (!erdungsbandMatrix[y]?.[checkX]) {\n          // Kein Modul links → Erdungsbandlength für aktuelles Feld + Feld darunter\n          return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n        }\n        \n        // Schritt 4: Hat das linke Feld ein Modul darunter?\n        if (y + 1 >= this.rows || !erdungsbandMatrix[y + 1]?.[checkX]) {\n          // Kein Modul unter dem linken Feld → Erdungsbandlength für aktuelles Feld + Feld darunter\n          return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n        }\n        \n        // Schritt 5: Haben die beiden linken Felder bereits Erdungsbandlength?\n        const leftUpper = erdungsbandMatrix[y]?.[checkX];\n        const leftLower = erdungsbandMatrix[y + 1]?.[checkX];\n        \n        if (leftUpper === 'erdungsband' && leftLower === 'erdungsband') {\n          // Beide haben Erdungsbandlength → Nichts tun\n          return 0;\n        } else if (leftUpper === 'erdungsband' && leftLower !== 'erdungsband') {\n          // Nur das obere hat Erdungsbandlength → Erdungsbandlength für aktuelles Feld + Feld darunter\n          return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n        } else {\n          // Keine Erdungsbandlength → Weiter nach links\n          checkX--;\n          continue;\n        }\n      }\n      \n      // Keine Module mehr links → Erdungsbandlength für aktuelles Feld + Feld darunter\n      return this.assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap);\n    }\n\n    // Weise Erdungsbandlength zu\n    assignErdungsbandLength(x, y, erdungsbandMatrix, moduleHeight, gap) {\n      // Prüfe ob aktuelles Feld bereits Erdungsbandlength hat\n      const currentFieldHasErdungsband = erdungsbandMatrix[y][x] === 'erdungsband';\n      \n      if (currentFieldHasErdungsband) {\n        // Nur das Feld darunter markieren\n        erdungsbandMatrix[y + 1][x] = 'erdungsband';\n        // Berechne Erdungsbandlength: 1 × Modul-Höhe + Gap\n        return moduleHeight + gap;\n      } else {\n        // Beide Felder markieren\n        erdungsbandMatrix[y][x] = 'erdungsband';\n        erdungsbandMatrix[y + 1][x] = 'erdungsband';\n        // Berechne Erdungsbandlength: 2 × Modul-Höhe + Gap\n        return 2 * moduleHeight + gap;\n      }\n    }\n\n\n\n\n\n\n    \n    \t\tloadConfig(idx) {\n\t\t\tconst cfg = this.configs[idx];\n\t\t\tthis.currentConfig = idx;\n\n\t\t\t// Input-Werte setzen\n\t\t\tthis.wIn.value = cfg.cellWidth;\n\t\t\tthis.hIn.value = cfg.cellHeight;\n\t\t\tthis.orV.checked = cfg.orientation === 'vertical';\n\t\t\tthis.orH.checked = !this.orV.checked;\n\t\t\t\n\t\t\t// Synchronisiere mit den Orientation Buttons\n\t\t\tthis.syncOrientationButtons();\n\t\t\tthis.incM.checked = cfg.incM;\n\t\t\tthis.mc4.checked = cfg.mc4;\n\t\t\tthis.solarkabel.checked = cfg.solarkabel || false; // Fallback für alte Konfigurationen\n\t\t\tthis.holz.checked = cfg.holz;\n\t\t\tthis.quetschkabelschuhe.checked = cfg.quetschkabelschuhe || false; // Fallback für alte Konfigurationen\n\t\t\tif (this.erdungsband) this.erdungsband.checked = cfg.erdungsband || false; // Fallback für alte Konfigurationen\n\t\t\tif (this.ulicaModule) this.ulicaModule.checked = cfg.ulicaModule || false; // Fallback für alte Konfigurationen\n\n\t\t\t// STATE Werte setzen - WICHTIG: Vor setup() setzen\n\t\t\tthis.cols = cfg.cols;\n\t\t\tthis.rows = cfg.rows;\n\t\t\tthis.selection = cfg.selection.map(r => [...r]);\n\n\t\t\t// Setup aufrufen (baut Grid mit korrekter Auswahl auf)\n\t\t\tthis.setup();\n\n\t\t\t// Produktliste und Summary aktualisieren\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\n\t\t\tthis.renderConfigList();\n\t\t\tthis.updateSaveButtons();\n\t\t\t\n\t\t\t// Detail-Ansicht aktualisieren wenn aktiv\n\t\t\tthis.updateDetailView();\n\t\t}\n\t\t\n\t\t// Spezielle Funktion für Cache-Load ohne Orientation-Überschreibung\n\t\tloadConfigFromCache(idx) {\n\t\t\tconst cfg = this.configs[idx];\n\t\t\tthis.currentConfig = idx;\n\n\t\t\t// Input-Werte setzen (OHNE Orientation)\n\t\t\tthis.wIn.value = cfg.cellWidth;\n\t\t\tthis.hIn.value = cfg.cellHeight;\n\t\t\t// Orientation wird NICHT gesetzt - bleibt aus dem Cache\n\t\t\t\n\t\t\tthis.incM.checked = cfg.incM;\n\t\t\tthis.mc4.checked = cfg.mc4;\n\t\t\tthis.solarkabel.checked = cfg.solarkabel || false;\n\t\t\tthis.holz.checked = cfg.holz;\n\t\t\tthis.quetschkabelschuhe.checked = cfg.quetschkabelschuhe || false;\n\t\t\tif (this.erdungsband) this.erdungsband.checked = cfg.erdungsband || false;\n\t\t\tif (this.ulicaModule) this.ulicaModule.checked = cfg.ulicaModule || false;\n\n\t\t\t// STATE Werte setzen\n\t\t\tthis.cols = cfg.cols;\n\t\t\tthis.rows = cfg.rows;\n\t\t\tthis.selection = cfg.selection.map(r => [...r]);\n\n\t\t\t// Setup aufrufen\n\t\t\tthis.setup();\n\n\t\t\t// Produktliste und Summary aktualisieren\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\n\t\t\tthis.renderConfigList();\n\t\t\tthis.updateSaveButtons();\n\t\t\t\n\t\t\t// Detail-Ansicht aktualisieren wenn aktiv\n\t\t\tthis.updateDetailView();\n\t\t}\n\t\t\n\t\t// Spezielle Funktion für Cache-Load der ersten Konfiguration mit korrekter Orientation\n\t\tloadFirstConfigFromCache() {\n\t\t\tif (this.configs.length === 0) return;\n\t\t\t\n\t\t\tconst cfg = this.configs[0];\n\t\t\tthis.currentConfig = 0;\n\n\t\t\t// Input-Werte setzen\n\t\t\tthis.wIn.value = cfg.cellWidth;\n\t\t\tthis.hIn.value = cfg.cellHeight;\n\t\t\t// Orientation wird NICHT gesetzt - bleibt aus dem Cache\n\t\t\t\n\t\t\tthis.incM.checked = cfg.incM;\n\t\t\tthis.mc4.checked = cfg.mc4;\n\t\t\tthis.solarkabel.checked = cfg.solarkabel || false;\n\t\t\tthis.holz.checked = cfg.holz;\n\t\t\tthis.quetschkabelschuhe.checked = cfg.quetschkabelschuhe || false;\n\t\t\tif (this.erdungsband) this.erdungsband.checked = cfg.erdungsband || false;\n\t\t\tif (this.ulicaModule) this.ulicaModule.checked = cfg.ulicaModule || false;\n\n\t\t\t// STATE Werte setzen\n\t\t\tthis.cols = cfg.cols;\n\t\t\tthis.rows = cfg.rows;\n\t\t\tthis.selection = cfg.selection.map(r => [...r]);\n\n\t\t\t// Setup aufrufen\n\t\t\tthis.setup();\n\n\t\t\t// Produktliste und Summary aktualisieren\n\t\t\tthis.buildList();\n\t\t\tthis.updateSummaryOnChange();\n\n\t\t\tthis.renderConfigList();\n\t\t\tthis.updateSaveButtons();\n\t\t\t\n\t\t\t// Detail-Ansicht aktualisieren wenn aktiv\n\t\t\tthis.updateDetailView();\n\t\t}\n\t\t\n\t\t// Funktion um die erste Konfiguration mit der globalen Orientation zu aktualisieren\n\t\tupdateFirstConfigOrientation(globalOrientation) {\n\t\t\tif (this.configs.length > 0) {\n\t\t\t\tthis.configs[0].orientation = globalOrientation;\n\t\t\t}\n\t\t}\n    \n    \t\tshowToast(message = 'Gespeichert', duration = 1500) {\n  \t\tconst toast = document.getElementById('toast');\n  \t\tif (!toast) return;\n  \t\ttoast.textContent = message;\n  \t\ttoast.classList.remove('hidden');\n\n  \t\tclearTimeout(this.toastTimeout);\n  \t\tthis.toastTimeout = setTimeout(() => {\n    \t\ttoast.classList.add('hidden');\n  \t\t}, duration);\n\t\t}\n\n    saveNewConfig(customName = null) {\n  \t\t// 1. Aktuelle Auswahl in der vorherigen Konfiguration speichern\n  \t\tif (this.currentConfig !== null) {\n  \t\t\tthis.updateConfig(); // Speichere aktuelle Änderungen in vorheriger Config\n  \t\t}\n  \t\t\n  \t\t// 2. Temporär currentConfig auf null setzen für neue Konfiguration\n  \t\tthis.currentConfig = null;\n\n\t\t\t// 2a. Erzwinge Default-Startzustand für neue Konfiguration: 5x5, vertikal\n\t\t\tif (this.default) {\n\t\t\t\tthis.cols = this.default.cols;\n\t\t\t\tthis.rows = this.default.rows;\n\t\t\t\tif (this.wIn) this.wIn.value = this.default.width;\n\t\t\t\tif (this.hIn) this.hIn.value = this.default.height;\n\t\t\t}\n\t\t\tif (this.orH && this.orV) {\n\t\t\t\tthis.orH.checked = false;\n\t\t\t\tthis.orV.checked = true;\n\t\t\t\tthis.syncOrientationButtons?.();\n\t\t\t}\n  \t\t\n  \t\t// 3. Neue Konfiguration mit leerem Grid erstellen\n\t\t\tconst emptySelection = Array.from({ length: this.rows }, () =>\n  \t\t\tArray.from({ length: this.cols }, () => false)\n  \t\t);\n  \t\t\n  \t\t// 4. Aktuelle Auswahl temporär speichern und durch leere ersetzen\n  \t\tconst originalSelection = this.selection;\n  \t\tthis.selection = emptySelection;\n  \t\t\n  \t\tconst cfg = this._makeConfigObject(customName);\n  \t\tthis.configs.push(cfg);\n  \t\t\n    \t\t// 5. Neue Konfiguration auswählen und Grid neu aufbauen\n    \t\tthis.currentConfig = this.configs.length - 1;\n    \t\tthis.setup(); // Baut Grid mit leerer Auswahl neu auf\n\n    \t\t// Direkt zur Detail-Ansicht der neuen Konfiguration wechseln\n    \t\tthis.showDetailView(this.currentConfig);\n  \t\t\n  \t\t\t\tthis.renderConfigList();\n\t\tthis.updateConfigList(); // Config-Liste in Overview updaten\n\t\tthis.updateSaveButtons();\n\t\t\n\t\t// 6. Detail-Ansicht aktualisieren wenn aktiv\n\t\tthis.updateDetailView();\n\t\t\n\t\tthis.showToast(`Neue Konfiguration \"${cfg.name}\" erstellt`);\n\t\t}\n\n    renameCurrentConfig(newName) {\n      if (this.currentConfig !== null && this.currentConfig >= 0 && this.currentConfig < this.configs.length) {\n        // Aktuelle Konfiguration umbenennen\n        this.configs[this.currentConfig].name = newName;\n        this.renderConfigList();\n        this.updateSaveButtons();\n      }\n    }\n\n    updateConfig() {\n      const idx = this.currentConfig;\n      this.configs[idx] = this._makeConfigObject();\n      this.renderConfigList();\n      this.updateSaveButtons();\n    }\n    \n    deleteConfig(configIndex) {\n  \t\tconst configName = this.configs[configIndex].name;\n  \t\tif (!confirm(`Willst du \"${configName}\" wirklich löschen?`)) return;\n\n  \t\tthis.configs.splice(configIndex, 1);\n  \t\t\n  \t\t// Nach dem Löschen: Wähle die nächste Konfiguration oder erstelle eine neue\n  \t\tif (this.configs.length > 0) {\n  \t\t\t// Wenn die gelöschte Konfiguration die aktuelle war\n  \t\t\tif (configIndex === this.currentConfig) {\n  \t\t\t\t// Wähle die nächste Konfiguration (oder die vorherige wenn es die letzte war)\n  \t\t\t\tconst newIndex = Math.min(configIndex, this.configs.length - 1);\n  \t\t\t\tthis.loadConfig(newIndex);\n  \t\t\t} else if (configIndex < this.currentConfig) {\n  \t\t\t\t// Eine Konfiguration vor der aktuellen wurde gelöscht, Index anpassen\n  \t\t\t\tthis.currentConfig--;\n  \t\t\t\tthis.renderConfigList();\n  \t\t\t} else {\n  \t\t\t\t// Eine Konfiguration nach der aktuellen wurde gelöscht, nur Liste neu rendern\n  \t\t\t\tthis.renderConfigList();\n  \t\t\t}\n  \t\t} else {\n  \t\t\t// Keine Konfigurationen mehr - erstelle eine neue\n  \t\t\tthis.createNewConfig();\n  \t\t}\n\n  \t\tthis.updateSaveButtons();\n\t\t}\n\n    createNewConfig() {\n  \t\t// Erstelle eine neue Standard-Konfiguration\n  \t\tthis.currentConfig = null;\n\t\t\tthis.resetGridToDefault(); // Setzt 5x5 und vertikal\n  \t\t\n  \t\t// Neue Konfiguration erstellen und hinzufügen\n  \t\tconst newConfig = this._makeConfigObject();\n  \t\tthis.configs.push(newConfig);\n  \t\tthis.currentConfig = this.configs.length - 1;\n  \t\t\n  \t\tthis.renderConfigList();\n  \t\tthis.updateSaveButtons();\n\t\t}\n\n    _makeConfigObject(customName = null) {\n      // Für neue Konfigurationen: Finde die nächste verfügbare Nummer\n      let configName;\n      if (customName) {\n        // Benutzerdefinierter Name\n        configName = customName;\n      } else if (this.currentConfig !== null) {\n        // Bestehende Konfiguration: Behalte den Namen\n        configName = this.configs[this.currentConfig].name;\n      } else {\n        // Neue Konfiguration: Finde nächste Nummer\n        let nextNumber = 1;\n        while (this.configs.some(cfg => cfg.name === `Konfiguration ${nextNumber}`)) {\n          nextNumber++;\n        }\n        configName = `Konfiguration ${nextNumber}`;\n      }\n      \n      return {\n        name:        configName,\n        selection:   this.selection.map(r => [...r]),\n        // Für neue Konfigurationen immer vertikal als Startzustand speichern\n        orientation: this.currentConfig === null ? 'vertical' : (this.orV && this.orV.checked ? 'vertical' : 'horizontal'),\n        incM:        this.incM && this.incM.checked,\n        mc4:         this.mc4 && this.mc4.checked,\n        solarkabel:  this.solarkabel && this.solarkabel.checked,\n        holz:        this.holz && this.holz.checked,\n        quetschkabelschuhe: this.quetschkabelschuhe && this.quetschkabelschuhe.checked,\n        erdungsband: this.erdungsband ? this.erdungsband.checked : false,\n        ulicaModule: this.ulicaModule ? this.ulicaModule.checked : false,\n        cols:        this.cols,\n        rows:        this.rows,\n        cellWidth:   parseFloat(this.wIn ? this.wIn.value : '179'),\n        cellHeight:  parseFloat(this.hIn ? this.hIn.value : '113')\n      };\n    }\n\n    renderConfigList() {\n      // Verwende das gleiche HTML-Design wie updateConfigList()\n      this.configListEl.innerHTML = '';\n      \n      this.configs.forEach((cfg, idx) => {\n        const div = document.createElement('div');\n        div.className = 'config-item' + (idx === this.currentConfig ? ' active' : '');\n        \n        const totalPrice = this.calculateConfigPrice(cfg);\n        const canDelete = this.configs.length >= 2;\n        \n        div.innerHTML = `\n          <div class=\"config-item-info\">\n            <div class=\"config-item-name\">${cfg.name || `Konfiguration #${idx + 1}`}</div>\n            <div class=\"config-item-price\">${totalPrice.toFixed(2).replace('.', ',')} €</div>\n          </div>\n          <div class=\"config-item-actions\">\n            <button class=\"icon-btn\" onclick=\"solarGrid.editConfigNameInList(${idx})\" title=\"Bearbeiten\">\n              <img src=\"https://cdn.prod.website-files.com/68498852db79a6c114f111ef/689369877a18221f25a4b743_Pen.png\" alt=\"Bearbeiten\" style=\"width: 16px; height: 16px;\">\n            </button>\n            ${canDelete ? `\n            <button class=\"icon-btn delete\" onclick=\"solarGrid.deleteConfigFromList(${idx})\" title=\"Löschen\">\n              <img src=\"https://cdn.prod.website-files.com/68498852db79a6c114f111ef/68936c5481f2a4db850a01f5_Trashbin.png\" alt=\"Löschen\" style=\"width: 16px; height: 16px;\">\n            </button>` : ''}\n            <div class=\"config-item-arrow\">\n              <img src=\"https://cdn.prod.website-files.com/68498852db79a6c114f111ef/68936986bd441749c46190e8_ChevronRight.png\" alt=\"Pfeil\" style=\"width: 10px; height: 16px;\">\n            </div>\n          </div>\n        `;\n        \n        div.addEventListener('click', (e) => {\n          // Verhindere Klick wenn auf Action-Button geklickt wurde\n          if (e.target.closest('.config-item-actions')) return;\n          \n          // Auto-Save der aktuellen Konfiguration vor dem Wechsel\n          if (this.currentConfig !== null && this.currentConfig !== idx) {\n            this.updateConfig();\n          }\n          \n          // Wechsle immer in die Detail-Ansicht der gewählten Konfiguration\n          this.showDetailView(idx);\n          this.showToast('Konfiguration geladen', 1000);\n        });\n        \n        this.configListEl.appendChild(div);\n      });\n    }\n\n    // Performance: Schnellerer Array-Vergleich\n    arraysEqual(a, b) {\n      if (a.length !== b.length) return false;\n      for (let i = 0; i < a.length; i++) {\n        if (a[i].length !== b[i].length) return false;\n        for (let j = 0; j < a[i].length; j++) {\n          if (a[i][j] !== b[i][j]) return false;\n        }\n      }\n      return true;\n    }\n\n    updateSummaryOnChange() {\n      // Performance: Debounced Updates\n      if (this.updateTimeout) {\n        clearTimeout(this.updateTimeout);\n      }\n      \n      this.updateTimeout = setTimeout(async () => {\n        // FEATURE 5: Performance-Monitoring - Update Time\n        const startTime = performance.now();\n        \n        // Auto-Save Indicator anzeigen\n        this.showAutoSaveIndicator();\n        \n        // Detail-Ansicht aktualisieren falls aktiv\n        if (document.getElementById('config-detail-view')?.classList.contains('active')) {\n          this.updateDetailView();\n        }\n        \n        // Gesamtpreis aktualisieren\n        this.updateCurrentTotalPrice();\n        \n        // Update config-list und overview wenn eine Konfiguration ausgewählt ist\n        if (this.currentConfig !== null) {\n          // Speichere die Konfiguration automatisch\n          this.updateConfig();\n          this.updateConfigList();\n        }\n        \n        // Automatisches Cache-Speichern bei jeder Änderung\n        this.saveToCache();\n        \n        this.performanceMetrics.updateTime = performance.now() - startTime;\n        this.updateTimeout = null;\n      }, this.updateDelay);\n    }\n\n\n\n\t\t// ISOLIERTE synchrone Berechnung für Fallback\n\t\tcalculatePartsDirectly(data) {\n\t\t\tconst { selection, rows, cols, cellWidth, cellHeight, orientation, options } = data;\n\t\t\tconst ulicaModule = options?.ulicaModule === true;\n\t\t\tconst parts = {\n\t\t\t\tSolarmodul: 0, UlicaSolarBlackJadeFlow: 0, Endklemmen: 0, Mittelklemmen: 0,\n\t\t\t\tDachhaken: 0, Schrauben: 0, Endkappen: 0,\n\t\t\t\tSchienenverbinder: 0, Schiene_240_cm: 0, Schiene_360_cm: 0, Tellerkopfschraube: 0\n\t\t\t};\n\n\t\t\tfor (let y = 0; y < rows; y++) {\n\t\t\t\tif (!Array.isArray(selection[y])) continue;\n\t\t\t\tlet run = 0;\n\n\t\t\t\tfor (let x = 0; x < cols; x++) {\n\t\t\t\t\tif (selection[y]?.[x]) {\n\t\t\t\t\t\trun++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (run) { \n\t\t\t\t\t\tthis.processGroupDirectly(run, parts, cellWidth, cellHeight, orientation, ulicaModule); \n\t\t\t\t\t\trun = 0; \n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (run) {\n\t\t\t\t\tthis.processGroupDirectly(run, parts, cellWidth, cellHeight, orientation, ulicaModule);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn parts;\n\t\t}\n\n\t\t// FALLBACK: Kopie der Worker-Berechnung\n\t\tprocessGroupDirectly(len, parts, cellWidth, cellHeight, orientation, ulicaModule = false) {\n\t\t\tconst isVertical = orientation === 'vertical';\n\t\t\tconst actualCellWidth = isVertical ? cellHeight : cellWidth;\n\t\t\t\n\t\t\tconst totalLen = len * actualCellWidth;\n\t\t\tconst floor360 = Math.floor(totalLen / 360);\n\t\t\tconst rem360 = totalLen - floor360 * 360;\n\t\t\tconst floor240 = Math.ceil(rem360 / 240);\n\t\t\tconst pure360 = Math.ceil(totalLen / 360);\n\t\t\tconst pure240 = Math.ceil(totalLen / 240);\n\t\t\t\n\t\t\tconst variants = [\n\t\t\t\t{cnt360: floor360, cnt240: floor240},\n\t\t\t\t{cnt360: pure360,  cnt240: 0},\n\t\t\t\t{cnt360: 0,        cnt240: pure240}\n\t\t\t].map(v => ({\n\t\t\t\t...v,\n\t\t\t\trails: v.cnt360 + v.cnt240,\n\t\t\t\twaste: v.cnt360 * 360 + v.cnt240 * 240 - totalLen\n\t\t\t}));\n\t\t\t\n\t\t\tconst minRails = Math.min(...variants.map(v => v.rails));\n\t\t\tconst best = variants\n\t\t\t\t.filter(v => v.rails === minRails)\n\t\t\t\t.reduce((a, b) => a.waste <= b.waste ? a : b);\n\t\t\t\n\t\t\tconst {cnt360, cnt240} = best;\n\t\t\t\n\t\t\tparts.Schiene_360_cm     += cnt360 * 2;\n\t\t\tparts.Schiene_240_cm     += cnt240 * 2;\n\t\t\tparts.Schienenverbinder  += (cnt360 + cnt240 - 1) * 4;\n\t\t\tparts.Endklemmen         += 4;\n\t\t\tparts.Mittelklemmen      += len > 1 ? (len - 1) * 2 : 0;\n\t\t\tparts.Dachhaken          += len > 1 ? len * 3 : 4;\n\t\t\tparts.Endkappen          += 4;  // Gleich wie Endklemmen\n\t\t\tparts.Solarmodul         += len;\n\t\t\t// UlicaSolarBlackJadeFlow hinzufügen wenn ulica-module Checkbox aktiviert ist\n\t\t\tif (ulicaModule) {\n\t\t\t\tparts.UlicaSolarBlackJadeFlow += len;\n\t\t\t}\n\t\t\t// Schrauben basierend auf Dachhaken berechnen\n\t\t\tparts.Schrauben          += len > 1 ? len * 3 : 4; // Basierend auf Dachhaken\n\t\t\tparts.Tellerkopfschraube += len > 1 ? (len * 3) * 2 : 8; // Basierend auf Dachhaken * 2\n\t\t}\n\n    resetAllConfigurations() {\n    \t// Bestätigungsabfrage\n    \tif (!confirm('Möchten Sie wirklich alle Konfigurationen löschen und von vorne anfangen?')) {\n    \t\treturn;\n    \t}\n    \t\n    \t// Cache löschen\n    \tthis.cacheManager.clearCache();\n    \t\n    \t// Alle Konfigurationen löschen\n    \tthis.configs = [];\n    \tthis.currentConfig = null;\n    \t\n    \t// Grid auf Default zurücksetzen\n    \tthis.cols = this.default.cols;\n    \tthis.rows = this.default.rows;\n    \tthis.selection = Array.from({ length: this.rows }, () =>\n    \t\tArray.from({ length: this.cols }, () => false)\n    \t);\n    \t\n    \t// Grid visuell aktualisieren - alle Module abwählen\n    \tthis.buildGrid();\n    \t\n    \t// Input-Felder auf Default zurücksetzen\n    \tif (this.wIn) this.wIn.value = this.default.width;\n    \tif (this.hIn) this.hIn.value = this.default.height;\n    \t\n    \t// Orientation auf Default zurücksetzen\n    \tif (this.orH && this.orV) {\n    \t\tthis.orH.checked = true;\n    \t\tthis.orV.checked = false;\n    \t}\n    \t\n    \t// Orientation-Buttons visuell aktualisieren\n    \tthis.syncOrientationButtons();\n    \t\n    \t// Checkboxen auf Default zurücksetzen (ALLE abwählen)\n    \tif (this.incM) this.incM.checked = false;\n    \tif (this.mc4) this.mc4.checked = false;\n    \tif (this.solarkabel) this.solarkabel.checked = false;\n    \tif (this.holz) this.holz.checked = false;\n    \tif (this.quetschkabelschuhe) this.quetschkabelschuhe.checked = false;\n    \tif (this.erdungsband) this.erdungsband.checked = false;\n    \tif (this.ulicaModule) this.ulicaModule.checked = false;\n    \t\n    \t// Module Dropdown auf Default zurücksetzen\n    \tif (this.moduleSelect) {\n    \t\tthis.moduleSelect.value = '';\n    \t\tthis.enableInputs();\n    \t}\n    \t\n    \t// Bestehende Konfigurationserstellung verwenden\n    \tthis.createNewConfig();\n    \t\n    \t// Orientation-Buttons nach createNewConfig() aktualisieren\n    \tthis.syncOrientationButtons();\n    \t\n    \t// Preise aktualisieren\n    \tthis.updateCurrentTotalPrice();\n    \t\n    \tthis.showToast('Alle Konfigurationen wurden zurückgesetzt', 2000);\n    }\n    \n    // NEUE FUNKTION: Speichere alle Konfigurationen und Einstellungen im Cache\n    saveToCache() {\n    \ttry {\n    \t\tconst cacheData = {\n    \t\t\tconfigs: this.configs,\n    \t\t\tcurrentConfig: this.currentConfig,\n    \t\t\tselection: this.selection, // Aktuelle Grid-Auswahl\n    \t\t\t// Aktuelle Grid-Einstellungen\n    \t\t\tcols: this.cols,\n    \t\t\trows: this.rows,\n    \t\t\tcellWidth: parseInt(this.wIn ? this.wIn.value : '179', 10),\n    \t\t\tcellHeight: parseInt(this.hIn ? this.hIn.value : '113', 10),\n    \t\t\torientation: this.orV && this.orV.checked ? 'vertical' : 'horizontal',\n    \t\t\t\t\t\t// Checkbox-Einstellungen\n\t\t\tincludeModules: this.incM ? this.incM.checked : false,\n\t\t\tmc4: this.mc4 ? this.mc4.checked : false,\n\t\t\tsolarkabel: this.solarkabel ? this.solarkabel.checked : false,\n\t\t\tholz: this.holz ? this.holz.checked : false,\n\t\t\tquetschkabelschuhe: this.quetschkabelschuhe ? this.quetschkabelschuhe.checked : false,\n\t\t\terdungsband: this.erdungsband ? this.erdungsband.checked : false,\n\t\t\tulicaModule: this.ulicaModule ? this.ulicaModule.checked : false,\n\t\t\t// Module Dropdown Auswahl\n\t\t\tmoduleSelectValue: this.moduleSelect ? this.moduleSelect.value : '',\n    \t\t\t// Grid-Struktur\n    \t\t\tgridStructure: {\n    \t\t\t\tcols: this.cols,\n    \t\t\t\trows: this.rows,\n    \t\t\t\tcellWidth: parseInt(this.wIn ? this.wIn.value : '179', 10),\n    \t\t\t\tcellHeight: parseInt(this.hIn ? this.hIn.value : '113', 10)\n    \t\t\t}\n    \t\t};\n    \t\t\n    \t\t// Verwende CacheManager für bessere Performance und Error Handling\n    \t\tthis.cacheManager.saveData(cacheData);\n    \t\t\n    \t\t// Zeige Auto-Save Indicator\n    \t\tthis.showAutoSaveIndicator();\n    \t} catch (error) {\n    \t\tconsole.error('Fehler beim Speichern des Caches:', error);\n    \t}\n    }\n    \n    // NEUE FUNKTION: Lade Konfigurationen aus dem Cache\n    loadFromCache() {\n    \ttry {\n    \t\t// Verwende CacheManager für bessere Error Handling\n    \t\tconst data = this.cacheManager.loadData();\n    \t\tif (!data) {\n    \t\t\tconsole.log('Kein Cache gefunden oder Cache abgelaufen');\n    \t\t\treturn false;\n    \t\t}\n    \t\t\n    \t\t// Prüfe localStorage Verfügbarkeit\n    \t\tif (!this.cacheManager.isLocalStorageAvailable()) {\n    \t\t\tthis.showToast('Es wurde nichts im Speicher gefunden', 3000);\n    \t\t\treturn false;\n    \t\t}\n    \t\t\n    \t\t// Lade Konfigurationen\n    \t\tif (data.configs && Array.isArray(data.configs)) {\n    \t\t\tthis.configs = data.configs;\n    \t\t\tthis.currentConfig = data.currentConfig;\n    \t\t\t\n    \t\t\t// Lade Grid-Auswahl\n    \t\tif (data.selection && Array.isArray(data.selection)) {\n    \t\t\tthis.selection = data.selection;\n    \t\t}\n    \t\t\t\n    \t\t\t// Lade Grid-Einstellungen\n    \t\t\tif (data.cols && data.rows) {\n    \t\t\t\tthis.cols = data.cols;\n    \t\t\t\tthis.rows = data.rows;\n    \t\t\t}\n    \t\t\t\n    \t\t\t// Lade Checkbox-Einstellungen\n    \t\t\tif (this.incM && typeof data.includeModules === 'boolean') {\n    \t\t\t\tthis.incM.checked = data.includeModules;\n    \t\t\t}\n    \t\t\tif (this.mc4 && typeof data.mc4 === 'boolean') {\n    \t\t\t\tthis.mc4.checked = data.mc4;\n    \t\t\t}\n    \t\t\tif (this.solarkabel && typeof data.solarkabel === 'boolean') {\n    \t\t\t\tthis.solarkabel.checked = data.solarkabel;\n    \t\t\t}\n    \t\t\tif (this.holz && typeof data.holz === 'boolean') {\n    \t\t\t\tthis.holz.checked = data.holz;\n    \t\t\t}\n    \t\t\tif (this.quetschkabelschuhe && typeof data.quetschkabelschuhe === 'boolean') {\n    \t\t\t\tthis.quetschkabelschuhe.checked = data.quetschkabelschuhe;\n    \t\t\t}\n    \t\t\tif (this.erdungsband && typeof data.erdungsband === 'boolean') {\n    \t\t\t\tthis.erdungsband.checked = data.erdungsband;\n    \t\t\t}\n    \t\t\t\t\t\tif (this.ulicaModule && typeof data.ulicaModule === 'boolean') {\n\t\t\t\tthis.ulicaModule.checked = data.ulicaModule;\n\t\t\t}\n\t\t\t\n\t\t\t// Lade Module Dropdown Auswahl\n\t\t\tif (this.moduleSelect && typeof data.moduleSelectValue === 'string') {\n\t\t\t\tthis.moduleSelect.value = data.moduleSelectValue;\n\t\t\t\t// Wenn ein Modul ausgewählt ist, Inputs entsprechend sperren/freigeben\n\t\t\t\tif (data.moduleSelectValue && data.moduleSelectValue !== 'custom') {\n\t\t\t\t\tthis.disableInputs();\n\t\t\t\t} else {\n\t\t\t\t\tthis.enableInputs();\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Lade Grid-Dimensionen\n\t\t\tif (this.wIn && data.cellWidth) {\n\t\t\t\tthis.wIn.value = data.cellWidth;\n\t\t\t}\n\t\t\tif (this.hIn && data.cellHeight) {\n\t\t\t\tthis.hIn.value = data.cellHeight;\n\t\t\t}\n    \t\t\t\n    \t\t\t// Lade Orientierung VOR dem Laden der Konfiguration\n\t\t\tif (this.orH && this.orV && typeof data.orientation === 'string') {\n\t\t\t\tthis.orH.checked = data.orientation === 'horizontal';\n\t\t\t\tthis.orV.checked = data.orientation === 'vertical';\n\t\t\t\t\n\t\t\t\t// Synchronisiere mit den Orientation Buttons (robuster)\n\t\t\t\tthis.syncOrientationButtons();\n\t\t\t\t\n\t\t\t\t// Aktualisiere die erste Konfiguration mit der globalen Orientation\n\t\t\t\tthis.updateFirstConfigOrientation(data.orientation);\n\t\t\t}\n    \t\t\t\n    \t\t\t// Lade die erste Konfiguration\n    \t\t\tif (this.configs.length > 0) {\n    \t\t\t\tthis.loadFirstConfigFromCache();\n    \t\t\t}\n    \t\t\t\n    \t\t\t// Grid und UI nach dem Laden wiederherstellen\n    \t\t\tthis.setup(); // Grid-Event-Listener wiederherstellen\n    \t\t\tthis.buildGrid(); // Grid visuell wiederherstellen\n    \t\t\tthis.buildList(); // Produktliste wiederherstellen\n    \t\t\t\n    \t\t\t// Event-Listener für alle UI-Elemente wiederherstellen\n    \t\t\tthis.setupAllEventListeners();\n    \t\t\t\n    \t\t\t// Aktualisiere UI nach dem Laden\n    \t\t\tthis.updateConfigList();\n    \t\t\tthis.updateCurrentTotalPrice();\n    \t\t\tthis.updateOverviewTotalPrice();\n    \t\t\t\n    \t\t\tthis.showToast('Konfiguration aus Cache geladen', 2000);\n    \t\t\treturn true;\n    \t\t}\n    \t} catch (error) {\n    \t\tconsole.error('Fehler beim Laden des Caches:', error);\n    \t\tthis.cacheManager.clearCache();\n    \t\tthis.showToast('Datei im Speicher ist beschädigt und konnte nicht geladen werden!', 3000);\n    \t}\n    \t\n    \treturn false;\n    }\n    \n        generateHiddenCartForms() {\n      const webflowForms = document.querySelectorAll('form[data-node-type=\"commerce-add-to-cart-form\"]');\n      this.webflowFormMap = {};\n      \n      webflowForms.forEach((form) => {\n        const productId = form.getAttribute('data-commerce-product-id');\n        const skuId = form.getAttribute('data-commerce-sku-id');\n        \n        const productKey = Object.keys(PRODUCT_MAP).find(key => \n          PRODUCT_MAP[key].productId === productId || PRODUCT_MAP[key].variantId === skuId\n        );\n        \n        if (productKey) {\n          this.webflowFormMap[productKey] = form;\n        }\n      });\n      \n      this.hideWebflowForms();\n    }\n\n    hideWebflowForms() {\n      Object.values(this.webflowFormMap).forEach(form => {\n        if (form && form.style) {\n          form.style.cssText = `\n            position: absolute !important;\n            left: -9999px !important;\n            top: -9999px !important;\n            width: 1px !important;\n            height: 1px !important;\n            overflow: hidden !important;\n            clip: rect(0, 0, 0, 0) !important;\n            white-space: nowrap !important;\n            border: 0 !important;\n            margin: 0 !important;\n            padding: 0 !important;\n            visibility: hidden !important;\n          `;\n        }\n      });\n    }\n\n    addProductToCart(productKey, quantity, isLastItem = false) {\n      const product = PRODUCT_MAP[productKey];\n      if (!product) return;\n      \n      const form = this.webflowFormMap[productKey];\n      if (!form) return;\n      \n      const qtyInput = form.querySelector('input[name=\"commerce-add-to-cart-quantity-input\"]');\n      if (qtyInput) {\n        qtyInput.value = quantity;\n      }\n      \n      const addToCartButton = form.querySelector('input[data-node-type=\"commerce-add-to-cart-button\"]');\n      if (addToCartButton) {\n        this.clickWebflowButtonSafely(form, addToCartButton, productKey, quantity, isLastItem);\n      }\n    }\n\n    clickWebflowButtonSafely(form, button, productKey, quantity, isLastItem) {\n      const qtyInput = form.querySelector('input[name=\"commerce-add-to-cart-quantity-input\"]');\n      if (qtyInput) qtyInput.value = quantity;\n      \n      if (isLastItem) {\n        // Für das letzte Item: Normaler Button-Klick (Cart-Container ist bereits sichtbar)\n        button.click();\n        return;\n      }\n      \n      // Für alle anderen Items: Versteckter Submit (Cart-Container ist versteckt)\n      const iframe = document.createElement('iframe');\n      iframe.name = 'safe-cart-' + Date.now() + Math.random();\n      iframe.style.cssText = `\n        position: absolute;\n        left: -10000px;\n        top: -10000px;\n        width: 1px;\n        height: 1px;\n        border: none;\n        visibility: hidden;\n        opacity: 0;\n      `;\n      \n      document.body.appendChild(iframe);\n      \n      const originalTarget = form.target || '';\n      form.target = iframe.name;\n      \n      let hasLoaded = false;\n      iframe.onload = () => {\n        if (!hasLoaded) {\n          hasLoaded = true;\n          form.target = originalTarget;\n          \n          if (qtyInput) qtyInput.value = 1;\n          \n          setTimeout(() => {\n            if (document.body.contains(iframe)) {\n              document.body.removeChild(iframe);\n            }\n          }, 1000);\n        }\n      };\n      \n      iframe.onerror = () => {\n        form.target = originalTarget;\n        if (document.body.contains(iframe)) {\n          document.body.removeChild(iframe);\n        }\n      };\n      \n      button.click();\n    }\n\n    addPartsListToCart(parts) {\n      const entries = Object.entries(parts).filter(([_, qty]) => qty > 0);\n      if (!entries.length) {\n        return;\n      }\n      \n      // Verstecke Cart-Container temporär\n      this.hideCartContainer();\n      \n      // Füge alle Produkte außer dem letzten sofort hinzu (ohne Delays)\n      const allButLast = entries.slice(0, -1);\n      const lastEntry = entries[entries.length - 1];\n      \n      // Alle Produkte außer dem letzten sofort hinzufügen\n      allButLast.forEach(([key, qty]) => {\n        const packsNeeded = Math.ceil(qty / VE[key]);\n        this.addProductToCart(key, packsNeeded, false);\n      });\n      \n      // Das letzte Produkt nach kurzer Verzögerung hinzufügen (zeigt Cart)\n      setTimeout(() => {\n        this.showCartContainer();\n        const [lastKey, lastQty] = lastEntry;\n        const packsNeeded = Math.ceil(lastQty / VE[lastKey]);\n        this.addProductToCart(lastKey, packsNeeded, true);\n      }, 500);\n    }\n\n    hideCartContainer() {\n      const cartContainer = document.querySelector('.w-commerce-commercecartcontainerwrapper');\n      if (cartContainer) {\n        cartContainer.style.display = 'none';\n      }\n    }\n\n    showCartContainer() {\n      const cartContainer = document.querySelector('.w-commerce-commercecartcontainerwrapper');\n      if (cartContainer) {\n        cartContainer.style.display = '';\n      }\n    }\n\n    async addCurrentToCart() {\n      try {\n        const parts = await this._buildPartsFor(this.selection, this.incM.checked, this.mc4.checked, this.solarkabel.checked, this.holz.checked, this.quetschkabelschuhe.checked, this.erdungsband ? this.erdungsband.checked : false, this.ulicaModule ? this.ulicaModule.checked : false);\n      const itemCount = Object.values(parts).reduce((sum, qty) => sum + qty, 0);\n      \n      if (itemCount === 0) {\n        this.showToast('Keine Produkte ausgewählt ⚠️', 2000);\n        return;\n      }\n      \n      // Sende Daten an Webhook\n      this.sendCurrentConfigToWebhook().then(success => {\n        if (success) {\n        } else {\n        }\n      });\n      \n      this.addPartsListToCart(parts);\n      this.showToast(`${itemCount} Produkte werden zum Warenkorb hinzugefügt...`, 3000);\n        \n        // PDF für aktuelle Konfiguration generieren\n        if (this.pdfGenerator && this.pdfGenerator.isAvailable()) {\n          setTimeout(() => {\n            this.pdfGenerator.generatePDF('current');\n          }, 500); // Kurze Verzögerung damit Warenkorb-Toast zuerst angezeigt wird\n        }\n      } catch (error) {\n        this.showToast('Fehler beim Berechnen der Produkte ❌', 2000);\n      }\n    }\n\n    async addAllToCart() {\n      try {\n      // Kein Auto-Save beim Warenkorb-Button-Klick - Config-Items sollen nicht neu gebaut werden\n      \n        // SCHRITT 1: Erstelle vollständigen ISOLIERTEN Snapshot aller Konfigurationen\n        const configSnapshot = this.createConfigSnapshot();\n        \n        // SCHRITT 2: PDF ZUERST mit isolierten Daten erstellen\n        if (this.pdfGenerator && this.pdfGenerator.isAvailable()) {\n          this.showToast('PDF wird erstellt...', 2000);\n          await this.pdfGenerator.generatePDFFromSnapshot(configSnapshot);\n          \t\t\tthis.showToast('PDF erfolgreich erstellt', 1500);\n        }\n        \n        // SCHRITT 3: Berechne Produkte für Warenkorb (mit Live-Data für aktuellen Zustand)\n        const allBundles = await Promise.all(this.configs.map(async (cfg, idx) => {\n        // Für die aktuell bearbeitete Konfiguration: Verwende aktuelle Werte\n        if (idx === this.currentConfig) {\n                      return await this._buildPartsFor(this.selection, this.incM.checked, this.mc4.checked, this.solarkabel.checked, this.holz.checked, this.quetschkabelschuhe.checked, this.erdungsband ? this.erdungsband.checked : false, this.ulicaModule ? this.ulicaModule.checked : false);\n      } else {\n        return await this._buildPartsFor(cfg.selection, cfg.incM, cfg.mc4, cfg.solarkabel, cfg.holz, cfg.quetschkabelschuhe, cfg.erdungsband, cfg.ulicaModule);\n        }\n        }));\n      \n      // Wenn keine Konfiguration ausgewählt ist (sollte nicht passieren), füge aktuelle Auswahl hinzu\n      if (this.currentConfig === null && this.configs.length === 0) {\n            const currentParts = await this._buildPartsFor(this.selection, this.incM.checked, this.mc4.checked, this.solarkabel.checked, this.holz.checked, this.quetschkabelschuhe.checked, this.erdungsband ? this.erdungsband.checked : false, this.ulicaModule ? this.ulicaModule.checked : false);\n            allBundles.push(currentParts);\n      }\n      \n      const total = {};\n      allBundles.forEach(parts => {\n        Object.entries(parts).forEach(([k, v]) => {\n          total[k] = (total[k] || 0) + v;\n        });\n      });\n      \n      const totalItemCount = Object.values(total).reduce((sum, qty) => sum + qty, 0);\n      \n      if (totalItemCount === 0) {\n        this.showToast('Keine Konfigurationen vorhanden ⚠️', 2000);\n        return;\n      }\n      \n        // SCHRITT 4: Sende alle Konfigurationen an Webhook (NACH PDF)\n        const webhookSuccess = await this.sendAllConfigsToWebhook();\n        if (webhookSuccess) {\n          // Success handling if needed\n        } else {\n          // Error handling if needed  \n        }\n      \n        // SCHRITT 5: Füge zum Warenkorb hinzu\n      this.addPartsListToCart(total);\n      this.showToast(`${totalItemCount} Produkte aus allen Konfigurationen werden hinzugefügt...`, 3000);\n        \n      } catch (error) {\n        console.error('Fehler in addAllToCart:', error);\n        this.showToast('Fehler beim Berechnen der Konfigurationen ❌', 2000);\n      }\n    }\n\n    async _buildPartsFor(sel, incM, mc4, solarkabel, holz, quetschkabelschuhe, erdungsband, ulicaModule) {\n      // Speichere aktuelle Auswahl\n      const originalSelection = this.selection.map(r => [...r]);\n      \n      try {\n        // Temporär setzen für Berechnung\n        this.selection = sel;\n        let parts = await this.calculateParts();\n        \n        // Module nur hinzufügen wenn Checkbox aktiviert ist\n        if (!incM) delete parts.Solarmodul;\n        if (!ulicaModule) delete parts.UlicaSolarBlackJadeFlow;\n        \n        // Zusatzprodukte basierend auf Checkboxen\n        if (!mc4) delete parts.MC4;\n        if (!solarkabel) delete parts.Solarkabel;\n        if (!holz) delete parts.Holzunterleger;\n        if (!quetschkabelschuhe) delete parts.Quetschkabelschuhe;\n        \n        // Erdungsband hinzufügen wenn aktiviert\n        if (erdungsband) {\n          parts.Erdungsband = this.calculateErdungsband();\n        } else {\n          delete parts.Erdungsband;\n        }\n        \n        return parts;\n      } finally {\n        // Ursprüngliche Auswahl wiederherstellen\n        this.selection = originalSelection;\n      }\n    }\n\n    _buildCartItems(parts) {\n      return Object.entries(parts).map(([k,v]) => {\n        const packs = Math.ceil(v / VE[k]), m = PRODUCT_MAP[k];\n        return (!m || packs <= 0) ? null : {\n          productId: m.productId,\n          variantId: m.variantId,\n          quantity:  packs\n        };\n      }).filter(Boolean);\n    }\n\n    // ===== PDF HELPER METHODS =====\n    \n    // Hole aktuelle Konfigurationsdaten für PDF\n    getCurrentConfigData() {\n      return {\n        name: this.currentConfig !== null && this.configs[this.currentConfig] ? \n              this.configs[this.currentConfig].name : 'Aktuelle Konfiguration',\n        cols: this.cols,\n        rows: this.rows,\n        selection: this.selection.map(row => [...row]), // Deep copy\n        orientation: this.orV.checked ? 'vertical' : 'horizontal',\n        includeModules: this.incM.checked,\n        mc4: this.mc4.checked,\n        cable: this.solarkabel.checked,\n        wood: this.holz.checked,\n        quetschkabelschuhe: this.quetschkabelschuhe.checked,\n        erdungsband: this.erdungsband ? this.erdungsband.checked : false,\n        ulicaModule: this.ulicaModule ? this.ulicaModule.checked : false\n      };\n    }\n\n    // NEUE METHODE: Globale Checkbox-Logik - aktualisiert alle Konfigurationen\n    updateAllConfigurationsForCheckboxes() {\n      // Aktualisiere alle gespeicherten Konfigurationen mit aktuellen Checkbox-Werten\n      this.configs.forEach((config, index) => {\n        config.incM = this.incM.checked;\n        config.mc4 = this.mc4.checked;\n        config.solarkabel = this.solarkabel.checked;\n        config.holz = this.holz.checked;\n        config.quetschkabelschuhe = this.quetschkabelschuhe.checked;\n        if (this.erdungsband) config.erdungsband = this.erdungsband.checked;\n        if (this.ulicaModule) config.ulicaModule = this.ulicaModule.checked;\n      });\n      \n      // Aktualisiere Summary und Produktliste\n      this.updateSummaryOnChange();\n      \n      // Aktualisiere auch die Produktliste in der detailed-overview\n      this.buildList();\n    }\n\n    // NEUE METHODE: Erstelle vollständigen isolierten Config-Snapshot für PDF\n    createConfigSnapshot() {\n      // Auto-Save der aktuellen Konfiguration falls nötig\n      if (this.currentConfig !== null) {\n        this.updateConfig();\n      }\n      \n      // Erstelle KOMPLETT ISOLIERTE Kopie aller Konfigurationsdaten\n      const snapshot = {\n        timestamp: new Date().toISOString(),\n        totalConfigs: this.configs.length,\n        currentConfigIndex: this.currentConfig,\n        configs: []\n      };\n      \n      // Durchlaufe alle Konfigurationen und erstelle Deep Copies\n      for (let index = 0; index < this.configs.length; index++) {\n        const config = this.configs[index];\n        \n        // Hole Daten - für aktuelle Config verwende Live-Daten\n        let targetSelection, targetCols, targetRows, targetOrientation;\n        let targetIncM, targetMc4, targetCable, targetWood, targetQuetschkabelschuhe, targetErdungsband, targetUlicaModule, targetCellWidth, targetCellHeight;\n        \n        if (index === this.currentConfig) {\n          // Aktuelle Konfiguration: MOMENTAUFNAHME der Live-Daten\n          targetSelection = this.selection ? this.selection.map(row => [...row]) : [];\n          targetCols = this.cols;\n          targetRows = this.rows;\n          targetOrientation = this.orV.checked ? 'vertical' : 'horizontal';\n          targetIncM = this.incM.checked;\n          targetMc4 = this.mc4.checked;\n          targetCable = this.solarkabel.checked;\n          targetWood = this.holz.checked;\n          targetQuetschkabelschuhe = this.quetschkabelschuhe.checked;\n          targetErdungsband = this.erdungsband ? this.erdungsband.checked : false;\n          targetUlicaModule = this.ulicaModule ? this.ulicaModule.checked : false;\n          console.log('Current ulicaModule checkbox state:', targetUlicaModule);\n          targetCellWidth = parseInt(this.wIn.value, 10);\n          targetCellHeight = parseInt(this.hIn.value, 10);\n        } else {\n          // Andere Konfigurationen: Deep Copy der gespeicherten Daten\n          targetSelection = config.selection ? config.selection.map(row => [...row]) : [];\n          targetCols = config.cols;\n          targetRows = config.rows;\n          targetOrientation = config.orientation;\n          targetIncM = config.incM;\n          targetMc4 = config.mc4;\n          targetCable = config.solarkabel;\n          targetWood = config.holz;\n          targetQuetschkabelschuhe = config.quetschkabelschuhe;\n          targetErdungsband = config.erdungsband;\n          targetUlicaModule = config.ulicaModule;\n          targetCellWidth = config.cellWidth;\n          targetCellHeight = config.cellHeight;\n        }\n        \n        // Normalisiere Selection für die Zieldimensionen\n        const normalizedSelection = Array.from({ length: targetRows || 5 }, (_, y) =>\n          Array.from({ length: targetCols || 5 }, (_, x) => {\n            if (targetSelection[y] && Array.isArray(targetSelection[y]) && x < targetSelection[y].length) {\n              return targetSelection[y][x] === true;\n            }\n            return false;\n          })\n        );\n        \n        // Erstelle isolierte Config-Kopie\n        const isolatedConfig = {\n          name: config.name || `Konfiguration ${index + 1}`,\n          index: index,\n          cols: targetCols || 5,\n          rows: targetRows || 5,\n          selection: normalizedSelection,\n          cellWidth: targetCellWidth || 179,\n          cellHeight: targetCellHeight || 113,\n          orientation: targetOrientation || 'horizontal',\n          includeModules: targetIncM === true,\n          mc4: targetMc4 || false,\n          cable: targetCable || false,\n          wood: targetWood || false,\n          quetschkabelschuhe: targetQuetschkabelschuhe || false,\n          erdungsband: targetErdungsband || false,\n          ulicaModule: targetUlicaModule === true,\n          // Zusätzliche Metadaten für Debugging\n          selectedCells: normalizedSelection.flat().filter(v => v).length,\n          totalCells: (targetCols || 5) * (targetRows || 5)\n        };\n        \n        snapshot.configs.push(isolatedConfig);\n      }\n      \n      return snapshot;\n    }\n\n    // DEPRECATED: Alte Methode für Backward Compatibility\n    getAllConfigsData() {\n      const snapshot = this.createConfigSnapshot();\n      return snapshot.configs;\n    }\n    \n    // ===== GRID PREVIEW METHODS =====\n    \n    showGridPreview(config) {\n      console.log('showGridPreview called with config:', config);\n      \n      // Speichere aktuellen Zustand für späteres Zurücksetzen (immer, nicht nur beim ersten Mal)\n      this.originalPreviewState = {\n        selection: this.selection ? this.selection.map(row => [...row]) : null,\n        cols: this.cols,\n        rows: this.rows,\n        orientation: this.orV ? this.orV.checked : false,\n        cellWidth: parseInt(this.wIn ? this.wIn.value : '179', 10),\n        cellHeight: parseInt(this.hIn ? this.hIn.value : '113', 10)\n      };\n      \n      console.log('Original state saved:', this.originalPreviewState);\n      \n      try {\n        // Erstelle Preview-Grid\n        this.createPreviewGrid(config);\n        \n        // Smooth Animation: Verstecke Hauptgrid und zeige Preview-Grid\n        this.hideMainGrid();\n        this.showPreviewGrid();\n        \n        // Füge Animation-Klassen hinzu\n        const mainGrid = document.getElementById('grid');\n        const previewGrid = document.getElementById('preview-grid');\n        \n        if (mainGrid) mainGrid.classList.add('grid-fade-out');\n        if (previewGrid) previewGrid.classList.add('grid-fade-in');\n        \n        console.log('Grid preview shown successfully');\n      } catch (error) {\n        console.error('Error in showGridPreview:', error);\n        // Fallback: Zeige Hauptgrid wieder an\n        this.showMainGrid();\n      }\n    }\n    \n    createPreviewGrid(config) {\n      console.log('createPreviewGrid called with config:', config);\n      \n      const previewGrid = document.getElementById('preview-grid');\n      \n      if (!previewGrid) {\n        console.error('Preview grid element not found');\n        return;\n      }\n      \n      console.log('Preview grid element found, building preview...');\n      \n      // Starte mit aktuellem Grid als Basis\n      let previewCols = this.cols;\n      let previewRows = this.rows;\n      let previewSelection = this.selection ? this.selection.map(row => [...row]) : \n        Array.from({ length: previewRows }, () => Array.from({ length: previewCols }, () => false));\n      \n            // Wende Konfiguration auf Preview an\n      if (config.useCurrentGrid) {\n        // Kurze Eingabe: Verwende aktuelles Grid als Basis\n        previewCols = config.cols;\n        previewRows = config.rows;\n        // Behalte aktuelle Selection\n        previewSelection = this.selection ? this.selection.map(row => [...row]) : \n          Array.from({ length: previewRows }, () => Array.from({ length: previewCols }, () => false));\n      } else if (config.cols && config.rows) {\n        // Neue Grid-Größe\n        previewCols = config.cols;\n        previewRows = config.rows;\n        \n        // Erstelle neue Selection basierend auf Modul-Anzahl oder leere Selection\n        if (config.moduleCount) {\n          previewSelection = this.createModuleSelection(config.moduleCount, previewCols, previewRows);\n        } else {\n          previewSelection = Array.from({ length: previewRows }, () =>\n            Array.from({ length: previewCols }, () => false)\n          );\n        }\n      } else if (config.moduleCount) {\n         // Nur Modul-Anzahl geändert - behalte Grid-Größe\n         const hasSpacing = config.adjustSpacing === 'withSpacing' || \n                           (config.rowConfig && config.rowConfig.spacing);\n         previewSelection = this.createModuleSelection(config.moduleCount, previewCols, previewRows, hasSpacing);\n       } else if (config.rowConfig) {\n        // Reihen-Konfiguration anwenden\n        const { numRows, modulesPerRow, spacing } = config.rowConfig;\n        previewRows = numRows + (spacing ? 1 : 0); // +1 für Abstand\n        \n        // Erstelle Selection mit Abstand\n        previewSelection = Array.from({ length: previewRows }, (_, rowIndex) =>\n          Array.from({ length: previewCols }, (_, colIndex) => {\n            if (spacing && rowIndex === Math.floor(numRows / 2)) {\n              return false; // Abstand-Reihe\n            }\n            return rowIndex < numRows && colIndex < modulesPerRow;\n          })\n        );\n      } else if (config.adjustSpacing) {\n        // Abstand-Konfiguration anwenden\n        if (config.adjustSpacing === 'withSpacing') {\n          // Füge Abstand zwischen Reihen hinzu\n          const newRows = previewRows + Math.ceil(previewRows / 2);\n          const newSelection = Array.from({ length: newRows }, () =>\n            Array.from({ length: previewCols }, () => false)\n          );\n          \n          // Kopiere Module mit Abstand\n          let newRowIndex = 0;\n          for (let oldRow = 0; oldRow < previewRows; oldRow++) {\n            for (let col = 0; col < previewCols; col++) {\n              if (previewSelection[oldRow] && previewSelection[oldRow][col]) {\n                newSelection[newRowIndex][col] = true;\n              }\n            }\n            newRowIndex += 2; // Überspringe Abstand-Reihe\n          }\n          \n          previewRows = newRows;\n          previewSelection = newSelection;\n        }\n      }\n      \n      // Baue Preview-Grid\n      this.buildPreviewGrid(previewGrid, previewSelection, previewCols, previewRows);\n    }\n    \n    buildPreviewGrid(previewGrid, selection, cols, rows) {\n      \n      \n      // Verwende die gleiche Berechnungslogik wie das Hauptgrid\n      const RAIL_GAP = 2;\n      const remPx = parseFloat(getComputedStyle(document.documentElement).fontSize);\n      \n      // Original Zellengrößen aus Input - bei Orientierung entsprechend anwenden\n      const inputW = parseInt(this.wIn ? this.wIn.value : '179', 10) || 179;\n      const inputH = parseInt(this.hIn ? this.hIn.value : '113', 10) || 113;\n      \n      // Bei vertikaler Orientierung: Breite und Höhe der Zellen tauschen\n      const isVertical = this.orV ? this.orV.checked : false;\n      const originalCellW = isVertical ? inputH : inputW;\n      const originalCellH = isVertical ? inputW : inputH;\n      \n      \n      \n      // Maximale verfügbare Größe (wie im Hauptgrid)\n      const maxWidth = this.wrapper ? this.wrapper.clientWidth - 100 : 800;\n      const maxHeight = this.wrapper ? this.wrapper.clientHeight - 100 : 600;\n      \n      // Berechne benötigte Gesamtgröße mit Original-Zellgrößen (inklusive Gaps für Schienen)\n      const totalWidthWithRailGaps = cols * originalCellW + (cols - 1) * RAIL_GAP;\n      const totalHeightWithRailGaps = rows * originalCellH + (rows - 1) * RAIL_GAP;\n      \n      // Berechne Skalierungsfaktoren für beide Dimensionen\n      const scaleX = maxWidth / totalWidthWithRailGaps;\n      const scaleY = maxHeight / totalHeightWithRailGaps;\n      \n      // Verwende den kleineren Skalierungsfaktor, um Proportionen zu erhalten\n      const scale = Math.min(scaleX, scaleY, 1);\n      \n      // Berechne finale Zellgrößen\n      const w = originalCellW * scale;\n      const h = originalCellH * scale;\n      \n      \n      \n      // Bestimme visuelle Gap: 0 wenn viele Spalten/Zeilen, sonst RAIL_GAP * scale\n      const shouldHideGap = cols >= 15 || rows >= 10;\n      const visualGap = shouldHideGap ? 0 : RAIL_GAP * scale;\n      \n      // Grid-Styling setzen\n      previewGrid.style.gridTemplateColumns = `repeat(${cols}, ${w}px)`;\n      previewGrid.style.gridTemplateRows = `repeat(${rows}, ${h}px)`;\n      previewGrid.style.gap = `${visualGap}px`;\n      \n      // Grid leeren\n      previewGrid.innerHTML = '';\n      \n      // Zellen erstellen\n      for (let row = 0; row < rows; row++) {\n        for (let col = 0; col < cols; col++) {\n          const cell = document.createElement('div');\n          cell.className = 'preview-grid-cell';\n          cell.dataset.row = row;\n          cell.dataset.col = col;\n          \n          // Selection anwenden\n          if (selection && selection[row] && selection[row][col]) {\n            cell.classList.add('selected');\n          }\n          \n          previewGrid.appendChild(cell);\n        }\n      }\n    }\n    \n    hideMainGrid() {\n      const mainGrid = document.getElementById('grid');\n      if (mainGrid) {\n        mainGrid.style.display = 'none';\n        mainGrid.style.visibility = 'hidden';\n        mainGrid.style.opacity = '0';\n      }\n    }\n    \n    showPreviewGrid() {\n      const previewGrid = document.getElementById('preview-grid');\n      if (previewGrid) {\n        previewGrid.style.display = 'grid';\n        previewGrid.style.visibility = 'visible';\n        previewGrid.style.opacity = '1';\n      }\n    }\n    \n    hidePreviewGrid() {\n      const previewGrid = document.getElementById('preview-grid');\n      if (previewGrid) {\n        previewGrid.style.display = 'none';\n        previewGrid.style.visibility = 'hidden';\n        previewGrid.style.opacity = '0';\n      }\n    }\n    \n    showMainGrid() {\n      const mainGrid = document.getElementById('grid');\n      if (mainGrid) {\n        mainGrid.style.display = 'grid';\n        mainGrid.style.visibility = 'visible';\n        mainGrid.style.opacity = '1';\n      }\n    }\n    \n    createModuleSelection(moduleCount, cols, rows, spacing = false) {\n      const selection = Array.from({ length: rows }, () =>\n        Array.from({ length: cols }, () => false)\n      );\n      \n      if (spacing) {\n        // Mit Abstand: Module in erste und letzte Reihe\n        const modulesPerRow = Math.ceil(moduleCount / 2);\n        let modulesPlaced = 0;\n        \n        // Erste Reihe\n        for (let col = 0; col < Math.min(modulesPerRow, cols) && modulesPlaced < moduleCount; col++) {\n          selection[0][col] = true;\n          modulesPlaced++;\n        }\n        \n        // Letzte Reihe (falls noch Module übrig)\n        if (modulesPlaced < moduleCount && rows > 2) {\n          for (let col = 0; col < Math.min(moduleCount - modulesPlaced, cols); col++) {\n            selection[rows - 1][col] = true;\n            modulesPlaced++;\n          }\n        }\n      } else {\n        // Ohne Abstand: Normale Auswahl von links nach rechts, oben nach unten\n        let modulesPlaced = 0;\n        for (let row = 0; row < rows && modulesPlaced < moduleCount; row++) {\n          for (let col = 0; col < cols && modulesPlaced < moduleCount; col++) {\n            selection[row][col] = true;\n            modulesPlaced++;\n          }\n        }\n      }\n      \n      return selection;\n    }\n    \n    clearGridPreview() {\n      console.log('Clearing grid preview');\n      \n      // Smooth Animation: Entferne Animation-Klassen\n      const mainGrid = document.getElementById('grid');\n      const previewGrid = document.getElementById('preview-grid');\n      \n      if (mainGrid) mainGrid.classList.remove('grid-fade-out');\n      if (previewGrid) previewGrid.classList.remove('grid-fade-in');\n      \n      // Kurze Verzögerung für Animation\n      setTimeout(() => {\n        // Verstecke Preview-Grid und zeige Hauptgrid\n        this.hidePreviewGrid();\n        this.showMainGrid();\n        \n        // Verwende gespeicherten ursprünglichen Zustand\n        if (this.originalPreviewState) {\n          this.selection = this.originalPreviewState.selection;\n          this.cols = this.originalPreviewState.cols;\n          this.rows = this.originalPreviewState.rows;\n          \n          if (this.orV && this.orH && this.originalPreviewState.orientation !== null) {\n            this.orV.checked = this.originalPreviewState.orientation;\n            this.orH.checked = !this.originalPreviewState.orientation;\n          }\n          \n          // Zusätzliche Eigenschaften wiederherstellen\n          if (this.wIn && this.originalPreviewState.cellWidth) {\n            this.wIn.value = this.originalPreviewState.cellWidth;\n          }\n          if (this.hIn && this.originalPreviewState.cellHeight) {\n            this.hIn.value = this.originalPreviewState.cellHeight;\n          }\n          \n          // Grid wiederherstellen\n          this.updateSize();\n          this.buildGrid();\n          \n          // Gespeicherten Zustand löschen\n          this.originalPreviewState = null;\n          console.log('Grid preview cleared and original state restored');\n        }\n        \n        // Sicherheitscheck: Stelle sicher, dass das Grid sichtbar ist\n        setTimeout(() => {\n          const mainGrid = document.getElementById('grid');\n          if (mainGrid && mainGrid.style.display === 'none') {\n            this.showMainGrid();\n          }\n        }, 100);\n      }, 150); // Kurze Verzögerung für smooth Animation\n    }\n    \n    setupResizeObserver() {\n      // Performance: Resize Observer für responsive Updates\n      if (this.wrapper && window.ResizeObserver) {\n        this.resizeObserver = new ResizeObserver((entries) => {\n          // Debounced resize updates\n          if (this.resizeTimeout) {\n            clearTimeout(this.resizeTimeout);\n          }\n          \n          this.resizeTimeout = setTimeout(() => {\n            this.updateSize();\n            this.resizeTimeout = null;\n          }, 150); // 150ms debounce\n        });\n        \n        this.resizeObserver.observe(this.wrapper);\n      }\n    }\n    \n    // FEATURE 8: Pinch-to-Zoom Setup\n    setupPinchToZoom() {\n      if (!this.wrapper) return;\n      \n      let initialDistance = 0;\n      let initialZoom = 1;\n      \n      this.wrapper.addEventListener('touchstart', (e) => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          initialDistance = this.getTouchDistance(e.touches[0], e.touches[1]);\n          initialZoom = this.zoomLevel;\n        }\n      });\n      \n      this.wrapper.addEventListener('touchmove', (e) => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const currentDistance = this.getTouchDistance(e.touches[0], e.touches[1]);\n          const scale = currentDistance / initialDistance;\n          const newZoom = Math.max(this.minZoom, Math.min(this.maxZoom, initialZoom * scale));\n          \n          this.setZoom(newZoom);\n        }\n      });\n      \n      this.wrapper.addEventListener('touchend', (e) => {\n        if (e.touches.length < 2) {\n          initialDistance = 0;\n          initialZoom = 1;\n        }\n      });\n    }\n    \n    getTouchDistance(touch1, touch2) {\n      const dx = touch1.clientX - touch2.clientX;\n      const dy = touch1.clientY - touch2.clientY;\n      return Math.sqrt(dx * dx + dy * dy);\n    }\n    \n    setZoom(zoomLevel) {\n      this.zoomLevel = zoomLevel;\n      this.wrapper.style.transform = `scale(${zoomLevel})`;\n      this.wrapper.style.transformOrigin = 'center center';\n    }\n    \n    cleanup() {\n      // Memory-Leak Prävention: Timeouts löschen\n      if (this.updateTimeout) {\n        clearTimeout(this.updateTimeout);\n        this.updateTimeout = null;\n      }\n      \n      if (this.previewTimeout) {\n        clearTimeout(this.previewTimeout);\n        this.previewTimeout = null;\n      }\n      \n      if (this.resizeTimeout) {\n        clearTimeout(this.resizeTimeout);\n        this.resizeTimeout = null;\n      }\n      \n      // Resize Observer cleanup\n      if (this.resizeObserver) {\n        this.resizeObserver.disconnect();\n        this.resizeObserver = null;\n      }\n      \n      // FEATURE 5: Performance-Monitoring Cleanup\n      if (this.performanceMetrics) {\n        this.performanceMetrics = null;\n      }\n      \n      // FEATURE 8: Pinch-to-Zoom Cleanup\n      if (this.zoomObserver) {\n        this.zoomObserver = null;\n      }\n      \n      // Event-Listener entfernen\n      if (this.gridEl) {\n        this.gridEl.innerHTML = '';\n      }\n      \n      // PDF Generator cleanup\n      if (this.pdfGenerator) {\n        this.pdfGenerator = null;\n      }\n    }\n  }\n\n  document.addEventListener('DOMContentLoaded', () => {\n    const grid = new SolarGrid();\n    grid.generateHiddenCartForms();\n    window.solarGrid = grid;\n  });\n\n  // Cleanup beim Verlassen der Seite\n  window.addEventListener('beforeunload', () => {\n    if (calculationManager) {\n      calculationManager.destroy();\n    }\n    \n    // Memory-Leak Prävention: Event-Listener entfernen\n    if (window.solarGrid) {\n      window.solarGrid.cleanup();\n    }\n  });\n})();\n"],"mappings":"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","ignoreList":[]}