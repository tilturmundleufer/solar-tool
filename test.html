<!DOCTYPE html>
<html>
<head>
    <title>Solar Tool Rail Logic Test</title>
</head>
<body>
    <h1>Solar Tool Rail Logic Test</h1>
    <div id="test-results"></div>
    
    <script>
        // Test the rail calculation logic
        function testRailCalculation() {
            const results = document.getElementById('test-results');
            
            // Simple test: 3x3 grid with all cells selected
            const testSelection = [
                [true, true, true],
                [true, true, true],
                [true, true, true]
            ];
            
            const testData = {
                selection: testSelection,
                rows: 3,
                cols: 3,
                cellWidth: 179,
                cellHeight: 113,
                orientation: 'horizontal'
            };
            
            // Test Worker calculation
            if (typeof Worker !== 'undefined') {
                try {
                    const worker = new Worker('./calculation-worker.js');
                    
                    worker.onmessage = function(e) {
                        const { type, data } = e.data;
                        
                        if (type === 'ready') {
                            console.log('Worker ready, sending test data...');
                            worker.postMessage({
                                type: 'calculateParts',
                                data: testData,
                                id: 1
                            });
                        }
                        
                        if (type === 'result') {
                            console.log('Worker result:', data);
                            
                            let html = '<h2>Worker Berechnung:</h2><ul>';
                            Object.entries(data).forEach(([key, value]) => {
                                if (value > 0) {
                                    html += `<li>${key}: ${value}</li>`;
                                }
                            });
                            html += '</ul>';
                            
                            // Check if rails are calculated
                            if (data.Schiene_240_cm > 0 || data.Schiene_360_cm > 0) {
                                html += '<p style="color: green;">✅ Schienen werden berechnet!</p>';
                            } else {
                                html += '<p style="color: red;">❌ Keine Schienen berechnet!</p>';
                            }
                            
                            results.innerHTML = html;
                            worker.terminate();
                        }
                        
                        if (type === 'error') {
                            console.error('Worker error:', data);
                            results.innerHTML = '<p style="color: red;">Worker Error: ' + data.error.message + '</p>';
                        }
                    };
                    
                    worker.onerror = function(error) {
                        console.error('Worker failed to load:', error);
                        results.innerHTML = '<p style="color: red;">Worker konnte nicht geladen werden</p>';
                    };
                    
                } catch (error) {
                    console.error('Worker creation failed:', error);
                    results.innerHTML = '<p style="color: red;">Worker creation failed: ' + error.message + '</p>';
                }
            } else {
                results.innerHTML = '<p style="color: orange;">Web Workers nicht unterstützt</p>';
            }
        }
        
        // Start test when page loads
        window.addEventListener('load', testRailCalculation);
    </script>
</body>
</html>