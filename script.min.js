!function(){const e={Endklemmen:100,Schrauben:100,Dachhaken:20,Mittelklemmen:100,Endkappen:50,Schienenverbinder:50,Schiene_240_cm:8,Schiene_360_cm:8,Solarmodul:1,MC4_Stecker:1,Holzunterleger:1},t={Solarmodul:120,Endklemmen:20,Schrauben:5,Dachhaken:15,Mittelklemmen:18,Endkappen:12,Schienenverbinder:10,Schiene_240_cm:30,Schiene_360_cm:40,MC4_Stecker:1,Holzunterleger:.5},i={Solarmodul:"Solarmodul",Endklemmen:"Endklemmen",Schrauben:"Schrauben",Dachhaken:"Dachhaken",Mittelklemmen:"Mittelklemmen",Endkappen:"Endkappen",Schienenverbinder:"Schienenverbinder",Schiene_240_cm:"Schiene 240 cm",Schiene_360_cm:"Schiene 360 cm",MC4_Stecker:"MC4 Stecker",Holzunterleger:"Holzunterleger"};class s{constructor(){this.gridEl=document.getElementById("grid"),this.wrapper=document.querySelector(".grid-wrapper"),this.overflower=document.querySelector(".grid-overflow"),this.colsIn=document.getElementById("cols-input"),this.rowsIn=document.getElementById("rows-input"),this.wIn=document.getElementById("width-input"),this.hIn=document.getElementById("height-input"),this.orH=document.getElementById("orient-h"),this.orV=document.getElementById("orient-v"),this.incM=document.getElementById("include-modules"),this.mc4=document.getElementById("mc4"),this.holz=document.getElementById("holz"),this.listHolder=document.querySelector(".produktliste-holder"),this.prodList=document.getElementById("produktliste"),this.summaryHolder=document.getElementById("summary-list-holder"),this.summaryList=document.getElementById("summary-list"),this.saveBtn=document.getElementById("save-config-btn"),this.updateBtn=document.getElementById("update-config-btn"),this.addBtn=document.getElementById("add-to-cart-btn"),this.summaryBtn=document.getElementById("summary-add-cart-btn"),this.configListEl=document.getElementById("config-list"),this.resetBtn=document.getElementById("reset-btn"),this.deleteBtn=document.getElementById("delete-config-btn"),this.selection=[],this.configs=[],this.currentConfig=null,this.default={cols:5,rows:5,width:176,height:113},this.init()}init(){this.loadFromLocalStorage(),this.attachInputListeners();const e=new URLSearchParams(window.location.search).get("configData");if(e)try{const t=decodeURIComponent(atob(e)),i=JSON.parse(t);return this.configs.push(i),void this.loadConfig(this.configs.length-1)}catch(e){console.warn("Ungültige Konfigurationsdaten in URL:",e)}[this.wIn,this.hIn].forEach(e=>e.addEventListener("change",()=>{this.updateSize(),this.buildList(),this.updateSummaryOnChange()}));let t=this.orH.checked?"horizontal":"vertical";if([this.orH,this.orV].forEach(e=>e.addEventListener("change",()=>{if(!e.checked)return;const i=e===this.orH?"horizontal":"vertical";if(i===t)return;const s=this.wIn.value;this.wIn.value=this.hIn.value,this.hIn.value=s,this.updateSize(),this.buildList(),this.updateSummaryOnChange();const n=getComputedStyle(document.documentElement).getPropertyValue("--cell-width").trim().replace("px",""),o=getComputedStyle(document.documentElement).getPropertyValue("--cell-height").trim().replace("px","");this.wIn.value=Math.round(parseFloat(n)),this.hIn.value=Math.round(parseFloat(o)),t=i})),[this.incM,this.mc4,this.holz].forEach(e=>e.addEventListener("change",()=>{this.buildList(),this.updateSummaryOnChange()})),document.getElementById("add-col").addEventListener("click",()=>this.addColumn()),document.getElementById("remove-col").addEventListener("click",()=>this.removeColumn()),document.getElementById("add-row").addEventListener("click",()=>this.addRow()),document.getElementById("remove-row").addEventListener("click",()=>this.removeRow()),this.saveBtn.addEventListener("click",()=>this.saveNewConfig()),this.updateBtn.addEventListener("click",()=>this.updateConfig()),this.deleteBtn.addEventListener("click",()=>this.deleteCurrentConfig()),this.addBtn.addEventListener("click",()=>this.addCurrentToCart()),this.summaryBtn.addEventListener("click",()=>this.addAllToCart()),this.resetBtn.addEventListener("click",()=>this.resetGridToDefault()),document.getElementById("delete-all-configs-btn").addEventListener("click",()=>this.deleteAllConfigs()),window.addEventListener("resize",()=>{this.updateSize(),this.buildGrid(),this.buildList(),this.updateSummaryOnChange()}),this.cols=this.default.cols,this.rows=this.default.rows,this.setup(),this.loadFromLocalStorage(),this.configs.length){const e=new URLSearchParams(window.location.search),t=parseInt(e.get("config"),10);if(!isNaN(t)&&this.configs[t])this.loadConfig(t);else{const e=this.currentConfig??0;this.loadConfig(e)}}else{this.cols=this.default.cols,this.rows=this.default.rows,this.setup();const e=this._makeConfigObject();this.configs.push(e),this.loadConfig(0)}}setup(){if(Array.isArray(this.selection)&&this.selection.length===this.rows&&this.selection[0]?.length===this.cols||(this.selection=Array.from({length:this.rows},()=>Array.from({length:this.cols},()=>!1))),this.cols=parseInt(this.colsIn.value,10),this.rows=parseInt(this.rowsIn.value,10),!this.cols||!this.rows)return void alert("Spalten und Zeilen > 0 sein");const e=this.selection;this.selection=Array.from({length:this.rows},(t,i)=>Array.from({length:this.cols},(t,s)=>e?.[i]?.[s]||!1)),this.wrapper.style.display="block",this.listHolder.style.display="block",this.updateSize(),this.buildGrid(),this.buildList(),this.renderProductSummary(),this.updateSaveButtons()}updateSaveButtons(){null===this.currentConfig?(this.saveBtn.style.display="inline-block",this.updateBtn.style.display="none",this.deleteBtn.classList.add("hidden")):(this.saveBtn.style.display="none",this.updateBtn.style.display="inline-block",this.deleteBtn.classList.remove("hidden"));const e=document.getElementById("delete-all-configs-btn");e&&(e.style.display=this.configs.length>0?"inline-block":"none")}attachInputListeners(){this._colsRowsHandler=()=>{this.cols=parseInt(this.colsIn.value,10),this.rows=parseInt(this.rowsIn.value,10),this.setup(),this.updateSummaryOnChange()},this.colsIn.addEventListener("input",this._colsRowsHandler),this.rowsIn.addEventListener("input",this._colsRowsHandler)}addColumn(){this.cols+=1;for(let e of this.selection)e.push(!1);this.colsIn.value=this.cols,this.updateGridAfterStructureChange()}removeColumn(){if(!(this.cols<=1)){this.cols-=1;for(let e of this.selection)e.pop();this.colsIn.value=this.cols,this.updateGridAfterStructureChange()}}addRow(){this.rows+=1,this.selection.push(Array(this.cols).fill(!1)),this.rowsIn.value=this.rows,this.updateGridAfterStructureChange()}removeRow(){this.rows<=1||(this.rows-=1,this.selection.pop(),this.rowsIn.value=this.rows,this.updateGridAfterStructureChange())}updateGridAfterStructureChange(){this.updateSize(),this.buildGrid(),this.buildList(),this.updateSummaryOnChange()}saveToLocalStorage(){const e={configs:this.configs,currentConfig:this.currentConfig};localStorage.setItem("solarConfigs",JSON.stringify(e))}loadFromLocalStorage(){const e=localStorage.getItem("solarConfigs");if(e)try{const t=JSON.parse(e);Array.isArray(t.configs)&&(this.configs=t.configs,this.currentConfig=t.currentConfig??null)}catch(e){console.error("Fehler beim Laden der gespeicherten Konfiguration:",e)}}updateSize(){const e=parseFloat(getComputedStyle(document.documentElement).fontSize),t=window.innerWidth-4*e,i=parseInt(this.wIn.value,10),s=parseInt(this.hIn.value,10),n=s/i,o=this.cols*i+2*(this.cols-1);let r,c;window.innerWidth>=1100&&this.cols<=10&&o>t?(r=(t-2*(this.cols-1))/this.cols,c=r*n):(r=i,c=s),document.documentElement.style.setProperty("--cell-width",r+"px"),document.documentElement.style.setProperty("--cell-height",c+"px"),this.overflower.style.width=`calc(${this.cols}*${r}px + ${2*(this.cols-1)}px)`,this.overflower.style.height=`calc(${this.rows}*${c}px + ${2*(this.rows-1)}px)`;const l=this.wrapper.getBoundingClientRect(),a=window.innerWidth-32,h=document.querySelector(".button-group-vertical");l.width>=a-1?h.classList.add("overlay-mode"):h.classList.remove("overlay-mode")}buildGrid(){if(!Array.isArray(this.selection))return;this.gridEl.innerHTML="",document.documentElement.style.setProperty("--cols",this.cols),document.documentElement.style.setProperty("--rows",this.rows);const e=(this.cols-1)/2,t=(this.rows-1)/2;for(let i=0;i<this.rows;i++)if(Array.isArray(this.selection[i]))for(let s=0;s<this.cols;s++){const n=document.createElement("div");n.className="grid-cell animate-in",this.selection[i]?.[s]&&n.classList.add("selected"),n.addEventListener("click",()=>{this.selection[i]||(this.selection[i]=[]),this.selection[i][s]=!this.selection[i][s],n.classList.toggle("selected"),this.buildList(),this.updateSummaryOnChange()});const o=s-e,r=i-t,c=60*Math.sqrt(o*o+r*r);n.style.animationDelay=`${c}ms`,setTimeout(()=>n.classList.remove("animate-in"),400),this.gridEl.appendChild(n)}}buildList(){const t=this.calculateParts();this.incM.checked||delete t.Solarmodul,this.mc4.checked&&(t.MC4_Stecker=this.selection.flat().filter(e=>e).length),this.holz.checked&&(t.Holzunterleger=(t.Schiene_240_cm||0)+(t.Schiene_360_cm||0));const i=Object.entries(t).filter(([,e])=>e>0);i.length?(this.listHolder.style.display="block",this.prodList.innerHTML=i.map(([t,i])=>`<div class="produkt-item">\n          <span>${Math.ceil(i/e[t])}×</span>\n          <img src="${this.mapImage(t)}" alt="${t}" onerror="this.src='https://via.placeholder.com/32?text=${encodeURIComponent(t)}'">\n          <span>${t.replace(/_/g," ")} (${i})</span>\n        </div>`).join(""),this.prodList.style.display="block"):this.listHolder.style.display="none"}resetGridToDefault(){const{cols:e,rows:t,width:i,height:s}=this.default,n=[];for(let i=0;i<t;i++){n[i]=[];for(let t=0;t<e;t++)n[i][t]=this.selection?.[i]?.[t]||!1}this.colsIn.value=e,this.rowsIn.value=t,this.wIn.value=i,this.hIn.value=s,this.orH.checked=!0,this.orV.checked=!1,this.cols=e,this.rows=t,this.setup(),this.selection=n,this.buildGrid(),this.buildList(),this.updateSummaryOnChange()}resetToDefaultGrid(){this.colsIn.value=this.default.cols,this.rowsIn.value=this.default.rows,this.wIn.value=this.default.width,this.hIn.value=this.default.height,this.orH.checked=!0,this.orV.checked=!1,this.cols=this.default.cols,this.rows=this.default.rows,this.selection=Array.from({length:this.rows},()=>Array.from({length:this.cols},()=>!1)),this.setup()}deleteAllConfigs(){confirm("Möchtest du wirklich alle Konfigurationen löschen?")&&(this.configs=[],localStorage.removeItem("solarConfigs"),this.currentConfig=null,this.resetToDefaultGrid(),this.renderConfigList(),this.updateSaveButtons())}calculateParts(){const e={Solarmodul:0,Endklemmen:0,Mittelklemmen:0,Dachhaken:0,Schrauben:0,Endkappen:0,Schienenverbinder:0,Schiene_240_cm:0,Schiene_360_cm:0};for(let t=0;t<this.rows;t++){if(!Array.isArray(this.selection[t]))continue;let i=0;for(let s=0;s<this.cols;s++)this.selection[t]?.[s]?i++:i&&(this.processGroup(i,e),i=0);i&&this.processGroup(i,e)}return e}processGroup(e,t){const i=e*parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--cell-width")),s=Math.floor(i/360),n=i-360*s,o=[{cnt360:s,cnt240:Math.ceil(n/240)},{cnt360:Math.ceil(i/360),cnt240:0},{cnt360:0,cnt240:Math.ceil(i/240)}].map(e=>({...e,rails:e.cnt360+e.cnt240,waste:360*e.cnt360+240*e.cnt240-i})),r=Math.min(...o.map(e=>e.rails)),c=o.filter(e=>e.rails===r).reduce((e,t)=>e.waste<=t.waste?e:t),{cnt360:l,cnt240:a}=c;t.Schiene_360_cm+=2*l,t.Schiene_240_cm+=2*a,t.Schienenverbinder+=4*(l+a-1),t.Endklemmen+=4,t.Mittelklemmen+=e>1?2*(e-1):0,t.Dachhaken+=e>1?3*e:4,t.Endkappen+=t.Endklemmen,t.Solarmodul+=e,t.Schrauben+=2*t.Dachhaken}mapImage(e){return{Solarmodul:"https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png",Endklemmen:"https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c316b21cb7d04ba2ed22_DSC04815-min.jpg",Schrauben:"https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c2704f5147533229ccde_DSC04796-min.jpg",Dachhaken:"https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c1c8a2835b7879f46811_DSC04760-min.jpg",Mittelklemmen:"https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c0d0c2d922d926976bd4_DSC04810-min.jpg",Endkappen:"https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853bdfbe7cffc653f6a4605_DSC04788-min.jpg",Schienenverbinder:"https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853c21f0c39e927fce0db3b_DSC04780-min.jpg",Schiene_240_cm:"https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853bce018164af4b4a187f1_DSC04825-min.jpg",Schiene_360_cm:"https://cdn.prod.website-files.com/684989b78146a1d9194e7b47/6853bcd5726d1d33d4b86ba4_DSC04824-min.jpg",MC4_Stecker:"https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png",Holzunterleger:"https://cdn.prod.website-files.com/68498852db79a6c114f111ef/6859af7eeb0350c3aa298572_Solar%20Panel.png"}[e]||""}loadConfig(e){const t=this.configs[e];this.currentConfig=e,this.colsIn.value=t.cols,this.rowsIn.value=t.rows,this.wIn.value=t.cellWidth,this.hIn.value=t.cellHeight,this.orV.checked="vertical"===t.orientation,this.orH.checked=!this.orV.checked,this.incM.checked=t.incM,this.mc4.checked=t.mc4,this.holz.checked=t.holz,this.cols=t.cols,this.rows=t.rows,this.selection=t.selection.map(e=>[...e]),this.setup(),this.renderConfigList(),this.updateSaveButtons()}showToast(e="Gespeichert ✅",t=1500){const i=document.getElementById("toast");i&&(i.textContent=e,i.classList.remove("hidden"),clearTimeout(this.toastTimeout),this.toastTimeout=setTimeout(()=>{i.classList.add("hidden")},t))}saveNewConfig(){const e=this._makeConfigObject();this.configs.push(e),this.renderConfigList(),this.updateSaveButtons(),this.currentConfig=null,this.resetGridToDefault(),this.showToast("Konfiguration gespeichert ✅"),this.saveToLocalStorage()}updateConfig(){const e=this.currentConfig;this.configs[e]=this._makeConfigObject(),this.currentConfig=null,this.resetToDefaultGrid(),this.renderConfigList(),this.updateSaveButtons(),this.saveToLocalStorage()}deleteCurrentConfig(){null!==this.currentConfig&&confirm("Willst du die Konfiguration wirklich löschen?")&&(this.configs.splice(this.currentConfig,1),this.saveToLocalStorage(),this.currentConfig=null,this.resetGridToDefault(),this.renderConfigList(),this.updateSaveButtons())}_makeConfigObject(){return{name:null!==this.currentConfig?this.configs[this.currentConfig].name:`Konfiguration ${this.configs.length+1}`,selection:this.selection.map(e=>[...e]),orientation:this.orV.checked?"vertical":"horizontal",incM:this.incM.checked,mc4:this.mc4.checked,holz:this.holz.checked,cols:parseInt(this.colsIn.value,10),rows:parseInt(this.rowsIn.value,10),cellWidth:parseInt(this.wIn.value,10),cellHeight:parseInt(this.hIn.value,10)}}renderConfigList(){this.configListEl.innerHTML="",this.configs.forEach((e,t)=>{const i=document.createElement("div");i.className="config-item"+(t===this.currentConfig?" active":""),i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="space-between",i.style.gap="0.5rem";const s=document.createElement("div");s.style.display="flex",s.style.alignItems="center",s.style.gap="0.25rem",s.style.flex="1";const n=document.createElement("span");n.textContent=e.name,n.style.cursor="pointer",n.addEventListener("click",()=>{if(null!==this.currentConfig){const e=this.currentConfig;this.currentConfig=e,this.updateConfig()}this.loadConfig(t),this.updateSaveButtons(),this.showToast("Automatisch gespeichert ✅",1500)});const o=document.createElement("button");o.innerHTML="✎",o.title="Namen bearbeiten",Object.assign(o.style,{border:"none",background:"none",cursor:"pointer",fontSize:"1rem",color:"#fff",padding:"0",marginLeft:"0.5rem",lineHeight:"1"}),o.addEventListener("click",t=>{t.stopPropagation();const i=document.createElement("input");i.type="text",i.value=e.name,i.style.flex="1",i.addEventListener("keydown",t=>{"Enter"===t.key&&(e.name=i.value.trim()||e.name,this.renderConfigList())}),i.addEventListener("blur",()=>{e.name=i.value.trim()||e.name,this.renderConfigList()}),s.replaceChild(i,n),i.focus()});const r=document.createElement("button");r.textContent="🔗",r.title="Konfiguration teilen",Object.assign(r.style,{background:"none",border:"none",cursor:"pointer",color:"inherit"}),r.addEventListener("click",e=>{e.stopPropagation();const i=JSON.stringify(this.configs[t]),s=btoa(encodeURIComponent(i)),n=`${window.location.origin}${window.location.pathname}?configData=${s}`;navigator.clipboard.writeText(n),this.showToast("Link kopiert ✅",1500)}),s.appendChild(n),s.appendChild(o),i.appendChild(s),i.appendChild(r),this.configListEl.appendChild(i)})}updateSummaryOnChange(){this.renderProductSummary()}renderProductSummary(){const i=this.incM.checked,s=this.mc4.checked,n=this.holz.checked,o=this.configs.map(e=>({selection:e.selection,orientation:e.orientation,incM:e.incM,mc4:e.mc4,holz:e.holz}));null===this.currentConfig&&o.push({selection:this.selection,orientation:this.orV.checked?"vertical":"horizontal",incM:i,mc4:s,holz:n});const r={};o.forEach(e=>{this.orV.checked="vertical"===e.orientation,this.orH.checked=!this.orV.checked,this.selection=e.selection,this.updateSize();let t=this.calculateParts();e.incM||delete t.Solarmodul,e.mc4&&(t.MC4_Stecker=e.selection.flat().filter(e=>e).length),e.holz&&(t.Holzunterleger=(t.Schiene_240_cm||0)+(t.Schiene_360_cm||0)),Object.entries(t).forEach(([e,t])=>{r[e]=(r[e]||0)+t})});const c=Object.entries(r).filter(([,e])=>e>0),l=Math.ceil(c.length/4);let a=0,h="";for(let i=0;i<l;i++){h+=`<div class="summary-column">${c.slice(4*i,4*(i+1)).map(([i,s])=>{const n=Math.ceil(s/e[i]),o=n*(t[i]||0);return a+=o,`<div class="produkt-item">\n        \t\t<span>${n}×</span>\n        \t\t<img src="${this.mapImage(i)}" alt="${i}" onerror="this.src='https://via.placeholder.com/32?text=${encodeURIComponent(i)}'">\n        \t\t<span>${i.replace(/_/g," ")} (${s})</span>\n        \t\t<span style="margin-left:auto; font-weight:bold;">${o.toFixed(2)} €</span>\n      \t\t</div>`}).join("")}</div>`}h+=`<div class="summary-total">Gesamtpreis: ${a.toFixed(2)} €</div>`,this.summaryList.innerHTML=h,this.summaryHolder.style.display=c.length?"block":"none",this.summaryList.style.display=c.length?"flex":"none"}initFoxyFormMap(){this.foxyFormsByName=new Map;let e=15;const t=()=>{this.refreshFoxyFormMap(),0===this.foxyFormsByName.size&&e-- >0&&setTimeout(t,300)};t();try{this._foxyObserver&&this._foxyObserver.disconnect()}catch(e){}let i=null;const s=()=>{clearTimeout(i),i=setTimeout(()=>this.refreshFoxyFormMap(),50)};this._foxyObserver=new MutationObserver(e=>{for(const t of e)if(t.addedNodes&&t.addedNodes.length){s();break}}),this._foxyObserver.observe(document.body,{childList:!0,subtree:!0})}refreshFoxyFormMap(){const e=new Map;document.querySelectorAll('form[action*="foxycart.com/cart"]').forEach(t=>{const i=t.querySelector('input[name="name"]'),s=i&&"string"==typeof i.value?i.value.trim():"";s&&e.set(s,t)}),this.foxyFormsByName=e}attachCartButtonListeners(){}addProductToCart(e,t){const s=i[e]||e.replace(/_/g," ");let n=this.findFoxyFormByName(s);if(n)try{const e=n.querySelector('input[name="quantity"]');e&&(e.value=Math.max(1,parseInt(t,10)||1));const i=n.querySelector('input[name="customer_type"]');try{const e=localStorage.getItem("solarTool_customerType");if(i&&e){const t=JSON.parse(e),s=t&&t.type?String(t.type):"";s&&(i.value=s)}}catch(e){}const o=n.querySelector("button[data-fc-add-to-cart]")||n.querySelector('button[type="submit"]');"function"==typeof n.requestSubmit?n.requestSubmit(o||void 0):o&&o.click()||n.submit(),console.log(`[SolarGrid] ${e?e.value:t}× '${s}' an Foxy übergeben.`)}catch(e){console.warn(`[SolarGrid] Foxy-Submit fehlgeschlagen für '${s}':`,e)}else console.warn(`[SolarGrid] Foxy-Formular für Produktname '${s}' nicht gefunden.`)}findFoxyFormByName(e){const t=String(e||"").trim();if(!t)return null;if(this.foxyFormsByName&&this.foxyFormsByName.has(t))return this.foxyFormsByName.get(t);try{const e=`form[action*="foxycart.com/cart"] input[name="name"][value="${CSS.escape(t)}"]`,i=document.querySelector(e);if(i)return i.closest("form")}catch(e){}const i=document.querySelectorAll('form[action*="foxycart.com/cart"]'),s=t.toLowerCase();for(const e of i){const t=e.querySelector('input[name="name"]')?.value?.trim();if(t&&t.toLowerCase()===s)return e}const n=e=>e.replace(/\s+/g," ").trim().toLowerCase(),o=n(t);for(const e of i){const t=e.querySelector('input[name="name"]')?.value;if(t&&n(t).includes(o))return e}return null}addPartsListToCart(t){const i=Object.entries(t).filter(([e,t])=>t>0);i.length?(console.log("[SolarGrid] Füge folgende Teile zum Warenkorb hinzu:",t),i.forEach(([t,i],s)=>{const n=Math.ceil(i/e[t]);console.log(`[SolarGrid] ${t}: ${i} Stück benötigt, ${n} Packungen à ${e[t]} Stück`),setTimeout(()=>this.addProductToCart(t,n),800*s)})):console.info("[SolarGrid] Keine Produkte zum Hinzufügen gefunden.")}addCurrentToCart(){const e=this._buildPartsFor(this.selection,this.incM.checked,this.mc4.checked,this.holz.checked);0!==Object.values(e).reduce((e,t)=>e+t,0)?(this.addPartsListToCart(e),this.showToast("Produkte zum Warenkorb hinzugefügt ✅",2e3)):this.showToast("Keine Produkte ausgewählt ⚠️",2e3)}addAllToCart(){const e=this.configs.map(e=>this._buildPartsFor(e.selection,e.incM,e.mc4,e.holz));null===this.currentConfig&&e.push(this._buildPartsFor(this.selection,this.incM.checked,this.mc4.checked,this.holz.checked));const t={};e.forEach(e=>{Object.entries(e).forEach(([e,i])=>{t[e]=(t[e]||0)+i})});0!==Object.values(t).reduce((e,t)=>e+t,0)?(this.addPartsListToCart(t),this.showToast("Alle Konfigurationen zum Warenkorb hinzugefügt ✅",2e3)):this.showToast("Keine Konfigurationen vorhanden ⚠️",2e3)}_buildPartsFor(e,t,i,s){this.selection=e;let n=this.calculateParts();return t||delete n.Solarmodul,i&&(n.MC4_Stecker=e.flat().filter(e=>e).length),s&&(n.Holzunterleger=(n.Schiene_240_cm||0)+(n.Schiene_360_cm||0)),n}_buildCartItems(t){return Object.entries(t).map(([t,i])=>{const s=Math.ceil(i/e[t]),n=PRODUCT_MAP[t];return!n||s<=0?null:{productId:n.productId,variantId:n.variantId,quantity:s}}).filter(Boolean)}}document.addEventListener("DOMContentLoaded",()=>{const e=new s;e.initFoxyFormMap(),window.solarGrid=e,window.debugFoxyForms=()=>{const e=document.querySelectorAll('form[action*="foxycart.com/cart"]');return console.log(`[Debug] Foxy-Formulare gefunden: ${e.length}`),e.forEach((e,t)=>{const i=e.querySelector('input[name="name"]')?.value,s=e.querySelector('input[name="code"]')?.value,n=e.querySelector('input[name="quantity"]')?.value;console.log(`[Debug] Form ${t+1}: name='${i}', sku='${s}', qty=${n}`)}),e},window.testAddToCart=(t="Solarmodul",i=1)=>{console.log(`[Debug] Teste Hinzufügung: ${i}x ${t}`),e.addProductToCart(t,i)},console.log("[SolarGrid] Initialisierung abgeschlossen. Debug-Funktionen verfügbar:"),console.log("- window.debugFoxyForms() - Zeigt alle Foxy-Formulare"),console.log("- window.testAddToCart(productKey, quantity) - Testet Hinzufügung eines Produkts")})}();